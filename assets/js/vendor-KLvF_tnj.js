const t={},e=function(e,i,n){let s=Promise.resolve();if(i&&i.length>0){let e=function(t){return Promise.all(t.map((t=>Promise.resolve(t).then((t=>({status:"fulfilled",value:t})),(t=>({status:"rejected",reason:t}))))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),r=n?.nonce||n?.getAttribute("nonce");s=e(i.map((e=>{if((e=function(t){return"/"+t}(e))in t)return;t[e]=!0;const i=e.endsWith(".css"),n=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const s=document.createElement("link");return s.rel=i?"stylesheet":"modulepreload",i||(s.as="script"),s.crossOrigin="",s.href=e,r&&s.setAttribute("nonce",r),document.head.appendChild(s),i?new Promise(((t,i)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>i(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))};var i;function n(t,e,i){const n=typeof i,s=typeof t;if("undefined"!==n){if("undefined"!==s){if(i){if("function"===s&&n===s)return function(e){return t(i(e))};if((e=t.constructor)===i.constructor){if(e===Array)return i.concat(t);if(e===Map){var r=new Map(i);for(var h of t)r.set(h[0],h[1]);return r}if(e===Set){for(r of(h=new Set(i),t.values()))h.add(r);return h}}}return t}return i}return"undefined"===s?e:t}function s(t,e){return void 0===t?e:t}function r(){return Object.create(null)}function h(t){return"string"==typeof t}function o(t){return"object"==typeof t}function l(t,e){if(h(e))t=t[e];else for(let i=0;t&&i<e.length;i++)t=t[e[i]];return t}const c=/[^\p{L}\p{N}]+/u,f=/(\d{3})/g,u=/(\D)(\d{3})/g,a=/(\d{3})(\D)/g,g=/[\u0300-\u036f]/g;function d(t={}){if(!this||this.constructor!==d)return new d(...arguments);if(arguments.length)for(t=0;t<arguments.length;t++)this.assign(arguments[t]);else this.assign(t)}function p(t){t.F=null,t.B.clear(),t.D.clear()}function m(t,e,i){i||(e||"object"!=typeof t?"object"==typeof e&&(i=e,e=0):i=t),i&&(t=i.query||t,e=i.limit||e);let n=""+(e||0);i&&(n+=(i.offset||0)+!!i.context+!!i.suggest+(!1!==i.resolve)+(i.resolution||this.resolution)+(i.boost||0)),t=(""+t).toLowerCase(),this.cache||(this.cache=new w);let s=this.cache.get(t+n);if(!s){const r=i&&i.cache;r&&(i.cache=!1),s=this.search(t,e,i),r&&(i.cache=r),this.cache.set(t+n,s)}return s}function w(t){this.limit=t&&!0!==t?t:1e3,this.cache=new Map,this.h=""}(i=d.prototype).assign=function(t){this.normalize=n(t.normalize,!0,this.normalize);let e,i=t.include,s=i||t.exclude||t.split;if(s||""===s){if("object"==typeof s&&s.constructor!==RegExp){let t="";e=!i,i||(t+="\\p{Z}"),s.letter&&(t+="\\p{L}"),s.number&&(t+="\\p{N}",e=!!i),s.symbol&&(t+="\\p{S}"),s.punctuation&&(t+="\\p{P}"),s.control&&(t+="\\p{C}"),(s=s.char)&&(t+="object"==typeof s?s.join(""):s);try{this.split=new RegExp("["+(i?"^":"")+t+"]+","u")}catch(r){this.split=/\s+/}}else this.split=s,e=!1===s||"a1a".split(s).length<2;this.numeric=n(t.numeric,e)}else{try{this.split=n(this.split,c)}catch(h){this.split=/\s+/}this.numeric=n(t.numeric,n(this.numeric,!0))}if(this.prepare=n(t.prepare,null,this.prepare),this.finalize=n(t.finalize,null,this.finalize),s=t.filter,this.filter="function"==typeof s?s:n(s&&new Set(s),null,this.filter),this.dedupe=n(t.dedupe,!0,this.dedupe),this.matcher=n((s=t.matcher)&&new Map(s),null,this.matcher),this.mapper=n((s=t.mapper)&&new Map(s),null,this.mapper),this.stemmer=n((s=t.stemmer)&&new Map(s),null,this.stemmer),this.replacer=n(t.replacer,null,this.replacer),this.minlength=n(t.minlength,1,this.minlength),this.maxlength=n(t.maxlength,1024,this.maxlength),this.rtl=n(t.rtl,!1,this.rtl),(this.cache=s=n(t.cache,!0,this.cache))&&(this.F=null,this.L="number"==typeof s?s:2e5,this.B=new Map,this.D=new Map,this.I=this.H=128),this.h="",this.J=null,this.A="",this.K=null,this.matcher)for(const n of this.matcher.keys())this.h+=(this.h?"|":"")+n;if(this.stemmer)for(const n of this.stemmer.keys())this.A+=(this.A?"|":"")+n;return this},i.addStemmer=function(t,e){return this.stemmer||(this.stemmer=new Map),this.stemmer.set(t,e),this.A+=(this.A?"|":"")+t,this.K=null,this.cache&&p(this),this},i.addFilter=function(t){return"function"==typeof t?this.filter=t:(this.filter||(this.filter=new Set),this.filter.add(t)),this.cache&&p(this),this},i.addMapper=function(t,e){return"object"==typeof t?this.addReplacer(t,e):t.length>1?this.addMatcher(t,e):(this.mapper||(this.mapper=new Map),this.mapper.set(t,e),this.cache&&p(this),this)},i.addMatcher=function(t,e){return"object"==typeof t?this.addReplacer(t,e):t.length<2&&(this.dedupe||this.mapper)?this.addMapper(t,e):(this.matcher||(this.matcher=new Map),this.matcher.set(t,e),this.h+=(this.h?"|":"")+t,this.J=null,this.cache&&p(this),this)},i.addReplacer=function(t,e){return"string"==typeof t?this.addMatcher(t,e):(this.replacer||(this.replacer=[]),this.replacer.push(t,e),this.cache&&p(this),this)},i.encode=function(t,e){if(this.cache&&t.length<=this.H)if(this.F){if(this.B.has(t))return this.B.get(t)}else this.F=setTimeout(p,50,this);this.normalize&&(t="function"==typeof this.normalize?this.normalize(t):g?t.normalize("NFKD").replace(g,"").toLowerCase():t.toLowerCase()),this.prepare&&(t=this.prepare(t)),this.numeric&&t.length>3&&(t=t.replace(u,"$1 $2").replace(a,"$1 $2").replace(f,"$1 "));const i=!(this.dedupe||this.mapper||this.filter||this.matcher||this.stemmer||this.replacer);let n,s,h=[],o=r(),l=this.split||""===this.split?t.split(this.split):[t];for(let r,f,u=0;u<l.length;u++)if((r=f=l[u])&&!(r.length<this.minlength||r.length>this.maxlength)){if(e){if(o[r])continue;o[r]=1}else{if(n===r)continue;n=r}if(i)h.push(r);else if(!this.filter||("function"==typeof this.filter?this.filter(r):!this.filter.has(r))){if(this.cache&&r.length<=this.I)if(this.F){var c=this.D.get(r);if(c||""===c){c&&h.push(c);continue}}else this.F=setTimeout(p,50,this);if(this.stemmer){let t;for(this.K||(this.K=new RegExp("(?!^)("+this.A+")$"));t!==r&&r.length>2;)t=r,r=r.replace(this.K,(t=>this.stemmer.get(t)))}if(r&&(this.mapper||this.dedupe&&r.length>1)){c="";for(let t,e,i=0,n="";i<r.length;i++)t=r.charAt(i),t===n&&this.dedupe||((e=this.mapper&&this.mapper.get(t))||""===e?e===n&&this.dedupe||!(n=e)||(c+=e):c+=n=t);r=c}if(this.matcher&&r.length>1&&(this.J||(this.J=new RegExp("("+this.h+")","g")),r=r.replace(this.J,(t=>this.matcher.get(t)))),r&&this.replacer)for(c=0;r&&c<this.replacer.length;c+=2)r=r.replace(this.replacer[c],this.replacer[c+1]);if(this.cache&&f.length<=this.I&&(this.D.set(f,r),this.D.size>this.L&&(this.D.clear(),this.I=this.I/1.1|0)),r){if(r!==f)if(e){if(o[r])continue;o[r]=1}else{if(s===r)continue;s=r}h.push(r)}}}return this.finalize&&(h=this.finalize(h)||h),this.cache&&t.length<=this.H&&(this.B.set(t,h),this.B.size>this.L&&(this.B.clear(),this.H=this.H/1.1|0)),h},w.prototype.set=function(t,e){this.cache.set(this.h=t,e),this.cache.size>this.limit&&this.cache.delete(this.cache.keys().next().value)},w.prototype.get=function(t){const e=this.cache.get(t);return e&&this.h!==t&&(this.cache.delete(t),this.cache.set(this.h=t,e)),e},w.prototype.remove=function(t){for(const e of this.cache){const i=e[0];e[1].includes(t)&&this.cache.delete(i)}},w.prototype.clear=function(){this.cache.clear(),this.h=""};const y={normalize:!1,numeric:!1,dedupe:!1},b={},x=new Map([["b","p"],["v","f"],["w","f"],["z","s"],["x","s"],["d","t"],["n","m"],["c","k"],["g","k"],["j","k"],["q","k"],["i","e"],["y","e"],["u","o"]]),v=new Map([["ae","a"],["oe","o"],["sh","s"],["kh","k"],["th","t"],["ph","f"],["pf","f"]]),k=[/([^aeo])h(.)/g,"$1$2",/([aeo])h([^aeo]|$)/g,"$1$2",/(.)\1+/g,"$1"],A={a:"",e:"",i:"",o:"",u:"",y:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,"ÃŸ":2,d:3,t:3,l:4,m:5,n:5,r:6};var j={Exact:y,Default:b,Normalize:b,LatinBalance:{mapper:x},LatinAdvanced:{mapper:x,matcher:v,replacer:k},LatinExtra:{mapper:x,replacer:k.concat([/(?!^)[aeo]/g,""]),matcher:v},LatinSoundex:{dedupe:!1,include:{letter:!0},finalize:function(t){for(let i=0;i<t.length;i++){var e=t[i];let n=e.charAt(0),s=A[n];for(let t,i=1;i<e.length&&(t=e.charAt(i),"h"===t||"w"===t||!(t=A[t])||t===s||(n+=t,s=t,4!==n.length));i++);t[i]=n}}},CJK:{split:""},LatinExact:y,LatinDefault:b,LatinSimple:b};function z(t,e,i,n){let s=[];for(let r,h=0;h<t.index.length;h++)if(r=t.index[h],e>=r.length)e-=r.length;else{const h=(e=r[n?"splice":"slice"](e,i)).length;if(h&&(s=s.length?s.concat(e):e,i-=h,n&&(t.length-=h),!i))break;e=0}return s}function M(t){if(!this||this.constructor!==M)return new M(t);this.index=t?[t]:[],this.length=t?t.length:0;const e=this;return new Proxy([],{get:(t,i)=>"length"===i?e.length:"push"===i?function(t){e.index[e.index.length-1].push(t),e.length++}:"pop"===i?function(){if(e.length)return e.length--,e.index[e.index.length-1].pop()}:"indexOf"===i?function(t){let i=0;for(let n,s,r=0;r<e.index.length;r++){if(n=e.index[r],s=n.indexOf(t),s>=0)return i+s;i+=n.length}return-1}:"includes"===i?function(t){for(let i=0;i<e.index.length;i++)if(e.index[i].includes(t))return!0;return!1}:"slice"===i?function(t,i){return z(e,t||0,i||e.length,!1)}:"splice"===i?function(t,i){return z(e,t||0,i||e.length,!0)}:"constructor"===i?Array:"symbol"!=typeof i?(t=e.index[i/2**31|0])&&t[i]:void 0,set:(t,i,n)=>(t=i/2**31|0,(e.index[t]||(e.index[t]=[]))[i]=n,e.length++,!0)})}function S(t=8){if(!this||this.constructor!==S)return new S(t);this.index=r(),this.h=[],this.size=0,t>32?(this.B=C,this.A=BigInt(t)):(this.B=B,this.A=t)}function _(t=8){if(!this||this.constructor!==_)return new _(t);this.index=r(),this.h=[],this.size=0,t>32?(this.B=C,this.A=BigInt(t)):(this.B=B,this.A=t)}function B(t){let e=2**this.A-1;if("number"==typeof t)return t&e;let i=0,n=this.A+1;for(let s=0;s<t.length;s++)i=(i*n^t.charCodeAt(s))&e;return 32===this.A?i+2**31:i}function C(t){let e=BigInt(2)**this.A-BigInt(1);var i=typeof t;if("bigint"===i)return t&e;if("number"===i)return BigInt(t)&e;i=BigInt(0);let n=this.A+BigInt(1);for(let s=0;s<t.length;s++)i=(i*n^BigInt(t.charCodeAt(s)))&e;return i}let O,P,D,L,q;async function E(t){var e=(t=t.data).task;const i=t.id;let n=t.args;if("init"===e)P=t.options||{},(e=t.factory)?(Function("return "+e)()(self),O=new self.FlexSearch.Index(P),delete self.FlexSearch):O=new Mt(P),postMessage({id:i});else{let s;"export"===e&&(n[1]?(n[0]=P.export,n[2]=0,n[3]=1):n=null),"import"===e?n[0]&&(t=await P.import.call(O,n[0]),O.import(n[0],t)):((s=n&&O[e].apply(O,n))&&s.then&&(s=await s),s&&s.await&&(s=await s.await),"search"===e&&s.result&&(s=s.result)),postMessage("search"===e?{id:i,msg:s}:{id:i})}}function I(t){F.call(t,"add"),F.call(t,"append"),F.call(t,"search"),F.call(t,"update"),F.call(t,"remove"),F.call(t,"searchCache")}function $(){D=q=0}function F(t){this[t+"Async"]=function(){const e=arguments;var i=e[e.length-1];let n;if("function"==typeof i&&(n=i,delete e[e.length-1]),D?q||(q=Date.now()-L>=this.priority*this.priority*3):(D=setTimeout($,0),L=Date.now()),q){const i=this;return new Promise((n=>{setTimeout((function(){n(i[t+"Async"].apply(i,e))}),0)}))}const s=this[t].apply(this,e);return i=s.then?s:new Promise((t=>t(s))),n&&i.then(n),i}}M.prototype.clear=function(){this.index.length=0},M.prototype.push=function(){},S.prototype.get=function(t){const e=this.index[this.B(t)];return e&&e.get(t)},S.prototype.set=function(t,e){var i=this.B(t);let n=this.index[i];n?(i=n.size,n.set(t,e),(i-=n.size)&&this.size++):(this.index[i]=n=new Map([[t,e]]),this.h.push(n),this.size++)},_.prototype.add=function(t){var e=this.B(t);let i=this.index[e];i?(e=i.size,i.add(t),(e-=i.size)&&this.size++):(this.index[e]=i=new Set([t]),this.h.push(i),this.size++)},(i=S.prototype).has=_.prototype.has=function(t){const e=this.index[this.B(t)];return e&&e.has(t)},i.delete=_.prototype.delete=function(t){const e=this.index[this.B(t)];e&&e.delete(t)&&this.size--},i.clear=_.prototype.clear=function(){this.index=r(),this.h=[],this.size=0},i.values=_.prototype.values=function*(){for(let t=0;t<this.h.length;t++)for(let e of this.h[t].values())yield e},i.keys=_.prototype.keys=function*(){for(let t=0;t<this.h.length;t++)for(let e of this.h[t].keys())yield e},i.entries=_.prototype.entries=function*(){for(let t=0;t<this.h.length;t++)for(let e of this.h[t].entries())yield e};let N=0;function T(t={},i){function n(e){function n(t){const e=(t=t.data||t).id,i=e&&o.h[e];i&&(i(t.msg),delete o.h[e])}if(this.worker=e,this.h=r(),this.worker)return h?this.worker.on("message",n):this.worker.onmessage=n,t.config?new Promise((function(e){N>1e9&&(N=0),o.h[++N]=function(){e(o)},o.worker.postMessage({id:N,task:"init",factory:s,options:t})})):(this.priority=t.priority||4,this.encoder=i||null,this.worker.postMessage({task:"init",factory:s,options:t}),this)}if(!this||this.constructor!==T)return new T(t);let s="undefined"!=typeof self?self._factory:"undefined"!=typeof window?window._factory:null;s&&(s=s.toString());const h="undefined"==typeof window,o=this,l=function(t,i,n){return i?"undefined"!=typeof module?new(require("worker_threads").Worker)(__dirname+"/worker/node.js"):e((()=>import("./__vite-browser-external-FmFgRqLi.js")),[]).then((function(t){return new t.Worker(import.meta.dirname+"/node/node.mjs")})):t?new window.Worker(URL.createObjectURL(new Blob(["onmessage="+E.toString()],{type:"text/javascript"}))):new window.Worker("string"==typeof n?n:import.meta.url.replace("/worker.js","/worker/worker.js").replace("flexsearch.bundle.module.min.js","module/worker/worker.js").replace("flexsearch.bundle.module.min.mjs","module/worker/worker.js"),{type:"module"})}(s,h,t.worker);return l.then?l.then((function(t){return n.call(o,t)})):n.call(this,l)}function J(t){T.prototype[t]=function(){const e=this,i=[].slice.call(arguments);var n=i[i.length-1];let s;return"function"==typeof n&&(s=n,i.pop()),n=new Promise((function(n){"export"===t&&"function"==typeof i[0]&&(i[0]=null),N>1e9&&(N=0),e.h[++N]=n,e.worker.postMessage({task:t,id:N,args:i})})),s?(n.then(s),this):n}}function R(t,e,i,n,s,h){if(t=t[s],n===i.length-1)e[s]=h||t;else if(t)if(t.constructor===Array)for(e=e[s]=Array(t.length),s=0;s<t.length;s++)R(t,e,i,n,s);else e=e[s]||(e[s]=r()),s=i[++n],R(t,e,i,n,s)}function K(t,e,i,n,s,r,h,o){if(t=t[h])if(n===e.length-1){if(t.constructor===Array){if(i[n]){for(e=0;e<t.length;e++)s.add(r,t[e],!0,!0);return}t=t.join(" ")}s.add(r,t,o,!0)}else if(t.constructor===Array)for(h=0;h<t.length;h++)K(t,e,i,n,s,r,h,o);else h=e[++n],K(t,e,i,n,s,r,h,o)}function G(t,e,i,n){if(!t.length)return t;if(1===t.length)return t=t[0],t=i||t.length>e?t.slice(i,i+e):t,n?ht.call(this,t):t;let s=[];for(let r,h,o=0;o<t.length;o++)if((r=t[o])&&(h=r.length)){if(i){if(i>=h){i-=h;continue}r=r.slice(i,i+e),h=r.length,i=0}if(h>e&&(r=r.slice(0,e),h=e),!s.length&&h>=e)return n?ht.call(this,r):r;if(s.push(r),!(e-=h))break}return s=s.length>1?[].concat.apply([],s):s[0],n?ht.call(this,s):s}function H(t,e,i,n){var s=n[0];if(s[0]&&s[0].query)return t[e].apply(t,s);if(!("and"!==e&&"not"!==e||t.result.length||t.await||s.suggest))return n.length>1&&(s=n[n.length-1]),(n=s.resolve)?t.await||t.result:t;let r,h,o,l,c,f=[],u=0,a=0;for(e=0;e<n.length;e++)if(s=n[e]){var g=void 0;if(s.constructor===Y)g=s.await||s.result;else if(s.then||s.constructor===Array)g=s;else{u=s.limit||0,a=s.offset||0,o=s.suggest,h=s.resolve,r=((l=s.highlight||t.highlight)||s.enrich)&&h,g=s.queue;let i=s.async||g,n=s.index,d=s.query;if(n?t.index||(t.index=n):n=t.index,d||s.tag){const r=s.field||s.pluck;if(r&&(!d||t.query&&!l||(t.query=d,t.field=r,t.highlight=l),n=n.index.get(r)),g&&(c||t.await)){let r;c=1;const h=t.C.length,o=new Promise((function(t){r=t}));!function(e,n){o.h=function(){n.index=null,n.resolve=!1;let s=i?e.searchAsync(n):e.search(n);return s.then?s.then((function(e){return t.C[h]=e=e.result||e,r(e),e})):(s=s.result||s,r(s),s)}}(n,Object.assign({},s)),t.C.push(o),f[e]=o;continue}s.resolve=!1,s.index=null,g=i?n.searchAsync(s):n.search(s),s.resolve=h,s.index=n}else if(s.and)g=W(s,"and",n);else if(s.or)g=W(s,"or",n);else if(s.not)g=W(s,"not",n);else{if(!s.xor)continue;g=W(s,"xor",n)}}g.await?(c=1,g=g.await):g.then?(c=1,g=g.then((function(t){return t.result||t}))):g=g.result||g,f[e]=g}if(c&&!t.await&&(t.await=new Promise((function(e){t.return=e}))),c){const e=Promise.all(f).then((function(n){for(let s=0;s<t.C.length;s++)if(t.C[s]===e){t.C[s]=function(){return i.call(t,n,u,a,r,h,o,l)};break}tt(t)}));t.C.push(e)}else{if(!t.await)return i.call(t,f,u,a,r,h,o,l);t.C.push((function(){return i.call(t,f,u,a,r,h,o,l)}))}return h?t.await||t.result:t}function W(t,e,i){const n=(t=t[e])[0]||t;return n.index||(n.index=i),i=new Y(n),t.length>1&&(i=i[e].apply(i,t.slice(1))),i}function U(t,e,i,n,s,r,h){return t.length&&(this.result.length&&t.push(this.result),t.length<2?this.result=t[0]:(this.result=it(t,e,i,!1,this.h),i=0)),s&&(this.await=null),s?this.resolve(e,i,n,h):this}function V(t,e,i,n,s,r,h){if(!r&&!this.result.length)return s?this.result:this;let o;if(t.length)if(this.result.length&&t.unshift(this.result),t.length<2)this.result=t[0];else{let n=0;for(let e,i,s=0;s<t.length;s++)if((e=t[s])&&(i=e.length))n<i&&(n=i);else if(!r){n=0;break}n?(this.result=et(t,n,e,i,r,this.h,s),o=!0):this.result=[]}else r||(this.result=t);return s&&(this.await=null),s?this.resolve(e,i,n,h,o):this}function Z(t,e,i,n,s,h,o){if(t.length)if(this.result.length&&t.unshift(this.result),t.length<2)this.result=t[0];else{t:{h=i;var l=this.h;const n=[],o=r();let c=0;for(let e,i=0;i<t.length;i++)if(e=t[i]){c<e.length&&(c=e.length);for(let t,i=0;i<e.length;i++)if(t=e[i])for(let e,n=0;n<t.length;n++)e=t[n],o[e]=o[e]?2:1}for(let i,r=0,f=0;r<c;r++)for(let c,u=0;u<t.length;u++)if((c=t[u])&&(i=c[r]))for(let a,g=0;g<i.length;g++)if(a=i[g],1===o[a])if(h)h--;else if(s){if(n.push(a),n.length===e){t=n;break t}}else{const i=r+(u?l:0);if(n[i]||(n[i]=[]),n[i].push(a),++f===e){t=n;break t}}t=n}this.result=t,l=!0}else h||(this.result=t);return s&&(this.await=null),s?this.resolve(e,i,n,o,l):this}function Q(t,e,i,n,s,r,h){if(!r&&!this.result.length)return s?this.result:this;if(t.length&&this.result.length){t:{r=i;var o=[];t=new Set(t.flat().flat());for(let i,n=0,h=0;n<this.result.length;n++)if(i=this.result[n])for(let l,c=0;c<i.length;c++)if(l=i[c],!t.has(l))if(r)r--;else if(s){if(o.push(l),o.length===e){t=o;break t}}else if(o[n]||(o[n]=[]),o[n].push(l),++h===e){t=o;break t}t=o}this.result=t,o=!0}return s&&(this.await=null),s?this.resolve(e,i,n,h,o):this}function X(t,e,i,n,s){let r,h,o;"string"==typeof s?(r=s,s=""):r=s.template,h=r.indexOf("$1"),o=r.substring(h+2),h=r.substring(0,h);let c=s&&s.boundary,f=!s||!1!==s.clip,u=s&&s.merge&&o&&h&&new RegExp(o+" "+h,"g");var a=0;if("object"==typeof(s=s&&s.ellipsis)){var g=s.template;a=g.length-2,s=s.pattern}let d,p;"string"!=typeof s&&(s=!1===s?"":"..."),a&&(s=g.replace("$1",s)),g=s.length-a,"object"==typeof c&&(d=c.before,0===d&&(d=-1),p=c.after,0===p&&(p=-1),c=c.total||9e5),a=new Map;for(let L,q,E,I=0;I<e.length;I++){let $;if(n)$=e,E=n;else{var m=e[I];if(E=m.field,!E)continue;$=m.result}q=i.get(E),L=q.encoder,"string"!=typeof(m=a.get(L))&&(m=L.encode(t),a.set(L,m));for(let t=0;t<$.length;t++){var w=$[t].doc;if(!w)continue;if(!(w=l(w,E)))continue;var y=w.trim().split(/\s+/);if(!y.length)continue;w="";var b=[];let e=[];for(var x=-1,v=-1,k=0,A=0;A<y.length;A++){var j=y[A],z=L.encode(j);let t;if((z=z.length>1?z.join(" "):z[0])&&j){for(var M=j.length,S=(L.split?j.replace(L.split,""):j).length-z.length,_="",B=0,C=0;C<m.length;C++){var O=m[C];if(O){var P=O.length;P+=S<0?0:S,B&&P<=B||(O=z.indexOf(O))>-1&&(_=(O?j.substring(0,O):"")+h+j.substring(O,O+P)+o+(O+P<M?j.substring(O+P):""),B=P,t=!0)}}_&&(c&&(x<0&&(x=w.length+(w?1:0)),v=w.length+(w?1:0)+_.length,k+=M,e.push(b.length),b.push({match:_})),w+=(w?" ":"")+_)}if(t){if(c&&k>=c)break}else w+=(w?" ":"")+(j=y[A]),c&&b.push({text:j})}if(k=e.length*(r.length-2),d||p||c&&w.length-k>c)if(A=v-x,d>0&&(A+=d),p>0&&(A+=p),A<=(k=c+k-2*g))y=d?x-(d>0?d:0):x-((k-A)/2|0),b=p?v+(p>0?p:0):y+k,f||(y>0&&" "!==w.charAt(y)&&" "!==w.charAt(y-1)&&(y=w.indexOf(" ",y))<0&&(y=0),b<w.length&&" "!==w.charAt(b-1)&&" "!==w.charAt(b)&&((b=w.lastIndexOf(" ",b))<v?b=v:++b)),w=(y?s:"")+w.substring(y,b)+(b<w.length?s:"");else{for(v=[],x={},k={},A={},j={},z={},_=S=M=0,C=B=1;;){var D=void 0;for(let t,i=0;i<e.length;i++){if(t=e[i],_)if(S!==_){if(A[i+1])continue;if(t+=_,x[t]){M-=g,k[i+1]=1,A[i+1]=1;continue}if(t>=b.length-1){if(t>=b.length){A[i+1]=1,t>=y.length&&(k[i+1]=1);continue}M-=g}if(w=b[t].text,P=p&&z[i]){if(!(P>0)){A[i+1]=1;continue}if(w.length>P){if(A[i+1]=1,!f)continue;w=w.substring(0,P)}(P-=w.length)||(P=-1),z[i]=P}if(M+w.length+1<=c)w=" "+w,v[i]+=w;else{if(!f){A[i+1]=1;continue}(D=c-M-1)>0&&(w=" "+w.substring(0,D),v[i]+=w),A[i+1]=1}}else{if(A[i])continue;if(t-=S,x[t]){M-=g,A[i]=1,k[i]=1;continue}if(t<=0){if(t<0){A[i]=1,k[i]=1;continue}M-=g}if(w=b[t].text,P=d&&j[i]){if(!(P>0)){A[i]=1;continue}if(w.length>P){if(A[i]=1,!f)continue;w=w.substring(w.length-P)}(P-=w.length)||(P=-1),j[i]=P}if(M+w.length+1<=c)w+=" ",v[i]=w+v[i];else{if(!f){A[i]=1;continue}(D=w.length+1-(c-M))>=0&&D<w.length&&(w=w.substring(D)+" ",v[i]=w+v[i]),A[i]=1}}else{let e;if(w=b[t].match,d&&(j[i]=d),p&&(z[i]=p),i&&M++,t?!i&&g&&(M+=g):(k[i]=1,A[i]=1),t>=y.length-1||t<b.length-1&&b[t+1].match?e=1:g&&(M+=g),M-=r.length-2,i&&!(M+w.length<=c)){D=B=C=k[i]=0;break}v[i]=w,e&&(k[i+1]=1,A[i+1]=1)}M+=w.length,D=x[t]=1}if(D)S===_?_++:S++;else{if(S===_?B=0:C=0,!B&&!C)break;B?_=++S:_++}}w="";for(let t,e=0;e<v.length;e++)t=(k[e]?e?" ":"":(e&&!s?" ":"")+s)+v[e],w+=t;s&&!k[v.length]&&(w+=s)}u&&(w=w.replace(u," ")),$[t].highlight=w}if(n)break}return e}function Y(t,e){if(!this||this.constructor!==Y)return new Y(t,e);let i,n,s,r,h,o,l=0;if(t&&t.index){const i=t;if(e=i.index,l=i.boost||0,n=i.query){s=i.field||i.pluck,r=i.highlight;const n=i.resolve;t=i.async||i.queue,i.resolve=!1,i.index=null,t=t?e.searchAsync(i):e.search(i),i.resolve=n,i.index=e,t=t.result||t}else t=[]}if(t&&t.then){const e=this;i=[t=t.then((function(t){e.C[0]=e.result=t.result||t,tt(e)}))],t=[],h=new Promise((function(t){o=t}))}this.index=e||null,this.result=t||[],this.h=l,this.C=i||[],this.await=h||null,this.return=o||null,this.highlight=r||null,this.query=n||"",this.field=s||""}function tt(t,e){let i=t.result;var n=t.await;t.await=null;for(let s,r=0;r<t.C.length;r++)if(s=t.C[r])if("function"==typeof s)i=s(),t.C[r]=i=i.result||i,r--;else if(s.h)i=s.h(),t.C[r]=i=i.result||i,r--;else if(s.then)return t.await=n;return n=t.return,t.C=[],t.return=null,e||n(i),i}function et(t,e,i,n,s,h,o){const l=t.length;let c,f,u=[];c=r();for(let r,a,g,d,p=0;p<e;p++)for(let e=0;e<l;e++)if(g=t[e],p<g.length&&(r=g[p]))for(let t=0;t<r.length;t++){if(a=r[t],(f=c[a])?c[a]++:(f=0,c[a]=1),d=u[f]||(u[f]=[]),!o){let t=p+(e||!s?0:h||0);d=d[t]||(d[t]=[])}if(d.push(a),o&&i&&f===l-1&&d.length-n===i)return n?d.slice(n):d}if(t=u.length)if(s)u=u.length>1?it(u,i,n,o,h):(u=u[0])&&i&&u.length>i||n?u.slice(n,i+n):u;else{if(t<l)return[];if(u=u[t-1],i||n)if(o)(u.length>i||n)&&(u=u.slice(n,i+n));else{s=[];for(let t,e=0;e<u.length;e++)if(t=u[e])if(n&&t.length>n)n-=t.length;else if((i&&t.length>i||n)&&(t=t.slice(n,i+n),i-=t.length,n&&(n-=t.length)),s.push(t),!i)break;u=s}}return u}function it(t,e,i,n,s){const h=[],o=r();let l;var c=t.length;let f;if(n){for(s=c-1;s>=0;s--)if(f=(n=t[s])&&n.length)for(c=0;c<f;c++)if(l=n[c],!o[l])if(o[l]=1,i)i--;else if(h.push(l),h.length===e)return h}else for(let r,u=c-1,a=0;u>=0;u--){r=t[u];for(let t=0;t<r.length;t++)if(f=(n=r[t])&&n.length)for(let r=0;r<f;r++)if(l=n[r],!o[l])if(o[l]=1,i)i--;else{let i=(t+(u<c-1&&s||0))/(u+1)|0;if((h[i]||(h[i]=[])).push(l),++a===e)return h}}return h}function nt(t,e,i,n,s){const h=r(),o=[];for(let r,l=0;l<e.length;l++){r=e[l];for(let t=0;t<r.length;t++)h[r[t]]=1}if(s){for(let r,l=0;l<t.length;l++)if(r=t[l],h[r])if(n)n--;else if(o.push(r),h[r]=0,i&&0==--i)break}else for(let r,l,c=0;c<t.result.length;c++)for(r=t.result[c],e=0;e<r.length;e++)l=r[e],h[l]&&((o[c]||(o[c]=[])).push(l),h[l]=0);return o}function st(t){const e=[],i=r(),n=r();for(let s,r,h,o,l,c,f,u=0;u<t.length;u++){s=t[u],r=s.field,h=s.result;for(let t=0;t<h.length;t++)l=h[t],"object"!=typeof l?l={id:o=l}:o=l.id,(c=i[o])?c.push(r):(l.field=i[o]=[r],e.push(l)),(f=l.highlight)&&(c=n[o],c||(n[o]=c={},l.highlight=c),c[r]=f)}return e}function rt(t,e,i,n,s){return(t=this.tag.get(t))&&(t=t.get(e))?((e=t.length-n)>0&&((i&&e>i||n)&&(t=t.slice(n,n+i)),s&&(t=ht.call(this,t))),t):[]}function ht(t){if(!this||!this.store)return t;if(this.db)return this.index.get(this.field[0]).db.enrich(t);const e=Array(t.length);for(let i,n=0;n<t.length;n++)i=t[n],e[n]={id:i,doc:this.store.get(i)};return e}function ot(t){if(!this||this.constructor!==ot)return new ot(t);const e=t.document||t.doc||t;let i,n;if(this.B=[],this.field=[],this.D=[],this.key=(i=e.key||e.id)&&ct(i,this.D)||"id",(n=t.keystore||0)&&(this.keystore=n),this.fastupdate=!!t.fastupdate,this.reg=!this.fastupdate||t.worker||t.db?n?new _(n):new Set:n?new S(n):new Map,this.h=(i=e.store||null)&&i&&!0!==i&&[],this.store=i?n?new S(n):new Map:null,this.cache=(i=t.cache||null)&&new w(i),t.cache=!1,this.worker=t.worker||!1,this.priority=t.priority||4,this.index=lt.call(this,t,e),this.tag=null,(i=e.tag)&&("string"==typeof i&&(i=[i]),i.length)){this.tag=new Map,this.A=[],this.F=[];for(let t,e,n=0;n<i.length;n++){if(t=i[n],e=t.field||t,!e)throw Error("The tag field from the document descriptor is undefined.");t.custom?this.A[n]=t.custom:(this.A[n]=ct(e,this.D),t.filter&&("string"==typeof this.A[n]&&(this.A[n]=new String(this.A[n])),this.A[n].G=t.filter)),this.F[n]=e,this.tag.set(e,new Map)}}if(this.worker){this.fastupdate=!1,t=[];for(const e of this.index.values())e.then&&t.push(e);if(t.length){const e=this;return Promise.all(t).then((function(t){let i=0;for(const n of e.index.entries()){const s=n[0];let r=n[1];r.then&&(r=t[i],e.index.set(s,r),i++)}return e}))}}else t.db&&(this.fastupdate=!1,this.mount(t.db))}function lt(t,e){const i=new Map;let n=e.index||e.field||e;h(n)&&(n=[n]);for(let r,l,c=0;c<n.length;c++){if(r=n[c],h(r)||(l=r,r=r.field),l=o(l)?Object.assign({},t,l):t,this.worker){var s=void 0;s=new T(l,s=(s=l.encoder)&&s.encode?s:new d("string"==typeof s?j[s]:s||{})),i.set(r,s)}this.worker||i.set(r,new Mt(l,this.reg)),l.custom?this.B[c]=l.custom:(this.B[c]=ct(r,this.D),l.filter&&("string"==typeof this.B[c]&&(this.B[c]=new String(this.B[c])),this.B[c].G=l.filter)),this.field[c]=r}if(this.h){h(t=e.store)&&(t=[t]);for(let e,i,n=0;n<t.length;n++)e=t[n],i=e.field||e,e.custom?(this.h[n]=e.custom,e.custom.O=i):(this.h[n]=ct(i,this.D),e.filter&&("string"==typeof this.h[n]&&(this.h[n]=new String(this.h[n])),this.h[n].G=e.filter))}return i}function ct(t,e){const i=t.split(":");let n=0;for(let s=0;s<i.length;s++)"]"===(t=i[s])[t.length-1]&&(t=t.substring(0,t.length-2))&&(e[n]=!0),t&&(i[n++]=t);return n<i.length&&(i.length=n),n>1?i:i[0]}function ft(t,e=0){let i=[],n=[];e&&(e=25e4/e*5e3|0);for(const s of t.entries())n.push(s),n.length===e&&(i.push(n),n=[]);return n.length&&i.push(n),i}function ut(t,e){e||(e=new Map);for(let i,n=0;n<t.length;n++)i=t[n],e.set(i[0],i[1]);return e}function at(t,e=0){let i=[],n=[];e&&(e=25e4/e*1e3|0);for(const s of t.entries())n.push([s[0],ft(s[1])[0]||[]]),n.length===e&&(i.push(n),n=[]);return n.length&&i.push(n),i}function gt(t,e){e||(e=new Map);for(let i,n,s=0;s<t.length;s++)i=t[s],n=e.get(i[0]),e.set(i[0],ut(i[1],n));return e}function dt(t){let e=[],i=[];for(const n of t.keys())i.push(n),25e4===i.length&&(e.push(i),i=[]);return i.length&&e.push(i),e}function pt(t,e){e||(e=new Set);for(let i=0;i<t.length;i++)e.add(t[i]);return e}function mt(t,e,i,n,s,r,h=0){const o=n&&n.constructor===Array;var l=o?n.shift():n;if(!l)return this.export(t,e,s,r+1);if((l=t((e?e+".":"")+(h+1)+"."+i,JSON.stringify(l)))&&l.then){const c=this;return l.then((function(){return mt.call(c,t,e,i,o?n:null,s,r,h+1)}))}return mt.call(this,t,e,i,o?n:null,s,r,h+1)}function wt(t,e){let i="";for(const n of t.entries()){t=n[0];const s=n[1];let r="";for(let t,i=0;i<s.length;i++){t=s[i]||[""];let n="";for(let i=0;i<t.length;i++)n+=(n?",":"")+("string"===e?'"'+t[i]+'"':t[i]);n="["+n+"]",r+=(r?",":"")+n}r='["'+t+'",['+r+"]]",i+=(i?",":"")+r}return i}function yt(t,e){let i=0;var n=void 0===e;if(t.constructor===Array){for(let s,r,h,o=0;o<t.length;o++)if((s=t[o])&&s.length){if(n)return 1;if(r=s.indexOf(e),r>=0){if(s.length>1)return s.splice(r,1),1;if(delete t[o],i)return 1;h=1}else{if(h)return 1;i++}}}else for(let s of t.entries())n=s[0],yt(s[1],e)?i++:t.delete(n);return i}J("add"),J("append"),J("search"),J("update"),J("remove"),J("clear"),J("export"),J("import"),T.prototype.searchCache=m,I(T.prototype),ot.prototype.add=function(t,e,i){if(o(t)&&(t=l(e=t,this.key)),e&&(t||0===t)){if(!i&&this.reg.has(t))return this.update(t,e);for(let r,o=0;o<this.field.length;o++){r=this.B[o];var n=this.index.get(this.field[o]);if("function"==typeof r){var s=r(e);s&&n.add(t,s,i,!0)}else(!(s=r.G)||s(e))&&(r.constructor===String?r=[""+r]:h(r)&&(r=[r]),K(e,r,this.D,0,n,t,r[0],i))}if(this.tag)for(n=0;n<this.A.length;n++){var c=this.A[n];s=this.tag.get(this.F[n]);let o=r();if("function"==typeof c){if(!(c=c(e)))continue}else{var f=c.G;if(f&&!f(e))continue;c.constructor===String&&(c=""+c),c=l(e,c)}if(s&&c){h(c)&&(c=[c]);for(let e,n,r=0;r<c.length;r++)if(e=c[r],!o[e]&&(o[e]=1,(f=s.get(e))?n=f:s.set(e,n=[]),!i||!n.includes(t))){if(n.length===2**31-1){if(f=new M(n),this.fastupdate)for(let t of this.reg.values())t.includes(n)&&(t[t.indexOf(n)]=f);s.set(e,n=f)}n.push(t),this.fastupdate&&((f=this.reg.get(t))?f.push(n):this.reg.set(t,[n]))}}}if(this.store&&(!i||!this.store.has(t))){let n;if(this.h){n=r();for(let t,s=0;s<this.h.length;s++){if(t=this.h[s],(i=t.G)&&!i(e))continue;let r;if("function"==typeof t){if(r=t(e),!r)continue;t=[t.O]}else if(h(t)||t.constructor===String){n[t]=e[t];continue}R(e,n,t,0,t[0],r)}}this.store.set(t,n||e)}this.worker&&(this.fastupdate||this.reg.add(t))}return this},Y.prototype.or=function(){return H(this,"or",U,arguments)},Y.prototype.and=function(){return H(this,"and",V,arguments)},Y.prototype.xor=function(){return H(this,"xor",Z,arguments)},Y.prototype.not=function(){return H(this,"not",Q,arguments)},(i=Y.prototype).limit=function(t){if(this.await){const e=this;this.C.push((function(){return e.limit(t).result}))}else if(this.result.length){const e=[];for(let i,n=0;n<this.result.length;n++)if(i=this.result[n]){if(!(i.length<=t)){e[n]=i.slice(0,t);break}if(e[n]=i,!(t-=i.length))break}this.result=e}return this},i.offset=function(t){if(this.await){const e=this;this.C.push((function(){return e.offset(t).result}))}else if(this.result.length){const e=[];for(let i,n=0;n<this.result.length;n++)(i=this.result[n])&&(i.length<=t?t-=i.length:(e[n]=i.slice(t),t=0));this.result=e}return this},i.boost=function(t){if(this.await){const e=this;this.C.push((function(){return e.boost(t).result}))}else this.h+=t;return this},i.resolve=function(t,e,i,n,s){let r=this.await?tt(this,!0):this.result;if(r.then){const h=this;return r.then((function(){return h.resolve(t,e,i,n,s)}))}return r.length&&("object"==typeof t?(n=t.highlight||this.highlight,i=!!n||t.enrich,e=t.offset,t=t.limit):(n=n||this.highlight,i=!!n||i),r=s?i?ht.call(this.index,r):r:G.call(this.index,r,t||100,e,i)),this.finalize(r,n)},i.finalize=function(t,e){if(t.then){const i=this;return t.then((function(t){return i.finalize(t,e)}))}e&&t.length&&this.query&&(t=X(this.query,t,this.index.index,this.field,e));const i=this.return;return this.highlight=this.index=this.result=this.C=this.await=this.return=null,this.query=this.field="",i&&i(t),t},ot.prototype.search=function(t,e,i,n){i||(!e&&o(t)?(i=t,t=""):o(e)&&(i=e,e=0));let r=[];var l=[];let c,f,u,a,g,d,p,m,w=0,y=!0;if(i){i.constructor===Array&&(i={index:i}),t=i.query||t,c=i.pluck,f=i.merge,a=i.boost,d=c||i.field||(d=i.index)&&(d.index?null:d);var b=this.tag&&i.tag;u=i.suggest,y=!1!==i.resolve,g=i.cache,p=y&&this.store&&i.highlight;var x=!!p||y&&this.store&&i.enrich;e=i.limit||e;var v=i.offset||0;if(e||(e=y?100:0),b&&(!this.db||!n)){b.constructor!==Array&&(b=[b]);var k=[];for(let t,e=0;e<b.length;e++)if(t=b[e],t.field&&t.tag){var A=t.tag;if(A.constructor===Array)for(var j=0;j<A.length;j++)k.push(t.field,A[j]);else k.push(t.field,A)}else{A=Object.keys(t);for(let e,i,n=0;n<A.length;n++)if(e=A[n],i=t[e],i.constructor===Array)for(j=0;j<i.length;j++)k.push(e,i[j]);else k.push(e,i)}if(b=k,!t){if(l=[],k.length)for(b=0;b<k.length;b+=2){if(this.db){if(!(n=this.index.get(k[b])))continue;l.push(n=n.db.tag(k[b+1],e,v,x))}else n=rt.call(this,k[b],k[b+1],e,v,x);r.push(y?{field:k[b],tag:k[b+1],result:n}:[n])}if(l.length){const t=this;return Promise.all(l).then((function(e){for(let t=0;t<e.length;t++)y?r[t].result=e[t]:r[t]=e[t];return y?r:new Y(r.length>1?et(r,1,0,0,u,a):r[0],t)}))}return y?r:new Y(r.length>1?et(r,1,0,0,u,a):r[0],this)}}y||c||!(d=d||this.field)||(h(d)?c=d:(d.constructor===Array&&1===d.length&&(d=d[0]),c=d.field||d.index)),d&&d.constructor!==Array&&(d=[d])}d||(d=this.field),k=(this.worker||this.db)&&!n&&[];for(let o,M,S,_=0;_<d.length;_++){if(M=d[_],this.db&&this.tag&&!this.B[_])continue;let c;if(h(M)||(c=M,M=c.field,t=c.query||t,e=s(c.limit,e),v=s(c.offset,v),u=s(c.suggest,u),p=y&&this.store&&s(c.highlight,p),x=!!p||y&&this.store&&s(c.enrich,x),g=s(c.cache,g)),n)o=n[_];else{j=(A=c||i||{}).enrich;var z=this.index.get(M);if(b&&(this.db&&(A.tag=b,A.field=d,m=z.db.support_tag_search),!m&&j&&(A.enrich=!1),m||(A.limit=0,A.offset=0)),o=g?z.searchCache(t,b&&!m?0:e,A):z.search(t,b&&!m?0:e,A),b&&!m&&(A.limit=e,A.offset=v),j&&(A.enrich=j),k){k[_]=o;continue}}if(S=(o=o.result||o)&&o.length,b&&S){if(A=[],j=0,this.db&&n){if(!m)for(z=d.length;z<n.length;z++){let t=n[z];if(t&&t.length)j++,A.push(t);else if(!u)return y?r:new Y(r,this)}}else for(let t,e,i=0;i<b.length;i+=2){if(t=this.tag.get(b[i]),!t){if(u)continue;return y?r:new Y(r,this)}if(e=(t=t&&t.get(b[i+1]))&&t.length)j++,A.push(t);else if(!u)return y?r:new Y(r,this)}if(j){if(o=nt(o,A,e,v,y),S=o.length,!S&&!u)return y?o:new Y(o,this);j--}}if(S)l[w]=M,r.push(o),w++;else if(1===d.length)return y?r:new Y(r,this)}if(k){if(this.db&&b&&b.length&&!m)for(x=0;x<b.length;x+=2){if(!(l=this.index.get(b[x]))){if(u)continue;return y?r:new Y(r,this)}k.push(l.db.tag(b[x+1],e,v,!1))}const n=this;return Promise.all(k).then((function(s){return i&&(i.resolve=y),s.length&&(s=n.search(t,e,i,s)),s}))}if(!w)return y?r:new Y(r,this);if(c&&(!x||!this.store))return r=r[0],y?r:new Y(r,this);for(k=[],v=0;v<l.length;v++){if(b=r[v],x&&b.length&&void 0===b[0].doc&&(this.db?k.push(b=this.index.get(this.field[0]).db.enrich(b)):b=ht.call(this,b)),c)return y?p?X(t,b,this.index,c,p):b:new Y(b,this);r[v]={field:l[v],result:b}}if(x&&this.db&&k.length){const e=this;return Promise.all(k).then((function(i){for(let t=0;t<i.length;t++)r[t].result=i[t];return p&&(r=X(t,r,e.index,c,p)),f?st(r):r}))}return p&&(r=X(t,r,this.index,c,p)),f?st(r):r},(i=ot.prototype).mount=function(t){let e=this.field;if(this.tag)for(let r,h=0;h<this.F.length;h++){r=this.F[h];var i=void 0;this.index.set(r,i=new Mt({},this.reg)),e===this.field&&(e=e.slice(0)),e.push(r),i.tag=this.tag.get(r)}i=[];const n={db:t.db,type:t.type,fastupdate:t.fastupdate};for(let r,h,o=0;o<e.length;o++){n.field=h=e[o],r=this.index.get(h);const s=new t.constructor(t.id,n);s.id=t.id,i[o]=s.mount(r),r.document=!0,o?r.bypass=!0:r.store=this.store}const s=this;return this.db=Promise.all(i).then((function(){s.db=!0}))},i.commit=async function(){const t=[];for(const e of this.index.values())t.push(e.commit());await Promise.all(t),this.reg.clear()},i.destroy=function(){const t=[];for(const e of this.index.values())t.push(e.destroy());return Promise.all(t)},i.append=function(t,e){return this.add(t,e,!0)},i.update=function(t,e){return this.remove(t).add(t,e)},i.remove=function(t){for(var e of(o(t)&&(t=l(t,this.key)),this.index.values()))e.remove(t,!0);if(this.reg.has(t)){if(this.tag&&!this.fastupdate)for(let i of this.tag.values())for(let n of i){e=n[0];const s=n[1],r=s.indexOf(t);r>-1&&(s.length>1?s.splice(r,1):i.delete(e))}this.store&&this.store.delete(t),this.reg.delete(t)}return this.cache&&this.cache.remove(t),this},i.clear=function(){const t=[];for(const e of this.index.values()){const i=e.clear();i.then&&t.push(i)}if(this.tag)for(const e of this.tag.values())e.clear();return this.store&&this.store.clear(),this.cache&&this.cache.clear(),t.length?Promise.all(t):this},i.contain=function(t){return this.db?this.index.get(this.field[0]).db.has(t):this.reg.has(t)},i.cleanup=function(){for(const t of this.index.values())t.cleanup();return this},i.get=function(t){return this.db?this.index.get(this.field[0]).db.enrich(t).then((function(t){return t[0]&&t[0].doc||null})):this.store.get(t)||null},i.set=function(t,e){return"object"==typeof t&&(t=l(e=t,this.key)),this.store.set(t,e),this},i.searchCache=m,i.export=function(t,e,i=0,n=0){if(i<this.field.length){const s=this.field[i];if((e=this.index.get(s).export(t,s,i,n=1))&&e.then){const n=this;return e.then((function(){return n.export(t,s,i+1)}))}return this.export(t,s,i+1)}let s,r;switch(n){case 0:s="reg",r=dt(this.reg),e=null;break;case 1:s="tag",r=this.tag&&at(this.tag,this.reg.size),e=null;break;case 2:s="doc",r=this.store&&ft(this.store),e=null;break;default:return}return mt.call(this,t,e,s,r||null,i,n)},i.import=function(t,e){var i=t.split(".");"json"===i[i.length-1]&&i.pop();const n=i.length>2?i[0]:"";if(i=i.length>2?i[2]:i[1],this.worker&&n)return this.index.get(n).import(t);if(e){if("string"==typeof e&&(e=JSON.parse(e)),n)return this.index.get(n).import(i,e);switch(i){case"reg":this.fastupdate=!1,this.reg=pt(e,this.reg);for(let t,e=0;e<this.field.length;e++)t=this.index.get(this.field[e]),t.fastupdate=!1,t.reg=this.reg;if(this.worker){e=[];for(const i of this.index.values())e.push(i.import(t));return Promise.all(e)}break;case"tag":this.tag=gt(e,this.tag);break;case"doc":this.store=ut(e,this.store)}}},I(ot.prototype),Mt.prototype.remove=function(t,e){const i=this.reg.size&&(this.fastupdate?this.reg.get(t):this.reg.has(t));if(i){if(this.fastupdate){for(let e,n,s=0;s<i.length;s++)if((e=i[s])&&(n=e.length))if(e[n-1]===t)e.pop();else{const i=e.indexOf(t);i>=0&&e.splice(i,1)}}else yt(this.map,t),this.depth&&yt(this.ctx,t);e||this.reg.delete(t)}return this.db&&(this.commit_task.push({del:t}),this.M&&St(this)),this.cache&&this.cache.remove(t),this};const bt={memory:{resolution:1},performance:{resolution:3,fastupdate:!0,context:{depth:1,resolution:1}},match:{tokenize:"forward"},score:{resolution:9,context:{depth:2,resolution:3}}};function xt(t,e,i,n,s,h,o){let l,c;if(!(l=e[i])||o&&!l[o]){if(o?((e=l||(e[i]=r()))[o]=1,c=t.ctx,(l=c.get(o))?c=l:c.set(o,c=t.keystore?new S(t.keystore):new Map)):(c=t.map,e[i]=1),(l=c.get(i))?c=l:c.set(i,c=l=[]),h)for(let i,r=0;r<l.length;r++)if((i=l[r])&&i.includes(s)){if(r<=n)return;i.splice(i.indexOf(s),1),t.fastupdate&&(e=t.reg.get(s))&&e.splice(e.indexOf(i),1);break}if(c=c[n]||(c[n]=[]),c.push(s),c.length===2**31-1){if(e=new M(c),t.fastupdate)for(let i of t.reg.values())i.includes(c)&&(i[i.indexOf(c)]=e);l[n]=c=e}t.fastupdate&&((n=t.reg.get(s))?n.push(c):t.reg.set(s,[c]))}}function vt(t,e,i,n,s){return i&&t>1?e+(n||0)<=t?i+(s||0):(t-1)/(e+(n||0))*(i+(s||0))+1|0:0}function kt(t,e,i,n,s,r,h){let o=t.length,l=t;if(o>1)l=et(t,e,i,n,s,r,h);else if(1===o)return h?G.call(null,t[0],i,n):new Y(t[0],this);return h?l:new Y(l,this)}function At(t,e,i,n,s,r,h){return t=zt(this,t,e,i,n,s,r,h),this.db?t.then((function(t){return s?t||[]:new Y(t,this)})):t&&t.length?s?G.call(this,t,i,n):new Y(t,this):s?[]:new Y([],this)}function jt(t,e,i,n){let s=[];if(t&&t.length){if(t.length<=n)return void e.push(t);for(let e,i=0;i<n;i++)(e=t[i])&&(s[i]=e);if(s.length)return void e.push(s)}if(!i)return s}function zt(t,e,i,n,s,r,h,o){let l;return i&&(l=t.bidirectional&&e>i)&&(l=i,i=e,e=l),t.db?t.db.get(e,i,n,s,r,h,o):t=i?(t=t.ctx.get(i))&&t.get(e):t.map.get(e)}function Mt(t,e){if(!this||this.constructor!==Mt)return new Mt(t);if(t){var i=h(t)?t:t.preset;i&&(t=Object.assign({},bt[i],t))}else t={};const n=!0===(i=t.context)?{depth:1}:i||{},s=h(t.encoder)?j[t.encoder]:t.encode||t.encoder||{};this.encoder=s.encode?s:"object"==typeof s?new d(s):{encode:s},this.resolution=t.resolution||9,this.tokenize=i=(i=t.tokenize)&&"default"!==i&&"exact"!==i&&i||"strict",this.depth="strict"===i&&n.depth||0,this.bidirectional=!1!==n.bidirectional,this.fastupdate=!!t.fastupdate,this.score=t.score||null,(i=t.keystore||0)&&(this.keystore=i),this.map=i?new S(i):new Map,this.ctx=i?new S(i):new Map,this.reg=e||(this.fastupdate?i?new S(i):new Map:i?new _(i):new Set),this.N=n.resolution||3,this.rtl=s.rtl||t.rtl||!1,this.cache=(i=t.cache||null)&&new w(i),this.resolve=!1!==t.resolve,(i=t.db)&&(this.db=this.mount(i)),this.M=!1!==t.commit,this.commit_task=[],this.commit_timer=null,this.priority=t.priority||4}function St(t){t.commit_timer||(t.commit_timer=setTimeout((function(){t.commit_timer=null,t.db.commit(t)}),1))}Mt.prototype.add=function(t,e,i,n){if(e&&(t||0===t)){if(!n&&!i&&this.reg.has(t))return this.update(t,e);n=this.depth;const f=(e=this.encoder.encode(e,!n)).length;if(f){const u=r(),a=r(),g=this.resolution;for(let r=0;r<f;r++){let d=e[this.rtl?f-1-r:r];var s=d.length;if(s&&(n||!a[d])){var h=this.score?this.score(e,d,r,null,0):vt(g,f,r),o="";switch(this.tokenize){case"tolerant":if(xt(this,a,d,h,t,i),s>2){for(let e,n,r,l,c=1;c<s-1;c++)e=d.charAt(c),n=d.charAt(c+1),r=d.substring(0,c)+n,l=d.substring(c+2),xt(this,a,o=r+e+l,h,t,i),xt(this,a,o=r+l,h,t,i);xt(this,a,d.substring(0,d.length-1),h,t,i)}break;case"full":if(s>2){for(let n,c=0;c<s;c++)for(h=s;h>c;h--){o=d.substring(c,h),n=this.rtl?s-1-c:c;var l=this.score?this.score(e,d,r,o,n):vt(g,f,r,s,n);xt(this,a,o,l,t,i)}break}case"bidirectional":case"reverse":if(s>1){for(l=s-1;l>0;l--){o=d[this.rtl?s-1-l:l]+o;var c=this.score?this.score(e,d,r,o,l):vt(g,f,r,s,l);xt(this,a,o,c,t,i)}o=""}case"forward":if(s>1){for(l=0;l<s;l++)xt(this,a,o+=d[this.rtl?s-1-l:l],h,t,i);break}default:if(xt(this,a,d,h,t,i),n&&f>1&&r<f-1)for(s=this.N,o=d,h=Math.min(n+1,this.rtl?r+1:f-r),l=1;l<h;l++)d=e[this.rtl?f-1-r-l:r+l],xt(this,u,(c=this.bidirectional&&d>o)?o:d,this.score?this.score(e,o,r,d,l-1):vt(s+(f/2>s?0:1),f,r,h-1,l-1),t,i,c?d:o)}}}this.fastupdate||this.reg.add(t)}}return this.db&&(this.commit_task.push(i?{ins:t}:{del:t}),this.M&&St(this)),this},Mt.prototype.search=function(t,e,i){if(i||(e||"object"!=typeof t?"object"==typeof e&&(i=e,e=0):(i=t,t="")),i&&i.cache)return i.cache=!1,t=this.searchCache(t,e,i),i.cache=!0,t;let n,s,h,o,l,c,f,u,a=[],g=0;i&&(t=i.query||t,e=i.limit||e,g=i.offset||0,s=i.context,h=i.suggest,u=(o=i.resolve)&&i.enrich,c=i.boost,f=i.resolution,l=this.db&&i.tag),void 0===o&&(o=this.resolve),s=this.depth&&!1!==s;let d=this.encoder.encode(t,!s);if(n=d.length,e=e||(o?100:0),1===n)return At.call(this,d[0],"",e,g,o,u,l);if(2===n&&s&&!h)return At.call(this,d[1],d[0],e,g,o,u,l);let p,m=r(),w=0;if(s&&(p=d[0],w=1),f||0===f||(f=p?this.N:this.resolution),this.db){if(this.db.search&&!1!==(i=this.db.search(this,d,e,g,h,o,u,l)))return i;const t=this;return async function(){for(let e,i;w<n;w++){if((i=d[w])&&!m[i]){if(m[i]=1,e=await zt(t,i,p,0,0,!1,!1),e=jt(e,a,h,f)){a=e;break}p&&(h&&e&&a.length||(p=i))}h&&p&&w===n-1&&!a.length&&(f=t.resolution,p="",w=-1,m=r())}return kt(a,f,e,g,h,c,o)}()}for(let y,b;w<n;w++){if((b=d[w])&&!m[b]){if(m[b]=1,y=zt(this,b,p,0,0,!1,!1),y=jt(y,a,h,f)){a=y;break}p&&(h&&y&&a.length||(p=b))}h&&p&&w===n-1&&!a.length&&(f=this.resolution,p="",w=-1,m=r())}return kt(a,f,e,g,h,c,o)},(i=Mt.prototype).mount=function(t){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),t.mount(this)},i.commit=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.commit(this)},i.destroy=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.destroy()},i.clear=function(){return this.map.clear(),this.ctx.clear(),this.reg.clear(),this.cache&&this.cache.clear(),this.db?(this.commit_timer&&clearTimeout(this.commit_timer),this.commit_timer=null,this.commit_task=[],this.db.clear()):this},i.append=function(t,e){return this.add(t,e,!0)},i.contain=function(t){return this.db?this.db.has(t):this.reg.has(t)},i.update=function(t,e){const i=this,n=this.remove(t);return n&&n.then?n.then((()=>i.add(t,e))):this.add(t,e)},i.cleanup=function(){return this.fastupdate?(yt(this.map),this.depth&&yt(this.ctx),this):this},i.searchCache=m,i.export=function(t,e,i=0,n=0){let s,r;switch(n){case 0:s="reg",r=dt(this.reg);break;case 1:s="cfg",r=null;break;case 2:s="map",r=ft(this.map,this.reg.size);break;case 3:s="ctx",r=at(this.ctx,this.reg.size);break;default:return}return mt.call(this,t,e,s,r,i,n)},i.import=function(t,e){if(e)switch("string"==typeof e&&(e=JSON.parse(e)),t=t.split("."),"json"===t[t.length-1]&&t.pop(),3===t.length&&t.shift(),t=t.length>1?t[1]:t[0],t){case"reg":this.fastupdate=!1,this.reg=pt(e,this.reg);break;case"map":this.map=ut(e,this.map);break;case"ctx":this.ctx=gt(e,this.ctx)}},i.serialize=function(t=!0){let e="",i="",n="";if(this.reg.size){let t;for(var s of this.reg.keys())t||(t=typeof s),e+=(e?",":"")+("string"===t?'"'+s+'"':s);e="index.reg=new Set(["+e+"]);",i=wt(this.map,t),i="index.map=new Map(["+i+"]);";for(const e of this.ctx.entries()){s=e[0];let i=wt(e[1],t);i="new Map(["+i+"])",i='["'+s+'",'+i+"]",n+=(n?",":"")+i}n="index.ctx=new Map(["+n+"]);"}return t?"function inject(index){"+e+i+n+"}":e+i+n},I(Mt.prototype);const _t="undefined"!=typeof window&&(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),Bt=["map","ctx","tag","reg","cfg"],Ct=r();function Ot(t,e,i){const n=t.value;let s,r=0;for(let h,o=0;o<n.length;o++){if(h=i?n:n[o]){for(let t,i,r=0;r<e.length;r++)if(i=e[r],t=h.indexOf(i),t>=0){if(s=1,!(h.length>1)){n[o]=[];break}h.splice(t,1)}r+=h.length}if(i)break}r?s&&t.update(n):t.delete(),t.continue()}function Pt(t,e){return new Promise(((i,n)=>{t.onsuccess=t.oncomplete=function(){e&&e(this.result),e=null,i(this.result)},t.onerror=t.onblocked=n,t=null}))}(i=function t(e,i={}){if(!this||this.constructor!==t)return new t(e,i);"object"==typeof e&&(i=e,e=e.name),this.id="flexsearch"+(e?":"+e.toLowerCase().replace(/[^a-z0-9_\-]/g,""):""),this.field=i.field?i.field.toLowerCase().replace(/[^a-z0-9_\-]/g,""):"",this.type=i.type,this.fastupdate=this.support_tag_search=!1,this.db=null,this.h={}}.prototype).mount=function(t){return t.index?t.mount(this):(t.db=this,this.open())},i.open=function(){if(this.db)return this.db;let t=this;navigator.storage&&navigator.storage.persist&&navigator.storage.persist(),Ct[t.id]||(Ct[t.id]=[]),Ct[t.id].push(t.field);const e=_t.open(t.id,1);return e.onupgradeneeded=function(){const e=t.db=this.result;for(let i,n=0;n<Bt.length;n++){i=Bt[n];for(let n,s=0;s<Ct[t.id].length;s++)n=Ct[t.id][s],e.objectStoreNames.contains(i+("reg"!==i&&n?":"+n:""))||e.createObjectStore(i+("reg"!==i&&n?":"+n:""))}},t.db=Pt(e,(function(e){t.db=e,t.db.onversionchange=function(){t.close()}}))},i.close=function(){this.db&&this.db.close(),this.db=null},i.destroy=function(){return Pt(_t.deleteDatabase(this.id))},i.clear=function(){const t=[];for(let i,n=0;n<Bt.length;n++){i=Bt[n];for(let e,n=0;n<Ct[this.id].length;n++)e=Ct[this.id][n],t.push(i+("reg"!==i&&e?":"+e:""))}const e=this.db.transaction(t,"readwrite");for(let i=0;i<t.length;i++)e.objectStore(t[i]).clear();return Pt(e)},i.get=function(t,e,i=0,n=0,s=!0,r=!1){t=this.db.transaction((e?"ctx":"map")+(this.field?":"+this.field:""),"readonly").objectStore((e?"ctx":"map")+(this.field?":"+this.field:"")).get(e?e+":"+t:t);const h=this;return Pt(t).then((function(t){let e=[];if(!t||!t.length)return e;if(s){if(!i&&!n&&1===t.length)return t[0];for(let s,r=0;r<t.length;r++)if((s=t[r])&&s.length){if(n>=s.length){n-=s.length;continue}const t=i?n+Math.min(s.length-n,i):s.length;for(let i=n;i<t;i++)e.push(s[i]);if(n=0,e.length===i)break}return r?h.enrich(e):e}return t}))},i.tag=function(t,e=0,i=0,n=!1){t=this.db.transaction("tag"+(this.field?":"+this.field:""),"readonly").objectStore("tag"+(this.field?":"+this.field:"")).get(t);const s=this;return Pt(t).then((function(t){return!t||!t.length||i>=t.length?[]:e||i?(t=t.slice(i,i+e),n?s.enrich(t):t):t}))},i.enrich=function(t){"object"!=typeof t&&(t=[t]);const e=this.db.transaction("reg","readonly").objectStore("reg"),i=[];for(let n=0;n<t.length;n++)i[n]=Pt(e.get(t[n]));return Promise.all(i).then((function(e){for(let i=0;i<e.length;i++)e[i]={id:t[i],doc:e[i]?JSON.parse(e[i]):null};return e}))},i.has=function(t){return Pt(t=this.db.transaction("reg","readonly").objectStore("reg").getKey(t)).then((function(t){return!!t}))},i.search=null,i.info=function(){},i.transaction=function(t,e,i){t+="reg"!==t&&this.field?":"+this.field:"";let n=this.h[t+":"+e];if(n)return i.call(this,n);let s=this.db.transaction(t,e);this.h[t+":"+e]=n=s.objectStore(t);const r=i.call(this,n);return this.h[t+":"+e]=null,Pt(s).finally((function(){return r}))},i.commit=async function(t){let e=t.commit_task,i=[];t.commit_task=[];for(let n,s=0;s<e.length;s++)n=e[s],n.del&&i.push(n.del);i.length&&await this.remove(i),t.reg.size&&(await this.transaction("map","readwrite",(function(e){for(const i of t.map){const t=i[0],n=i[1];n.length&&(e.get(t).onsuccess=function(){let i=this.result;var s;if(i&&i.length){const t=Math.max(i.length,n.length);for(let e,r,h=0;h<t;h++)if((r=n[h])&&r.length){if((e=i[h])&&e.length)for(s=0;s<r.length;s++)e.push(r[s]);else i[h]=r;s=1}}else i=n,s=1;s&&e.put(i,t)})}})),await this.transaction("ctx","readwrite",(function(e){for(const i of t.ctx){const t=i[0],n=i[1];for(const i of n){const n=i[0],s=i[1];s.length&&(e.get(t+":"+n).onsuccess=function(){let i=this.result;var r;if(i&&i.length){const t=Math.max(i.length,s.length);for(let e,n,h=0;h<t;h++)if((n=s[h])&&n.length){if((e=i[h])&&e.length)for(r=0;r<n.length;r++)e.push(n[r]);else i[h]=n;r=1}}else i=s,r=1;r&&e.put(i,t+":"+n)})}}})),t.store?await this.transaction("reg","readwrite",(function(e){for(const i of t.store){const t=i[0],n=i[1];e.put("object"==typeof n?JSON.stringify(n):1,t)}})):t.bypass||await this.transaction("reg","readwrite",(function(e){for(const i of t.reg.keys())e.put(1,i)})),t.tag&&await this.transaction("tag","readwrite",(function(e){for(const i of t.tag){const t=i[0],n=i[1];n.length&&(e.get(t).onsuccess=function(){let i=this.result;i=i&&i.length?i.concat(n):n,e.put(i,t)})}})),t.map.clear(),t.ctx.clear(),t.tag&&t.tag.clear(),t.store&&t.store.clear(),t.document||t.reg.clear())},i.remove=function(t){return"object"!=typeof t&&(t=[t]),Promise.all([this.transaction("map","readwrite",(function(e){e.openCursor().onsuccess=function(){const e=this.result;e&&Ot(e,t)}})),this.transaction("ctx","readwrite",(function(e){e.openCursor().onsuccess=function(){const e=this.result;e&&Ot(e,t)}})),this.transaction("tag","readwrite",(function(e){e.openCursor().onsuccess=function(){const e=this.result;e&&Ot(e,t,!0)}})),this.transaction("reg","readwrite",(function(e){for(let i=0;i<t.length;i++)e.delete(t[i])}))])};const Dt=ot;export{Dt as D,e as _};
