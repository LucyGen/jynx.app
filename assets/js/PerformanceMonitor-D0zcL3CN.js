const t={HIGH:"HIGH",MEDIUM:"MEDIUM",LOW:"LOW",POTATO:"POTATO"},s={HIGH:{maxParticles:100,particleMultiplier:1,enableGlow:!0,enableTrails:!0,enableScreenShake:!0,shadowBlur:20},MEDIUM:{maxParticles:50,particleMultiplier:.5,enableGlow:!0,enableTrails:!0,enableScreenShake:!0,shadowBlur:10},LOW:{maxParticles:20,particleMultiplier:.3,enableGlow:!1,enableTrails:!1,enableScreenShake:!0,shadowBlur:0},POTATO:{maxParticles:0,particleMultiplier:0,enableGlow:!1,enableTrails:!1,enableScreenShake:!1,shadowBlur:0}};class e{constructor(){this.fps=60,this.frameCount=0,this.lastFpsUpdate=performance.now(),this.fpsHistory=[],this.lastFrameTime=performance.now(),this.frameTime=16.67,this.frameTimeHistory=[],this.lagSpikes=0,this.currentQuality=t.HIGH,this.autoAdjustQuality=!0,this.qualityAdjustmentCooldown=0,this.QUALITY_ADJUSTMENT_COOLDOWN=2e3,this.memoryUsage=0,this.hasMemoryAPI=void 0!==performance.memory,this.warnings=[],this.warningThreshold=3,this.stats={totalFrames:0,averageFps:60,minFps:60,maxFps:60,averageFrameTime:16.67,maxFrameTime:16.67,lagSpikes:0,qualityAdjustments:0}}update(t){const s=performance.now(),e=s-this.lastFrameTime;this.lastFrameTime=s,this.frameTime=e,this.frameTimeHistory.push(e),this.frameTimeHistory.length>60&&this.frameTimeHistory.shift(),e>50&&(this.lagSpikes++,this.stats.lagSpikes++),this.frameCount++,this.stats.totalFrames++;const i=s-this.lastFpsUpdate;return i>=1e3&&(this.fps=Math.round(this.frameCount/i*1e3),this.fpsHistory.push(this.fps),this.fpsHistory.length>60&&this.fpsHistory.shift(),this.stats.minFps=Math.min(this.stats.minFps,this.fps),this.stats.maxFps=Math.max(this.stats.maxFps,this.fps),this.frameCount=0,this.lastFpsUpdate=s),this.fpsHistory.length>0&&(this.stats.averageFps=Math.round(this.fpsHistory.reduce(((t,s)=>t+s),0)/this.fpsHistory.length)),this.frameTimeHistory.length>0&&(this.stats.averageFrameTime=this.frameTimeHistory.reduce(((t,s)=>t+s),0)/this.frameTimeHistory.length,this.stats.maxFrameTime=Math.max(this.stats.maxFrameTime,e)),this.hasMemoryAPI&&(this.memoryUsage=performance.memory.usedJSHeapSize/1048576),this.autoAdjustQuality&&this.updateQualityLevel(s),this.getMetrics()}updateQualityLevel(s){if(s-this.qualityAdjustmentCooldown<this.QUALITY_ADJUSTMENT_COOLDOWN)return;const e=this.stats.averageFps;let i=this.currentQuality;e<30?i=t.POTATO:e<45?this.currentQuality===t.HIGH?i=t.MEDIUM:this.currentQuality===t.MEDIUM&&(i=t.LOW):e>=55&&(this.currentQuality===t.POTATO?i=t.LOW:this.currentQuality===t.LOW?i=t.MEDIUM:this.currentQuality===t.MEDIUM&&(i=t.HIGH)),i!==this.currentQuality&&(this.setQualityLevel(i),this.qualityAdjustmentCooldown=s,this.stats.qualityAdjustments++)}setQualityLevel(t){s[t]&&(this.currentQuality=t)}getQualitySettings(){return{...s[this.currentQuality]}}getMetrics(){return{fps:this.fps,frameTime:this.frameTime,averageFps:this.stats.averageFps,averageFrameTime:this.stats.averageFrameTime,minFps:this.stats.minFps,maxFps:this.stats.maxFps,lagSpikes:this.lagSpikes,memoryUsage:this.memoryUsage,qualityLevel:this.currentQuality,isLagging:this.fps<45}}getStats(){return{...this.stats,currentFps:this.fps,currentFrameTime:this.frameTime,memoryUsage:this.memoryUsage,qualityLevel:this.currentQuality}}isPerformanceAcceptable(){return this.stats.averageFps>=45}isLowEndDevice(){return this.currentQuality===t.LOW||this.currentQuality===t.POTATO}setAutoAdjustQuality(t){this.autoAdjustQuality=t}addWarning(t){this.warnings.push({message:t,timestamp:performance.now(),fps:this.fps,frameTime:this.frameTime}),this.warnings.length>10&&this.warnings.shift()}getWarnings(){return[...this.warnings]}resetStats(){this.stats={totalFrames:0,averageFps:60,minFps:60,maxFps:60,averageFrameTime:16.67,maxFrameTime:16.67,lagSpikes:0,qualityAdjustments:0},this.fpsHistory=[],this.frameTimeHistory=[],this.lagSpikes=0,this.warnings=[]}exportReport(){return{timestamp:(new Date).toISOString(),duration:this.stats.totalFrames/60,performance:{averageFps:this.stats.averageFps,minFps:this.stats.minFps,maxFps:this.stats.maxFps,averageFrameTime:this.stats.averageFrameTime.toFixed(2)+"ms",maxFrameTime:this.stats.maxFrameTime.toFixed(2)+"ms"},issues:{lagSpikes:this.stats.lagSpikes,qualityAdjustments:this.stats.qualityAdjustments,warnings:this.warnings.length},quality:{currentLevel:this.currentQuality,settings:this.getQualitySettings()},device:{hasMemoryAPI:this.hasMemoryAPI,memoryUsage:this.memoryUsage.toFixed(2)+" MB",userAgent:navigator.userAgent},warnings:this.warnings}}logStatus(){}}export{t as QualityLevel,e as default};
