import{D as e}from"./vendor-BmBcEOuS.js";const t={flexsearch:{tokenize:"forward",resolution:9,cache:!0,document:{id:"id",index:["title","excerpt","tags","category"]}},indexing:{basePath:"/content/search/",filePattern:"{locale}.json",cacheEnabled:!0,cacheTTL:864e5,cacheKeyPrefix:"search_index_v3_",preloadLocales:["en"],maxCacheSizeMB:10},performance:{enabled:!0,slowSearchThreshold:100},locales:{supported:["en","fr","es","pt","de","it","ru","ar","hi","id","pl","uk","ko","tr","bn","vi"],default:"en",urlPattern:/^\/([a-z]{2})\//}};class s{constructor(e){this.locale=e,this.index=null,this.posts=[],this.isReady=!1,this.indexedCount=0,this._initializeIndex()}_initializeIndex(){const s=(this.locale,{...t.flexsearch});try{if(!e||"function"!=typeof e)throw new Error("FlexSearch Document not available");this.index=new e(s)}catch(r){throw new Error(`Failed to initialize search engine: ${r.message}`)}}async indexPosts(e){if(!e||!Array.isArray(e)||0===e.length)return 0;performance.now();try{return this.posts=e,e.forEach((e=>{e.id&&(this.index.add({id:e.id,title:e.title||"",excerpt:e.excerpt||"",tags:Array.isArray(e.tags)?e.tags.join(" "):"",category:e.category||""}),this.indexedCount++)})),this.isReady=!0,performance.now(),this.indexedCount}catch(t){throw this.isReady=!1,new Error(`Failed to index posts: ${t.message}`)}}async search(e,t={}){if(!this.isReady)return[];if(!e||"string"!=typeof e||0===e.trim().length)return[];const{limit:s=50,includeScore:r=!1}=t;performance.now();try{const t=e.trim().toLowerCase(),a=this.index.search(t,{limit:s,suggest:!0}),i=this._mergeSearchResults(a,r);return performance.now(),i.map((e=>{const t=this.posts.find((t=>t.id===e.id));return r&&t?{...t,_score:e.score}:t})).filter(Boolean)}catch(a){return[]}}_mergeSearchResults(e,t){if(!Array.isArray(e)||0===e.length)return[];const s=new Map;e.forEach((e=>{e&&e.result&&e.result.forEach((e=>{s.has(e)?t&&(s.get(e).score+=1):s.set(e,{id:e,score:1})}))}));let r=Array.from(s.values());return t&&r.sort(((e,t)=>t.score-e.score)),r}async suggest(e,t=5){if(!this.isReady||!e)return[];try{const s=this.index.search(e,{limit:t,suggest:!0,field:"title"}),r=new Set;return Array.isArray(s)&&s.length>0&&s.forEach((e=>{e&&e.result&&e.result.forEach((e=>{const t=this.posts.find((t=>t.id===e));t&&t.title&&r.add(t.title)}))})),Array.from(r).slice(0,t)}catch(s){return[]}}clear(){this.index&&this._initializeIndex(),this.posts=[],this.isReady=!1,this.indexedCount=0}getStats(){return{locale:this.locale,isReady:this.isReady,postsIndexed:this.indexedCount,postsStored:this.posts.length}}ready(){return this.isReady&&this.indexedCount>0}}class r{constructor(){this.cache=new Map,this.loadingPromises=new Map,this.config=t.indexing,this.manifestCache=null,this.manifestLastFetch=0,this.manifestCacheTTL=3e5}async load(e,t=!1){if(!t&&this.cache.has(e))return this.cache.get(e);if(this.loadingPromises.has(e))return this.loadingPromises.get(e);const s=this._loadIndex(e,t);this.loadingPromises.set(e,s);try{const t=await s;return this.cache.set(e,t),t}finally{this.loadingPromises.delete(e)}}async _loadIndex(e,t){performance.now();try{if(!t&&this.config.cacheEnabled){const t=await this._loadFromCache(e);if(t)return performance.now(),t}const s=await this._fetchIndex(e);return this.config.cacheEnabled&&this._saveToCache(e,s),performance.now(),s}catch(s){throw s}}async _fetchIndex(e,t=1){const s=this._getIndexURL(e);try{const t=await fetch(s);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const r=await t.json();if(!this._validateIndex(r,e))throw new Error("Invalid index structure");return r}catch(r){if(t<3)return await this._delay(1e3*t),this._fetchIndex(e,t+1);throw new Error(`Failed to fetch index after 3 attempts: ${r.message}`)}}async _loadFromCache(e){try{const t=this.config.cacheKeyPrefix+e,s=localStorage.getItem(t);if(!s)return null;const{data:r,timestamp:a}=JSON.parse(s);if(Date.now()-a>this.config.cacheTTL)return localStorage.removeItem(t),null;if(!this._validateIndex(r,e))return localStorage.removeItem(t),null;const i=await this._fetchManifest();if(i&&i.locales[e]){if(r.generated_at!==i.locales[e])return localStorage.removeItem(t),null}return r}catch(t){return null}}_saveToCache(e,t){try{const s=this.config.cacheKeyPrefix+e,r={data:t,timestamp:Date.now()},a=JSON.stringify(r),i=((a.length/1024).toFixed(1),1024*this.config.maxCacheSizeMB*1024);if(a.length>i)return;localStorage.setItem(s,a)}catch(s){"QuotaExceededError"===s.name&&this._clearOldCaches()}}_validateIndex(e,t){if(!e||"object"!=typeof e)return!1;if(e.locale!==t)return!1;if(!Array.isArray(e.posts))return!1;if(e.posts.length>0){const t=e.posts[0],s=["id","title","slug"];for(const e of s)if(!(e in t))return!1}return!0}_getIndexURL(e){const{basePath:t,filePattern:s}=this.config;return t+s.replace("{locale}",e)}_clearOldCaches(){const e=this.config.cacheKeyPrefix;try{const t=Object.keys(localStorage).filter((t=>t.startsWith(e))).map((e=>{try{return{key:e,timestamp:JSON.parse(localStorage.getItem(e)).timestamp||0}}catch{return{key:e,timestamp:0}}})).sort(((e,t)=>e.timestamp-t.timestamp));t.slice(0,Math.ceil(t.length/2)).forEach((e=>{localStorage.removeItem(e.key)}))}catch(t){}}async preload(e=[]){performance.now();try{await Promise.all(e.map((e=>this.load(e).catch((e=>{}))))),performance.now()}catch(t){}}clearAllCaches(){this.cache.clear();const e=this.config.cacheKeyPrefix;Object.keys(localStorage).filter((t=>t.startsWith(e))).forEach((e=>localStorage.removeItem(e)))}getStats(){const e=this.cache.size,t=this.config.cacheKeyPrefix;return{memoryCached:e,storageCached:Object.keys(localStorage).filter((e=>e.startsWith(t))).length,loadingInProgress:this.loadingPromises.size}}_delay(e){return new Promise((t=>setTimeout(t,e)))}async _fetchManifest(){try{const e=Date.now();if(this.manifestCache&&e-this.manifestLastFetch<this.manifestCacheTTL)return this.manifestCache;const t=this.config.basePath+"versions.json",s=await fetch(t,{cache:"no-cache"});if(!s.ok)return null;const r=await s.json();return r.locales&&"object"==typeof r.locales?(this.manifestCache=r,this.manifestLastFetch=e,r):null}catch(e){return null}}}const a=new class{constructor(){this.enabled=t.performance.enabled,this.metrics=new Map,this.marks=new Map,this.slowSearches=[]}mark(e){if(!this.enabled)return;const t=`search_${e}_start`;this.marks.set(e,performance.now()),performance.mark&&performance.mark(t)}measure(e){if(!this.enabled)return 0;const t=this.marks.get(e);if(!t)return 0;const s=performance.now()-t;if(this.marks.delete(e),this._recordMetric(e,s),performance.measure)try{performance.measure(`search_${e}`,`search_${e}_start`)}catch(r){}return s}_recordMetric(e,s){this.metrics.has(e)||this.metrics.set(e,{count:0,total:0,min:1/0,max:-1/0,values:[]});const r=this.metrics.get(e);r.count++,r.total+=s,r.min=Math.min(r.min,s),r.max=Math.max(r.max,s),r.values.push(s),r.values.length>100&&r.values.shift(),"search_latency"===e&&s>t.performance.slowSearchThreshold&&this._recordSlowSearch(s)}_recordSlowSearch(e){this.slowSearches.push({duration:e,timestamp:Date.now()}),this.slowSearches.length>20&&this.slowSearches.shift()}getMetric(e){if(!this.metrics.has(e))return null;const t=this.metrics.get(e),s=t.count>0?t.total/t.count:0,r=[...t.values].sort(((e,t)=>e-t)),a=r.length>0?r[Math.floor(r.length/2)]:0,i=Math.floor(.95*r.length),n=r.length>0?r[i]:0;return{name:e,count:t.count,avg:Math.round(100*s)/100,median:Math.round(100*a)/100,min:Math.round(100*t.min)/100,max:Math.round(100*t.max)/100,p95:Math.round(100*n)/100}}getAllMetrics(){const e={};for(const[t]of this.metrics)e[t]=this.getMetric(t);return e}getSummary(){const e=this.getMetric("search_latency"),t=this.getMetric("index_load"),s=this.getMetric("render");let r="A+",a=100;return e&&(e.p95>100?(r="C",a=75):e.p95>50?(r="B",a=85):e.p95>25&&(r="A",a=95)),{grade:r,score:a,metrics:{search_latency:e,index_load:t,render_time:s},slowSearchCount:this.slowSearches.length,recommendation:this._getRecommendation(e)}}_getRecommendation(e){return e?e.p95<25?"Excellent performance! üöÄ":e.p95<50?"Good performance, consider optimizing index size":e.p95<100?"Average performance, check index structure":"Poor performance, review search implementation":"No data yet"}logMetrics(){if(!this.enabled)return;this.getSummary();const e=this.getAllMetrics();Object.values(e).forEach((e=>{})),this.slowSearches.length}getMemoryUsage(){return performance.memory?{usedJSHeapSize:Math.round(performance.memory.usedJSHeapSize/1024/1024),totalJSHeapSize:Math.round(performance.memory.totalJSHeapSize/1024/1024),jsHeapSizeLimit:Math.round(performance.memory.jsHeapSizeLimit/1024/1024),unit:"MB"}:null}getCoreWebVitalsImpact(){const e=this.getMetric("index_load"),t=this.getMetric("search_latency");return{lcp_impact:e?`${e.avg}ms`:"Minimal",fid_impact:t?`${t.avg}ms`:"Minimal",cls_impact:"None (no layout shifts)",overall:e&&e.p95<100?"Good":"Needs improvement"}}export(){return{timestamp:(new Date).toISOString(),metrics:this.getAllMetrics(),summary:this.getSummary(),memory:this.getMemoryUsage(),webVitals:this.getCoreWebVitalsImpact()}}reset(){this.metrics.clear(),this.marks.clear(),this.slowSearches=[]}setEnabled(e){this.enabled=e}};class i{constructor(){this.locale=function(){const e=window.location.pathname.match(t.locales.urlPattern);return e&&(s=e[1],t.locales.supported.includes(s))?e[1]:t.locales.default;var s}(),this.engine=null,this.loader=new r,this.currentQuery="",this.elements={},this.isInitialized=!1,this.resultCache=new Map}async initialize(){a.mark("init");try{this._getDOMElements(),this._setupEventListeners(),this.currentQuery=this._getQueryFromURL(),await this._loadIndex(),this.currentQuery?(this._updateInputValue(this.currentQuery),await this.search(this.currentQuery)):this._showEmptyState(),this.isInitialized=!0,a.measure("init")}catch(e){this._showError("Failed to initialize search")}}async _loadIndex(){a.mark("index_load");try{this._updateLoadingText("Loading search index...");const e=await this.loader.load(this.locale);this._updateLoadingText("Indexing articles..."),this.engine=new s(this.locale),await this.engine.indexPosts(e.posts),this.elements.loading?.classList.add("hidden"),a.measure("index_load")}catch(e){throw e}}_updateLoadingText(e){const t=this.elements.loading?.querySelector(".search-loading__text");t&&(t.textContent=e)}async search(e){if(!e||e.trim().length<2)return void this._showEmptyState();const t=e.trim().toLowerCase();this.currentQuery=t;const s=`${this.locale}:${t}`;if(this.resultCache.has(s)){const e=this.resultCache.get(s);this._renderResults(e.results,e.query)}else{this._showLoadingState(),a.mark("search_latency");try{if(!this.engine||!this.engine.ready())throw new Error("Search engine not ready");const r=await this.engine.search(t,{limit:50,includeScore:!0});a.measure("search_latency"),a.mark("render"),this._cacheResults(s,r,e),this._renderResults(r,e),a.measure("render"),this._trackSearch(e,r.length)}catch(r){this._showError("Search failed")}}}_cacheResults(e,t,s){if(this.resultCache.size>=50){const e=this.resultCache.keys().next().value;this.resultCache.delete(e)}this.resultCache.set(e,{results:t,query:s,timestamp:Date.now()})}_renderResults(e,t){if(0===e.length)return void this._showEmptyState(t);if(this.elements.loading?.classList.add("hidden"),this.elements.empty?.classList.add("hidden"),this.elements.count){const s=1===e.length?`Found 1 result for "${t}"`:`Found ${e.length} results for "${t}"`;this.elements.count.textContent=s,this.elements.count.classList.remove("hidden")}const s=e.map((e=>this._renderPost(e,t))).join("");this.elements.results.innerHTML=s,this.elements.results.classList.remove("hidden"),this.elements.results.classList.add("fade-in")}_renderPost(e,t){const s=`${"en"===this.locale?"/blog":`/${this.locale}/blog`}/${e.slug}.html`,r=this._escapeHTML(e.title||""),a=this._escapeHTML(e.excerpt||""),i=this._escapeHTML(e.category||"uncategorized"),n=this._highlight(r,t),c=this._highlight(a,t);return`\n      <article class="blog-card" data-category="${i}">\n        <a href="${s}" class="blog-card__link">\n          <div class="blog-card__image">\n            <img src="${e.featured_image||"/blog-og-default.png"}" alt="${this._escapeHTML(e.featured_image_alt||r)}" loading="lazy">\n          </div>\n          <div class="blog-card__content">\n            <span class="blog-card__category">${i}</span>\n            <h3 class="blog-card__title">${n}</h3>\n            <p class="blog-card__excerpt">${c}</p>\n            <div class="blog-card__meta">\n              <span class="blog-card__date">${this._formatDate(e.date_published)}</span>\n              <span class="blog-card__readtime">${e.reading_time||5} min read</span>\n            </div>\n          </div>\n        </a>\n      </article>\n    `.trim()}_highlight(e,t){if(!e||!t)return e;const s=t.toLowerCase().split(/\s+/).filter((e=>e.length>2));let r=e;return s.forEach((e=>{const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(${t})`,"gi");r=r.replace(s,'<mark class="search-highlight">$1</mark>')})),r}_escapeHTML(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(e).replace(/[&<>"']/g,(e=>t[e]))}_formatDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return""}}_showLoadingState(){this.elements.loading?.classList.remove("hidden"),this.elements.results?.classList.add("hidden"),this.elements.empty?.classList.add("hidden"),this.elements.count?.classList.add("hidden")}_showEmptyState(e=""){if(this.elements.loading?.classList.add("hidden"),this.elements.results?.classList.add("hidden"),this.elements.count?.classList.add("hidden"),this.elements.empty){if(e){const t=this.elements.empty.querySelector(".search-empty__message");t&&(t.textContent=`No results found for "${e}". Try different keywords or browse all articles.`)}this.elements.empty.classList.remove("hidden")}}_showError(e,t=!0){if(this._showEmptyState(),this.elements.empty){const e=this.elements.empty.querySelector(".search-empty__title");e&&(e.textContent="‚ö†Ô∏è Search Unavailable");const s=this.elements.empty.querySelector(".search-empty__message");if(s&&(s.textContent="Search is temporarily unavailable. Browse all articles or try again later."),t&&!this.retryAttempts&&(this.retryAttempts=0),t&&this.retryAttempts<2){const e=this.elements.empty.querySelector(".search-empty__cta");if(e){e.innerHTML="";const t=document.createElement("button");t.textContent="Retry Search",t.className="search-empty__link",t.style.marginRight="10px",t.onclick=()=>{this.retryAttempts++,this.initialize()},e.appendChild(t);const s=document.createElement("a");s.href="/blog.html",s.textContent="Browse All Articles",s.className="search-empty__link",e.appendChild(s)}}else if(!t||this.retryAttempts>=2){const e=this.elements.empty?.querySelector(".search-empty__message");e&&(setTimeout((()=>{e.innerHTML='Redirecting to all articles in 5 seconds... <a href="/blog.html" style="color: var(--color-neon); text-decoration: underline;">Go now</a>'}),2e3),setTimeout((()=>{window.location.href="/blog.html"}),7e3))}}}_getDOMElements(){this.elements={input:document.getElementById("search-input"),form:document.getElementById("search-form"),results:document.getElementById("search-results"),loading:document.getElementById("search-loading"),empty:document.getElementById("search-empty"),count:document.getElementById("results-count")},this.elements.results}_setupEventListeners(){if(this.elements.form&&this.elements.form.addEventListener("submit",(e=>{e.preventDefault();const t=this.elements.input?.value.trim();t&&(this._updateURL(t),this.search(t))})),this.elements.input){let e;this.elements.input.addEventListener("input",(t=>{clearTimeout(e);const s=t.target.value.trim();e=setTimeout((()=>{s.length>=2?(this._updateURL(s),this.search(s)):0===s.length&&this._showEmptyState()}),200)}))}}_getQueryFromURL(){return new URLSearchParams(window.location.search).get("q")||""}_updateURL(e){const t=new URL(window.location);t.searchParams.set("q",e),window.history.pushState({},"",t)}_updateInputValue(e){this.elements.input&&(this.elements.input.value=e)}_trackSearch(e,t){e.length,this.locale,(new Date).toISOString()}getStats(){return{locale:this.locale,isInitialized:this.isInitialized,currentQuery:this.currentQuery,cacheSize:this.resultCache.size,engine:this.engine?this.engine.getStats():null,loader:this.loader?this.loader.getStats():null,performance:a.getSummary()}}clearCaches(){this.resultCache.clear(),this.loader.clearAllCaches()}}window.addEventListener("error",(e=>{if(document.getElementById("search-results")){const e=document.getElementById("search-empty"),t=document.getElementById("search-loading");if(t&&t.classList.add("hidden"),e){e.classList.remove("hidden");const t=e.querySelector(".search-empty__title"),s=e.querySelector(".search-empty__message");t&&(t.textContent="‚ö†Ô∏è Something Went Wrong"),s&&(s.textContent="An unexpected error occurred. Please try refreshing the page or browse all articles.")}}})),window.addEventListener("unhandledrejection",(e=>{})),document.addEventListener("DOMContentLoaded",(async()=>{try{const e=new i;await e.initialize()}catch(e){const t=document.getElementById("search-empty"),s=document.getElementById("search-loading");if(s&&s.classList.add("hidden"),t){t.classList.remove("hidden");const e=t.querySelector(".search-empty__title"),s=t.querySelector(".search-empty__message");e&&(e.textContent="‚ö†Ô∏è Search Unavailable"),s&&(s.innerHTML='Search could not be initialized. <a href="/blog.html" style="color: var(--color-neon); text-decoration: underline;">Browse all articles</a> instead.')}}}));
