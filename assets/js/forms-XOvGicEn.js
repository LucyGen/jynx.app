import{l as e}from"./logger-BUGiJmJP.js";import{a as t}from"./animations-D8EY1eRf.js";const i=new class{constructor(e="en"){this.defaultLocale=e,this.translations={},this.observers=new Set,this.loadingPromises={},this.supportedLocales=["en","fr","es","pt","de","it","ru","ar","hi","id","pl","uk","ko","tr","bn","vi"],this.currentLocale=this.determineLocale(),this.currentLocale!==this.defaultLocale&&this._preloadTranslation(this.defaultLocale)}determineLocale(){const e=window.location.pathname,t=e.match(/^\/([a-z]{2})(\/|$)/);if(t){const e=t[1].toLowerCase();if(this.supportedLocales.includes(e))return localStorage.setItem("userLocale",e),e}if("/"===e||e.startsWith("/index")||e.startsWith("/about")||e.startsWith("/download")||e.startsWith("/privacy")||e.startsWith("/terms"))return localStorage.setItem("userLocale",this.defaultLocale),this.defaultLocale;const i=localStorage.getItem("userLocale");return i&&this.supportedLocales.includes(i)?i:this.defaultLocale}_preloadTranslation(e){return this.loadingPromises[e]||(this.loadingPromises[e]=this._fetchTranslation(e).then((t=>(this.translations[e]=t,t))).catch((e=>null))),this.loadingPromises[e]}async _fetchTranslation(e){const t=`/locales/${e}.json`;try{const e=await fetch(t,{headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!e.ok)throw new Error(`Failed to load translations. Status: ${e.status}`);const i=await e.json();if("object"!=typeof i||null===i)throw new Error("Invalid translation file format");return i}catch(i){throw i}}async init(){try{document.documentElement.lang=this.currentLocale,this.setupLanguageSwitcher(),this.syncLanguageSelectors(this.currentLocale)}catch(e){this.currentLocale=this.defaultLocale}}preloadRemainingLocales(){const e=this.supportedLocales.filter((e=>!this.translations[e]));0!==e.length&&(window.pageLoader?"function"==typeof window.pageLoader.onBackgroundLoadSafe?window.pageLoader.onBackgroundLoadSafe((()=>this._preloadAllLocales(e))):"function"==typeof window.pageLoader.onReady?window.pageLoader.onReady((()=>this._preloadAllLocales(e))):this._schedulePreload(e):this._schedulePreload(e))}_schedulePreload(e){"function"==typeof window.requestIdleCallback?window.requestIdleCallback((()=>this._preloadAllLocales(e))):setTimeout((()=>this._preloadAllLocales(e)),1e3)}_preloadAllLocales(e){e.forEach((e=>{this.translations[e]||e===this.currentLocale||this._preloadTranslation(e)}))}async changeLocale(e){if(e!==this.currentLocale&&this.supportedLocales.includes(e))try{localStorage.setItem("userLocale",e);const t=this._buildLanguageUrl(e);window.location.href=t}catch(t){}}_buildLanguageUrl(e){const t=window.location.pathname;let i="en",s="index";const a=t.match(/^\/([a-z]{2})(\/|$)/);if(a&&this.supportedLocales.includes(a[1])){i=a[1];const e=t.replace(`/${i}`,"");s=this._extractPageName(e)}else s=this._extractPageName(t);let o;return o="en"===e?"index"===s?"/":`/${s}`:"index"===s?`/${e}/`:`/${e}/${s}`,window.location.hash&&(o+=window.location.hash),o}_extractPageName(e){const t=e.replace(/^\/|\/$/g,"").replace(/\.html$/,"");return t&&0!==t.length&&["index","about","download","privacy","terms"].includes(t)?t:"index"}syncLanguageSelectors(e){try{const t=document.querySelectorAll("#language-switcher, #language-selector");if(!t.length)return;const i=e.toString().toLowerCase();t.forEach((e=>{const t=e.options;if(t?.length){const s=Array.from(t).find((e=>e.value.toLowerCase()===i));s&&e.value!==s.value&&(e.value=s.value)}}))}catch(t){}}_showLoadingIndicator(e){const t=document.querySelectorAll("#language-switcher, #language-selector"),i=document.querySelectorAll("[data-i18n], [data-i18n-placeholder], [data-i18n-aria-label]");let s=document.querySelector(".language-transition-container"),a=document.getElementById("i18n-success-icon");e?(a&&(a.style.display="none"),s||(s=document.createElement("div"),s.classList.add("language-transition-container"),document.body.appendChild(s),s.offsetHeight),s.classList.add("active"),t.forEach((e=>{e.classList.add("loading"),e.setAttribute("aria-busy","true")})),i.forEach((e=>{e.classList.add("i18n-loading")})),this._announceToScreenReaders("Changing language. Please wait.")):(s&&(s.classList.remove("active"),setTimeout((()=>{s&&s.parentNode&&s.parentNode.removeChild(s)}),300)),t.forEach((e=>{e.classList.remove("loading"),e.removeAttribute("aria-busy"),e.classList.add("switch-complete"),this._showSuccessIcon(e),setTimeout((()=>{e.classList.remove("switch-complete")}),600)})),i.forEach((e=>{e.classList.remove("i18n-loading")})),this._announceToScreenReaders(`Language changed to ${this.currentLocale}`))}_showSuccessIcon(e){let t=document.getElementById("i18n-success-icon");t||(t=document.createElement("div"),t.setAttribute("id","i18n-success-icon"),t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.zIndex="9999",t.style.pointerEvents="none",t.style.borderRadius="50%",t.style.backgroundColor="var(--color-success, #4CAF50)",t.style.color="white",t.style.width="20px",t.style.height="20px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.opacity="0",t.style.transition="opacity 0.2s ease-out",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',document.body.appendChild(t));const i=e.getBoundingClientRect();t.style.top=i.top+i.height/2-10+"px",t.style.left=`${i.right+10}px`,t.style.opacity="1",setTimeout((()=>{t&&(t.style.opacity="0")}),1500),window.matchMedia("(prefers-reduced-motion: reduce)").matches||t.animate([{transform:"scale(0.8)",opacity:0},{transform:"scale(1.1)",opacity:1},{transform:"scale(1)",opacity:1}],{duration:300,easing:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fill:"forwards"})}_announceToScreenReaders(e){try{let t=document.getElementById("i18n-sr-announcer");t||(t=document.createElement("div"),t.setAttribute("id","i18n-sr-announcer"),t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.style.position="absolute",t.style.width="1px",t.style.height="1px",t.style.padding="0",t.style.margin="-1px",t.style.overflow="hidden",t.style.clip="rect(0, 0, 0, 0)",t.style.whiteSpace="nowrap",t.style.border="0",document.body.appendChild(t)),t.textContent=e}catch(t){}}setupLanguageSwitcher(){try{const e=document.querySelectorAll("#language-switcher, #language-selector");if(!e.length)return;const t=t=>{e.forEach((e=>{e.value!==t&&(e.value=t)}))};if(this.currentLocale){const i=this.currentLocale.toString().toLowerCase();let s=null;for(const t of e){const e=t.options;if(e?.length){const t=Array.from(e).find((e=>e.value.toLowerCase()===i));if(t){s=t.value;break}}}s&&t(s)}e.forEach((e=>{const i=e.cloneNode(!0);e.parentNode.replaceChild(i,e),i.addEventListener("change",(e=>{const i=e.target.value;t(i),this.changeLocale(i)}))}))}catch(e){}}async loadTranslations(e){try{return this.loadingPromises[e]||(this.loadingPromises[e]=this._fetchTranslation(e).then((t=>(this.translations[e]=t,t)))),await this.loadingPromises[e],this.currentLocale=e,this.translations[e]}catch(t){throw t}}translate(e,t={}){if(!e)return"";const i=e.split(".");let s=this.translations[this.currentLocale];if(!s)return e;for(const a of i)if(s=s?.[a],void 0===s){s=this.getFromDefaultLocale(e);break}return"string"!=typeof s?e:s.replace(/\{\{\s*(\w+)\s*\}\}/g,((e,i)=>void 0!==t[i]?t[i]:`{{${i}}}`))}getFromDefaultLocale(e){if(!e)return"";const t=e.split(".");let i=this.translations[this.defaultLocale];if(!i)return e;for(const s of t)if(i=i?.[s],void 0===i)return e;return i}updatePageContent(){try{document.querySelectorAll("[data-i18n]").forEach((e=>{const t=e.getAttribute("data-i18n");e.textContent=this.translate(t),e.classList.add("i18n-transition")})),document.querySelectorAll("[data-i18n-placeholder]").forEach((e=>{const t=e.getAttribute("data-i18n-placeholder");e.placeholder=this.translate(t),e.classList.add("i18n-transition")})),document.querySelectorAll("[data-i18n-aria-label]").forEach((e=>{const t=e.getAttribute("data-i18n-aria-label");e.setAttribute("aria-label",this.translate(t)),e.classList.add("i18n-transition")}))}catch(e){}}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}notifyObservers(){this.observers.forEach((e=>{try{e(this.currentLocale)}catch(t){}}))}getCurrentLocale(){return this.currentLocale}};"undefined"!=typeof window&&(window.i18n=i),document.addEventListener("DOMContentLoaded",(()=>{i.init().catch((e=>{}))}));const s=function(e,t=""){e&&(e.dataset.originalText=e.innerHTML,e.dataset.originalDisabled=e.disabled,e.classList.add("is-loading"),e.disabled=!0,e.setAttribute("aria-busy","true"))},a=function(e){e&&(e.classList.remove("is-loading"),e.removeAttribute("aria-busy"),"originalText"in e.dataset&&(e.innerHTML=e.dataset.originalText,delete e.dataset.originalText),"originalDisabled"in e.dataset?(e.disabled="true"===e.dataset.originalDisabled,delete e.dataset.originalDisabled):e.disabled=!1)},o=e.getModuleLogger("google-sheets-service");async function r(e,t){throw new Error("Google Sheets web app URL is not configured")}const n=async function(e,t={}){o.info("Adding email to waitlist",{email:e.substring(0,3)+"..."});try{o.time("waitlist-submission"),(new Date).toISOString(),window.location.href,navigator.userAgent,navigator.language||navigator.userLanguage;const e=await r();return o.timeEnd("waitlist-submission"),o.info("Email added to waitlist successfully"),{success:!0,...e}}catch(i){throw o.error("Error adding email to waitlist",i),i}},l=async function(e,t={}){o.info("Submitting feedback",{feedbackLength:e.length,feedbackPreview:e.substring(0,20)+(e.length>20?"...":"")});try{o.time("feedback-submission"),(new Date).toISOString(),t.email,window.location.href,window.location.pathname,navigator.userAgent,navigator.language||navigator.userLanguage;const e=await r();return o.timeEnd("feedback-submission"),o.info("Feedback submitted successfully"),{success:!0,...e}}catch(i){throw o.error("Error submitting feedback",i),i}},c=e.getModuleLogger("form-error-handler"),d=new class{constructor(){this.errorKeys={"permission-denied":"form.errors.permission_denied","invalid-argument":"form.errors.invalid_argument","not-found":"form.errors.not_found",unavailable:"form.errors.server_unavailable","resource-exhausted":"form.errors.too_many_requests",internal:"form.errors.server_error","network-error":"form.errors.network_error",timeout:"form.errors.timeout","invalid-email":"form.errors.invalid_email","empty-field":"form.errors.empty_field",default:"form.errors.default"}}handleError(e,t,i={}){c.error("Form error",e);const s={clearOnFocus:!0,associatedInput:null,...i},a=e.code&&e.code.split("/")[1]||e.code||e.name||"default",o=this.getErrorMessage(a,e.message);return t&&(t.textContent=o,t.setAttribute("role","alert"),t.classList.add("active"),s.clearOnFocus&&s.associatedInput&&s.associatedInput.addEventListener("focus",(()=>{t.textContent="",t.classList.remove("active"),t.removeAttribute("role")}),{once:!0})),o}getErrorMessage(e,t){if(this.errorKeys[e])return i.translate(this.errorKeys[e]);for(const s in this.errorKeys)if(e.includes(s))return i.translate(this.errorKeys[s]);return c.debug("Unknown error code, using fallback",{code:e,fallback:!!t}),t||i.translate(this.errorKeys.default)}},u=new class{constructor(){this.isInitialized=!1,this.logger=e.getModuleLogger("form-manager"),this.logger.info("FormManager instance created")}init(){if(this.isInitialized)this.logger.warn("FormManager already initialized");else{this.logger.time("form-manager-initialization"),this.logger.info("Initializing form manager");try{this.logger.debug("Setting up forms"),this.setupForms(),this.logger.debug("Setting up feedback system"),this.setupFeedbackSystem(),this.logger.info("Form manager initialization complete")}catch(e){this.logger.error("Form manager initialization failed",e)}finally{this.isInitialized=!0,this.logger.timeEnd("form-manager-initialization")}}}setupForms(){this.logger.debug("Setting up form handlers");const e=document.getElementById("signup-form"),o=document.getElementById("email"),r=document.getElementById("email-error");this.logger.debug("Form elements:",{signupFormFound:!!e,emailInputFound:!!o,emailErrorFound:!!r});const n=document.getElementById("combined-form");e?(this.logger.debug("Adding event listener to signup form"),e.addEventListener("submit",(async n=>{n.preventDefault(),this.logger.debug("Signup form submitted");const l=o.value.trim();if(this.logger.debug("Validating email",{email:l.substring(0,3)+"..."}),!this.validateEmail(l))return this.logger.debug("Email validation failed"),r.textContent=i.translate("form.email.error"),void o.focus();r.textContent="",this.logger.debug("Email validation passed, proceeding with submission");try{const a=e.querySelector('button[type="submit"]');s(a,i.translate("form.submitting")),this.logger.debug("Form in submission state"),this.logger.time("form-submission");const o=await this.submitWaitlistEmail(l);this.logger.timeEnd("form-submission"),this.logger.info("Form submission successful",{email:l.substring(0,3)+"...",success:o.success,duration:o.duration+"ms"}),this.logger.debug("Animating form success state"),t.setupFormAnimation(e,(()=>{e.innerHTML=`<div class="success-message">${i.translate("form.success")}</div>`;const t=e.querySelector(".success-message");t&&(t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="opacity 0.6s ease-out, transform 0.6s ease-out",requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="translateY(0)"}))),this.logger.debug("Success message displayed")}))}catch(c){this.logger.error("Form submission error:",c);const t=e.querySelector('button[type="submit"]');a(t),d.handleError(c,r,{clearOnFocus:!0,associatedInput:o})}}))):n?this.logger.info("Using combined form instead of separate signup form"):this.logger.debug("Signup form not found. This is expected if using the combined form approach."),function(e=".btn"){document.querySelectorAll(e).forEach((e=>{e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())})),"a"===e.tagName.toLowerCase()&&e.setAttribute("role","button")}))}()}setupFeedbackSystem(){this.logger.debug("Setting up feedback system");const e=document.getElementById("feedback-form"),t=document.getElementById("feedback-thanks"),o=document.getElementById("combined-form"),r=document.getElementById("form-thanks");this.logger.debug("Feedback elements:",{feedbackFormFound:!!e,feedbackThanksFound:!!t,combinedFormFound:!!o,formThanksFound:!!r}),o?this.logger.info("Using combined form approach for feedback"):e?(this.logger.debug("Setting up feedback form"),e.style.opacity="1",e.style.height="auto",this.logger.debug("Feedback form is always visible"),e.addEventListener("submit",(async o=>{o.preventDefault(),this.logger.debug("Feedback form submitted");const r=document.getElementById("feedback-text").value.trim();if(r){this.logger.debug("Feedback text provided, length:",r.length);try{const o=e.querySelector('button[type="submit"]');s(o,i.translate("feedback.submitting")),this.logger.debug("Feedback form in submission state"),this.logger.time("feedback-submission");const n=await this.submitFeedback(r);this.logger.timeEnd("feedback-submission"),this.logger.info("Feedback submission successful",{type:"positive",textLength:r.length,success:n.success}),this.logger.debug("Animating feedback form out"),e.style.transition="height 0.5s ease-in, opacity 0.5s ease-in",e.style.height=e.scrollHeight+"px",requestAnimationFrame((()=>{e.style.height="0",e.style.opacity="0",e.addEventListener("transitionend",(()=>{e.classList.add("hidden"),e.reset(),this.logger.trace("Feedback form hidden and reset"),this.logger.debug("Animating thanks message in"),t.style.opacity="0",t.style.transform="scale(0.9)",t.style.transition="opacity 0.5s ease-out, transform 0.5s ease-out",t.classList.remove("hidden"),requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="scale(1)",this.logger.debug("Thanks message shown, scheduling auto-hide"),setTimeout((()=>{t.style.opacity="0",t.style.transform="scale(0.9)",t.addEventListener("transitionend",(()=>{t.classList.add("hidden"),a(o),this.logger.debug("Reset feedback UI state")}),{once:!0})}),3e3)}))}))}))}catch(n){this.logger.error("Feedback submission error:",n);const t=e.querySelector('button[type="submit"]');a(t);const i=document.createElement("div");i.classList.add("error-message"),e.appendChild(i),d.handleError(n,i),setTimeout((()=>{i.parentNode&&i.parentNode.removeChild(i)}),5e3)}}else this.logger.debug("Empty feedback text, submission ignored")}))):this.logger.debug("Separate feedback form not found. This is expected when using the combined form approach.")}validateEmail(e){return this.logger.trace("Validating email format"),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}async submitWaitlistEmail(e){this.logger.debug("Submitting email to waitlist",{email:e.substring(0,3)+"..."});try{let s="en";try{s=i.getCurrentLocale()}catch(t){s=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:s})}const a={uiLanguage:s};return await n(e,a)}catch(s){throw this.logger.error("Waitlist submission error",s),s}}async submitFeedback(e){this.logger.debug("Submitting feedback",{feedbackLength:e.length});try{let s="en";try{s=i.getCurrentLocale()}catch(t){s=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:s})}const a={uiLanguage:s};return await l(e,a)}catch(s){throw this.logger.error("Feedback submission error",s),s}}},g=new class{constructor(){this.isInitialized=!1,this.logger=e.getModuleLogger("combined-form-handler"),this.logger.info("CombinedFormHandler instance created")}init(){if(this.isInitialized)this.logger.warn("CombinedFormHandler already initialized");else{this.logger.time("combined-form-initialization"),this.logger.info("Initializing combined form handler");try{this.setupCombinedForm(),this.logger.info("Combined form handler initialization complete")}catch(e){this.logger.error("Combined form handler initialization failed",e)}finally{this.isInitialized=!0,this.logger.timeEnd("combined-form-initialization")}}}setupCombinedForm(){this.logger.debug("Setting up combined form handler");const e=document.getElementById("combined-form"),t=document.getElementById("email"),o=document.getElementById("feedback-text"),r=document.getElementById("email-error"),n=document.getElementById("form-thanks");this.logger.debug("Form elements:",{combinedFormFound:!!e,emailInputFound:!!t,feedbackTextFound:!!o,emailErrorFound:!!r,formThanksFound:!!n}),e?(this.logger.debug("Adding event listener to combined form"),e.addEventListener("submit",(async l=>{l.preventDefault(),this.logger.debug("Combined form submitted");const c=t.value.trim(),u=o.value.trim();if(this.logger.debug("Validating form data",{email:c?c.substring(0,3)+"...":"empty",hasFeedback:!!u}),c&&!this.validateEmail(c))return this.logger.debug("Email validation failed"),r.textContent=i.translate("form.email.error"),void t.focus();if(!c&&!u)return this.logger.debug("Both email and feedback are empty"),void(r.textContent=i.translate("feedback.error_empty"));r.textContent="",this.logger.debug("Email validation passed, proceeding with submission");try{const t=e.querySelector('button[type="submit"]');let a;if(s(t,i.translate("form.submitting")),this.logger.debug("Form in submission state"),c&&(this.logger.time("waitlist-submission"),a=await this.submitWaitlistEmail(c),this.logger.timeEnd("waitlist-submission"),this.logger.info("Waitlist submission successful",{email:c.substring(0,3)+"...",success:a.success})),u){this.logger.time("feedback-submission");const e=await this.submitFeedback(u,c);this.logger.timeEnd("feedback-submission"),this.logger.info("Feedback submission successful",{textLength:u.length,success:e.success})}document.dispatchEvent(new CustomEvent("form-submission-success")),this.logger.debug("Animating form success transition"),e.style.transition="height 0.5s ease-in, opacity 0.5s ease-in",e.style.height=e.scrollHeight+"px",requestAnimationFrame((()=>{e.style.height="0",e.style.opacity="0",e.addEventListener("transitionend",(()=>{e.classList.add("hidden"),e.reset(),this.logger.debug("Animating thanks message"),n.style.opacity="0",n.style.transform="scale(0.9)",n.style.transition="opacity 0.5s ease-out, transform 0.5s ease-out",n.classList.remove("hidden"),requestAnimationFrame((()=>{n.style.opacity="1",n.style.transform="scale(1)"}))}),{once:!0})}))}catch(g){this.logger.error("Form submission error:",g);const i=e.querySelector('button[type="submit"]');a(i),d.handleError(g,r,{clearOnFocus:!0,associatedInput:t})}}))):this.logger.warn("Combined form not found, form handler not initialized")}validateEmail(e){return this.logger.trace("Validating email format"),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}async submitWaitlistEmail(e){this.logger.debug("Submitting email to waitlist",{email:e.substring(0,3)+"..."});try{let s="en";try{s=i.getCurrentLocale()}catch(t){s=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:s})}const a={uiLanguage:s};return await n(e,a)}catch(s){throw this.logger.error("Waitlist submission error",s),s}}async submitFeedback(e,t=null){this.logger.debug("Submitting feedback",{feedbackLength:e.length,hasEmail:!!t});try{let a="en";try{a=i.getCurrentLocale()}catch(s){a=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:a})}const o={uiLanguage:a,email:t||null};return await l(e,o)}catch(a){throw this.logger.error("Feedback submission error",a),a}}};export{g as c,u as f,i};
