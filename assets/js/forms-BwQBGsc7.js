import{l as e}from"./logger-BUGiJmJP.js";import{a as t}from"./animations-qrCngR8q.js";const s=new class{constructor(e="en"){this.defaultLocale=e,this.translations={},this.loadingPromises={},this.blogPostsData=null,this.languageDropdownInstances=[],this.supportedLocales=["en","fr","es","pt","de","it","ru","ar","hi","id","pl","uk","ko","tr","bn","vi"],this.currentLocale=this.determineLocale(),this.currentLocale!==this.defaultLocale&&this._preloadTranslation(this.defaultLocale)}determineLocale(){const e=window.location.pathname,t=e.match(/^\/([a-z]{2})(\/|$)/);if(t){const e=t[1].toLowerCase();if(this.supportedLocales.includes(e))return localStorage.setItem("userLocale",e),e}if("/"===e||e.startsWith("/index")||e.startsWith("/about")||e.startsWith("/download")||e.startsWith("/privacy")||e.startsWith("/terms"))return localStorage.setItem("userLocale",this.defaultLocale),this.defaultLocale;const s=localStorage.getItem("userLocale");return s&&this.supportedLocales.includes(s)?s:this.defaultLocale}registerLanguageDropdown(e){e&&!this.languageDropdownInstances.includes(e)&&this.languageDropdownInstances.push(e)}_preloadTranslation(e){return this.loadingPromises[e]||(this.loadingPromises[e]=this._fetchTranslation(e).then((t=>(this.translations[e]=t,t))).catch((e=>null))),this.loadingPromises[e]}async _fetchTranslation(e){const t=`/locales/${e}.json`;try{const e=await fetch(t,{headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!e.ok)throw new Error(`Failed to load translations. Status: ${e.status}`);const s=await e.json();if("object"!=typeof s||null===s)throw new Error("Invalid translation file format");return s}catch(s){throw s}}async _loadBlogPostsData(){if(null!==this.blogPostsData)return this.blogPostsData;try{const e=await fetch("/content/blog/blog-posts.json",{headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!e.ok)throw new Error(`Failed to load blog posts data. Status: ${e.status}`);const t=await e.json();if("object"!=typeof t||!t.posts||!Array.isArray(t.posts))throw new Error("Invalid blog posts data format");return this.blogPostsData=t,t}catch(e){return this.blogPostsData={posts:[]},this.blogPostsData}}async init(){try{document.documentElement.lang=this.currentLocale,this._restoreScrollPosition(),await this.loadTranslations(this.currentLocale),window.i18nData=this.translations[this.currentLocale],this.setupLanguageSwitcher(),this.syncLanguageSelectors(this.currentLocale)}catch(e){this.currentLocale=this.defaultLocale}}_restoreScrollPosition(){try{const e=sessionStorage.getItem("i18n_scroll_position");if(null!==e){const t=parseInt(e,10);sessionStorage.removeItem("i18n_scroll_position"),requestAnimationFrame((()=>{window.scrollTo({top:t,behavior:"instant"})}))}}catch(e){}}async changeLocale(e){if(e!==this.currentLocale&&this.supportedLocales.includes(e))try{localStorage.setItem("userLocale",e);const t=window.scrollY||window.pageYOffset;sessionStorage.setItem("i18n_scroll_position",t.toString());const s=await this._buildLanguageUrl(e);window.location.href=s}catch(t){}}async _buildLanguageUrl(e){const t=window.location.pathname;let s="en",i="index";const o=t.match(/^\/([a-z]{2})(\/|$)/);if(o&&this.supportedLocales.includes(o[1])){s=o[1];const e=t.replace(`/${s}`,"");i=this._extractPageName(e)}else i=this._extractPageName(t);if("blog"===i)return"en"===e?"/blog.html"+(window.location.hash||""):`/${e}/blog.html`+(window.location.hash||"");if(i.startsWith("blog/")){const t=i.replace("blog/",""),s=await this._getBlogSlugForLocale(t,e);return s?"en"===e?`/blog/${s}.html`+(window.location.hash||""):`/${e}/blog/${s}.html`+(window.location.hash||""):"en"===e?"/blog.html"+(window.location.hash||""):`/${e}/blog.html`+(window.location.hash||"")}let a;return a="en"===e?"index"===i?"/":`/${i}`:"index"===i?`/${e}/`:`/${e}/${i}`,window.location.hash&&(a+=window.location.hash),a}_extractPageName(e){const t=e.replace(/^\/|\/$/g,"").replace(/\.html$/,"");return t&&0!==t.length?"blog"===t?"blog":t.startsWith("blog/")||["index","about","download","privacy","terms"].includes(t)?t:"index":"index"}async _getBlogSlugForLocale(e,t){try{if(await this._loadBlogPostsData(),!this.blogPostsData||!this.blogPostsData.posts||0===this.blogPostsData.posts.length)return null;const s=this.blogPostsData.posts.find((t=>t.slug===e||!!t.translated_slugs&&Object.values(t.translated_slugs).includes(e)));return s&&s.translated_slugs&&s.translated_slugs[t]?s.translated_slugs[t]:null}catch(s){return null}}syncLanguageSelectors(e){try{const t=document.querySelectorAll("#language-switcher, #language-selector"),s=e.toString().toLowerCase();t.forEach((e=>{const t=e.options;if(t?.length){const i=Array.from(t).find((e=>e.value.toLowerCase()===s));i&&e.value!==i.value&&(e.value=i.value)}})),this.languageDropdownInstances.forEach((e=>{e&&"function"==typeof e.updateValue&&e.updateValue(s)}))}catch(t){}}setupLanguageSwitcher(){try{const e=document.querySelectorAll("#language-switcher, #language-selector");if(!e.length)return;const t=t=>{e.forEach((e=>{e.value!==t&&(e.value=t)}))};if(this.currentLocale){const s=this.currentLocale.toString().toLowerCase();let i=null;for(const t of e){const e=t.options;if(e?.length){const t=Array.from(e).find((e=>e.value.toLowerCase()===s));if(t){i=t.value;break}}}i&&t(i)}e.forEach((e=>{const s=e.cloneNode(!0);e.parentNode.replaceChild(s,e),s.addEventListener("change",(e=>{const s=e.target.value;t(s),this.changeLocale(s)}))}))}catch(e){}}async loadTranslations(e){try{return this.loadingPromises[e]||(this.loadingPromises[e]=this._fetchTranslation(e).then((t=>(this.translations[e]=t,t)))),await this.loadingPromises[e],this.currentLocale=e,this.translations[e]}catch(t){throw t}}translate(e,t={}){if(!e)return"";const s=e.split(".");let i=this.translations[this.currentLocale];if(!i)return e;for(const o of s)if(i=i?.[o],void 0===i){i=this.getFromDefaultLocale(e);break}return"string"!=typeof i?e:i.replace(/\{\{\s*(\w+)\s*\}\}/g,((e,s)=>void 0!==t[s]?t[s]:`{{${s}}}`))}getFromDefaultLocale(e){if(!e)return"";const t=e.split(".");let s=this.translations[this.defaultLocale];if(!s)return e;for(const i of t)if(s=s?.[i],void 0===s)return e;return s}getCurrentLocale(){return this.currentLocale}};"undefined"!=typeof window&&(window.i18n=s),document.addEventListener("DOMContentLoaded",(()=>{s.init().catch((e=>{}))})),window.addEventListener("pageshow",(e=>{if(e.persisted)try{const e=s.determineLocale();e!==s.currentLocale&&(s.currentLocale=e),s.syncLanguageSelectors(e),document.documentElement.lang=e}catch(t){}}));const i=function(e,t=""){e&&(e.dataset.originalText=e.innerHTML,e.dataset.originalDisabled=e.disabled,e.classList.add("is-loading"),e.disabled=!0,e.setAttribute("aria-busy","true"))},o=function(e){e&&(e.classList.remove("is-loading"),e.removeAttribute("aria-busy"),"originalText"in e.dataset&&(e.innerHTML=e.dataset.originalText,delete e.dataset.originalText),"originalDisabled"in e.dataset?(e.disabled="true"===e.dataset.originalDisabled,delete e.dataset.originalDisabled):e.disabled=!1)},a=e.getModuleLogger("google-sheets-service"),r="https://script.google.com/macros/s/AKfycbys7QFeL7twK66r_CpcUQ_aeFzXFAHAzHqtAR49hPlyOno3L4tk8X3PFKlGocmVkKm7Lg/exec";async function n(e,t){try{return await fetch(e,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a.info("Data submitted to Google Sheets"),{success:!0,message:"Submitted successfully"}}catch(s){throw a.error("Google Sheets submission error",s),s}}const l={addToWaitlist:async function(e,t={}){a.info("Adding email to waitlist",{email:e.substring(0,3)+"..."});try{a.time("waitlist-submission");const s={timestamp:(new Date).toISOString(),email:e,feedback:"",...t,source:window.location.href,userAgent:navigator.userAgent,browserLanguage:navigator.language||navigator.userLanguage},i=await n(r,s);return a.timeEnd("waitlist-submission"),a.info("Email added to waitlist successfully"),{success:!0,...i}}catch(s){throw a.error("Error adding email to waitlist",s),s}},submitFeedback:async function(e,t={}){a.info("Submitting feedback",{feedbackLength:e.length,feedbackPreview:e.substring(0,20)+(e.length>20?"...":"")});try{a.time("feedback-submission");const s={timestamp:(new Date).toISOString(),email:t.email||"",feedback:e,...t,source:window.location.href,pathname:window.location.pathname,userAgent:navigator.userAgent,browserLanguage:navigator.language||navigator.userLanguage},i=await n(r,s);return a.timeEnd("feedback-submission"),a.info("Feedback submitted successfully"),{success:!0,...i}}catch(s){throw a.error("Error submitting feedback",s),s}}},c=e.getModuleLogger("form-error-handler"),g=new class{constructor(){this.errorKeys={"permission-denied":"form.errors.permission_denied","invalid-argument":"form.errors.invalid_argument","not-found":"form.errors.not_found",unavailable:"form.errors.server_unavailable","resource-exhausted":"form.errors.too_many_requests",internal:"form.errors.server_error","network-error":"form.errors.network_error",timeout:"form.errors.timeout","invalid-email":"form.errors.invalid_email","empty-field":"form.errors.empty_field",default:"form.errors.default"}}handleError(e,t,s={}){c.error("Form error",e);const i={clearOnFocus:!0,associatedInput:null,...s},o=e.code&&e.code.split("/")[1]||e.code||e.name||"default",a=this.getErrorMessage(o,e.message);return t&&(t.textContent=a,t.setAttribute("role","alert"),t.classList.add("active"),i.clearOnFocus&&i.associatedInput&&i.associatedInput.addEventListener("focus",(()=>{t.textContent="",t.classList.remove("active"),t.removeAttribute("role")}),{once:!0})),a}getErrorMessage(e,t){if(this.errorKeys[e])return s.translate(this.errorKeys[e]);for(const i in this.errorKeys)if(e.includes(i))return s.translate(this.errorKeys[i]);return c.debug("Unknown error code, using fallback",{code:e,fallback:!!t}),t||s.translate(this.errorKeys.default)}},u=new class{constructor(){this.isInitialized=!1,this.logger=e.getModuleLogger("form-manager"),this.logger.info("FormManager instance created")}init(){if(this.isInitialized)this.logger.warn("FormManager already initialized");else{this.logger.time("form-manager-initialization"),this.logger.info("Initializing form manager");try{this.logger.debug("Setting up forms"),this.setupForms(),this.logger.debug("Setting up feedback system"),this.setupFeedbackSystem(),this.logger.info("Form manager initialization complete")}catch(e){this.logger.error("Form manager initialization failed",e)}finally{this.isInitialized=!0,this.logger.timeEnd("form-manager-initialization")}}}setupForms(){this.logger.debug("Setting up form handlers");const e=document.getElementById("signup-form"),a=document.getElementById("email"),r=document.getElementById("email-error");this.logger.debug("Form elements:",{signupFormFound:!!e,emailInputFound:!!a,emailErrorFound:!!r});const n=document.getElementById("combined-form");e?(this.logger.debug("Adding event listener to signup form"),e.addEventListener("submit",(async n=>{n.preventDefault(),this.logger.debug("Signup form submitted");const l=a.value.trim();if(this.logger.debug("Validating email",{email:l.substring(0,3)+"..."}),!this.validateEmail(l))return this.logger.debug("Email validation failed"),r.textContent=s.translate("form.email.error"),void a.focus();r.textContent="",this.logger.debug("Email validation passed, proceeding with submission");try{const o=e.querySelector('button[type="submit"]');i(o,s.translate("form.submitting")),this.logger.debug("Form in submission state"),this.logger.time("form-submission");const a=await this.submitWaitlistEmail(l);this.logger.timeEnd("form-submission"),this.logger.info("Form submission successful",{email:l.substring(0,3)+"...",success:a.success,duration:a.duration+"ms"}),this.logger.debug("Animating form success state"),t.setupFormAnimation(e,(()=>{e.innerHTML=`<div class="success-message">${s.translate("form.success")}</div>`;const t=e.querySelector(".success-message");t&&(t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="opacity 0.6s ease-out, transform 0.6s ease-out",requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="translateY(0)"}))),this.logger.debug("Success message displayed")}))}catch(c){this.logger.error("Form submission error:",c);const t=e.querySelector('button[type="submit"]');o(t),g.handleError(c,r,{clearOnFocus:!0,associatedInput:a})}}))):n?this.logger.info("Using combined form instead of separate signup form"):this.logger.debug("Signup form not found. This is expected if using the combined form approach."),function(e=".btn"){document.querySelectorAll(e).forEach((e=>{e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())})),"a"===e.tagName.toLowerCase()&&e.setAttribute("role","button")}))}()}setupFeedbackSystem(){this.logger.debug("Setting up feedback system");const e=document.getElementById("feedback-form"),t=document.getElementById("feedback-thanks"),a=document.getElementById("combined-form"),r=document.getElementById("form-thanks");this.logger.debug("Feedback elements:",{feedbackFormFound:!!e,feedbackThanksFound:!!t,combinedFormFound:!!a,formThanksFound:!!r}),a?this.logger.info("Using combined form approach for feedback"):e?(this.logger.debug("Setting up feedback form"),e.style.opacity="1",e.style.height="auto",this.logger.debug("Feedback form is always visible"),e.addEventListener("submit",(async a=>{a.preventDefault(),this.logger.debug("Feedback form submitted");const r=document.getElementById("feedback-text").value.trim();if(r){this.logger.debug("Feedback text provided, length:",r.length);try{const a=e.querySelector('button[type="submit"]');i(a,s.translate("feedback.submitting")),this.logger.debug("Feedback form in submission state"),this.logger.time("feedback-submission");const n=await this.submitFeedback(r);this.logger.timeEnd("feedback-submission"),this.logger.info("Feedback submission successful",{type:"positive",textLength:r.length,success:n.success}),this.logger.debug("Animating feedback form out"),e.style.transition="height 0.5s ease-in, opacity 0.5s ease-in",e.style.height=e.scrollHeight+"px",requestAnimationFrame((()=>{e.style.height="0",e.style.opacity="0",e.addEventListener("transitionend",(()=>{e.classList.add("hidden"),e.reset(),this.logger.trace("Feedback form hidden and reset"),this.logger.debug("Animating thanks message in"),t.style.opacity="0",t.style.transform="scale(0.9)",t.style.transition="opacity 0.5s ease-out, transform 0.5s ease-out",t.classList.remove("hidden"),requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="scale(1)",this.logger.debug("Thanks message shown, scheduling auto-hide"),setTimeout((()=>{t.style.opacity="0",t.style.transform="scale(0.9)",t.addEventListener("transitionend",(()=>{t.classList.add("hidden"),o(a),this.logger.debug("Reset feedback UI state")}),{once:!0})}),3e3)}))}))}))}catch(n){this.logger.error("Feedback submission error:",n);const t=e.querySelector('button[type="submit"]');o(t);const s=document.createElement("div");s.classList.add("error-message"),e.appendChild(s),g.handleError(n,s),setTimeout((()=>{s.parentNode&&s.parentNode.removeChild(s)}),5e3)}}else this.logger.debug("Empty feedback text, submission ignored")}))):this.logger.debug("Separate feedback form not found. This is expected when using the combined form approach.")}validateEmail(e){return this.logger.trace("Validating email format"),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}async submitWaitlistEmail(e){this.logger.debug("Submitting email to waitlist",{email:e.substring(0,3)+"..."});try{let i="en";try{i=s.getCurrentLocale()}catch(t){i=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:i})}const o={uiLanguage:i};return await l.addToWaitlist(e,o)}catch(i){throw this.logger.error("Waitlist submission error",i),i}}async submitFeedback(e){this.logger.debug("Submitting feedback",{feedbackLength:e.length});try{let i="en";try{i=s.getCurrentLocale()}catch(t){i=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:i})}const o={uiLanguage:i};return await l.submitFeedback(e,o)}catch(i){throw this.logger.error("Feedback submission error",i),i}}},d=new class{constructor(){this.isInitialized=!1,this.logger=e.getModuleLogger("combined-form-handler"),this.logger.info("CombinedFormHandler instance created")}init(){if(this.isInitialized)this.logger.warn("CombinedFormHandler already initialized");else{this.logger.time("combined-form-initialization"),this.logger.info("Initializing combined form handler");try{this.setupCombinedForm(),this.logger.info("Combined form handler initialization complete")}catch(e){this.logger.error("Combined form handler initialization failed",e)}finally{this.isInitialized=!0,this.logger.timeEnd("combined-form-initialization")}}}setupCombinedForm(){this.logger.debug("Setting up combined form handler");const e=document.getElementById("combined-form"),t=document.getElementById("email"),a=document.getElementById("feedback-text"),r=document.getElementById("email-error"),n=document.getElementById("form-thanks");this.logger.debug("Form elements:",{combinedFormFound:!!e,emailInputFound:!!t,feedbackTextFound:!!a,emailErrorFound:!!r,formThanksFound:!!n}),e?(this.logger.debug("Adding event listener to combined form"),e.addEventListener("submit",(async l=>{l.preventDefault(),this.logger.debug("Combined form submitted");const c=t.value.trim(),u=a.value.trim();if(this.logger.debug("Validating form data",{email:c?c.substring(0,3)+"...":"empty",hasFeedback:!!u}),c&&!this.validateEmail(c))return this.logger.debug("Email validation failed"),r.textContent=s.translate("form.email.error"),void t.focus();if(!c&&!u)return this.logger.debug("Both email and feedback are empty"),void(r.textContent=s.translate("feedback.error_empty"));r.textContent="",this.logger.debug("Email validation passed, proceeding with submission");try{const t=e.querySelector('button[type="submit"]');if(i(t,s.translate("form.submitting")),this.logger.debug("Form in submission state"),this.logger.time("form-submission"),c&&u){const e=await this.submitFeedback(u,c);this.logger.info("Combined submission successful",{email:c.substring(0,3)+"...",feedbackLength:u.length,success:e.success})}else if(c){const e=await this.submitWaitlistEmail(c);this.logger.info("Waitlist submission successful",{email:c.substring(0,3)+"...",success:e.success})}else if(u){const e=await this.submitFeedback(u,null);this.logger.info("Feedback submission successful",{feedbackLength:u.length,success:e.success})}this.logger.timeEnd("form-submission"),this.logger.debug("Animating form success transition"),e.style.transition="height 0.5s ease-in, opacity 0.5s ease-in",e.style.height=e.scrollHeight+"px",requestAnimationFrame((()=>{e.style.height="0",e.style.opacity="0",e.addEventListener("transitionend",(()=>{e.classList.add("hidden"),e.reset(),this.logger.debug("Animating thanks message"),n.style.opacity="0",n.style.transform="scale(0.9)",n.style.transition="opacity 0.5s ease-out, transform 0.5s ease-out",n.classList.remove("hidden"),requestAnimationFrame((()=>{n.style.opacity="1",n.style.transform="scale(1)"}))}),{once:!0})}))}catch(d){this.logger.error("Form submission error:",d);const s=e.querySelector('button[type="submit"]');o(s),g.handleError(d,r,{clearOnFocus:!0,associatedInput:t})}}))):this.logger.warn("Combined form not found, form handler not initialized")}validateEmail(e){return this.logger.trace("Validating email format"),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}async submitWaitlistEmail(e){this.logger.debug("Submitting email to waitlist",{email:e.substring(0,3)+"..."});try{let i="en";try{i=s.getCurrentLocale()}catch(t){i=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:i})}const o={uiLanguage:i};return await l.addToWaitlist(e,o)}catch(i){throw this.logger.error("Waitlist submission error",i),i}}async submitFeedback(e,t=null){this.logger.debug("Submitting feedback",{feedbackLength:e.length,hasEmail:!!t});try{let o="en";try{o=s.getCurrentLocale()}catch(i){o=(navigator.language||navigator.userLanguage||"en").split("-")[0],this.logger.warn("Could not get current locale, using fallback",{locale:o})}const a={uiLanguage:o,email:t||null};return await l.submitFeedback(e,a)}catch(o){throw this.logger.error("Feedback submission error",o),o}}};export{d as c,u as f,l as g,s as i};
