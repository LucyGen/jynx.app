const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/LocalStorageService-BFa-OMlj.js","assets/js/logger-CHTAPRDI.js","assets/js/analytics-service-UCL_K60g.js","assets/js/firebase-vendor-BZRpGTjc.js","assets/js/vendor-BveZ_Umi.js","assets/js/GameManager-BpRmIxpk.js","assets/js/config-RBrWeKVX.js","assets/js/CanvasRenderer-CJ09IDnv.js","assets/js/ParticleSystem-B0kY8n5t.js","assets/js/SoloGameMode-SJNLXgWM.js","assets/js/LocalDuoMode-gHUbAs_A.js","assets/js/OnlineDuoMode-D_cmO9-g.js"])))=>i.map(i=>d[i]);
import{a as e}from"./analytics-service-UCL_K60g.js";import{_ as t}from"./firebase-vendor-BZRpGTjc.js";import{g as n,l as s}from"./logger-CHTAPRDI.js";import"./vendor-BveZ_Umi.js";const i={GAME:{FPS:60,FRAME_DURATION:1e3/60,MAX_DELTA_TIME:100},CANVAS:{WIDTH:375,HEIGHT:667,MAX_WIDTH:768,MAX_HEIGHT:1024,BACKGROUND_COLOR:"#0a0a0f",DPR_MULTIPLIER:window.devicePixelRatio||1},DOT:{RADIUS:15,COLOR_P1:"#ff00aa",COLOR_P2:"#00aaff",INITIAL_X:.5,INITIAL_Y:.8,JUMP_VELOCITY:-12,MAX_FALL_VELOCITY:15,TRAIL_PARTICLES:3},PHYSICS:{GRAVITY:.6,AIR_RESISTANCE:.98,GROUND_LEVEL:.9,BOUNCE_DAMPENING:.7},OBSTACLE:{WIDTH:40,HEIGHT:80,GAP:150,COLOR:"#ffffff",SPAWN_RATE:2e3,MIN_SPAWN_RATE:800,SPEED:3,MAX_SPEED:8,SPAWN_X_OFFSET:50},DIFFICULTY:{ENABLED:!0,INITIAL_THRESHOLD:5,SCORE_INCREMENT:5,SPEED_INCREASE:.3,SPAWN_RATE_DECREASE:100,GAP_DECREASE:5,MIN_GAP:100},SCORING:{OBSTACLE_PASS:1,PERFECT_SYNC:3,SYNC_THRESHOLD:20,COMBO_MULTIPLIER:.1,MAX_COMBO_MULTIPLIER:3,COMBO_DECAY_TIME:2e3},INPUT:{DEBOUNCE_TIME:100,TOUCH_TARGET_PADDING:20,KEYBOARD_ENABLED:!0,P1_KEY:" ",P2_KEY:"ArrowUp"},AUDIO:{MASTER_VOLUME:.7,SFX_VOLUME:.8,MUSIC_VOLUME:.5,ENABLED:!0,FILES:{JUMP:"/sync-game/assets/audio/jump.mp3",COLLISION:"/sync-game/assets/audio/collision.mp3",SUCCESS:"/sync-game/assets/audio/success.mp3",DEATH:"/sync-game/assets/audio/death.mp3"}},PARTICLES:{ENABLED:!0,MAX_PARTICLES:50,LIFETIME:1e3,TRAIL_LIFETIME:500,EXPLOSION_COUNT:20},UI:{SHOW_FPS:!1,SHOW_HITBOXES:!1,TRANSITION_DURATION:300,TOAST_DURATION:3e3,TUTORIAL_DURATION:5e3},MULTIPLAYER:{ENABLED:!1,MATCHMAKING_TIMEOUT:3e4,MAX_LATENCY:200,SYNC_INTERVAL:50,MAX_RECONNECT_ATTEMPTS:3},STORAGE:{KEY_PREFIX:"sync_game_",KEYS:{HIGH_SCORE:"high_score",SETTINGS:"settings",STATS:"stats",AUDIO_ENABLED:"audio_enabled",JYNX_CTA_DISMISSED:"jynx_cta_dismissed",JYNX_CTA_SHOWN_COUNT:"jynx_cta_shown_count",JYNX_CTA_LAST_SHOWN:"jynx_cta_last_shown",JYNX_CONVERSION_TRACKED:"jynx_conversion_tracked",JYNX_EMAIL_COLLECTED:"jynx_email_collected",JYNX_SELECTED_VARIANT:"jynx_selected_variant"}},ANALYTICS:{ENABLED:!0,TRACK_FREQUENCY:1,EVENTS:{APP_INIT:"sync_app_init",GAME_START:"sync_game_start",GAME_OVER:"sync_game_over",HIGH_SCORE:"sync_high_score",MODE_SELECT:"sync_mode_select",SHARE:"sync_share"}},PERFORMANCE:{ENABLED:!0,LOG_WARNINGS:!0,BUDGET_MS:16.67,OBJECT_POOLING:!0,MAX_POOLED_OBJECTS:100},DEBUG:{ENABLED:!1,LOG_LEVEL:"info",PROFILING:!1,SKIP_TUTORIAL:!1,GOD_MODE:!1},BUILD:{VERSION:"1.0.0",ENVIRONMENT:"production",BUILT_AT:(new Date).toISOString()},getCanvasSize:function(){const e=Math.min(window.innerWidth,this.CANVAS.MAX_WIDTH),t=Math.min(window.innerHeight,this.CANVAS.MAX_HEIGHT);return{width:e,height:t,aspectRatio:e/t}},getDifficultyMultipliers:function(e){if(!this.DIFFICULTY.ENABLED)return{speed:1,spawnRate:1,gap:1};const t=Math.floor(e/this.DIFFICULTY.SCORE_INCREMENT);return{speed:Math.min(1+t*this.DIFFICULTY.SPEED_INCREASE/this.OBSTACLE.SPEED,this.OBSTACLE.MAX_SPEED/this.OBSTACLE.SPEED),spawnRate:Math.max(1-t*this.DIFFICULTY.SPAWN_RATE_DECREASE/this.OBSTACLE.SPAWN_RATE,this.OBSTACLE.MIN_SPAWN_RATE/this.OBSTACLE.SPAWN_RATE),gap:Math.max(this.OBSTACLE.GAP-t*this.DIFFICULTY.GAP_DECREASE,this.DIFFICULTY.MIN_GAP)}}};Object.freeze(i),Object.freeze(i.GAME),Object.freeze(i.CANVAS),Object.freeze(i.DOT),Object.freeze(i.PHYSICS),Object.freeze(i.OBSTACLE),Object.freeze(i.DIFFICULTY),Object.freeze(i.SCORING),Object.freeze(i.INPUT),Object.freeze(i.AUDIO),Object.freeze(i.PARTICLES),Object.freeze(i.UI),Object.freeze(i.MULTIPLAYER),Object.freeze(i.STORAGE),Object.freeze(i.ANALYTICS),Object.freeze(i.PERFORMANCE),Object.freeze(i.DEBUG),Object.freeze(i.BUILD);const a=Object.freeze({MENU:"MENU",PLAYING:"PLAYING",PAUSED:"PAUSED",GAME_OVER:"GAME_OVER",LEADERBOARD:"LEADERBOARD",MATCHMAKING:"MATCHMAKING",LOADING:"LOADING"}),o=Object.freeze({SOLO:"SOLO",DUO:"DUO",ONLINE:"ONLINE"}),r=Object.freeze({TOUCH:"TOUCH",MOUSE:"MOUSE",KEYBOARD:"KEYBOARD"}),c=Object.freeze({JUMP:"JUMP",COLLISION:"COLLISION",SUCCESS:"SUCCESS",PERFECT_SYNC:"PERFECT_SYNC",DEATH:"DEATH",UI_CLICK:"UI_CLICK",COUNTDOWN:"COUNTDOWN"}),l=Object.freeze({MENU:"MENU",GAME:"GAME",GAME_OVER:"GAME_OVER",LEADERBOARD:"LEADERBOARD",LOBBY:"LOBBY",SETTINGS:"SETTINGS",TUTORIAL:"TUTORIAL"}),d=Object.freeze({CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED",STATE_SYNC:"STATE_SYNC",INPUT_RECEIVED:"INPUT_RECEIVED",MATCH_START:"MATCH_START",MATCH_END:"MATCH_END",ERROR:"ERROR",PING:"PING"}),h=Object.freeze({LINEAR:e=>e,EASE_IN:e=>e*e,EASE_OUT:e=>e*(2-e),EASE_IN_OUT:e=>e<.5?2*e*e:(4-2*e)*e-1,CUBIC_IN:e=>e*e*e,CUBIC_OUT:e=>--e*e*e+1,ELASTIC_OUT:e=>Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1});Object.freeze({VERSION:"1.0.0",DATE:(new Date).toISOString(),ENV:"production"});class u{static instance=null;static getInstance(){return u.instance||(u.instance=new u),u.instance}constructor(){if(u.instance)return u.instance;this.logger=n("InputManager"),this.isInitialized=!1,this.listeners={leftLane:[],rightLane:[],pause:[],restart:[],mute:[]},this.inputBuffer=[],this.maxBufferSize=5,this.activeKeys=new Set,this.hapticEnabled=!0,this.hapticSupported="vibrate"in navigator,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.activeTouches=new Map,this.boundHandlers={touchStart:null,touchEnd:null,touchCancel:null,mouseDown:null,mouseUp:null,keyDown:null,keyUp:null,contextMenu:null,resize:null},this.enabled=!0,this.debugMode=i.DEBUG.ENABLED,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.midpoint=this.screenWidth/2,this.touchIndicators=[],u.instance=this}async init(){if(this.isInitialized)this.logger.warn("InputManager already initialized");else{this.logger.info("Initializing InputManager");try{this.checkReducedMotionPreference(),this.setupTouchInput(),this.setupMouseInput(),this.setupKeyboardInput(),this.setupWindowHandlers(),this.createFeedbackContainer(),this.updateDimensions(),this.isInitialized=!0,this.logger.debug("InputManager initialized successfully",{hapticSupported:this.hapticSupported,prefersReducedMotion:this.prefersReducedMotion,screenWidth:this.screenWidth,screenHeight:this.screenHeight})}catch(e){throw this.logger.error("InputManager initialization failed:",e),e}}}setupTouchInput(){const e=document.querySelector(".sync-canvas")||document;this.boundHandlers.touchStart=this.handleTouchStart.bind(this),this.boundHandlers.touchEnd=this.handleTouchEnd.bind(this),this.boundHandlers.touchCancel=this.handleTouchCancel.bind(this),e.addEventListener("touchstart",this.boundHandlers.touchStart,{passive:!1}),e.addEventListener("touchend",this.boundHandlers.touchEnd,{passive:!0}),e.addEventListener("touchcancel",this.boundHandlers.touchCancel,{passive:!0}),this.boundHandlers.contextMenu=e=>e.preventDefault(),e.addEventListener("contextmenu",this.boundHandlers.contextMenu),this.logger.debug("Touch input handlers registered")}setupMouseInput(){const e=document.querySelector(".sync-canvas"),t=e||document;this.boundHandlers.mouseDown=this.handleMouseDown.bind(this),this.boundHandlers.mouseUp=this.handleMouseUp.bind(this),t.addEventListener("mousedown",this.boundHandlers.mouseDown),t.addEventListener("mouseup",this.boundHandlers.mouseUp),e&&(e.style.cursor="pointer"),this.logger.debug("Mouse input handlers registered")}setupKeyboardInput(){i.INPUT.KEYBOARD_ENABLED?(this.boundHandlers.keyDown=this.handleKeyDown.bind(this),this.boundHandlers.keyUp=this.handleKeyUp.bind(this),document.addEventListener("keydown",this.boundHandlers.keyDown),document.addEventListener("keyup",this.boundHandlers.keyUp),this.logger.debug("Keyboard input handlers registered")):this.logger.debug("Keyboard input disabled in config")}setupWindowHandlers(){this.boundHandlers.resize=this.handleResize.bind(this),window.addEventListener("resize",this.boundHandlers.resize),window.addEventListener("orientationchange",this.boundHandlers.resize)}handleTouchStart(e){if(this.enabled){e.preventDefault();for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t],s=n.clientX,i=n.clientY;this.activeTouches.set(n.identifier,{x:s,y:i,timestamp:Date.now()});const a=s<this.midpoint?"left":"right";this.bufferInput({lane:a,type:r.TOUCH,position:{x:s,y:i},timestamp:Date.now()}),this.showTouchIndicator(s,i),this.triggerHaptic("light"),this.debugMode&&this.logger.debug("Touch input",{lane:a,x:s,y:i})}}}handleTouchEnd(e){if(this.enabled)for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t];this.activeTouches.delete(n.identifier)}}handleTouchCancel(e){if(this.enabled)for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t];this.activeTouches.delete(n.identifier)}}handleMouseDown(e){if(!this.enabled)return;const t=e.clientX,n=e.clientY,s=t<this.midpoint?"left":"right";this.bufferInput({lane:s,type:r.MOUSE,position:{x:t,y:n},timestamp:Date.now()}),this.showTouchIndicator(t,n),this.debugMode&&this.logger.debug("Mouse input",{lane:s,x:t,y:n})}handleMouseUp(e){}handleKeyDown(e){if(!this.enabled)return;const t=e.key.toLowerCase();return this.activeKeys.has(t)?void 0:(this.activeKeys.add(t),["a","arrowleft","q","w","z"].includes(t)?(e.preventDefault(),this.bufferInput({lane:"left",type:r.KEYBOARD,key:t,timestamp:Date.now()}),void this.showKeyPressVisual("left")):["d","arrowright","e","r","x"].includes(t)?(e.preventDefault(),this.bufferInput({lane:"right",type:r.KEYBOARD,key:t,timestamp:Date.now()}),void this.showKeyPressVisual("right")):" "===t||"spacebar"===t?(e.preventDefault(),this.bufferInput({lane:"left",type:r.KEYBOARD,key:"space",timestamp:Date.now()}),this.bufferInput({lane:"right",type:r.KEYBOARD,key:"space",timestamp:Date.now()}),void this.showKeyPressVisual("both")):"escape"===t?(e.preventDefault(),void this.notifyListeners("pause",{type:r.KEYBOARD,timestamp:Date.now()})):"m"===t?(e.preventDefault(),void this.notifyListeners("mute",{type:r.KEYBOARD,timestamp:Date.now()})):void 0)}handleKeyUp(e){const t=e.key.toLowerCase();this.activeKeys.delete(t)}handleResize(){this.updateDimensions(),this.logger.debug("Screen dimensions updated",{width:this.screenWidth,height:this.screenHeight,midpoint:this.midpoint})}updateDimensions(){this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.midpoint=this.screenWidth/2}bufferInput(e){this.inputBuffer.length>=this.maxBufferSize&&(this.logger.warn("Input buffer full, dropping oldest input"),this.inputBuffer.shift()),this.inputBuffer.push(e)}processInputBuffer(){if(0===this.inputBuffer.length)return[];const e=[...this.inputBuffer];return this.inputBuffer=[],e.forEach((e=>{"left"===e.lane?this.notifyListeners("leftLane",e):"right"===e.lane&&this.notifyListeners("rightLane",e)})),e}onLeftLaneInput(e){"function"==typeof e?this.listeners.leftLane.push(e):this.logger.error("onLeftLaneInput: callback must be a function")}onRightLaneInput(e){"function"==typeof e?this.listeners.rightLane.push(e):this.logger.error("onRightLaneInput: callback must be a function")}onPause(e){"function"==typeof e?this.listeners.pause.push(e):this.logger.error("onPause: callback must be a function")}onRestart(e){"function"==typeof e?this.listeners.restart.push(e):this.logger.error("onRestart: callback must be a function")}onMute(e){"function"==typeof e?this.listeners.mute.push(e):this.logger.error("onMute: callback must be a function")}notifyListeners(e,t){this.listeners[e]?this.listeners[e].forEach((n=>{try{n(t)}catch(s){this.logger.error(`Error in ${e} listener:`,s)}})):this.logger.warn(`No listeners registered for event: ${e}`)}off(e,t){if(!this.listeners[e])return;const n=this.listeners[e].indexOf(t);n>-1&&this.listeners[e].splice(n,1)}enableHapticFeedback(){this.hapticEnabled=!0,this.logger.info("Haptic feedback enabled")}disableHapticFeedback(){this.hapticEnabled=!1,this.logger.info("Haptic feedback disabled")}triggerHaptic(e="light"){if(!this.hapticEnabled||!this.hapticSupported||this.prefersReducedMotion)return;const t={light:10,medium:50,heavy:100},n=t[e]||t.light;try{navigator.vibrate(n)}catch(s){this.logger.warn("Haptic feedback failed:",s)}}triggerCollisionFeedback(){this.triggerHaptic("medium")}triggerGameOverFeedback(){this.triggerHaptic("heavy")}createFeedbackContainer(){let e=document.getElementById("sync-input-feedback");e||(e=document.createElement("div"),e.id="sync-input-feedback",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 9999;\n      ",document.body.appendChild(e)),this.feedbackContainer=e}showTouchIndicator(e,t){if(this.prefersReducedMotion)return;const n=document.createElement("div");if(n.className="sync-touch-indicator",n.style.cssText=`\n      position: absolute;\n      left: ${e}px;\n      top: ${t}px;\n      width: 20px;\n      height: 20px;\n      margin-left: -10px;\n      margin-top: -10px;\n      border-radius: 50%;\n      background: ${e<this.midpoint?"#ff00aa":"#00aaff"};\n      opacity: 0.6;\n      pointer-events: none;\n      animation: sync-touch-ripple 0.6s ease-out forwards;\n    `,this.feedbackContainer.appendChild(n),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n)}),600),this.touchIndicators.push(n),this.touchIndicators.length>10){const e=this.touchIndicators.shift();e&&e.parentNode&&e.parentNode.removeChild(e)}}showKeyPressVisual(e){if(!this.debugMode||this.prefersReducedMotion)return;const t={left:{x:.25*this.screenWidth,y:.9*this.screenHeight},right:{x:.75*this.screenWidth,y:.9*this.screenHeight},both:null};if("both"===e)this.showTouchIndicator(t.left.x,t.left.y),this.showTouchIndicator(t.right.x,t.right.y);else{const n=t[e];n&&this.showTouchIndicator(n.x,n.y)}}checkReducedMotionPreference(){const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.prefersReducedMotion=e.matches,e.addEventListener("change",(e=>{this.prefersReducedMotion=e.matches,this.logger.info("Reduced motion preference changed:",e.matches)}))}getInputState(){return{enabled:this.enabled,hapticEnabled:this.hapticEnabled,hapticSupported:this.hapticSupported,prefersReducedMotion:this.prefersReducedMotion,activeKeys:Array.from(this.activeKeys),activeTouches:this.activeTouches.size,bufferSize:this.inputBuffer.length,screenDimensions:{width:this.screenWidth,height:this.screenHeight,midpoint:this.midpoint}}}enable(){this.enabled=!0,this.logger.info("Input enabled")}disable(){this.enabled=!1,this.logger.info("Input disabled")}clearBuffer(){this.inputBuffer=[],this.activeKeys.clear()}reset(){this.clearBuffer(),this.activeTouches.clear(),this.touchIndicators=[],this.enabled=!0,this.logger.debug("InputManager reset")}destroy(){this.logger.info("Destroying InputManager");const e=document.querySelector(".sync-canvas")||document;this.boundHandlers.touchStart&&e.removeEventListener("touchstart",this.boundHandlers.touchStart),this.boundHandlers.touchEnd&&e.removeEventListener("touchend",this.boundHandlers.touchEnd),this.boundHandlers.touchCancel&&e.removeEventListener("touchcancel",this.boundHandlers.touchCancel),this.boundHandlers.mouseDown&&e.removeEventListener("mousedown",this.boundHandlers.mouseDown),this.boundHandlers.mouseUp&&e.removeEventListener("mouseup",this.boundHandlers.mouseUp),this.boundHandlers.keyDown&&document.removeEventListener("keydown",this.boundHandlers.keyDown),this.boundHandlers.keyUp&&document.removeEventListener("keyup",this.boundHandlers.keyUp),this.boundHandlers.contextMenu&&e.removeEventListener("contextmenu",this.boundHandlers.contextMenu),this.boundHandlers.resize&&(window.removeEventListener("resize",this.boundHandlers.resize),window.removeEventListener("orientationchange",this.boundHandlers.resize)),Object.keys(this.listeners).forEach((e=>{this.listeners[e]=[]})),this.clearBuffer(),this.activeTouches.clear(),this.feedbackContainer&&this.feedbackContainer.parentNode&&this.feedbackContainer.parentNode.removeChild(this.feedbackContainer),u.instance=null,this.logger.info("InputManager destroyed successfully")}}const m="primary",g="secondary",p="ghost",y="medium",E="large";class b{constructor(e){this.logger=n("Button"),this.text=e.text,this.onClick=e.onClick,this.variant=e.variant||m,this.size=e.size||y,this.icon=e.icon||null,this.disabled=e.disabled||!1,this.className=e.className||"",this.loading=!1,this.element=this.createButton()}createButton(){const e=document.createElement("button");if(e.className=this.getButtonClasses(),e.disabled=this.disabled,this.icon){const t=document.createElement("span");t.className="sync-btn-icon",t.innerHTML=this.icon,e.appendChild(t)}const t=document.createElement("span");return t.className="sync-btn-text",t.textContent=this.text,e.appendChild(t),e.addEventListener("click",(e=>this.handleClick(e))),"vibrate"in navigator&&e.addEventListener("touchstart",(()=>{this.disabled||this.loading||navigator.vibrate(10)})),e}getButtonClasses(){const e=["sync-btn"];return e.push(`sync-btn-${this.variant}`),this.size!==y&&e.push(`sync-btn-${this.size}`),this.loading&&e.push("sync-btn-loading"),this.className&&e.push(this.className),e.join(" ")}handleClick(e){this.disabled||this.loading?e.preventDefault():(this.createRipple(e),this.onClick&&this.onClick(e))}createRipple(e){const t=this.element,n=document.createElement("span"),s=t.getBoundingClientRect(),i=Math.max(s.width,s.height),a=e.clientX-s.left-i/2,o=e.clientY-s.top-i/2;n.style.width=n.style.height=`${i}px`,n.style.left=`${a}px`,n.style.top=`${o}px`,n.className="sync-btn-ripple",t.appendChild(n),setTimeout((()=>{n.remove()}),600)}setLoading(e){if(this.loading=e,this.element.disabled=e||this.disabled,e){this.element.classList.add("sync-btn-loading");const e=this.element.querySelector(".sync-btn-text");e&&(e.dataset.originalText=e.textContent,e.innerHTML='<span class="sync-loading-dots"><span></span><span></span><span></span></span>')}else{this.element.classList.remove("sync-btn-loading");const e=this.element.querySelector(".sync-btn-text");e&&e.dataset.originalText&&(e.textContent=e.dataset.originalText,delete e.dataset.originalText)}}setDisabled(e){this.disabled=e,this.element.disabled=e||this.loading}setText(e){this.text=e;const t=this.element.querySelector(".sync-btn-text");t&&!this.loading&&(t.textContent=e)}getElement(){return this.element}destroy(){this.element&&this.element.parentNode&&this.element.remove()}}class f{constructor(e,t){this.logger=n("MenuScreen"),this.container=e,this.callbacks=t,this.buttons=[],this.render()}render(){this.container.innerHTML="",this.container.className="sync-screen sync-menu";const e=this.createHeader();this.container.appendChild(e);const t=this.createContent();this.container.appendChild(t);const n=this.createFooter();this.container.appendChild(n),this.logger.debug("Menu screen rendered")}createHeader(){const e=document.createElement("div");e.className="sync-header";const t=document.createElement("a");t.href="/",t.className="sync-back-link",t.innerHTML="â† Back",e.appendChild(t);const n=document.createElement("button");return n.className="sync-icon-btn",n.innerHTML="âš™",n.setAttribute("aria-label","Settings"),n.addEventListener("click",(()=>{this.callbacks.onSettings&&this.callbacks.onSettings()})),e.appendChild(n),e}createContent(){const e=document.createElement("div");e.className="sync-menu-content";const t=document.createElement("h1");t.className="sync-title",t.textContent="SYNC",e.appendChild(t);const n=document.createElement("p");n.className="sync-tagline",n.textContent="Test your timing. Master the rhythm.",e.appendChild(n);const s=this.createHighScoreSection();e.appendChild(s);const i=this.createModeButtons();e.appendChild(i);const a=document.createElement("button");return a.className="sync-link-btn",a.innerHTML="ðŸ† View Leaderboard",a.addEventListener("click",(()=>{this.callbacks.onLeaderboard&&this.callbacks.onLeaderboard()})),e.appendChild(a),e}createHighScoreSection(){const e=document.createElement("div");e.className="sync-high-score";const t=document.createElement("div");t.className="sync-label",t.textContent="High Score",e.appendChild(t);const n=document.createElement("div");return n.className="sync-value",n.id="sync-high-score-value",n.textContent="0",e.appendChild(n),e}createModeButtons(){const e=document.createElement("div");e.className="sync-menu-buttons";const t=new b({text:"Solo",variant:m,size:E,icon:"ðŸ‘¤",onClick:()=>this.handleModeSelect(o.SOLO),className:"sync-mode-btn"}),n=t.getElement(),s=document.createElement("span");s.className="sync-btn-desc",s.textContent="Single player mode",n.appendChild(s),e.appendChild(n),this.buttons.push(t);const i=new b({text:"Duo (Local)",variant:g,size:E,icon:"ðŸ‘¥",onClick:()=>this.handleModeSelect(o.DUO),className:"sync-mode-btn"}),a=i.getElement(),r=document.createElement("span");r.className="sync-btn-desc",r.textContent="Two players on same device",a.appendChild(r),e.appendChild(a),this.buttons.push(i);const c=new b({text:"Duo (Online)",variant:p,size:E,icon:"ðŸŒ",onClick:()=>this.handleModeSelect(o.ONLINE),disabled:!0,className:"sync-mode-btn"}),l=c.getElement(),d=document.createElement("span");return d.className="sync-btn-desc",d.textContent="Coming soon",l.appendChild(d),e.appendChild(l),this.buttons.push(c),e}createFooter(){const e=document.createElement("div");e.className="sync-footer";const t=document.createElement("p");return t.className="sync-footer-text",t.innerHTML='Powered by <a href="https://jynx.app" class="sync-footer-link" target="_blank">Jynx</a>',e.appendChild(t),e}handleModeSelect(e){this.logger.debug(`Mode selected: ${e}`),this.callbacks.onModeSelect&&this.callbacks.onModeSelect(e)}updateHighScore(e){const t=document.getElementById("sync-high-score-value");t&&(t.textContent=e.toString())}show(){this.container.classList.remove("sync-screen-hidden")}hide(){this.container.classList.add("sync-screen-hidden")}destroy(){this.buttons.forEach((e=>e.destroy())),this.buttons=[],this.container.innerHTML=""}}class S{constructor(e,t={}){this.logger=n("ScoreDisplay"),this.container=e,this.currentScore=0,this.displayedScore=0,this.animationId=null,this.comboMultiplier=1,this.milestones=t.milestones||[10,25,50,100,250,500,1e3],this.createElements()}createElements(){this.container.innerHTML="",this.container.className="sync-score-display",this.scoreElement=document.createElement("div"),this.scoreElement.className="sync-score-value",this.scoreElement.textContent="0",this.container.appendChild(this.scoreElement),this.comboElement=document.createElement("div"),this.comboElement.className="sync-combo-indicator",this.comboElement.style.display="none",this.container.appendChild(this.comboElement)}updateScore(e,t=!0){const n=this.currentScore;this.currentScore=e,this.checkMilestone(n,e),t?(this.animateScore(this.displayedScore,e),this.pulseScore()):(this.displayedScore=e,this.scoreElement.textContent=Math.floor(e).toString())}animateScore(e,t){this.animationId&&cancelAnimationFrame(this.animationId);const n=performance.now(),s=i=>{const a=i-n,o=Math.min(a/500,1),r=h.EASE_OUT(o);this.displayedScore=e+(t-e)*r,this.scoreElement.textContent=Math.floor(this.displayedScore).toString(),o<1&&(this.animationId=requestAnimationFrame(s))};this.animationId=requestAnimationFrame(s)}pulseScore(){this.scoreElement.classList.remove("sync-score-pulse"),this.scoreElement.offsetWidth,this.scoreElement.classList.add("sync-score-pulse")}checkMilestone(e,t){const n=this.milestones.find((n=>e<n&&t>=n));n&&this.celebrateMilestone(n)}celebrateMilestone(e){this.logger.debug(`Milestone reached: ${e}`),this.scoreElement.classList.add("sync-score-milestone"),setTimeout((()=>{this.scoreElement.classList.remove("sync-score-milestone")}),1e3);const t=new CustomEvent("milestone",{detail:{milestone:e,score:this.currentScore}});this.container.dispatchEvent(t)}updateCombo(e){this.comboMultiplier=e,e>1?(this.comboElement.textContent=`Ã—${e.toFixed(1)}`,this.comboElement.style.display="block",this.comboElement.classList.add("sync-combo-pulse"),setTimeout((()=>{this.comboElement.classList.remove("sync-combo-pulse")}),300)):this.comboElement.style.display="none"}reset(){this.animationId&&cancelAnimationFrame(this.animationId),this.currentScore=0,this.displayedScore=0,this.comboMultiplier=1,this.scoreElement.textContent="0",this.comboElement.style.display="none",this.scoreElement.classList.remove("sync-score-pulse","sync-score-milestone")}getScore(){return this.currentScore}destroy(){this.animationId&&cancelAnimationFrame(this.animationId)}}class C{constructor(e,t){this.logger=n("GameScreen"),this.container=e,this.callbacks=t,this.scoreDisplay=null,this.currentMode=o.SOLO,this.render()}render(){this.container.innerHTML="",this.container.className="sync-screen sync-game";const e=document.createElement("div");e.id="sync-canvas-container",e.className="sync-canvas-container",this.container.appendChild(e);const t=this.createHUD();this.container.appendChild(t);const n=this.createControls();this.container.appendChild(n);const s=this.createPauseOverlay();this.container.appendChild(s),this.logger.debug("Game screen rendered")}createHUD(){const e=document.createElement("div");e.className="sync-game-hud";const t=document.createElement("div");t.id="sync-score-container",this.scoreDisplay=new S(t),e.appendChild(t);const n=document.createElement("button");n.className="sync-icon-btn",n.innerHTML="â¸",n.setAttribute("aria-label","Pause game"),n.addEventListener("click",(()=>{this.callbacks.onPause&&this.callbacks.onPause()})),e.appendChild(n);const s=document.createElement("div");return s.id="sync-fps-display",s.className="sync-fps",s.style.display="none",e.appendChild(s),e}createControls(){const e=document.createElement("div");e.id="sync-game-controls",e.className="sync-game-controls";const t=document.createElement("div");t.className="sync-control",t.dataset.player="1",t.innerHTML='<span class="sync-control-label">TAP</span>',e.appendChild(t);const n=document.createElement("div");return n.className="sync-control sync-control-hidden",n.dataset.player="2",n.innerHTML='<span class="sync-control-label">TAP</span>',e.appendChild(n),e}createPauseOverlay(){const e=document.createElement("div");e.id="sync-pause-overlay",e.className="sync-pause-overlay";const t=document.createElement("h2");t.className="sync-pause-title",t.textContent="PAUSED",e.appendChild(t);const n=document.createElement("div");n.className="sync-pause-buttons";const s=document.createElement("button");s.className="sync-btn sync-btn-primary",s.textContent="Resume",s.addEventListener("click",(()=>this.resumeGame())),n.appendChild(s);const i=document.createElement("button");i.className="sync-btn sync-btn-secondary",i.textContent="Restart",i.addEventListener("click",(()=>this.restartGame())),n.appendChild(i);const a=document.createElement("button");return a.className="sync-btn sync-btn-tertiary",a.textContent="Quit to Menu",a.addEventListener("click",(()=>this.quitToMenu())),n.appendChild(a),e.appendChild(n),e}setMode(e){this.currentMode=e;const t=this.container.querySelector('[data-player="2"]');t&&(e===o.DUO||e===o.ONLINE?t.classList.remove("sync-control-hidden"):t.classList.add("sync-control-hidden"))}updateHUD(e){if(this.scoreDisplay&&void 0!==e.score&&this.scoreDisplay.updateScore(e.score),this.scoreDisplay&&void 0!==e.comboMultiplier&&this.scoreDisplay.updateCombo(e.comboMultiplier),void 0!==e.fps){const t=document.getElementById("sync-fps-display");t&&(t.textContent=`${e.fps} FPS`)}}showPauseOverlay(){const e=document.getElementById("sync-pause-overlay");e&&e.classList.add("sync-pause-visible")}hidePauseOverlay(){const e=document.getElementById("sync-pause-overlay");e&&e.classList.remove("sync-pause-visible")}resumeGame(){this.hidePauseOverlay(),this.callbacks.onPause&&this.callbacks.onPause()}restartGame(){this.hidePauseOverlay(),this.callbacks.onRestart&&this.callbacks.onRestart()}quitToMenu(){this.hidePauseOverlay(),this.callbacks.onQuit&&this.callbacks.onQuit()}show(){this.container.classList.remove("sync-screen-hidden")}hide(){this.container.classList.add("sync-screen-hidden")}reset(){this.scoreDisplay&&this.scoreDisplay.reset(),this.hidePauseOverlay()}destroy(){this.scoreDisplay&&this.scoreDisplay.destroy(),this.container.innerHTML=""}}class M{constructor(e,t){this.logger=n("GameOverScreen"),this.container=e,this.callbacks=t,this.buttons=[],this.currentStats=null,this.animationId=null,this.render()}render(){this.container.innerHTML="",this.container.className="sync-screen sync-game-over";const e=document.createElement("div");e.className="sync-game-over-content";const t=document.createElement("h2");t.className="sync-game-over-title",t.textContent="GAME OVER",e.appendChild(t);const n=this.createScoreSection();e.appendChild(n);const s=this.createStatsSection();e.appendChild(s);const i=this.createRatingSection();e.appendChild(i);const a=this.createButtons();e.appendChild(a);const o=this.createCTA();e.appendChild(o),this.container.appendChild(e),this.logger.debug("Game over screen rendered")}createScoreSection(){const e=document.createElement("div");e.className="sync-game-over-score";const t=document.createElement("div");t.className="sync-label",t.textContent="Final Score",e.appendChild(t);const n=document.createElement("div");return n.className="sync-value",n.id="sync-final-score",n.textContent="0",e.appendChild(n),e}createStatsSection(){const e=document.createElement("div");return e.className="sync-game-over-stats",e.id="sync-game-stats",e}createRatingSection(){const e=document.createElement("div");return e.className="sync-performance-rating",e.id="sync-performance-rating",e.style.display="none",e}createButtons(){const e=document.createElement("div");e.className="sync-game-over-buttons";const t=new b({text:"Play Again",variant:m,onClick:()=>{this.callbacks.onPlayAgain&&this.callbacks.onPlayAgain()}});e.appendChild(t.getElement()),this.buttons.push(t);const n=new b({text:"Share Score",variant:g,onClick:()=>{this.callbacks.onShare&&this.callbacks.onShare()}});e.appendChild(n.getElement()),this.buttons.push(n);const s=new b({text:"Leaderboard",variant:p,onClick:()=>{this.callbacks.onLeaderboard&&this.callbacks.onLeaderboard()}});e.appendChild(s.getElement()),this.buttons.push(s);const i=new b({text:"Main Menu",variant:p,onClick:()=>{this.callbacks.onMenu&&this.callbacks.onMenu()}});return e.appendChild(i.getElement()),this.buttons.push(i),e}createCTA(){const e=document.createElement("div");e.className="sync-jynx-cta",e.id="sync-jynx-cta",e.style.display="none";const t=document.createElement("p");t.textContent="Love SYNC? Find teammates for your favorite games on ";const n=document.createElement("a");return n.href="https://jynx.app",n.target="_blank",n.className="sync-link",n.textContent="Jynx",t.appendChild(n),e.appendChild(t),e}showStats(e){this.currentStats=e,this.animateScore(0,e.score);const t=document.getElementById("sync-game-stats");t&&(t.innerHTML="",[{label:"Time",value:this.formatTime(e.timeSurvived)},{label:"Obstacles",value:e.obstaclesPassed||0},{label:"Near Misses",value:e.nearMisses||0},{label:"Perfect Syncs",value:e.perfectSyncs||0},{label:"Max Combo",value:`Ã—${(e.maxCombo||1).toFixed(1)}`},{label:"High Score",value:e.isNewHighScore?"NEW!":e.highScore||0}].forEach((e=>{const n=document.createElement("div");n.className="sync-stat";const s=document.createElement("div");s.className="sync-stat-label",s.textContent=e.label,n.appendChild(s);const i=document.createElement("div");i.className="sync-stat-value",i.textContent=e.value,n.appendChild(i),t.appendChild(n)})));const n=this.calculateRating(e.score);this.showRating(n),this.showCTAIfNeeded(e)}animateScore(e,t){this.animationId&&cancelAnimationFrame(this.animationId);const n=performance.now(),s=document.getElementById("sync-final-score"),i=a=>{const o=a-n,r=Math.min(o/1e3,1),c=h.EASE_OUT(r),l=Math.floor(e+(t-e)*c);s&&(s.textContent=l.toString()),r<1&&(this.animationId=requestAnimationFrame(i))};this.animationId=requestAnimationFrame(i)}formatTime(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}calculateRating(e){return e>=100?"S":e>=50?"A":e>=25?"B":e>=10?"C":"D"}showRating(e){const t=document.getElementById("sync-performance-rating");t&&(t.innerHTML=`\n      <div class="sync-rating-badge sync-rating-${e}">\n        <span class="sync-rating-letter">${e}</span>\n        <span class="sync-rating-label">Rank</span>\n      </div>\n    `,t.style.display="flex","S"!==e&&"A"!==e||t.classList.add("sync-rating-celebrate"))}showCTAIfNeeded(e){const t=document.getElementById("sync-jynx-cta");if(!t)return;const n=parseInt(localStorage.getItem("sync_games_played")||"0")+1;localStorage.setItem("sync_games_played",n.toString()),(e.rank&&e.rank<=100||n>=3)&&(t.style.display="block")}show(){this.container.classList.remove("sync-screen-hidden")}hide(){this.container.classList.add("sync-screen-hidden")}reset(){this.animationId&&cancelAnimationFrame(this.animationId)}destroy(){this.reset(),this.buttons.forEach((e=>e.destroy())),this.buttons=[],this.container.innerHTML=""}}class I{constructor(e,t={}){this.logger=n("ProgressBar"),this.container=e,this.indeterminate=t.indeterminate||!1,this.showPercentage=!1!==t.showPercentage,this.progress=0,this.createElements()}createElements(){this.container.innerHTML="",this.container.className="sync-progress-bar",this.track=document.createElement("div"),this.track.className="sync-progress-track",this.fill=document.createElement("div"),this.fill.className="sync-progress-fill",this.indeterminate&&this.fill.classList.add("sync-progress-indeterminate"),this.track.appendChild(this.fill),this.container.appendChild(this.track),this.showPercentage&&!this.indeterminate&&(this.percentageText=document.createElement("div"),this.percentageText.className="sync-progress-percentage",this.percentageText.textContent="0%",this.container.appendChild(this.percentageText))}setProgress(e){this.indeterminate?this.logger.warn("Cannot set progress on indeterminate progress bar"):(this.progress=Math.max(0,Math.min(100,e)),this.fill.style.width=`${this.progress}%`,this.percentageText&&(this.percentageText.textContent=`${Math.round(this.progress)}%`),this.progress>=100?this.fill.classList.add("sync-progress-complete"):this.fill.classList.remove("sync-progress-complete"))}setIndeterminate(e){this.indeterminate=e,e?(this.fill.classList.add("sync-progress-indeterminate"),this.fill.style.width="",this.percentageText&&(this.percentageText.style.display="none")):(this.fill.classList.remove("sync-progress-indeterminate"),this.setProgress(this.progress),this.percentageText&&(this.percentageText.style.display=""))}reset(){this.setProgress(0)}show(){this.container.style.display=""}hide(){this.container.style.display="none"}destroy(){this.container.innerHTML=""}}const v="daily",L="weekly",T="all_time";class A{constructor(e,t){this.logger=n("LeaderboardScreen"),this.container=e,this.callbacks=t,this.currentPeriod=T,this.leaderboardData=null,this.progressBar=null,this.buttons=[],this.render()}render(){this.container.innerHTML="",this.container.className="sync-screen sync-leaderboard";const e=this.createHeader();this.container.appendChild(e);const t=this.createTabs();this.container.appendChild(t);const n=document.createElement("div");n.id="sync-leaderboard-loading",n.style.padding="1rem",this.progressBar=new I(n,{indeterminate:!0}),this.container.appendChild(n);const s=document.createElement("div");s.className="sync-leaderboard-content",s.id="sync-leaderboard-content",this.container.appendChild(s);const i=new b({text:"Back to Menu",variant:p,onClick:()=>{this.callbacks.onBack&&this.callbacks.onBack()}}),a=document.createElement("div");a.style.padding="1rem",a.appendChild(i.getElement()),this.container.appendChild(a),this.buttons.push(i),this.logger.debug("Leaderboard screen rendered")}createHeader(){const e=document.createElement("div");e.className="sync-screen-header";const t=document.createElement("h2");return t.textContent="Leaderboard",e.appendChild(t),e}createTabs(){const e=document.createElement("div");return e.className="sync-tabs",[{key:v,label:"Daily"},{key:L,label:"Weekly"},{key:T,label:"All-Time"}].forEach((t=>{const n=document.createElement("button");n.className="sync-tab",n.textContent=t.label,n.dataset.period=t.key,t.key===this.currentPeriod&&n.classList.add("sync-tab-active"),n.addEventListener("click",(()=>this.switchTab(t.key))),e.appendChild(n)})),e}switchTab(e){e!==this.currentPeriod&&(this.currentPeriod=e,this.container.querySelectorAll(".sync-tab").forEach((t=>{t.dataset.period===e?t.classList.add("sync-tab-active"):t.classList.remove("sync-tab-active")})),this.loadLeaderboard(e))}async loadLeaderboard(e){this.showLoading();try{if(this.callbacks.onLoadLeaderboard){const t=await this.callbacks.onLoadLeaderboard(e);this.displayLeaderboard(t)}}catch(t){this.logger.error("Failed to load leaderboard",t),this.showError("Failed to load leaderboard. Please try again.")}}displayLeaderboard(e){this.leaderboardData=e,this.hideLoading();const t=document.getElementById("sync-leaderboard-content");if(!t)return;if(t.innerHTML="",!e||0===e.length)return void(t.innerHTML='<p class="sync-empty-state">No entries yet. Be the first!</p>');const n=document.createElement("div");n.className="sync-leaderboard-list",e.forEach(((e,t)=>{const s=this.createLeaderboardItem(e,t+1);n.appendChild(s)})),t.appendChild(n),this.scrollToPlayer()}createLeaderboardItem(e,t){const n=document.createElement("div");n.className="sync-leaderboard-item",e.isPlayer&&(n.classList.add("sync-leaderboard-player"),n.id="sync-player-rank");const s=document.createElement("div");s.className="sync-leaderboard-rank",s.textContent=t.toString(),n.appendChild(s);const i=document.createElement("div");if(i.className="sync-leaderboard-name",i.textContent=e.name||`Player ${e.id}`,n.appendChild(i),e.mode){const t=document.createElement("div");t.className="sync-leaderboard-mode",t.textContent="DUO"===e.mode?"ðŸ‘¥":"ðŸ‘¤",t.title="DUO"===e.mode?"Duo mode":"Solo mode",n.appendChild(t)}const a=document.createElement("div");return a.className="sync-leaderboard-score",a.textContent=e.score.toString(),n.appendChild(a),n}scrollToPlayer(){const e=document.getElementById("sync-player-rank");e&&setTimeout((()=>{e.scrollIntoView({behavior:"smooth",block:"center"})}),300)}showLoading(){const e=document.getElementById("sync-leaderboard-loading"),t=document.getElementById("sync-leaderboard-content");e&&(e.style.display="block"),t&&(t.style.display="none")}hideLoading(){const e=document.getElementById("sync-leaderboard-loading"),t=document.getElementById("sync-leaderboard-content");e&&(e.style.display="none"),t&&(t.style.display="block")}showError(e){this.hideLoading();const t=document.getElementById("sync-leaderboard-content");t&&(t.innerHTML=`<p class="sync-error-state">${e}</p>`)}show(){this.container.classList.remove("sync-screen-hidden"),this.loadLeaderboard(this.currentPeriod)}hide(){this.container.classList.add("sync-screen-hidden")}destroy(){this.progressBar&&this.progressBar.destroy(),this.buttons.forEach((e=>e.destroy())),this.buttons=[],this.container.innerHTML=""}}const N="idle",w="searching",O="found",k="timeout";class D{constructor(e,t){this.logger=n("LobbyScreen"),this.container=e,this.callbacks=t,this.state=N,this.timeoutTimer=null,this.buttons=[],this.render()}render(){this.container.innerHTML="",this.container.className="sync-screen sync-lobby";const e=this.createHeader();this.container.appendChild(e);const t=document.createElement("div");t.className="sync-lobby-content",t.id="sync-lobby-content";const n=this.createModeSelection();t.appendChild(n),this.container.appendChild(t),this.logger.debug("Lobby screen rendered")}createHeader(){const e=document.createElement("div");e.className="sync-screen-header";const t=document.createElement("h2");return t.textContent="Online Matchmaking",e.appendChild(t),e}createModeSelection(){const e=document.createElement("div");e.className="sync-lobby-modes";const t=document.createElement("h3");t.textContent="Find a Partner",t.style.textAlign="center",t.style.marginBottom="2rem",e.appendChild(t);const n=document.createElement("div");n.className="sync-lobby-buttons";const s=new b({text:"Quick Match",variant:m,icon:"âš¡",onClick:()=>this.startQuickMatch()}),i=s.getElement(),a=document.createElement("span");a.className="sync-btn-desc",a.textContent="Find random partner",i.appendChild(a),n.appendChild(i),this.buttons.push(s);const o=new b({text:"Invite Friend",variant:g,icon:"ðŸ”—",onClick:()=>this.showInviteLink()}),r=o.getElement(),c=document.createElement("span");c.className="sync-btn-desc",c.textContent="Share invite link",r.appendChild(c),n.appendChild(r),this.buttons.push(o),e.appendChild(n);const l=new b({text:"Back to Menu",variant:p,onClick:()=>{this.callbacks.onBack&&this.callbacks.onBack()}}),d=document.createElement("div");return d.style.marginTop="2rem",d.appendChild(l.getElement()),e.appendChild(d),this.buttons.push(l),e}createSearchingUI(){const e=document.createElement("div");e.className="sync-lobby-searching";const t=document.createElement("div");t.className="sync-loading-spinner",e.appendChild(t);const n=document.createElement("p");n.className="sync-lobby-status",n.innerHTML='Searching for partner<span class="sync-loading-dots"><span></span><span></span><span></span></span>',e.appendChild(n);const s=new b({text:"Cancel",variant:"danger",onClick:()=>this.cancelMatchmaking()}),i=document.createElement("div");return i.style.marginTop="2rem",i.appendChild(s.getElement()),e.appendChild(i),this.buttons.push(s),e}createPartnerFoundUI(e){const t=document.createElement("div");t.className="sync-lobby-found";const n=document.createElement("div");n.className="sync-lobby-icon",n.textContent="âœ“",n.style.fontSize="4rem",n.style.color="var(--success, #00ff88)",t.appendChild(n);const s=document.createElement("p");if(s.className="sync-lobby-status",s.textContent="Partner found!",t.appendChild(s),e&&e.name){const n=document.createElement("p");n.textContent=`Playing with: ${e.name}`,n.style.opacity="0.8",t.appendChild(n)}const i=document.createElement("p");return i.className="sync-lobby-countdown",i.textContent="Starting in 3...",t.appendChild(i),t}createTimeoutUI(){const e=document.createElement("div");e.className="sync-lobby-timeout";const t=document.createElement("div");t.className="sync-lobby-icon",t.textContent="â±",t.style.fontSize="4rem",e.appendChild(t);const n=document.createElement("p");n.className="sync-lobby-status",n.textContent="No partner found",e.appendChild(n);const s=document.createElement("div");s.className="sync-lobby-buttons",s.style.marginTop="2rem";const i=new b({text:"Try Again",variant:m,onClick:()=>this.startQuickMatch()});s.appendChild(i.getElement()),this.buttons.push(i);const a=new b({text:"Play Solo",variant:g,onClick:()=>{this.callbacks.onPlaySolo&&this.callbacks.onPlaySolo()}});return s.appendChild(a.getElement()),this.buttons.push(a),e.appendChild(s),e}startQuickMatch(){this.state=w,this.updateUI(),this.callbacks.onQuickMatch&&this.callbacks.onQuickMatch(),this.timeoutTimer=setTimeout((()=>{this.onTimeout()}),1e4)}showInviteLink(){this.callbacks.onInvite&&this.callbacks.onInvite()}cancelMatchmaking(){this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null),this.state=N,this.updateUI(),this.callbacks.onCancel&&this.callbacks.onCancel()}onPartnerFound(e){this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null),this.state=O,this.updateUI(e),this.startCountdown()}onTimeout(){this.state=k,this.updateUI(),this.callbacks.onTimeout&&this.callbacks.onTimeout()}startCountdown(){let e=3;const t=this.container.querySelector(".sync-lobby-countdown"),n=setInterval((()=>{e--,t&&(e>0?t.textContent=`Starting in ${e}...`:(t.textContent="Starting now!",clearInterval(n),setTimeout((()=>{this.callbacks.onStart&&this.callbacks.onStart()}),500)))}),1e3)}updateUI(e=null){const t=document.getElementById("sync-lobby-content");if(!t)return;let n;switch(this.buttons.forEach((e=>e.destroy())),this.buttons=[],t.innerHTML="",this.state){case N:n=this.createModeSelection();break;case w:n=this.createSearchingUI();break;case O:n=this.createPartnerFoundUI(e);break;case k:n=this.createTimeoutUI()}n&&t.appendChild(n)}show(){this.container.classList.remove("sync-screen-hidden")}hide(){this.container.classList.add("sync-screen-hidden")}reset(){this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null),this.state=N,this.updateUI()}destroy(){this.reset(),this.buttons.forEach((e=>e.destroy())),this.buttons=[],this.container.innerHTML=""}}const x="success",_="error",R="info",P="warning";class B{constructor(){this.logger=n("Toast"),this.toasts=[],this.container=this.createContainer()}createContainer(){let e=document.getElementById("sync-toast-container");return e||(e=document.createElement("div"),e.id="sync-toast-container",e.className="sync-toast-container",document.body.appendChild(e)),e}show(e,t=R,n=i.UI.TOAST_DURATION){const s=this.createToast(e,t);return this.container.appendChild(s),this.toasts.push(s),requestAnimationFrame((()=>{s.classList.add("sync-toast-visible")})),n>0&&setTimeout((()=>{this.dismiss(s)}),n),s}createToast(e,t){const n=document.createElement("div");n.className=`sync-toast sync-toast-${t}`;const s=this.getIconForType(t);if(s){const e=document.createElement("span");e.className="sync-toast-icon",e.textContent=s,n.appendChild(e)}const i=document.createElement("span");i.className="sync-toast-message",i.textContent=e,n.appendChild(i);const a=document.createElement("button");return a.className="sync-toast-close",a.innerHTML="Ã—",a.setAttribute("aria-label","Close"),a.addEventListener("click",(()=>this.dismiss(n))),n.appendChild(a),n}getIconForType(e){return{[x]:"âœ“",[_]:"âœ•",[R]:"â„¹",[P]:"âš "}[e]||""}dismiss(e){e.classList.remove("sync-toast-visible"),setTimeout((()=>{e.remove(),this.toasts=this.toasts.filter((t=>t!==e))}),300)}dismissAll(){this.toasts.forEach((e=>this.dismiss(e)))}success(e,t){return this.show(e,x,t)}error(e,t){return this.show(e,_,t)}info(e,t){return this.show(e,R,t)}warning(e,t){return this.show(e,P,t)}destroy(){this.dismissAll(),this.container&&this.container.parentNode&&this.container.remove()}}class H{constructor(e){this.logger=n("Modal"),this.title=e.title,this.content=e.content,this.closeOnBackdrop=!1!==e.closeOnBackdrop,this.closeOnEscape=!1!==e.closeOnEscape,this.onClose=e.onClose||null,this.className=e.className||"",this.isOpen=!1,this.previousFocus=null,this.backdrop=this.createBackdrop(),this.modal=this.createModal(),this.bindEvents()}createBackdrop(){const e=document.createElement("div");return e.className="sync-modal-backdrop",this.closeOnBackdrop&&e.addEventListener("click",(()=>this.close())),e}createModal(){const e=document.createElement("div");e.className=`sync-modal ${this.className}`,e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","sync-modal-title");const t=document.createElement("div");t.className="sync-modal-header";const n=document.createElement("h2");n.id="sync-modal-title",n.className="sync-modal-title",n.textContent=this.title,t.appendChild(n);const s=document.createElement("button");s.className="sync-modal-close",s.innerHTML="Ã—",s.setAttribute("aria-label","Close modal"),s.addEventListener("click",(()=>this.close())),t.appendChild(s),e.appendChild(t);const i=document.createElement("div");return i.className="sync-modal-body","string"==typeof this.content?i.innerHTML=this.content:this.content instanceof HTMLElement&&i.appendChild(this.content),e.appendChild(i),e.addEventListener("click",(e=>{e.stopPropagation()})),e}bindEvents(){this.closeOnEscape&&(this.escapeHandler=e=>{"Escape"===e.key&&this.isOpen&&this.close()},document.addEventListener("keydown",this.escapeHandler))}open(){this.isOpen||(this.previousFocus=document.activeElement,document.body.appendChild(this.backdrop),document.body.appendChild(this.modal),requestAnimationFrame((()=>{this.backdrop.classList.add("sync-modal-backdrop-visible"),this.modal.classList.add("sync-modal-visible")})),document.body.style.overflow="hidden",this.focusFirstElement(),this.isOpen=!0,this.logger.debug("Modal opened"))}close(){this.isOpen&&(this.backdrop.classList.remove("sync-modal-backdrop-visible"),this.modal.classList.remove("sync-modal-visible"),setTimeout((()=>{this.backdrop.remove(),this.modal.remove(),document.body.style.overflow="",this.previousFocus&&this.previousFocus.focus(),this.onClose&&this.onClose(),this.isOpen=!1,this.logger.debug("Modal closed")}),200))}focusFirstElement(){const e=this.modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');e.length>0&&e[0].focus()}setContent(e){const t=this.modal.querySelector(".sync-modal-body");t&&("string"==typeof e?t.innerHTML=e:e instanceof HTMLElement&&(t.innerHTML="",t.appendChild(e)))}setTitle(e){const t=this.modal.querySelector(".sync-modal-title");t&&(t.textContent=e)}destroy(){this.isOpen&&this.close(),this.escapeHandler&&document.removeEventListener("keydown",this.escapeHandler)}}class U{constructor(){if(U.instance)return U.instance;this.logger=n("UIManager"),this.isInitialized=!1,this.currentScreen=null,this.screens=new Map,this.screenInstances=new Map,this.modals=[],this.toast=null,this.gameManager=null,U.instance=this}async init(){if(this.isInitialized)this.logger.warn("UIManager already initialized");else{this.logger.debug("Initializing UIManager...");try{this.toast=new B,this.cacheScreenContainers(),this.initializeScreens(),this.isInitialized=!0,this.logger.debug("UIManager initialized")}catch(e){throw this.logger.error("UIManager initialization failed:",e),e}}}cacheScreenContainers(){this.screens.set(l.MENU,document.getElementById("sync-menu-screen")),this.screens.set(l.GAME,document.getElementById("sync-game-screen")),this.screens.set(l.GAME_OVER,document.getElementById("sync-game-over-screen")),this.screens.set(l.LEADERBOARD,document.getElementById("sync-leaderboard-screen")),this.screens.set(l.LOBBY,document.getElementById("sync-lobby-screen")),this.screens.forEach(((e,t)=>{e||((e=document.createElement("div")).id=`sync-${t.toLowerCase()}-screen`,e.className="sync-screen sync-screen-hidden",document.querySelector(".sync-container")?.appendChild(e),this.screens.set(t,e))}))}initializeScreens(){try{const e=this.screens.get(l.MENU);e&&this.screenInstances.set(l.MENU,new f(e,{onModeSelect:e=>this.handleModeSelect(e),onLeaderboard:()=>this.showScreen(l.LEADERBOARD),onSettings:()=>this.showSettings()}))}catch(e){this.logger.error("Failed to initialize Menu screen:",e)}try{const e=this.screens.get(l.GAME);e&&this.screenInstances.set(l.GAME,new C(e,{onPause:()=>this.togglePause(),onRestart:()=>this.restartGame(),onQuit:()=>this.quitToMenu()}))}catch(e){this.logger.error("Failed to initialize Game screen:",e)}try{const e=this.screens.get(l.GAME_OVER);e&&this.screenInstances.set(l.GAME_OVER,new M(e,{onPlayAgain:()=>this.playAgain(),onShare:()=>this.shareScore(),onLeaderboard:()=>this.showScreen(l.LEADERBOARD),onMenu:()=>this.showScreen(l.MENU)}))}catch(e){this.logger.error("Failed to initialize Game Over screen:",e)}try{const e=this.screens.get(l.LEADERBOARD);e&&this.screenInstances.set(l.LEADERBOARD,new A(e,{onBack:()=>this.showScreen(l.MENU),onLoadLeaderboard:e=>this.loadLeaderboard(e)}))}catch(e){this.logger.error("Failed to initialize Leaderboard screen:",e)}try{const e=this.screens.get(l.LOBBY);e&&this.screenInstances.set(l.LOBBY,new D(e,{onBack:()=>this.showScreen(l.MENU),onQuickMatch:()=>this.startQuickMatch(),onInvite:()=>this.showInviteLink(),onCancel:()=>this.cancelMatchmaking(),onTimeout:()=>this.handleMatchmakingTimeout(),onStart:()=>this.startOnlineGame(),onPlaySolo:()=>this.handleModeSelect(o.SOLO)}))}catch(e){this.logger.error("Failed to initialize Lobby screen:",e)}}showScreen(e,t={},n="fade"){if(this.logger.debug(`Showing screen: ${e}`),this.currentScreen||this.hideLoadingScreen(),this.currentScreen){const e=this.screens.get(this.currentScreen),t=this.screenInstances.get(this.currentScreen);t&&"function"==typeof t.hide?t.hide():e&&e.classList.add("sync-screen-hidden")}const s=this.screens.get(e),i=this.screenInstances.get(e);i&&"function"==typeof i.show?(i.show(),t&&Object.keys(t).length>0&&e===l.GAME_OVER&&i.showStats&&i.showStats(t)):s&&s.classList.remove("sync-screen-hidden"),this.currentScreen=e,this.trackScreenView(e)}hideScreen(e){const t=this.screens.get(e),n=this.screenInstances.get(e);n&&"function"==typeof n.hide?n.hide():t&&t.classList.add("sync-screen-hidden")}showModal(e,t={}){const n=new H({title:t.title||"Modal",content:t.content||"",closeOnBackdrop:!1!==t.closeOnBackdrop,closeOnEscape:!1!==t.closeOnEscape,onClose:t.onClose||null,className:t.className||""});return n.open(),this.modals.push(n),n}hideModal(e){e&&(e.close(),this.modals=this.modals.filter((t=>t!==e)))}updateHUD(e){const t=this.screenInstances.get(l.GAME);t&&"function"==typeof t.updateHUD&&t.updateHUD(e)}showToast(e,t="info",n){this.toast&&this.toast.show(e,t,n)}updateScore(e){const t=this.screenInstances.get(l.GAME);t&&t.scoreDisplay&&t.scoreDisplay.updateScore(e)}updateHighScore(e){const t=this.screenInstances.get(l.MENU);t&&"function"==typeof t.updateHighScore&&t.updateHighScore(e)}updateFPS(e){const t=document.getElementById("sync-fps-display");t&&i.UI.SHOW_FPS&&(t.textContent=`${e} FPS`,t.style.display="block")}showLoadingScreen(){const e=document.getElementById("sync-loading");e&&(e.style.display="flex")}hideLoadingScreen(){const e=document.getElementById("sync-loading");e&&(e.style.display="none")}showErrorScreen(e){const t=document.getElementById("sync-error"),n=document.getElementById("sync-error-message");t&&n&&(n.textContent=e.message||"An unexpected error occurred",t.style.display="flex")}handleModeSelect(e){if(this.logger.debug(`Mode selected: ${e}`),e===o.ONLINE)this.showScreen(l.LOBBY);else if(this.gameManager&&"function"==typeof this.gameManager.startGame){const t=this.screenInstances.get(l.GAME);t&&t.setMode(e),this.showScreen(l.GAME),this.gameManager.startGame(e)}}togglePause(){if(this.gameManager&&"function"==typeof this.gameManager.togglePause){const e=this.gameManager.togglePause(),t=this.screenInstances.get(l.GAME);e?t?.showPauseOverlay():t?.hidePauseOverlay()}}restartGame(){this.gameManager&&"function"==typeof this.gameManager.restartGame&&this.gameManager.restartGame()}quitToMenu(){this.gameManager&&"function"==typeof this.gameManager.stopGame&&this.gameManager.stopGame(),this.showScreen(l.MENU)}playAgain(){this.gameManager&&"function"==typeof this.gameManager.restartGame&&(this.showScreen(l.GAME),this.gameManager.restartGame())}shareScore(){const e=this.screenInstances.get(l.GAME_OVER),t=e?.currentStats;if(!t)return;const n=`I just scored ${t.score} in SYNC! Can you beat my score? ðŸŽ®`,s=window.location.href;navigator.share?navigator.share({title:"SYNC Game Score",text:n,url:s}).catch((e=>{this.logger.debug("Share cancelled or failed",e)})):this.showShareDialog(n,s)}showShareDialog(e,t){const n=document.createElement("div");n.innerHTML=`\n      <p>Share your score:</p>\n      <textarea readonly style="width: 100%; padding: 0.5rem; margin: 1rem 0; border-radius: 4px;">${e}\n${t}</textarea>\n      <button class="sync-btn sync-btn-primary" onclick="navigator.clipboard.writeText('${e}\\n${t}').then(() => alert('Copied to clipboard!'))">Copy to Clipboard</button>\n    `,this.showModal("share",{title:"Share Score",content:n})}showSettings(){const e=document.createElement("div");e.className="sync-settings-content";const t=document.createElement("div");t.className="sync-setting",t.innerHTML=`\n      <div class="sync-setting-label">Sound Effects</div>\n      <input type="checkbox" class="sync-toggle" id="sync-audio-toggle" ${i.AUDIO.ENABLED?"checked":""}>\n    `,e.appendChild(t);const n=document.createElement("div");n.className="sync-setting",n.innerHTML='\n      <div class="sync-setting-label">Haptic Feedback</div>\n      <input type="checkbox" class="sync-toggle" id="sync-haptic-toggle" checked>\n    ',e.appendChild(n),this.showModal("settings",{title:"Settings",content:e}),setTimeout((()=>{const e=document.getElementById("sync-audio-toggle"),t=document.getElementById("sync-haptic-toggle");e&&e.addEventListener("change",(e=>{this.gameManager?.audioManager&&this.gameManager.audioManager.setEnabled(e.target.checked)})),t&&t.addEventListener("change",(e=>{localStorage.setItem("sync_haptic_enabled",e.target.checked)}))}),100)}async loadLeaderboard(e){return new Promise((e=>{setTimeout((()=>{const t=Array.from({length:20},((e,t)=>({id:t+1,name:`Player ${t+1}`,score:100-5*t,mode:t%3==0?"DUO":"SOLO",isPlayer:10===t})));e(t)}),500)}))}startQuickMatch(){this.logger.debug("Starting quick match..."),this.showToast("Quick match not yet implemented","info")}showInviteLink(){const e=`${window.location.origin}/sync?room=${Date.now()}`,t=document.createElement("div");t.innerHTML=`\n      <p>Share this link with your friend:</p>\n      <input type="text" readonly value="${e}" style="width: 100%; padding: 0.5rem; margin: 1rem 0; border-radius: 4px;">\n      <button class="sync-btn sync-btn-primary" onclick="navigator.clipboard.writeText('${e}').then(() => alert('Link copied!'))">Copy Link</button>\n    `,this.showModal("invite",{title:"Invite Friend",content:t})}cancelMatchmaking(){this.logger.debug("Matchmaking cancelled")}handleMatchmakingTimeout(){this.showToast("No partner found. Try again or play solo.","warning",5e3)}startOnlineGame(){this.logger.debug("Starting online game..."),this.gameManager&&"function"==typeof this.gameManager.startGame&&(this.showScreen(l.GAME),this.gameManager.startGame(o.ONLINE))}trackScreenView(e){i.ANALYTICS.ENABLED&&this.gameManager?.analytics&&this.gameManager.analytics.trackEvent("screen_view",{screen_name:e})}setGameManager(e){this.gameManager=e}setInputManager(e){this.inputManager=e,this.logger.debug("InputManager linked to UIManager")}setAudioManager(e){this.audioManager=e,this.logger.debug("AudioManager linked to UIManager")}getCurrentScreen(){return this.currentScreen}destroy(){this.screenInstances.forEach((e=>{e&&"function"==typeof e.destroy&&e.destroy()})),this.modals.forEach((e=>e.destroy())),this.toast&&this.toast.destroy(),this.screens.clear(),this.screenInstances.clear(),this.modals=[],this.logger.debug("UIManager destroyed")}}new U;class G{constructor(){if(G.instance)return G.instance;this.logger=n("AudioManager"),this.audioContext=null,this.masterGainNode=null,this.sfxGainNode=null,this.musicGainNode=null,this.soundBuffers=new Map,this.activeSources=new Set,this.musicSource=null,this.currentMusicTrack=null,this.masterVolume=1,this.sfxVolume=.8,this.musicVolume=.5,this.muted=!1,this.initialized=!1,this.unlocked=!1,this.loading=!1,this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),this.isIOS=/iPhone|iPad|iPod/i.test(navigator.userAgent),this.useWebAudio=!(!window.AudioContext&&!window.webkitAudioContext),this.html5Sounds=new Map,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,G.instance=this}async init(){if(this.initialized)this.logger.debug("AudioManager already initialized");else{this.logger.info("Initializing AudioManager");try{this.loadSettings(),this.useWebAudio?await this.initWebAudio():this.logger.warn("Web Audio API not supported, using HTML5 Audio fallback"),await this.generateAllSounds(),this.isMobile&&this.setupAutoplayUnlock(),this.initialized=!0,this.logger.info("AudioManager initialized successfully")}catch(e){this.logger.error("Failed to initialize AudioManager",e),this.initialized=!0}}}async initWebAudio(){const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.gain.value=this.muted?0:this.masterVolume,this.masterGainNode.connect(this.audioContext.destination),this.sfxGainNode=this.audioContext.createGain(),this.sfxGainNode.gain.value=this.sfxVolume,this.sfxGainNode.connect(this.masterGainNode),this.musicGainNode=this.audioContext.createGain(),this.musicGainNode.gain.value=this.musicVolume,this.musicGainNode.connect(this.masterGainNode),this.logger.debug("Web Audio API initialized",{sampleRate:this.audioContext.sampleRate,state:this.audioContext.state})}setupAutoplayUnlock(){const e=()=>{this.unlocked||(this.logger.debug("Attempting to unlock audio"),this.audioContext&&"suspended"===this.audioContext.state?this.audioContext.resume().then((()=>{this.logger.info("Audio context unlocked"),this.unlocked=!0;const t=this.audioContext.createBuffer(1,1,22050),n=this.audioContext.createBufferSource();n.buffer=t,n.connect(this.audioContext.destination),n.start(0),document.removeEventListener("touchstart",e),document.removeEventListener("touchend",e),document.removeEventListener("click",e)})):this.unlocked=!0)};document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("touchend",e,{once:!0}),document.addEventListener("click",e,{once:!0})}async generateAllSounds(){if(this.useWebAudio&&this.audioContext){this.logger.debug("Generating procedural sounds");try{this.soundBuffers.set(c.JUMP,this.generateJumpSound()),this.soundBuffers.set(c.COLLISION,this.generateCollisionSound()),this.soundBuffers.set(c.SUCCESS,this.generateSuccessSound()),this.soundBuffers.set(c.DEATH,this.generateDeathSound()),this.soundBuffers.set(c.UI_CLICK,this.generateUIClickSound()),this.soundBuffers.set(c.COUNTDOWN,this.generateCountdownSound()),this.soundBuffers.set("PERFECT_SYNC",this.generatePerfectSyncSound()),this.logger.info(`Generated ${this.soundBuffers.size} procedural sounds`)}catch(e){this.logger.error("Failed to generate sounds",e)}}else this.logger.warn("Cannot generate sounds without Web Audio API")}generateJumpSound(){const e=this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,.1*e,e),n=t.getChannelData(0);for(let s=0;s<t.length;s++){const t=s/e,i=440+t/.1*440,a=Math.exp(10*-t);n[s]=Math.sin(2*Math.PI*i*t)*a*.3}return t}generateCollisionSound(){const e=this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,.2*e,e),n=t.getChannelData(0);for(let s=0;s<t.length;s++){const t=s/e,i=Math.exp(20*-t),a=Math.sin(2*Math.PI*80*t),o=.3*(2*Math.random()-1);n[s]=(.7*a+.3*o)*i*.4}return t}generateSuccessSound(){const e=this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,.15*e,e),n=t.getChannelData(0),s=[523.25,659.25,783.99];for(let i=0;i<t.length;i++){const t=i/e,a=Math.exp(8*-t);let o=0;s.forEach((e=>{o+=Math.sin(2*Math.PI*e*t)})),n[i]=o/s.length*a*.25}return t}generatePerfectSyncSound(){const e=this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,.2*e,e),n=t.getChannelData(0),s=[523.25,783.99,1046.5];for(let i=0;i<t.length;i++){const t=i/e,a=Math.exp(6*-t);let o=0;s.forEach(((e,n)=>{const s=.02*n;t>=s&&(o+=Math.sin(2*Math.PI*e*(t-s)))})),n[i]=o/s.length*a*.3}return t}generateDeathSound(){const e=this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,.5*e,e),n=t.getChannelData(0);for(let s=0;s<t.length;s++){const t=s/e,i=440-t/.5*330,a=Math.exp(3*-t);n[s]=Math.sin(2*Math.PI*i*t)*a*.3}return t}generateUIClickSound(){const e=this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,.05*e,e),n=t.getChannelData(0);for(let s=0;s<t.length;s++){const t=s/e,i=Math.exp(50*-t);n[s]=Math.sin(2*Math.PI*1200*t)*i*.2}return t}generateCountdownSound(){const e=this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,.1*e,e),n=t.getChannelData(0);for(let s=0;s<t.length;s++){const t=s/e,i=Math.exp(15*-t);n[s]=Math.sin(2*Math.PI*880*t)*i*.25}return t}play(e,t={}){if(!this.initialized||this.muted)return;const{volume:n=1,pan:s=0,pitch:i=1,delay:a=0,loop:o=!1}=t;try{this.useWebAudio&&this.audioContext?this.playWebAudio(e,n,s,i,a,o):this.playHTML5Audio(e,n)}catch(r){this.logger.warn(`Failed to play sound: ${e}`,r)}}playWebAudio(e,t,n,s,i,a){const o=this.soundBuffers.get(e);if(!o)return void this.logger.warn(`Sound buffer not found: ${e}`);const r=this.audioContext.createBufferSource();r.buffer=o,r.playbackRate.value=s,r.loop=a;const c=this.audioContext.createGain();c.gain.value=t;const l=this.audioContext.createStereoPanner();l.pan.value=Math.max(-1,Math.min(1,n)),r.connect(c),c.connect(l),l.connect(this.sfxGainNode),this.activeSources.add(r),r.onended=()=>{this.activeSources.delete(r),r.disconnect(),c.disconnect(),l.disconnect()};const d=this.audioContext.currentTime+i;r.start(d),this.activeSources.size>10&&this.activeSources.values().next().value.stop()}playHTML5Audio(e,t){this.logger.debug(`HTML5 Audio playback not fully implemented: ${e}`)}playMusic(e,t=!0,n=1){!this.initialized||this.muted||this.prefersReducedMotion||(this.musicSource&&this.stopMusic(1),this.logger.debug(`Playing music: ${e} (loop: ${t})`),this.currentMusicTrack=e)}stopMusic(e=1){if(!this.musicSource)return;const t=this.audioContext.currentTime;this.musicGainNode.gain.setValueAtTime(this.musicVolume,t),this.musicGainNode.gain.linearRampToValueAtTime(0,t+e),setTimeout((()=>{this.musicSource&&(this.musicSource.stop(),this.musicSource=null,this.currentMusicTrack=null),this.musicGainNode.gain.value=this.musicVolume}),1e3*e),this.logger.debug("Stopping music")}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.masterGainNode&&(this.masterGainNode.gain.value=this.muted?0:this.masterVolume),this.saveSettings(),this.logger.debug(`Master volume set to ${this.masterVolume}`)}setSoundVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e)),this.sfxGainNode&&(this.sfxGainNode.gain.value=this.sfxVolume),this.saveSettings(),this.logger.debug(`SFX volume set to ${this.sfxVolume}`)}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),this.musicGainNode&&(this.musicGainNode.gain.value=this.musicVolume),this.saveSettings(),this.logger.debug(`Music volume set to ${this.musicVolume}`)}mute(){this.muted=!0,this.masterGainNode&&(this.masterGainNode.gain.value=0),this.saveSettings(),this.logger.debug("Audio muted")}unmute(){this.muted=!1,this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolume),this.saveSettings(),this.logger.debug("Audio unmuted")}toggleMute(){return this.muted?this.unmute():this.mute(),this.muted}setUIManager(e){this.uiManager=e,this.logger.debug("UIManager linked to AudioManager")}async preloadCriticalSounds(){return this.logger.debug("Critical sounds already loaded during init"),Promise.resolve()}async preloadAllSounds(){return this.logger.debug("All sounds already loaded during init"),Promise.resolve()}setEnabled(e){this.enabled=e,this.logger.debug("Audio "+(e?"enabled":"disabled")),e||this.mute()}isMuted(){return this.muted}getVolumes(){return{master:this.masterVolume,sfx:this.sfxVolume,music:this.musicVolume,muted:this.muted}}loadSettings(){try{const e=`${i.STORAGE.KEY_PREFIX}audio_settings`,t=localStorage.getItem(e);if(t){const e=JSON.parse(t);this.masterVolume=e.master??1,this.sfxVolume=e.sfx??.8,this.musicVolume=e.music??.5,this.muted=e.muted??!1,this.logger.debug("Loaded audio settings from storage",e)}}catch(e){this.logger.warn("Failed to load audio settings",e)}}saveSettings(){try{const e=`${i.STORAGE.KEY_PREFIX}audio_settings`,t={master:this.masterVolume,sfx:this.sfxVolume,music:this.musicVolume,muted:this.muted};localStorage.setItem(e,JSON.stringify(t))}catch(e){this.logger.warn("Failed to save audio settings",e)}}destroy(){this.logger.debug("Destroying AudioManager"),this.activeSources.forEach((e=>{try{e.stop()}catch(t){}})),this.activeSources.clear(),this.musicSource&&(this.musicSource.stop(),this.musicSource=null),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.soundBuffers.clear(),this.html5Sounds.clear(),this.initialized=!1,this.logger.info("AudioManager destroyed")}static getInstance(){return G.instance||(G.instance=new G),G.instance}}class z{constructor(){if(z.instance)throw new Error("SyncGameApp is a singleton. Use SyncGameApp.getInstance()");this.isInitialized=!1,this.isLoading=!1,this.logger=s.getModuleLogger("sync-game"),this.inputManager=null,this.uiManager=null,this.audioManager=null,this.gameManager=null,this.gameModeController=null,this.firebaseService=null,this.localStorageService=null,this.currentScreen=l.MENU,this.currentMode=null,this.startTime=null,this.frameCount=0,this.lastFpsUpdate=0,this.fps=0,this.logger.info("SyncGameApp instance created")}static getInstance(){return z.instance||(z.instance=new z),z.instance}async init(){if(this.isInitialized)this.logger.warn("SyncGameApp already initialized");else if(this.isLoading)this.logger.warn("SyncGameApp initialization already in progress");else{this.isLoading=!0,this.logger.time("sync-game-initialization"),this.logger.info("Initializing SYNC Game",i.BUILD);try{this.showLoadingScreen(),await this.initCoreManagers(),await this.loadAssets(),this.setupAnalytics(),this.showScreen(l.MENU),this.deferNonCriticalFeatures(),this.logger.info("SYNC Game initialization complete"),this.isInitialized=!0}catch(e){this.logger.error("SYNC Game initialization failed",e),this.showErrorScreen(e)}finally{this.isLoading=!1,this.logger.timeEnd("sync-game-initialization")}}}async initCoreManagers(){this.logger.debug("Initializing core managers"),this.logger.debug("Initializing UI Manager"),this.uiManager=new U,await this.uiManager.init(),this.logger.debug("Initializing Input Manager"),this.inputManager=new u,await this.inputManager.init(),this.logger.debug("Initializing Audio Manager"),this.audioManager=new G,await this.audioManager.init(),this.wireManagers(),this.logger.debug("Core managers initialized")}wireManagers(){this.uiManager&&this.inputManager&&this.uiManager.setInputManager(this.inputManager),this.audioManager&&this.uiManager&&this.audioManager.setUIManager(this.uiManager)}async loadAssets(){this.logger.debug("Loading critical assets"),i.AUDIO.ENABLED&&this.audioManager&&await this.audioManager.preloadCriticalSounds(),await this.loadLocalData(),this.logger.debug("Critical assets loaded")}async loadLocalData(){try{const{default:e}=await t((async()=>{const{default:e}=await import("./LocalStorageService-BFa-OMlj.js");return{default:e}}),__vite__mapDeps([0,1,2,3,4]));this.localStorageService=new e;const n=this.localStorageService.getHighScore(),s=this.localStorageService.getSettings();this.logger.debug("Local data loaded",{highScore:n,settings:s}),void 0!==s.audioEnabled&&this.audioManager.setEnabled(s.audioEnabled)}catch(e){this.logger.warn("Failed to load local data",e)}}deferNonCriticalFeatures(){this.logger.debug("Deferring non-critical features");const e=async()=>{try{i.AUDIO.ENABLED&&this.audioManager&&await this.audioManager.preloadAllSounds(),i.MULTIPLAYER.ENABLED&&await this.initFirebase(),this.logger.debug("Non-critical features loaded")}catch(e){this.logger.error("Failed to load non-critical features",e)}};"requestIdleCallback"in window?requestIdleCallback((()=>{e()}),{timeout:2e3}):setTimeout((()=>{e()}),100)}async initFirebase(){try{this.logger.debug("Initializing Firebase");const{default:e}=await t((async()=>{const{default:e}=await import("./firebase-vendor-BZRpGTjc.js").then((e=>e.F));return{default:e}}),__vite__mapDeps([3,4]));this.firebaseService=new e,await this.firebaseService.init(),this.logger.info("Firebase initialized")}catch(e){this.logger.error("Firebase initialization failed",e),i.MULTIPLAYER.ENABLED=!1}}setupAnalytics(){this.logger.debug("Setting up analytics integration"),i.ANALYTICS.ENABLED&&e.logEvent(i.ANALYTICS.EVENTS.APP_INIT,{version:i.BUILD.VERSION,timestamp:Date.now()}),this.setupScreenTracking(),this.logger.debug("Analytics integration complete")}setupScreenTracking(){const t=this.showScreen.bind(this);this.showScreen=(n,s)=>(i.ANALYTICS.ENABLED&&e.logEvent("sync_screen_view",{screen_name:n,timestamp:Date.now()}),t(n,s))}showLoadingScreen(){if(this.uiManager)this.uiManager.showLoadingScreen();else{const e=document.getElementById("sync-loading");e&&(e.style.display="flex")}}showScreen(e,t={}){this.logger.debug(`Showing screen: ${e}`,t),this.currentScreen=e,this.uiManager&&this.uiManager.showScreen(e,t)}showErrorScreen(e){if(this.logger.error("Showing error screen",e),this.uiManager)this.uiManager.showErrorScreen(e);else{const t=document.getElementById("sync-error");t&&(t.textContent=`Error: ${e.message}`,t.style.display="block")}}async startGame(t){this.logger.info(`Starting game in ${t} mode`);try{this.gameManager||await this.initGameManager(),this.gameModeController||await this.initGameModeController(t),i.ANALYTICS.ENABLED&&e.logEvent(i.ANALYTICS.EVENTS.GAME_START,{mode:t,timestamp:Date.now()}),this.currentMode=t,await this.gameModeController.start(),this.showScreen(l.GAME),this.logger.info("Game started")}catch(n){this.logger.error("Failed to start game",n),this.showErrorScreen(n)}}async initGameManager(){this.logger.debug("Lazy loading GameManager");const{default:n}=await t((async()=>{const{default:e}=await import("./GameManager-BpRmIxpk.js");return{default:e}}),__vite__mapDeps([5,1,6,2,3,4])),{default:s}=await t((async()=>{const{default:e}=await import("./CanvasRenderer-CJ09IDnv.js");return{default:e}}),__vite__mapDeps([7,1,2,3,4])),{default:i}=await t((async()=>{const{default:e}=await import("./ParticleSystem-B0kY8n5t.js");return{default:e}}),__vite__mapDeps([8,1,2,3,4])),{default:a}=await t((async()=>{const{default:e}=await import("./PerformanceMonitor-D0zcL3CN.js");return{default:e}}),[]),o=document.getElementById("sync-game-canvas");if(!o)throw new Error("Game canvas not found");const r=new s(o);await r.init();const c=new i,l=new a;this.gameManager=n.getInstance(),await this.gameManager.init({canvas:o,inputManager:this.inputManager,audioManager:this.audioManager,uiManager:this.uiManager,renderer:r,particleSystem:c,performanceMonitor:l,firebaseSync:this.firebaseService,analyticsService:e}),this.uiManager&&this.uiManager.setGameManager(this.gameManager),this.logger.debug("GameManager initialized with full dependencies")}async initGameModeController(e){switch(this.logger.debug(`Initializing ${e} game mode controller`),e){case"SOLO":{const{default:e}=await t((async()=>{const{default:e}=await import("./SoloGameMode-SJNLXgWM.js");return{default:e}}),__vite__mapDeps([9,1,2,3,4]));this.gameModeController=new e(this.gameManager,this.inputManager);break}case"DUO":{const{default:e}=await t((async()=>{const{default:e}=await import("./LocalDuoMode-gHUbAs_A.js");return{default:e}}),__vite__mapDeps([10,1,2,3,4]));this.gameModeController=new e(this.gameManager,this.inputManager);break}case"ONLINE":{if(!this.firebaseService)throw new Error("Online mode requires Firebase initialization");const{default:e}=await t((async()=>{const{default:e}=await import("./OnlineDuoMode-D_cmO9-g.js");return{default:e}}),__vite__mapDeps([11,1,6,2,3,4]));this.gameModeController=new e(this.gameManager,this.inputManager,this.firebaseService);break}default:throw new Error(`Unknown game mode: ${e}`)}this.logger.debug(`${e} game mode controller initialized`)}endGame(t){this.logger.info("Game ended",t),i.ANALYTICS.ENABLED&&e.logEvent(i.ANALYTICS.EVENTS.GAME_OVER,{mode:this.currentMode,score:t.score,highScore:t.isHighScore,timestamp:Date.now()}),t.isHighScore&&this.localStorageService&&(this.localStorageService.saveHighScore(t.score),i.ANALYTICS.ENABLED&&e.logEvent(i.ANALYTICS.EVENTS.HIGH_SCORE,{score:t.score,mode:this.currentMode})),this.showScreen(l.GAME_OVER,t)}returnToMenu(){this.logger.info("Returning to menu"),this.gameModeController&&this.gameModeController.stop&&this.gameModeController.stop(),this.gameManager&&this.gameManager.isRunning&&this.gameManager.stop(),this.gameModeController=null,this.currentMode=null,this.showScreen(l.MENU)}updateFPS(){if(!i.UI.SHOW_FPS)return;this.frameCount++;const e=performance.now();e>=this.lastFpsUpdate+1e3&&(this.fps=Math.round(1e3*this.frameCount/(e-this.lastFpsUpdate)),this.frameCount=0,this.lastFpsUpdate=e,this.uiManager&&this.uiManager.updateFPS(this.fps))}destroy(){this.logger.info("Destroying SYNC Game"),this.gameManager&&this.gameManager.destroy(),this.inputManager&&this.inputManager.destroy(),this.audioManager&&this.audioManager.destroy(),this.uiManager&&this.uiManager.destroy(),this.firebaseService&&this.firebaseService.disconnect(),this.isInitialized=!1,this.logger.info("SYNC Game destroyed")}}const F=z.getInstance();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{F.init()})):F.init(),window.addEventListener("beforeunload",(()=>{F.destroy()})),i.DEBUG.ENABLED&&(window.syncGameApp=F);export{c as A,i as C,o as G,d as N,a};
