import{G as e}from"./sync-game-CMiSMg4n.js";import{g as t}from"./logger-CHTAPRDI.js";import"./analytics-service-UCL_K60g.js";import"./firebase-vendor-yjSyvrsK.js";import"./vendor-BmBcEOuS.js";class s{constructor(e,s){this.gameManager=e,this.inputManager=s,this.logger=t("LocalDuoMode"),this.isActive=!1,this.player1Jumps=0,this.player2Jumps=0,this.syncedJumps=0,this.lastJumpTime=null}async start(){this.logger.info("Starting local duo game mode"),this.isActive=!0,this.resetPlayerStats(),this.setupSplitInput(),await this.gameManager.startLocalDuoGame(),this.subscribeToGameEvents()}resetPlayerStats(){this.player1Jumps=0,this.player2Jumps=0,this.syncedJumps=0}setupSplitInput(){this.jumpHandler=e=>{if(!this.isActive)return;const{player:t,inputType:s}=e,a=Date.now();this.gameManager.handleJumpInput({player:t,inputType:s||"TOUCH",timestamp:a}),1===t?(this.player1Jumps++,this.logger.debug("Player 1 jumped")):2===t&&(this.player2Jumps++,this.logger.debug("Player 2 jumped")),this.checkSyncOpportunity(t,a)},this.inputManager.on("jump",this.jumpHandler)}checkSyncOpportunity(e,t){if(this.lastJumpTime){if(this.lastJumpTime.player!==e){const e=Math.abs(t-this.lastJumpTime.timestamp);e<100&&this.logger.debug(`Sync opportunity detected (${e}ms apart)`)}this.lastJumpTime={player:e,timestamp:t}}else this.lastJumpTime={player:e,timestamp:t}}subscribeToGameEvents(){this.gameManager.on("perfectSync",(e=>{this.syncedJumps++,this.logger.info(`Perfect sync! Total syncs: ${this.syncedJumps}`),this.celebratePerfectSync(e)})),this.gameManager.on("gameOver",(e=>{this.handleGameOver(e)}))}celebratePerfectSync(e){this.logger.debug(`Combo: ${e.combo} - Great teamwork!`)}handleGameOver(e){this.logger.info("Local duo game over",e);const t=this.calculateCooperationScore();this.updateLocalDuoHighScore(e.score);const s=this.calculateTeamGrade({...e,cooperationScore:t,syncedJumps:this.syncedJumps});this.logger.info("Team performance:",{score:e.score,cooperationScore:t,teamGrade:s,player1Jumps:this.player1Jumps,player2Jumps:this.player2Jumps,syncedJumps:this.syncedJumps})}calculateCooperationScore(){const e=this.player1Jumps+this.player2Jumps;if(0===e)return 0;const t=2*this.syncedJumps/e;return Math.min(100,Math.round(100*t))}calculateTeamGrade(e){const{score:t,cooperationScore:s,syncedJumps:a,maxCombo:r}=e;return s>=90&&t>=1e3&&a>=30?"S+":s>=80&&t>=750&&a>=20?"S":s>=70&&t>=500&&a>=15?"A":s>=60&&t>=250?"B":t>=100?"C":"D"}updateLocalDuoHighScore(e){e>parseInt(localStorage.getItem("sync_duo_high_score")||"0")&&(localStorage.setItem("sync_duo_high_score",e.toString()),this.logger.info(`New duo high score: ${e}`));const t=parseInt(localStorage.getItem("sync_duo_games_played")||"0");localStorage.setItem("sync_duo_games_played",(t+1).toString())}stop(){this.logger.info("Stopping local duo game mode"),this.isActive=!1,this.jumpHandler&&(this.inputManager.off("jump",this.jumpHandler),this.jumpHandler=null),this.gameManager&&(this.gameManager.off("perfectSync",this.handlePerfectSyncEvent),this.gameManager.off("gameOver",this.handleGameOverEvent)),this.lastJumpTime=null}getStats(){return{mode:e.DUO,highScore:parseInt(localStorage.getItem("sync_duo_high_score")||"0"),gamesPlayed:parseInt(localStorage.getItem("sync_duo_games_played")||"0"),totalSyncedJumps:parseInt(localStorage.getItem("sync_duo_total_syncs")||"0"),currentSession:{player1Jumps:this.player1Jumps,player2Jumps:this.player2Jumps,syncedJumps:this.syncedJumps,cooperationScore:this.calculateCooperationScore()}}}}export{s as LocalDuoMode,s as default};
