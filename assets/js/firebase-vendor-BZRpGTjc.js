import{o as e,_ as t}from"./vendor-BveZ_Umi.js";const n={},i=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e})),(e=>({status:"rejected",reason:e}))))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=i?.nonce||i?.getAttribute("nonce");s=e(t.map((e=>{if((e=function(e){return"/"+e}(e))in n)return;n[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,r&&s.setAttribute("nonce",r),document.head.appendChild(s),t?new Promise(((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))};var s={};const r=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},a=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const t=e[s],r=s+1<e.length,o=r?e[s+1]:0,a=s+2<e.length,c=a?e[s+2]:0,l=t>>2,h=(3&t)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],r=s<e.length?n[e.charAt(s)]:0;++s;const o=s<e.length?n[e.charAt(s)]:64;++s;const a=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==r||null==o||null==a)throw new l;const c=t<<2|r>>4;if(i.push(c),64!==o){const e=r<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const h=function(e){const t=a(e);return c.encodeByteArray(t,!0)},u=function(e){return h(e).replace(/\./g,"")},d=function(e){try{return c.decodeString(e,!0)}catch(t){}return null};function f(e){return p(void 0,e)}function p(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=p(e[n],t[n]));return e}const g=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const e=s.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return}},m=e=>{var t,n;return null===(n=null===(t=g())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},y=e=>{const t=m(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},_=()=>{var e;return null===(e=g())||void 0===e?void 0:e.config},v=e=>{var t;return null===(t=g())||void 0===t?void 0:t[`_${e}`]};class w{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function I(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(r)),""].join(".")}function b(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function T(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(b())}function C(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function E(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function S(){return!function(){var e;const t=null===(e=g())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"==={}.toString.call(global.process)}catch(n){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function k(){try{return"object"==typeof indexedDB}catch(e){return!1}}function N(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}))}class x extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,A.prototype.create)}}class A{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(D,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new x(i,o,n)}}const D=/\{\$([^}]+)}/g;function P(e){return JSON.parse(e)}function R(e){return JSON.stringify(e)}const O=function(e){let t={},n={},i={},s="";try{const r=e.split(".");t=P(d(r[0])||""),n=P(d(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(r){}return{header:t,claims:n,data:i,signature:s}};function M(e,t){return{}.hasOwnProperty.call(e,t)}function L(e,t){return{}.hasOwnProperty.call(e,t)?e[t]:void 0}function F(e){for(const t in e)if({}.hasOwnProperty.call(e,t))return!1;return!0}function U(e,t,n){const i={};for(const s in e)({}).hasOwnProperty.call(e,s)&&(i[s]=t.call(n,e[s],s,e));return i}function V(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(q(n)&&q(r)){if(!V(n,r))return!1}else if(n!==r)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function q(e){return null!==e&&"object"==typeof e}function j(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}class B{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let h=0;h<16;h++)n[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)n[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const e=n[h-3]^n[h-8]^n[h-14]^n[h-16];n[h]=4294967295&(e<<1|e>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let h=0;h<80;h++){h<40?h<20?(i=c^o&(a^c),s=1518500249):(i=o^a^c,s=1859775393):h<60?(i=o&a|c&(o|a),s=2400959708):(i=o^a^c,s=3395469782);const e=(r<<5|r>>>27)+i+l+s+n[h]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=r,r=e}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<t;){if(0===r)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(s[r]=e.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<t;)if(s[r]=e[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}class z{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=K),void 0===i.error&&(i.error=K),void 0===i.complete&&(i.complete=K);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function K(){}function $(e,t){return`${e} failed: ${t} argument `}const G=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function H(e,t=1e3,n=2){const i=t*Math.pow(n,e),s=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+s)}function W(e){return e&&e._delegate?e._delegate:e}class Q{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Y="[DEFAULT]";class J{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new w;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Y})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});n.resolve(e)}catch(t){}}}}clearInstance(e=Y){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=Y){return this.instances.has(e)}getOptions(e=Y){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,r]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(s)&&r.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(i){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===Y?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(s){}var i;return n||null}normalizeInstanceIdentifier(e=Y){return this.component?this.component.multipleInstances?e:Y:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class X{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new J(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Z,ee;(ee=Z||(Z={}))[ee.DEBUG=0]="DEBUG",ee[ee.VERBOSE=1]="VERBOSE",ee[ee.INFO=2]="INFO",ee[ee.WARN=3]="WARN",ee[ee.ERROR=4]="ERROR",ee[ee.SILENT=5]="SILENT";const te={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},ne=Z.INFO,ie={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},se=(e,t,...n)=>{if(!(t<e.logLevel||((new Date).toISOString(),ie[t])))throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class re{constructor(e){this.name=e,this._logLevel=ne,this._logHandler=se,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?te[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}class oe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ae="@firebase/app",ce="0.10.13",le=new re("@firebase/app"),he="@firebase/app-compat",ue="@firebase/analytics-compat",de="@firebase/analytics",fe="@firebase/app-check-compat",pe="@firebase/app-check",ge="@firebase/auth",me="@firebase/auth-compat",ye="@firebase/database",_e="@firebase/data-connect",ve="@firebase/database-compat",we="@firebase/functions",Ie="@firebase/functions-compat",be="@firebase/installations",Te="@firebase/installations-compat",Ce="@firebase/messaging",Ee="@firebase/messaging-compat",Se="@firebase/performance",ke="@firebase/performance-compat",Ne="@firebase/remote-config",xe="@firebase/remote-config-compat",Ae="@firebase/storage",De="@firebase/storage-compat",Pe="@firebase/firestore",Re="@firebase/vertexai-preview",Oe="@firebase/firestore-compat",Me="firebase",Le="[DEFAULT]",Fe={[ae]:"fire-core",[he]:"fire-core-compat",[de]:"fire-analytics",[ue]:"fire-analytics-compat",[pe]:"fire-app-check",[fe]:"fire-app-check-compat",[ge]:"fire-auth",[me]:"fire-auth-compat",[ye]:"fire-rtdb",[_e]:"fire-data-connect",[ve]:"fire-rtdb-compat",[we]:"fire-fn",[Ie]:"fire-fn-compat",[be]:"fire-iid",[Te]:"fire-iid-compat",[Ce]:"fire-fcm",[Ee]:"fire-fcm-compat",[Se]:"fire-perf",[ke]:"fire-perf-compat",[Ne]:"fire-rc",[xe]:"fire-rc-compat",[Ae]:"fire-gcs",[De]:"fire-gcs-compat",[Pe]:"fire-fst",[Oe]:"fire-fst-compat",[Re]:"fire-vertex","fire-js":"fire-js",[Me]:"fire-js-all"},Ue=new Map,Ve=new Map,qe=new Map;function je(e,t){try{e.container.addComponent(t)}catch(n){le.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Be(e){const t=e.name;if(qe.has(t))return le.debug(`There were multiple attempts to register component ${t}.`),!1;qe.set(t,e);for(const n of Ue.values())je(n,e);for(const n of Ve.values())je(n,e);return!0}function ze(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ke(e){return void 0!==e.settings}const $e=new A("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ge{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Q("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $e.create("app-deleted",{appName:this._name})}}const He="10.14.1";function We(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:Le,automaticDataCollectionEnabled:!1},t),s=i.name;if("string"!=typeof s||!s)throw $e.create("bad-app-name",{appName:String(s)});if(n||(n=_()),!n)throw $e.create("no-options");const r=Ue.get(s);if(r){if(V(n,r.options)&&V(i,r.config))return r;throw $e.create("duplicate-app",{appName:s})}const o=new X(s);for(const c of qe.values())o.addComponent(c);const a=new Ge(n,i,o);return Ue.set(s,a),a}function Qe(e=Le){const t=Ue.get(e);if(!t&&e===Le&&_())return We();if(!t)throw $e.create("no-app",{appName:e});return t}function Ye(e,t,n){var i;let s=null!==(i=Fe[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void le.warn(e.join(" "))}Be(new Q(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const Je="firebase-heartbeat-store";let Xe=null;function Ze(){return Xe||(Xe=e("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Je)}catch(n){}}}).catch((e=>{throw $e.create("idb-open",{originalErrorMessage:e.message})}))),Xe}async function et(e,t){try{const n=(await Ze()).transaction(Je,"readwrite"),i=n.objectStore(Je);await i.put(t,tt(e)),await n.done}catch(n){if(n instanceof x)le.warn(n.message);else{const e=$e.create("idb-set",{originalErrorMessage:null==n?void 0:n.message});le.warn(e.message)}}}function tt(e){return`${e.name}!${e.options.appId}`}class nt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new st(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=it();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return;return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(n){le.warn(n)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=it(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),rt(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),rt(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),s=u(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return le.warn(t),""}}}function it(){return(new Date).toISOString().substring(0,10)}class st{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!k()&&N().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ze()).transaction(Je),n=await t.objectStore(Je).get(tt(e));return await t.done,n}catch(t){if(t instanceof x)le.warn(t.message);else{const e=$e.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});le.warn(e.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function rt(e){return u(JSON.stringify({version:2,heartbeats:e})).length}Be(new Q("platform-logger",(e=>new oe(e)),"PRIVATE")),Be(new Q("heartbeat",(e=>new nt(e)),"PRIVATE")),Ye(ae,ce,""),Ye(ae,ce,"esm2017"),Ye("fire-js",""),Ye("firebase","10.14.1","app");const ot=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},at=new A("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ct=new re("@firebase/auth");function lt(e,...t){ct.logLevel<=Z.ERROR&&ct.error(`Auth (${He}): ${e}`,...t)}function ht(e,...t){throw pt(e,...t)}function ut(e,...t){return pt(e,...t)}function dt(e,t,n){const i=Object.assign(Object.assign({},ot()),{[t]:n});return new A("auth","Firebase",i).create(t,{appName:e.name})}function ft(e){return dt(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function pt(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return at.create(e,...t)}function gt(e,t,...n){if(!e)throw pt(t,...n)}function mt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw lt(t),new Error(t)}function yt(e,t){e||mt(t)}function _t(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function vt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class wt{constructor(e,t){this.shortDelay=e,this.longDelay=t,yt(t>e,"Short delay should be less than long delay!"),this.isMobile=T()||E()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===vt()||"https:"===vt()||C()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function It(e,t){yt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class bt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void mt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void mt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void mt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Tt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ct=new wt(3e4,6e4);function Et(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function St(e,t,n,i,s={}){return kt(e,s,(async()=>{let s={},r={};i&&("GET"===t?r=i:s={body:JSON.stringify(i)});const o=j(Object.assign({key:e.config.apiKey},r)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},s);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),bt.fetch()(xt(e,e.config.apiHost,n,o),c)}))}async function kt(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Tt),t);try{const t=new At(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Dt(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Dt(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Dt(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw Dt(e,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw dt(e,a,o);ht(e,a)}}catch(s){if(s instanceof x)throw s;ht(e,"network-request-failed",{message:String(s)})}}async function Nt(e,t,n,i,s={}){const r=await St(e,t,n,i,s);return"mfaPendingCredential"in r&&ht(e,"multi-factor-auth-required",{_serverResponse:r}),r}function xt(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?It(e.config,s):`${e.config.apiScheme}://${s}`}class At{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(ut(this.auth,"network-request-failed"))),Ct.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Dt(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=ut(e,t,i);return s.customData._tokenResponse=n,s}async function Pt(e,t){return St(e,"POST","/v1/accounts:lookup",t)}function Rt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Ot(e){return 1e3*Number(e)}function Mt(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return lt("JWT malformed, contained fewer than 3 sections"),null;try{const e=d(n);return e?JSON.parse(e):(lt("Failed to decode base64 JWT payload"),null)}catch(s){return lt("Caught error parsing JWT payload as JSON",null==s?void 0:s.toString()),null}}function Lt(e){const t=Mt(e);return gt(t,"internal-error"),gt(void 0!==t.exp,"internal-error"),gt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Ft(e,t,n=!1){if(n)return t;try{return await t}catch(i){throw i instanceof x&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(i)&&e.auth.currentUser===e&&await e.auth.signOut(),i}}class Ut{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Vt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Rt(this.lastLoginAt),this.creationTime=Rt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function qt(e){var t;const n=e.auth,i=await e.getIdToken(),s=await Ft(e,Pt(n,{idToken:i}));gt(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const o=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?jt(r.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Vt(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function jt(e){return e.map((e=>{var{providerId:n}=e,i=t(e,["providerId"]);return{providerId:n,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}}))}class Bt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){gt(e.idToken,"internal-error"),gt(void 0!==e.idToken,"internal-error"),gt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Lt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){gt(0!==e.length,"internal-error");const t=Lt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(gt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await kt(e,{},(async()=>{const n=j({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,r=xt(e,i,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",bt.fetch()(r,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new Bt;return n&&(gt("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(gt("string"==typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(gt("number"==typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Bt,this.toJSON())}_performRefresh(){return mt("not implemented")}}function zt(e,t){gt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Kt{constructor(e){var{uid:n,auth:i,stsTokenManager:s}=e,r=t(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ut(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Vt(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Ft(this,this.stsTokenManager.getToken(this.auth,e));return gt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=W(e),i=await n.getIdToken(t),s=Mt(i);gt(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:Rt(Ot(s.auth_time)),issuedAtTime:Rt(Ot(s.iat)),expirationTime:Rt(Ot(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=W(e);await qt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(gt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Kt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){gt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await qt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ke(this.auth.app))return Promise.reject(ft(this.auth));const e=await this.getIdToken();return await Ft(this,async function(e,t){return St(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(r=t.photoURL)&&void 0!==r?r:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:_,emailVerified:v,isAnonymous:w,providerData:I,stsTokenManager:b}=t;gt(_&&b,e,"internal-error");const T=Bt.fromJSON(this.name,b);gt("string"==typeof _,e,"internal-error"),zt(h,e.name),zt(u,e.name),gt("boolean"==typeof v,e,"internal-error"),gt("boolean"==typeof w,e,"internal-error"),zt(d,e.name),zt(f,e.name),zt(p,e.name),zt(g,e.name),zt(m,e.name),zt(y,e.name);const C=new Kt({uid:_,auth:e,email:u,emailVerified:v,displayName:h,isAnonymous:w,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:y});return I&&Array.isArray(I)&&(C.providerData=I.map((e=>Object.assign({},e)))),g&&(C._redirectEventId=g),C}static async _fromIdTokenResponse(e,t,n=!1){const i=new Bt;i.updateFromServerResponse(t);const s=new Kt({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await qt(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];gt(void 0!==i.localId,"internal-error");const s=void 0!==i.providerUserInfo?jt(i.providerUserInfo):[],r=!(i.email&&i.passwordHash||(null==s?void 0:s.length)),o=new Bt;o.updateFromIdToken(n);const a=new Kt({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:r}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Vt(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||(null==s?void 0:s.length))};return Object.assign(a,c),a}}const $t=new Map;function Gt(e){yt(e instanceof Function,"Expected a class definition");let t=$t.get(e);return t?(yt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,$t.set(e,t),t)}class Ht{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ht.type="NONE";const Wt=Ht;function Qt(e,t,n){return`firebase:${e}:${t}:${n}`}class Yt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=Qt(this.userKey,i.apiKey,s),this.fullPersistenceKey=Qt("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Kt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Yt(Gt(Wt),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=i[0]||Gt(Wt);const r=Qt(n,e.config.apiKey,e.name);let o=null;for(const l of t)try{const t=await l._get(r);if(t){const n=Kt._fromJSON(e,t);l!==s&&(o=n),s=l;break}}catch(c){}const a=i.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(r)}catch(c){}}))),new Yt(s,e,n)):new Yt(s,e,n)}}function Jt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(tn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Xt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(sn(t))return"Blackberry";if(rn(t))return"Webos";if(Zt(t))return"Safari";if((t.includes("chrome/")||en(t))&&!t.includes("edge/"))return"Chrome";if(nn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Xt(e=b()){return/firefox\//i.test(e)}function Zt(e=b()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function en(e=b()){return/crios\//i.test(e)}function tn(e=b()){return/iemobile/i.test(e)}function nn(e=b()){return/android/i.test(e)}function sn(e=b()){return/blackberry/i.test(e)}function rn(e=b()){return/webos/i.test(e)}function on(e=b()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function an(e=b()){return on(e)||nn(e)||rn(e)||sn(e)||/windows phone/i.test(e)||tn(e)}function cn(e,t=[]){let n;switch(e){case"Browser":n=Jt(b());break;case"Worker":n=`${Jt(b())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${He}/${i}`}class ln{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(s){i(s)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(i){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==n?void 0:n.message})}}}class hn{constructor(e){var t,n,i,s;const r=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=r.minPasswordLength)&&void 0!==t?t:6,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),void 0!==r.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),void 0!==r.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),void 0!==r.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),void 0!==r.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,s,r,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(i=a.containsLowercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(r=a.containsNumericCharacter)||void 0===r||r),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class un{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fn(this),this.idTokenSubscription=new fn(this),this.beforeStateQueue=new ln(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=at,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Gt(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Yt.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Pt(this,{idToken:e}),n=await Kt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ke(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(r){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(r)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return gt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qt(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ke(this.app))return Promise.reject(ft(this));const t=e?W(e):null;return t&&gt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&gt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return Ke(this.app)?Promise.reject(ft(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ke(this.app)?Promise.reject(ft(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Gt(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return St(e,"GET","/v2/passwordPolicy",Et(e,t))}(this),t=new hn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new A("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return St(e,"POST","/v2/accounts:revokeToken",Et(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Gt(e)||this._popupRedirectResolver;gt(t,this,"argument-error"),this.redirectPersistenceManager=await Yt.create(this,[Gt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let r=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(gt(o,this,"internal-error"),o.then((()=>{r||s(this.currentUser)})),"function"==typeof t){const s=e.addObserver(t,n,i);return()=>{r=!0,s()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return gt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=cn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){ct.logLevel<=Z.WARN&&ct.warn(`Auth (${He}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function dn(e){return W(e)}class fn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new z(e,void 0);return t.subscribe.bind(t)}((e=>this.observer=e))}get next(){return gt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let pn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function mn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class yn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return mt("not implemented")}_getIdTokenResponse(e){return mt("not implemented")}_linkToIdToken(e,t){return mt("not implemented")}_getReauthenticationResolver(e){return mt("not implemented")}}async function _n(e,t){return Nt(e,"POST","/v1/accounts:signInWithIdp",Et(e,t))}class vn extends yn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new vn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ht("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n="string"==typeof e?JSON.parse(e):e,{providerId:i,signInMethod:s}=n,r=t(n,["providerId","signInMethod"]);if(!i||!s)return null;const o=new vn(i,s);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){return _n(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,_n(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_n(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=j(t)}return e}}class wn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class In extends wn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class bn extends In{constructor(){super("facebook.com")}static credential(e){return vn._fromParams({providerId:bn.PROVIDER_ID,signInMethod:bn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bn.credentialFromTaggedObject(e)}static credentialFromError(e){return bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return bn.credential(e.oauthAccessToken)}catch(t){return null}}}bn.FACEBOOK_SIGN_IN_METHOD="facebook.com",bn.PROVIDER_ID="facebook.com";class Tn extends In{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return vn._fromParams({providerId:Tn.PROVIDER_ID,signInMethod:Tn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Tn.credentialFromTaggedObject(e)}static credentialFromError(e){return Tn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Tn.credential(t,n)}catch(i){return null}}}Tn.GOOGLE_SIGN_IN_METHOD="google.com",Tn.PROVIDER_ID="google.com";class Cn extends In{constructor(){super("github.com")}static credential(e){return vn._fromParams({providerId:Cn.PROVIDER_ID,signInMethod:Cn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cn.credentialFromTaggedObject(e)}static credentialFromError(e){return Cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Cn.credential(e.oauthAccessToken)}catch(t){return null}}}Cn.GITHUB_SIGN_IN_METHOD="github.com",Cn.PROVIDER_ID="github.com";class En extends In{constructor(){super("twitter.com")}static credential(e,t){return vn._fromParams({providerId:En.PROVIDER_ID,signInMethod:En.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return En.credentialFromTaggedObject(e)}static credentialFromError(e){return En.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return En.credential(t,n)}catch(i){return null}}}En.TWITTER_SIGN_IN_METHOD="twitter.com",En.PROVIDER_ID="twitter.com";class Sn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await Kt._fromIdTokenResponse(e,n,i),r=kn(n);return new Sn({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=kn(n);return new Sn({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function kn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Nn extends x{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Nn.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Nn(e,t,n,i)}}function xn(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Nn._fromErrorAndOperation(e,n,t,i);throw n}))}const An="__sak";class Dn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(An,"1"),this.storage.removeItem(An),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Pn extends Dn{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=an(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);!function(){const e=b();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Pn.type="LOCAL";const Rn=Pn;class On extends Dn{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}On.type="SESSION";const Mn=On;class Ln{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Ln(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Fn(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}Ln.receivers=[];class Un{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const c=Fn("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(l),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function Vn(){return window}function qn(){return void 0!==Vn().WorkerGlobalScope&&"function"==typeof Vn().importScripts}const jn="firebaseLocalStorageDb",Bn="firebaseLocalStorage",zn="fbase_key";class Kn{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function $n(e,t){return e.transaction([Bn],t?"readwrite":"readonly").objectStore(Bn)}function Gn(){const e=indexedDB.open(jn,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Bn,{keyPath:zn})}catch(i){n(i)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Bn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(jn);return new Kn(e).toPromise()}(),t(await Gn()))}))}))}async function Hn(e,t,n){const i=$n(e,!0).put({[zn]:t,value:n});return new Kn(i).toPromise()}function Wn(e,t){const n=$n(e,!0).delete(t);return new Kn(n).toPromise()}class Qn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Gn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ln._getInstance(qn()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Un(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Gn();return await Hn(e,An,"1"),await Wn(e,An),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Hn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=$n(e,!1).get(t),i=await new Kn(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Wn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=$n(e,!1).getAll();return new Kn(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Qn.type="LOCAL";const Yn=Qn;new wt(3e4,6e4);class Jn extends yn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _n(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _n(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _n(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Xn(e){return async function(e,t,n=!1){if(Ke(e.app))return Promise.reject(ft(e));const i="signIn",s=await xn(e,i,t),r=await Sn._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}(e.auth,new Jn(e),e.bypassAuthState)}function Zn(e){const{auth:t,user:n}=e;return gt(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e;if(Ke(i.app))return Promise.reject(ft(i));const s="reauthenticate";try{const r=await Ft(e,xn(i,s,t,e),n);gt(r.idToken,i,"internal-error");const o=Mt(r.idToken);gt(o,i,"internal-error");const{sub:a}=o;return gt(e.uid===a,i,"user-mismatch"),Sn._forOperation(e,s,r)}catch(r){throw"auth/user-not-found"===(null==r?void 0:r.code)&&ht(i,"user-mismatch"),r}}(n,new Jn(e),e.bypassAuthState)}async function ei(e){const{auth:t,user:n}=e;return gt(n,t,"internal-error"),async function(e,t,n=!1){const i=await Ft(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Sn._forOperation(e,"link",i)}(n,new Jn(e),e.bypassAuthState)}class ti{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Xn;case"linkViaPopup":case"linkViaRedirect":return ei;case"reauthViaPopup":case"reauthViaRedirect":return Zn;default:ht(this.auth,"internal-error")}}resolve(e){yt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){yt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ni=new wt(2e3,1e4);class ii extends ti{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,ii.currentPopupAction&&ii.currentPopupAction.cancel(),ii.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return gt(e,this.auth,"internal-error"),e}async onExecution(){yt(1===this.filter.length,"Popup operations only handle one event");const e=Fn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(ut(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ut(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ii.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(ut(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,ni.get())};e()}}ii.currentPopupAction=null;const si=new Map;class ri extends ti{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=si.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Qt("pendingRedirect",e.config.apiKey,e.name)}(t),i=function(e){return Gt(e._redirectPersistence)}(e);if(!(await i._isAvailable()))return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}si.set(this.auth._key(),e)}return this.bypassAuthState||si.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function oi(e,t){si.set(e._key(),t)}async function ai(e,t,n=!1){if(Ke(e.app))return Promise.reject(ft(e));const i=dn(e),s=function(e,t){return t?Gt(t):(gt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(i,t),r=new ri(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class ci{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hi(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!hi(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(ut(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(li(e))}saveEventToCache(e){this.cachedEventUids.add(li(e)),this.lastProcessedEventTime=Date.now()}}function li(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function hi({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const ui=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,di=/^https?/;function fi(e){const t=_t(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!di.test(n))return!1;if(ui.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const pi=new wt(3e4,6e4);function gi(){const e=Vn().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let mi=null;const yi=new wt(5e3,15e3),_i={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function wi(e){const t=e.config;gt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?It(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:He},s=vi.get(e.config.apiHost);s&&(i.eid=s);const r=e._getFrameworks();return r.length&&(i.fw=r.join(",")),`${n}?${j(i).slice(1)}`}async function Ii(e){const t=await function(e){return mi=mi||function(e){return new Promise(((t,n)=>{var i,s,r,o;function a(){gi(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{gi(),n(ut(e,"network-request-failed"))},timeout:pi.get()})}if(null===(s=null===(i=Vn().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=Vn().gapi)||void 0===r?void 0:r.load)){const t=`__iframefcb${Math.floor(1e6*Math.random())}`;return Vn()[t]=()=>{gapi.load?a():n(ut(e,"network-request-failed"))},(o=`${pn.gapiScript}?onload=${t}`,pn.loadJS(o)).catch((e=>n(e)))}a()}})).catch((e=>{throw mi=null,e}))}(e),mi}(e),n=Vn().gapi;return gt(n,e,"internal-error"),t.open({where:document.body,url:wi(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_i,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=ut(e,"network-request-failed"),r=Vn().setTimeout((()=>{i(s)}),yi.get());function o(){Vn().clearTimeout(r),n(t)}t.ping(o).then(o,(()=>{i(s)}))}))))}const bi={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ti{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Ci=encodeURIComponent("fac");async function Ei(e,t,n,i,s,r){gt(e.config.authDomain,e,"auth-domain-config-required"),gt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:He,eventId:s};if(t instanceof wn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",F(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof In){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const h of Object.keys(a))void 0===a[h]&&delete a[h];const c=await e._getAppCheckToken(),l=c?`#${Ci}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?It(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${j(a).slice(1)}${l}`}const Si="webStorageSupport",ki=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mn,this._completeRedirectFn=ai,this._overrideRedirectResult=oi}async _openPopup(e,t,n,i){var s;return yt(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,s=600){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},bi),{width:i.toString(),height:s.toString(),top:r,left:o}),l=b().toLowerCase();n&&(a=en(l)?"_blank":n),Xt(l)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=b()){var t;return on(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new Ti(null);const u=window.open(t||"",a,h);gt(u,e,"popup-blocked");try{u.focus()}catch(d){}return new Ti(u)}(e,await Ei(e,t,n,_t(),i),Fn())}async _openRedirect(e,t,n,i){return await this._originValidation(e),s=await Ei(e,t,n,_t(),i),Vn().location.href=s,new Promise((()=>{}));var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(yt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await Ii(e),n=new ci(e);return t.register("authEvent",(t=>(gt(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Si,{type:Si},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[Si];void 0!==s&&t(!!s),ht(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return St(e,"GET","/v1/projects",t)}(e);for(const i of t)try{if(fi(i))return}catch(n){}ht(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return an()||Zt()||on()}};var Ni="@firebase/auth",xi="1.7.9";class Ai{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){gt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Di=v("authIdTokenMaxAge")||300;let Pi=null;function Ri(e=Qe()){const t=ze(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ze(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(V(n.getOptions(),null!=t?t:{}))return e;ht(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:ki,persistence:[Yn,Rn,Mn]}),i=v("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Di)return;const i=null==t?void 0:t.token;Pi!==i&&(Pi=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){W(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e){W(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}var s;const r=m("auth");return r&&function(e,t){const n=dn(e);gt(n._canInitEmulator,n,"emulator-config-failed"),gt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=gn(t),{host:s,port:r}=function(e){const t=gn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:mn(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:mn(t)}}}(t),o=null===r?"":`:${r}`;n.config.emulator={url:`${i}//${s}${o}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:s,port:r,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info,"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}var Oi;pn={loadJS:e=>new Promise(((t,n)=>{const i=document.createElement("script");var s,r;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=ut("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(r=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==r?r:document).appendChild(i)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Oi="Browser",Be(new Q("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:r,authDomain:o}=n.options;gt(r&&!r.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:r,authDomain:o,clientPlatform:Oi,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cn(Oi)},c=new un(n,i,s,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Gt);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Be(new Q("auth-internal",(e=>{const t=dn(e.getProvider("auth").getImmediate());return new Ai(t)}),"PRIVATE").setInstantiationMode("EXPLICIT")),Ye(Ni,xi,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Oi)),Ye(Ni,xi,"esm2017");var Mi={};const Li="@firebase/database",Fi="1.0.8";let Ui="";function Vi(e){Ui=e}class qi{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),R(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:P(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ji{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return M(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Bi=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new qi(t)}}catch(t){}return new ji},zi=Bi("localStorage"),Ki=Bi("sessionStorage"),$i=new re("@firebase/database"),Gi=function(){let e=1;return function(){return e++}}(),Hi=function(e){const t=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=55296&&s<=56319){const t=s-55296;i++,r(i<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(i)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t}(e),n=new B;n.update(t);const i=n.digest();return c.encodeByteArray(i)},Wi=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=Wi.apply(null,i):t+="object"==typeof i?R(i):i,t+=" "}return t};let Qi=null,Yi=!0;const Ji=function(...e){if(!0===Yi&&(Yi=!1,null===Qi&&!0===Ki.get("logging_enabled")&&(r(!0,"Can't turn on custom loggers persistently."),$i.logLevel=Z.VERBOSE,Qi=$i.log.bind($i))),Qi){const t=Wi.apply(null,e);Qi(t)}},Xi=function(e){return function(...t){Ji(e,...t)}},Zi=function(...e){const t="FIREBASE INTERNAL ERROR: "+Wi(...e);$i.error(t)},es=function(...e){const t=`FIREBASE FATAL ERROR: ${Wi(...e)}`;throw $i.error(t),new Error(t)},ts=function(...e){const t="FIREBASE WARNING: "+Wi(...e);$i.warn(t)},ns=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},is="[MIN_NAME]",ss="[MAX_NAME]",rs=function(e,t){if(e===t)return 0;if(e===is||t===ss)return-1;if(t===is||e===ss)return 1;{const n=fs(e),i=fs(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},os=function(e,t){return e===t?0:e<t?-1:1},as=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+R(t))},cs=function(e){if("object"!=typeof e||null===e)return R(e);const t=[];for(const i in e)t.push(i);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=R(t[i]),n+=":",n+=cs(e[t[i]]);return n+="}",n},ls=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let s=0;s<n;s+=t)s+t>n?i.push(e.substring(s,n)):i.push(e.substring(s,s+t));return i};function hs(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const us=function(e){r(!ns(e),"Invalid JSON number");let t,n,i,s,o;0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=s+1023,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},ds=new RegExp("^-?(0*)\\d{1,10}$"),fs=function(e){if(ds.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},ps=function(e){try{e()}catch(t){setTimeout((()=>{const e=t.stack||"";throw ts("Exception was thrown by user callback.",e),t}),Math.floor(0))}},gs=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class ms{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){ts(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class ys{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(Ji("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ts(e)}}class _s{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}_s.OWNER="owner";const vs=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ws="ac",Is="websocket",bs="long_polling";class Ts{constructor(e,t,n,i,s=!1,r="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=zi.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&zi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Cs(e,t,n){let i;if(r("string"==typeof t,"typeof type must == string"),r("object"==typeof n,"typeof params must == object"),t===Is)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==bs)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const s=[];return hs(n,((e,t)=>{s.push(e+"="+t)})),i+s.join("&")}class Es{constructor(){this.counters_={}}incrementCounter(e,t=1){M(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return f(this.counters_)}}const Ss={},ks={};function Ns(e){const t=e.toString();return Ss[t]||(Ss[t]=new Es),Ss[t]}class xs{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&ps((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const As="start";class Ds{constructor(e,t,n,i,s,r,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Xi(e),this.stats_=Ns(t),this.urlFn=e=>(this.appCheckToken&&(e[ws]=this.appCheckToken),Cs(t,bs,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new xs(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ps(((...e)=>{const[t,n,i,s,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===As)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[As]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[ws]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&vs.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ds.forceAllow_=!0}static forceDisallow(){Ds.forceDisallow_=!0}static isAvailable(){return!!Ds.forceAllow_||!(Ds.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=h(t),i=ls(n,1840);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=R(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ps{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Gi(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ps.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(s){Ji("frame writing exception"),s.stack&&Ji(s.stack),Ji(s)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ji("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Ji("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}}),Math.floor(1))}}let Rs=null;"undefined"!=typeof MozWebSocket?Rs=MozWebSocket:"undefined"!=typeof WebSocket&&(Rs=WebSocket);class Os{constructor(e,t,n,i,s,r,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Xi(this.connId),this.stats_=Ns(t),this.connURL=Os.connectionURL_(t,r,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,s){const r={v:"5"};return"undefined"!=typeof location&&location.hostname&&vs.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),i&&(r[ws]=i),s&&(r.p=s),Cs(e,Is,r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,zi.set("previous_websocket_failure",!0);try{let e;this.mySock=new Rs(this.connURL,[],e)}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Os.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Rs&&!Os.forceDisallow_}static previouslyFailed(){return zi.isInMemoryStorage||!0===zi.get("previous_websocket_failure")}markConnectionHealthy(){zi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=P(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(r(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=ls(t,16384);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Os.responsesRequiredToBeHealthy=2,Os.healthyTimeout=3e4;class Ms{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ds,Os]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Os&&Os.isAvailable();let n=t&&!Os.previouslyFailed();if(e.webSocketOnly&&(t||ts("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Os];else{const e=this.transports_=[];for(const t of Ms.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Ms.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ms.globalTransportInitialized_=!1;class Ls{constructor(e,t,n,i,s,r,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Xi("c:"+this.id+":"),this.transportManager_=new Ms(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=gs((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=as("t",e),n=as("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=as("t",e),n=as("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=as("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Zi("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Zi("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&ts("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),gs((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gs((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(zi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Fs{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Us{constructor(e){this.allowedEvents_=e,this.listeners_={},r(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!n||n===i[s].context))return void i.splice(s,1)}validateEventType_(e){r(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class Vs extends Us{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||T()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Vs}getInitialEvent(e){return r("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class qs{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function js(){return new qs("")}function Bs(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function zs(e){return e.pieces_.length-e.pieceNum_}function Ks(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new qs(e.pieces_,t)}function $s(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Gs(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Hs(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new qs(t,0)}function Ws(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof qs)for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new qs(n,0)}function Qs(e){return e.pieceNum_>=e.pieces_.length}function Ys(e,t){const n=Bs(e),i=Bs(t);if(null===n)return t;if(n===i)return Ys(Ks(e),Ks(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Js(e,t){const n=Gs(e,0),i=Gs(t,0);for(let s=0;s<n.length&&s<i.length;s++){const e=rs(n[s],i[s]);if(0!==e)return e}return n.length===i.length?0:n.length<i.length?-1:1}function Xs(e,t){if(zs(e)!==zs(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Zs(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(zs(e)>zs(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class er{constructor(e,t){this.errorPrefix_=t,this.parts_=Gs(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=G(this.parts_[n]);tr(this)}}function tr(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+nr(e))}function nr(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class ir extends Us{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new ir}getInitialEvent(e){return r("visible"===e,"Unknown event type: "+e),[this.visible_]}}const sr=1e3;class rr extends Fs{constructor(e,t,n,i,s,r,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=rr.nextPersistentConnectionId_++,this.log_=Xi("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=sr,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ir.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Vs.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_(R(s)),r(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new w,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),r(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),r(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(s=>{const r=s.d,o=s.s;rr.warnOnListenWarnings_(r,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,r))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&M(e,"w")){const n=L(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();ts(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=O(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=O(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),r(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,s){this.initConnection_();const r={p:t,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:e,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+R(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Zi("Unrecognized action received from server: "+R(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){r(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=sr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=sr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=sr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+rr.nextConnectionId_++,o=this.lastSessionId;let a=!1,c=null;const l=function(){c?c.close():(a=!0,i())},h=function(e){r(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)};this.realtime_={close:l,sendRequest:h};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,r]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);a?Ji("getToken() completed but was canceled"):(Ji("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=r&&r.token,c=new Ls(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,i,(e=>{ts(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),o))}catch(e){this.log_("Failed to get token: "+e),a||(this.repoInfo_.nodeAdmin&&ts(e),l())}}}interrupt(e){Ji("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ji("Resuming connection for reason: "+e),delete this.interruptReasons_[e],F(this.interruptReasons_)&&(this.reconnectDelay_=sr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>cs(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new qs(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){Ji("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ji("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_&&this.securityDebugCallback_(e)}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Ui.replace(/\./g,"-")]=1,T()?e["framework.cordova"]=1:E()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Vs.getInstance().currentlyOnline();return F(this.interruptReasons_)&&e}}rr.nextPersistentConnectionId_=0,rr.nextConnectionId_=0;class or{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new or(e,t)}}class ar{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new or(is,e),i=new or(is,t);return 0!==this.compare(n,i)}minPost(){return or.MIN}}let cr;class lr extends ar{static get __EMPTY_NODE(){return cr}static set __EMPTY_NODE(e){cr=e}compare(e,t){return rs(e.name,t.name)}isDefinedOn(e){throw o("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return or.MIN}maxPost(){return new or(ss,cr)}makePost(e,t){return r("string"==typeof e,"KeyIndex indexValue must always be a string."),new or(e,cr)}toString(){return".key"}}const hr=new lr;let ur=class{constructor(e,t,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse_?e.left:e.right;else{if(0===r){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},dr=class e{constructor(t,n,i,s,r){this.key=t,this.value=n,this.color=null!=i?i:e.RED,this.left=null!=s?s:pr.EMPTY_NODE,this.right=null!=r?r:pr.EMPTY_NODE}copy(t,n,i,s,r){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=i?i:this.color,null!=s?s:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return pr.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return pr.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};dr.RED=!0,dr.BLACK=!1;let fr,pr=class e{constructor(t,n=e.EMPTY_NODE){this.comparator_=t,this.root_=n}insert(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,dr.BLACK,null,null))}remove(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,dr.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ur(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ur(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ur(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ur(this.root_,null,this.comparator_,!0,e)}};function gr(e,t){return rs(e.name,t.name)}function mr(e,t){return rs(e,t)}pr.EMPTY_NODE=new class{copy(e,t,n,i,s){return this}insert(e,t,n){return new dr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const yr=function(e){return"number"==typeof e?"number:"+us(e):"string:"+e},_r=function(e){if(e.isLeafNode()){const t=e.val();r("string"==typeof t||"number"==typeof t||"object"==typeof t&&M(t,".sv"),"Priority must be a string or number.")}else r(e===fr||e.isEmpty(),"priority of unexpected type.");r(e===fr||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let vr,wr,Ir;class br{constructor(e,t=br.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,r(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),_r(this.priorityNode_)}static set __childrenNodeConstructor(e){vr=e}static get __childrenNodeConstructor(){return vr}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new br(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:br.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Qs(e)?this:".priority"===Bs(e)?this.priorityNode_:br.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:br.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=Bs(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(r(".priority"!==n||1===zs(e),".priority must be the last token in a path"),this.updateImmediateChild(n,br.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ks(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+yr(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?us(this.value_):this.value_,this.lazyHash_=Hi(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===br.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof br.__childrenNodeConstructor?-1:(r(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=br.VALUE_TYPE_ORDER.indexOf(t),s=br.VALUE_TYPE_ORDER.indexOf(n);return r(i>=0,"Unknown leaf type: "+t),r(s>=0,"Unknown leaf type: "+n),i===s?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}br.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Tr=new class extends ar{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return 0===s?rs(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return or.MIN}maxPost(){return new or(ss,new br("[PRIORITY-POST]",Ir))}makePost(e,t){const n=wr(e);return new or(t,new br("[PRIORITY-POST]",n))}toString(){return".priority"}},Cr=Math.log(2);class Er{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Cr,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Sr=function(e,t,n,i){e.sort(t);const s=function(t,i){const r=i-t;let o,a;if(0===r)return null;if(1===r)return o=e[t],a=n?n(o):o,new dr(a,o.node,dr.BLACK,null,null);{const c=parseInt(r/2,10)+t,l=s(t,c),h=s(c+1,i);return o=e[c],a=n?n(o):o,new dr(a,o.node,dr.BLACK,l,h)}},r=function(t){let i=null,r=null,o=e.length;const a=function(t,i){const r=o-t,a=o;o-=t;const l=s(r+1,a),h=e[r],u=n?n(h):h;c(new dr(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(r=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,dr.BLACK):(a(i,dr.BLACK),a(i,dr.RED))}return r}(new Er(e.length));return new pr(i||t,r)};let kr;const Nr={};class xr{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return r(Nr&&Tr,"ChildrenNode.ts has not been loaded"),kr=kr||new xr({".priority":Nr},{".priority":Tr}),kr}get(e){const t=L(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof pr?t:null}hasIndex(e){return M(this.indexSet_,e.toString())}addIndex(e,t){r(e!==hr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const s=t.getIterator(or.Wrap);let o,a=s.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=s.getNext();o=i?Sr(n,e.getCompare()):Nr;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new xr(h,l)}addToIndexes(e,t){const n=U(this.indexes_,((n,i)=>{const s=L(this.indexSet_,i);if(r(s,"Missing index implementation for "+i),n===Nr){if(s.isDefinedOn(e.node)){const n=[],i=t.getIterator(or.Wrap);let r=i.getNext();for(;r;)r.name!==e.name&&n.push(r),r=i.getNext();return n.push(e),Sr(n,s.getCompare())}return Nr}{const i=t.get(e.name);let s=n;return i&&(s=s.remove(new or(e.name,i))),s.insert(e,e.node)}}));return new xr(n,this.indexSet_)}removeFromIndexes(e,t){const n=U(this.indexes_,(n=>{if(n===Nr)return n;{const i=t.get(e.name);return i?n.remove(new or(e.name,i)):n}}));return new xr(n,this.indexSet_)}}let Ar;class Dr{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&_r(this.priorityNode_),this.children_.isEmpty()&&r(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ar||(Ar=new Dr(new pr(mr),null,xr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ar}updatePriority(e){return this.children_.isEmpty()?this:new Dr(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Ar:t}}getChild(e){const t=Bs(e);return null===t?this:this.getImmediateChild(t).getChild(Ks(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(r(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new or(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(n,this.children_));const r=i.isEmpty()?Ar:this.priorityNode_;return new Dr(i,r,s)}}updateChild(e,t){const n=Bs(e);if(null===n)return t;{r(".priority"!==Bs(e)||1===zs(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(Ks(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,s=!0;if(this.forEachChild(Tr,((r,o)=>{t[r]=o.val(e),n++,s&&Dr.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1})),!e&&s&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+yr(this.getPriority().val())+":"),this.forEachChild(Tr,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":Hi(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new or(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new or(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new or(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,or.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,or.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Pr?-1:0}withIndex(e){if(e===hr||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Dr(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===hr||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Tr),n=t.getIterator(Tr);let i=e.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=e.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(e){return e===hr?null:this.indexMap_.get(e.toString())}}Dr.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Pr=new class extends Dr{constructor(){super(new pr(mr),Dr.EMPTY_NODE,xr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Dr.EMPTY_NODE}isEmpty(){return!1}};function Rr(e,t=null){if(null===e)return Dr.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),r(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new br(e,Rr(t));if(e instanceof Array){let n=Dr.EMPTY_NODE;return hs(e,((t,i)=>{if(M(e,t)&&"."!==t.substring(0,1)){const e=Rr(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(Rr(t))}{const n=[];let i=!1;if(hs(e,((e,t)=>{if("."!==e.substring(0,1)){const s=Rr(t);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),n.push(new or(e,s)))}})),0===n.length)return Dr.EMPTY_NODE;const s=Sr(n,gr,(e=>e.name),mr);if(i){const e=Sr(n,Tr.getCompare());return new Dr(s,Rr(t),new xr({".priority":e},{".priority":Tr}))}return new Dr(s,Rr(t),xr.Default)}}Object.defineProperties(or,{MIN:{value:new or(is,Dr.EMPTY_NODE)},MAX:{value:new or(ss,Pr)}}),lr.__EMPTY_NODE=Dr.EMPTY_NODE,br.__childrenNodeConstructor=Dr,fr=Pr,Ir=Pr,wr=Rr;class Or extends ar{constructor(e){super(),this.indexPath_=e,r(!Qs(e)&&".priority"!==Bs(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return 0===s?rs(e.name,t.name):s}makePost(e,t){const n=Rr(e),i=Dr.EMPTY_NODE.updateChild(this.indexPath_,n);return new or(t,i)}maxPost(){const e=Dr.EMPTY_NODE.updateChild(this.indexPath_,Pr);return new or(ss,e)}toString(){return Gs(this.indexPath_,0).join("/")}}const Mr=new class extends ar{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?rs(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return or.MIN}maxPost(){return or.MAX}makePost(e,t){const n=Rr(e);return new or(t,n)}toString(){return".value"}};function Lr(e){return{type:"value",snapshotNode:e}}function Fr(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ur(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Vr(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class qr{constructor(e){this.index_=e}updateChild(e,t,n,i,s,o){r(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Ur(t,a)):r(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Fr(t,n)):o.trackChildChange(Vr(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Tr,((e,i)=>{t.hasChild(e)||n.trackChildChange(Ur(e,i))})),t.isLeafNode()||t.forEachChild(Tr,((t,i)=>{if(e.hasChild(t)){const s=e.getImmediateChild(t);s.equals(i)||n.trackChildChange(Vr(t,i,s))}else n.trackChildChange(Fr(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Dr.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class jr{constructor(e){this.indexedFilter_=new qr(e.getIndex()),this.index_=e.getIndex(),this.startPost_=jr.getStartPost_(e),this.endPost_=jr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,s,r){return this.matches(new or(t,n))||(n=Dr.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,s,r)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Dr.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(Dr.EMPTY_NODE);const s=this;return t.forEachChild(Tr,((e,t)=>{s.matches(new or(e,t))||(i=i.updateImmediateChild(e,Dr.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Br{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new jr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,s,r){return this.rangedFilter_.matches(new or(t,n))||(n=Dr.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,s,r):this.fullLimitUpdateChild_(e,t,n,s,r)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=Dr.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=Dr.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(Dr.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,Dr.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,s){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;r(a.numChildren()===this.limit_,"");const c=new or(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let r=i.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=r&&(r.name===t||a.hasChild(r.name));)r=i.getChildAfterChild(this.index_,r,this.reverse_);const u=null==r?1:o(r,c);if(h&&!n.isEmpty()&&u>=0)return null!=s&&s.trackChildChange(Vr(t,n,e)),a.updateImmediateChild(t,n);{null!=s&&s.trackChildChange(Ur(t,e));const n=a.updateImmediateChild(t,Dr.EMPTY_NODE);return null!=r&&this.rangedFilter_.matches(r)?(null!=s&&s.trackChildChange(Fr(r.name,r.node)),n.updateImmediateChild(r.name,r.node)):n}}return n.isEmpty()?e:h&&o(l,c)>=0?(null!=s&&(s.trackChildChange(Ur(l.name,l.node)),s.trackChildChange(Fr(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,Dr.EMPTY_NODE)):e}}class zr{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Tr}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return r(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return r(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:is}hasEnd(){return this.endSet_}getIndexEndValue(){return r(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return r(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ss}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return r(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Tr}copy(){const e=new zr;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Kr(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Tr?n="$priority":e.index_===Mr?n="$value":e.index_===hr?n="$key":(r(e.index_ instanceof Or,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=R(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=R(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+R(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=R(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+R(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function $r(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Tr&&(t.i=e.index_.toString()),t}class Gr extends Fs{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=Xi("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(r(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const r=Gr.getListenId_(e,n),o={};this.listens_[r]=o;const a=Kr(e._queryParams);this.restRequest_(s+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(s,a,!1,n),L(this.listens_,r)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=Gr.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Kr(e._queryParams),n=e._path.toString(),i=new w;return this.restRequest_(n+".json",t,((e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+j(t);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=P(o.responseText)}catch(e){ts("Failed to parse JSON response for "+r+": "+o.responseText)}n(null,t)}else 401!==o.status&&404!==o.status&&ts("Got unsuccessful REST response for "+r+" Status: "+o.status),n(o.status);n=null}},o.open("GET",r,!0),o.send()}))}}class Hr{constructor(){this.rootNode_=Dr.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Wr(){return{value:null,children:new Map}}function Qr(e,t,n){if(Qs(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=Bs(t);e.children.has(i)||e.children.set(i,Wr()),Qr(e.children.get(i),t=Ks(t),n)}}function Yr(e,t){if(Qs(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(Tr,((t,n)=>{Qr(e,new qs(t),n)})),Yr(e,t)}}if(e.children.size>0){const n=Bs(t);return t=Ks(t),e.children.has(n)&&Yr(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}return!0}function Jr(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{Jr(i,new qs(t.toString()+"/"+e),n)}))}class Xr{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&hs(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Zr{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Xr(e);const n=1e4+2e4*Math.random();gs(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;hs(e,((e,i)=>{i>0&&M(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),gs(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var eo,to;function no(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(to=eo||(eo={}))[to.OVERWRITE=0]="OVERWRITE",to[to.MERGE=1]="MERGE",to[to.ACK_USER_WRITE=2]="ACK_USER_WRITE",to[to.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class io{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=eo.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Qs(this.path)){if(null!=this.affectedTree.value)return r(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new qs(e));return new io(js(),t,this.revert)}}return r(Bs(this.path)===e,"operationForChild called for unrelated child."),new io(Ks(this.path),this.affectedTree,this.revert)}}class so{constructor(e,t){this.source=e,this.path=t,this.type=eo.LISTEN_COMPLETE}operationForChild(e){return Qs(this.path)?new so(this.source,js()):new so(this.source,Ks(this.path))}}class ro{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=eo.OVERWRITE}operationForChild(e){return Qs(this.path)?new ro(this.source,js(),this.snap.getImmediateChild(e)):new ro(this.source,Ks(this.path),this.snap)}}class oo{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=eo.MERGE}operationForChild(e){if(Qs(this.path)){const t=this.children.subtree(new qs(e));return t.isEmpty()?null:t.value?new ro(this.source,js(),t.value):new oo(this.source,js(),t)}return r(Bs(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new oo(this.source,Ks(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ao{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Qs(e))return this.isFullyInitialized()&&!this.filtered_;const t=Bs(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class co{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function lo(e,t,n,i,s,r){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw o("Should only compare child_ events.");const i=new or(t.childName,t.snapshotNode),s=new or(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,r);s.forEach((s=>{s.respondsTo(n.type)&&t.push(s.createEvent(i,e.query_))}))}))}function ho(e,t){return{eventCache:e,serverCache:t}}function uo(e,t,n,i){return ho(new ao(t,n,i),e.serverCache)}function fo(e,t,n,i){return ho(e.eventCache,new ao(t,n,i))}function po(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function go(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let mo;class yo{constructor(e,t=(()=>(mo||(mo=new pr(os)),mo))()){this.value=e,this.children=t}static fromObject(e){let t=new yo(null);return hs(e,((e,n)=>{t=t.set(new qs(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:js(),value:this.value};if(Qs(e))return null;{const n=Bs(e),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(Ks(e),t);return null!=s?{path:Ws(new qs(n),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Qs(e))return this;{const t=Bs(e),n=this.children.get(t);return null!==n?n.subtree(Ks(e)):new yo(null)}}set(e,t){if(Qs(e))return new yo(t,this.children);{const n=Bs(e),i=(this.children.get(n)||new yo(null)).set(Ks(e),t),s=this.children.insert(n,i);return new yo(this.value,s)}}remove(e){if(Qs(e))return this.children.isEmpty()?new yo(null):new yo(null,this.children);{const t=Bs(e),n=this.children.get(t);if(n){const i=n.remove(Ks(e));let s;return s=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&s.isEmpty()?new yo(null):new yo(this.value,s)}return this}}get(e){if(Qs(e))return this.value;{const t=Bs(e),n=this.children.get(t);return n?n.get(Ks(e)):null}}setTree(e,t){if(Qs(e))return t;{const n=Bs(e),i=(this.children.get(n)||new yo(null)).setTree(Ks(e),t);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new yo(this.value,s)}}fold(e){return this.fold_(js(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,s)=>{n[i]=s.fold_(Ws(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,js(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(Qs(e))return null;{const i=Bs(e),s=this.children.get(i);return s?s.findOnPath_(Ks(e),Ws(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,js(),t)}foreachOnPath_(e,t,n){if(Qs(e))return this;{this.value&&n(t,this.value);const i=Bs(e),s=this.children.get(i);return s?s.foreachOnPath_(Ks(e),Ws(t,i),n):new yo(null)}}foreach(e){this.foreach_(js(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(Ws(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class _o{constructor(e){this.writeTree_=e}static empty(){return new _o(new yo(null))}}function vo(e,t,n){if(Qs(t))return new _o(new yo(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const s=i.path;let r=i.value;const o=Ys(s,t);return r=r.updateChild(o,n),new _o(e.writeTree_.set(s,r))}{const i=new yo(n),s=e.writeTree_.setTree(t,i);return new _o(s)}}}function wo(e,t,n){let i=e;return hs(n,((e,n)=>{i=vo(i,Ws(t,e),n)})),i}function Io(e,t){if(Qs(t))return _o.empty();{const n=e.writeTree_.setTree(t,new yo(null));return new _o(n)}}function bo(e,t){return null!=To(e,t)}function To(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ys(n.path,t)):null}function Co(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Tr,((e,n)=>{t.push(new or(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new or(e,n.value))})),t}function Eo(e,t){if(Qs(t))return e;{const n=To(e,t);return new _o(null!=n?new yo(n):e.writeTree_.subtree(t))}}function So(e){return e.writeTree_.isEmpty()}function ko(e,t){return No(js(),e.writeTree_,t)}function No(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal(((t,s)=>{".priority"===t?(r(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):n=No(Ws(e,t),s,n)})),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(Ws(e,".priority"),i)),n}}function xo(e,t){return qo(t,e)}function Ao(e,t){if(e.snap)return Zs(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Zs(Ws(e.path,n),t))return!0;return!1}function Do(e){return e.visible}function Po(e,t,n){let i=_o.empty();for(let s=0;s<e.length;++s){const r=e[s];if(t(r)){const e=r.path;let t;if(r.snap)Zs(n,e)?(t=Ys(n,e),i=vo(i,t,r.snap)):Zs(e,n)&&(t=Ys(e,n),i=vo(i,js(),r.snap.getChild(t)));else{if(!r.children)throw o("WriteRecord should have .snap or .children");if(Zs(n,e))t=Ys(n,e),i=wo(i,t,r.children);else if(Zs(e,n))if(t=Ys(e,n),Qs(t))i=wo(i,js(),r.children);else{const e=L(r.children,Bs(t));if(e){const n=e.getChild(Ks(t));i=vo(i,js(),n)}}}}}return i}function Ro(e,t,n,i,s){if(i||s){const r=Eo(e.visibleWrites,t);if(!s&&So(r))return n;if(s||null!=n||bo(r,js())){const r=function(e){return(e.visible||s)&&(!i||!~i.indexOf(e.writeId))&&(Zs(e.path,t)||Zs(t,e.path))};return ko(Po(e.allWrites,r,t),n||Dr.EMPTY_NODE)}return null}{const i=To(e.visibleWrites,t);if(null!=i)return i;{const i=Eo(e.visibleWrites,t);return So(i)?n:null!=n||bo(i,js())?ko(i,n||Dr.EMPTY_NODE):null}}}function Oo(e,t,n,i){return Ro(e.writeTree,e.treePath,t,n,i)}function Mo(e,t){return function(e,t,n){let i=Dr.EMPTY_NODE;const s=To(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(Tr,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const s=Eo(e.visibleWrites,t);return n.forEachChild(Tr,((e,t)=>{const n=ko(Eo(s,new qs(e)),t);i=i.updateImmediateChild(e,n)})),Co(s).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Co(Eo(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function Lo(e,t,n,i){return function(e,t,n,i,s){r(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=Ws(t,n);if(bo(e.visibleWrites,o))return null;{const t=Eo(e.visibleWrites,o);return So(t)?s.getChild(n):ko(t,s.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function Fo(e,t){return function(e,t){return To(e.visibleWrites,t)}(e.writeTree,Ws(e.treePath,t))}function Uo(e,t,n){return function(e,t,n,i){const s=Ws(t,n),r=To(e.visibleWrites,s);return null!=r?r:i.isCompleteForChild(n)?ko(Eo(e.visibleWrites,s),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Vo(e,t){return qo(Ws(e.treePath,t),e.writeTree)}function qo(e,t){return{treePath:e,writeTree:t}}class jo{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;r("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),r(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const s=i.type;if("child_added"===t&&"child_removed"===s)this.changeMap.set(n,Vr(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===s)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===s)this.changeMap.set(n,Ur(n,i.oldSnap));else if("child_changed"===t&&"child_added"===s)this.changeMap.set(n,Fr(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==s)throw o("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,Vr(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Bo=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class zo{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new ao(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Uo(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:go(this.viewCache_),s=function(e,t,n,i,s,r){return function(e,t,n,i,s,r,o){let a;const c=Eo(e.visibleWrites,t),l=To(c,js());if(null!=l)a=l;else{if(null==n)return[];a=ko(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<s;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,s,r)}(this.writes_,i,t,1,n,e);return 0===s.length?null:s[0]}}function Ko(e,t,n,i,s,o){const a=t.eventCache;if(null!=Fo(i,n))return t;{let c,l;if(Qs(n))if(r(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=go(t),s=Mo(i,n instanceof Dr?n:Dr.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),s,o)}else{const n=Oo(i,go(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const h=Bs(n);if(".priority"===h){r(1===zs(n),"Can't have a priority with additional path components");const s=a.getNode();l=t.serverCache.getNode();const o=Lo(i,n,s,l);c=null!=o?e.filter.updatePriority(s,o):a.getNode()}else{const r=Ks(n);let u;if(a.isCompleteForChild(h)){l=t.serverCache.getNode();const e=Lo(i,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(r,e):a.getNode().getImmediateChild(h)}else u=Uo(i,h,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,r,s,o):a.getNode()}}return uo(t,c,a.isFullyInitialized()||Qs(n),e.filter.filtersNodes())}}function $o(e,t,n,i,s,r,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(Qs(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=Bs(n);if(!c.isCompleteForPath(n)&&zs(n)>1)return t;const s=Ks(n),r=c.getNode().getImmediateChild(e).updateChild(s,i);l=".priority"===e?h.updatePriority(c.getNode(),r):h.updateChild(c.getNode(),e,r,s,Bo,null)}const u=fo(t,l,c.isFullyInitialized()||Qs(n),h.filtersNodes());return Ko(e,u,n,s,new zo(s,u,r),a)}function Go(e,t,n,i,s,r,o){const a=t.eventCache;let c,l;const h=new zo(s,t,r);if(Qs(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=uo(t,l,!0,e.filter.filtersNodes());else{const s=Bs(n);if(".priority"===s)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=uo(t,l,a.isFullyInitialized(),a.isFiltered());else{const r=Ks(n),l=a.getNode().getImmediateChild(s);let u;if(Qs(r))u=i;else{const e=h.getCompleteChild(s);u=null!=e?".priority"===$s(r)&&e.getChild(Hs(r)).isEmpty()?e:e.updateChild(r,i):Dr.EMPTY_NODE}c=l.equals(u)?t:uo(t,e.filter.updateChild(a.getNode(),s,u,r,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function Ho(e,t){return e.eventCache.isCompleteForChild(t)}function Wo(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Qo(e,t,n,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Qs(n)?i:new yo(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=Wo(0,t.serverCache.getNode().getImmediateChild(n),i);l=$o(e,l,new qs(n),c,s,r,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=Wo(0,t.serverCache.getNode().getImmediateChild(n),i);l=$o(e,l,new qs(n),c,s,r,o,a)}})),l}class Yo{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new qr(n.getIndex()),s=(r=n).loadsAllData()?new qr(r.getIndex()):r.hasLimit()?new Br(r):new jr(r);var r;this.processor_=function(e){return{filter:e}}(s);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(Dr.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(Dr.EMPTY_NODE,a.getNode(),null),h=new ao(c,o.isFullyInitialized(),i.filtersNodes()),u=new ao(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=ho(u,h),this.eventGenerator_=new co(this.query_)}get query(){return this.query_}}function Jo(e,t){const n=go(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Qs(t)&&!n.getImmediateChild(Bs(t)).isEmpty())?n.getChild(t):null}function Xo(e){return 0===e.eventRegistrations_.length}function Zo(e,t,n){const i=[];if(n){r(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,s);t&&i.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const s=e.eventRegistrations_[i];if(s.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(s)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function ea(e,t,n,i){t.type===eo.MERGE&&null!==t.source.queryId&&(r(go(e.viewCache_),"We should always have a full cache before handling merges"),r(po(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,a=function(e,t,n,i,s){const a=new jo;let c,l;if(n.type===eo.OVERWRITE){const o=n;o.source.fromUser?c=Go(e,t,o.path,o.snap,i,s,a):(r(o.source.fromServer,"Unknown source."),l=o.source.tagged||t.serverCache.isFiltered()&&!Qs(o.path),c=$o(e,t,o.path,o.snap,i,s,l,a))}else if(n.type===eo.MERGE){const o=n;o.source.fromUser?c=function(e,t,n,i,s,r,o){let a=t;return i.foreach(((i,c)=>{const l=Ws(n,i);Ho(t,Bs(l))&&(a=Go(e,a,l,c,s,r,o))})),i.foreach(((i,c)=>{const l=Ws(n,i);Ho(t,Bs(l))||(a=Go(e,a,l,c,s,r,o))})),a}(e,t,o.path,o.children,i,s,a):(r(o.source.fromServer,"Unknown source."),l=o.source.tagged||t.serverCache.isFiltered(),c=Qo(e,t,o.path,o.children,i,s,l,a))}else if(n.type===eo.ACK_USER_WRITE){const o=n;c=o.revert?function(e,t,n,i,s,o){let a;if(null!=Fo(i,n))return t;{const c=new zo(i,t,s),l=t.eventCache.getNode();let h;if(Qs(n)||".priority"===Bs(n)){let n;if(t.serverCache.isFullyInitialized())n=Oo(i,go(t));else{const e=t.serverCache.getNode();r(e instanceof Dr,"serverChildren would be complete if leaf node"),n=Mo(i,e)}h=e.filter.updateFullNode(l,n,o)}else{const s=Bs(n);let r=Uo(i,s,t.serverCache);null==r&&t.serverCache.isCompleteForChild(s)&&(r=l.getImmediateChild(s)),h=null!=r?e.filter.updateChild(l,s,r,Ks(n),c,o):t.eventCache.getNode().hasChild(s)?e.filter.updateChild(l,s,Dr.EMPTY_NODE,Ks(n),c,o):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=Oo(i,go(t)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=Fo(i,js()),uo(t,h,a,e.filter.filtersNodes())}}(e,t,o.path,i,s,a):function(e,t,n,i,s,r,o){if(null!=Fo(s,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(Qs(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return $o(e,t,n,c.getNode().getChild(n),s,r,a,o);if(Qs(n)){let i=new yo(null);return c.getNode().forEachChild(hr,((e,t)=>{i=i.set(new qs(e),t)})),Qo(e,t,n,i,s,r,a,o)}return t}{let l=new yo(null);return i.foreach(((e,t)=>{const i=Ws(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),Qo(e,t,n,l,s,r,a,o)}}(e,t,o.path,o.affectedTree,i,s,a)}else{if(n.type!==eo.LISTEN_COMPLETE)throw o("Unknown operation type: "+n.type);c=function(e,t,n,i,s){const r=t.serverCache;return Ko(e,fo(t,r.getNode(),r.isFullyInitialized()||Qs(n),r.isFiltered()),n,i,Bo,s)}(e,t,n.path,i,a)}const h=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=po(e);(n.length>0||!e.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Lr(po(t)))}}(t,c,h),{viewCache:c,changes:h}}(e.processor_,s,t,n,i);var c,l;return c=e.processor_,l=a.viewCache,r(l.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),r(l.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),r(a.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,ta(e,a.changes,a.viewCache.eventCache.getNode(),null)}function ta(e,t,n,i){const s=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const s=[],r=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&r.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),lo(e,s,"child_removed",t,i,n),lo(e,s,"child_added",t,i,n),lo(e,s,"child_moved",r,i,n),lo(e,s,"child_changed",t,i,n),lo(e,s,"value",t,i,n),s}(e.eventGenerator_,t,n,s)}let na,ia;class sa{constructor(){this.views=new Map}}function ra(e,t,n,i){const s=t.source.queryId;if(null!==s){const o=e.views.get(s);return r(null!=o,"SyncTree gave us an op for an invalid query."),ea(o,t,n,i)}{let s=[];for(const r of e.views.values())s=s.concat(ea(r,t,n,i));return s}}function oa(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function aa(e,t){let n=null;for(const i of e.views.values())n=n||Jo(i,t);return n}function ca(e,t){if(t._queryParams.loadsAllData())return ua(e);{const n=t._queryIdentifier;return e.views.get(n)}}function la(e,t){return null!=ca(e,t)}function ha(e){return null!=ua(e)}function ua(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let da=1;class fa{constructor(e){this.listenProvider_=e,this.syncPointTree_=new yo(null),this.pendingWriteTree_={visibleWrites:_o.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function pa(e,t,n,i,s){return function(e,t,n,i,s){r(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:s}),s&&(e.visibleWrites=vo(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,s),s?wa(e,new ro({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function ga(e,t,n=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));r(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&Ao(t,i.path)?s=!1:Zs(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?(function(e){e.visibleWrites=Po(e.allWrites,Do,js()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(i.snap?e.visibleWrites=Io(e.visibleWrites,i.path):hs(i.children,(t=>{e.visibleWrites=Io(e.visibleWrites,Ws(i.path,t))})),!0))}(e.pendingWriteTree_,t)){let t=new yo(null);return null!=i.snap?t=t.set(js(),!0):hs(i.children,(e=>{t=t.set(new qs(e),!0)})),wa(e,new io(i.path,t,n))}return[]}function ma(e,t,n){return wa(e,new ro({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function ya(e,t,n,i,s=!1){const o=t._path,a=e.syncPointTree_.get(o);let c=[];if(a&&("default"===t._queryIdentifier||la(a,t))){const l=function(e,t,n,i){const s=t._queryIdentifier,o=[];let a=[];const c=ha(e);if("default"===s)for(const[r,l]of e.views.entries())a=a.concat(Zo(l,n,i)),Xo(l)&&(e.views.delete(r),l.query._queryParams.loadsAllData()||o.push(l.query));else{const t=e.views.get(s);t&&(a=a.concat(Zo(t,n,i)),Xo(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!ha(e)&&o.push(new(r(na,"Reference.ts has not been loaded"),na)(t._repo,t._path)),{removed:o,events:a}}(a,t,n,i);0===a.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));const h=l.removed;if(c=l.events,!s){const n=-1!==h.findIndex((e=>e._queryParams.loadsAllData())),s=e.syncPointTree_.findOnPath(o,((e,t)=>ha(t)));if(n&&!s){const t=e.syncPointTree_.subtree(o);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&ha(t))return[ua(t)];{let e=[];return t&&(e=oa(t)),hs(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],s=i.query,r=Ta(e,i);e.listenProvider_.startListening(xa(s),Ca(e,s),r.hashFn,r.onComplete)}}}if(!s&&h.length>0&&!i)if(n){const n=null;e.listenProvider_.stopListening(xa(t),n)}else h.forEach((t=>{const n=e.queryToTagMap.get(Ea(t));e.listenProvider_.stopListening(xa(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=Ea(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,h)}return c}function _a(e,t,n,i=!1){const s=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(s,((e,t)=>{const n=Ys(e,s);o=o||aa(t,n),a=a||ha(t)}));let c,l=e.syncPointTree_.get(s);l?(a=a||ha(l),o=o||aa(l,js())):(l=new sa,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o?c=!0:(c=!1,o=Dr.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild(((e,t)=>{const n=aa(t,js());n&&(o=o.updateImmediateChild(e,n))})));const h=la(l,t);if(!h&&!t._queryParams.loadsAllData()){const n=Ea(t);r(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=da++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let u=function(e,t,n,i,s,r){const o=function(e,t,n,i,s){const r=t._queryIdentifier,o=e.views.get(r);if(!o){let e=Oo(n,s?i:null),r=!1;e?r=!0:i instanceof Dr?(e=Mo(n,i),r=!1):(e=Dr.EMPTY_NODE,r=!1);const o=ho(new ao(e,r,!1),new ao(i,s,!1));return new Yo(t,o)}return o}(e,t,i,s,r);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Tr,((e,t)=>{i.push(Fr(e,t))})),n.isFullyInitialized()&&i.push(Lr(n.getNode())),ta(e,i,n.getNode(),t)}(o,n)}(l,t,n,xo(e.pendingWriteTree_,s),o,c);if(!h&&!a&&!i){const n=ca(l,t);u=u.concat(function(e,t,n){const i=t._path,s=Ca(e,t),o=Ta(e,n),a=e.listenProvider_.startListening(xa(t),s,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(i);if(s)r(!ha(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!Qs(e)&&t&&ha(t))return[ua(t).query];{let e=[];return t&&(e=e.concat(oa(t).map((e=>e.query)))),hs(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(xa(i),Ca(e,i))}}return a}(e,t,n))}return u}function va(e,t,n){const i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=aa(n,Ys(e,t));if(i)return i}));return Ro(i,t,s,n,!0)}function wa(e,t){return Ia(t,e.syncPointTree_,null,xo(e.pendingWriteTree_,js()))}function Ia(e,t,n,i){if(Qs(e.path))return ba(e,t,n,i);{const s=t.get(js());null==n&&null!=s&&(n=aa(s,js()));let r=[];const o=Bs(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Vo(i,o);r=r.concat(Ia(a,c,e,t))}return s&&(r=r.concat(ra(s,e,i,n))),r}}function ba(e,t,n,i){const s=t.get(js());null==n&&null!=s&&(n=aa(s,js()));let r=[];return t.children.inorderTraversal(((t,s)=>{const o=n?n.getImmediateChild(t):null,a=Vo(i,t),c=e.operationForChild(t);c&&(r=r.concat(ba(c,s,o,a)))})),s&&(r=r.concat(ra(s,e,i,n))),r}function Ta(e,t){const n=t.query,i=Ca(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Dr.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=Sa(e,n);if(i){const n=ka(i),s=n.path,r=n.queryId,o=Ys(s,t);return Na(e,s,new so(no(r),o))}return[]}(e,n._path,i):function(e,t){return wa(e,new so({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return ya(e,n,null,i)}}}}function Ca(e,t){const n=Ea(t);return e.queryToTagMap.get(n)}function Ea(e){return e._path.toString()+"$"+e._queryIdentifier}function Sa(e,t){return e.tagToQueryMap.get(t)}function ka(e){const t=e.indexOf("$");return r(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new qs(e.substr(0,t))}}function Na(e,t,n){const i=e.syncPointTree_.get(t);return r(i,"Missing sync point for query tag that we're tracking"),ra(i,n,xo(e.pendingWriteTree_,t),null)}function xa(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(r(ia,"Reference.ts has not been loaded"),ia)(e._repo,e._path):e}class Aa{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Aa(t)}node(){return this.node_}}class Da{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Ws(this.path_,e);return new Da(this.syncTree_,t)}node(){return va(this.syncTree_,this.path_)}}const Pa=function(e,t,n){return e&&"object"==typeof e?(r(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Ra(e[".sv"],t,n):"object"==typeof e[".sv"]?Oa(e[".sv"],t):void r(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Ra=function(e,t,n){if("timestamp"===e)return n.timestamp;r(!1,"Unexpected server value: "+e)},Oa=function(e,t,n){e.hasOwnProperty("increment")||r(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!=typeof i&&r(!1,"Unexpected increment value: "+i);const s=t.node();if(r(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},Ma=function(e,t,n){return La(e,new Aa(t),n)};function La(e,t,n){const i=e.getPriority().val(),s=Pa(i,t.getImmediateChild(".priority"),n);let r;if(e.isLeafNode()){const i=e,r=Pa(i.getValue(),t,n);return r!==i.getValue()||s!==i.getPriority().val()?new br(r,Rr(s)):e}{const i=e;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new br(s))),i.forEachChild(Tr,((e,i)=>{const s=La(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))})),r}}class Fa{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Ua(e,t){let n=t instanceof qs?t:new qs(t),i=e,s=Bs(n);for(;null!==s;){const e=L(i.node.children,s)||{children:{},childCount:0};i=new Fa(s,i,e),n=Ks(n),s=Bs(n)}return i}function Va(e){return e.node.value}function qa(e,t){e.node.value=t,$a(e)}function ja(e){return e.node.childCount>0}function Ba(e,t){hs(e.node.children,((n,i)=>{t(new Fa(n,e,i))}))}function za(e,t,n,i){n&&!i&&t(e),Ba(e,(e=>{za(e,t,!0,i)})),n&&i&&t(e)}function Ka(e){return new qs(null===e.parent?e.name:Ka(e.parent)+"/"+e.name)}function $a(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===Va(e)&&!ja(e)}(n),s=M(e.node.children,t);i&&s?(delete e.node.children[t],e.node.childCount--,$a(e)):i||s||(e.node.children[t]=n.node,e.node.childCount++,$a(e))}(e.parent,e.name,e)}const Ga=/[\[\].#$\/\u0000-\u001F\u007F]/,Ha=/[\[\].#$\u0000-\u001F\u007F]/,Wa=10485760,Qa=function(e){return"string"==typeof e&&0!==e.length&&!Ga.test(e)},Ya=function(e){return"string"==typeof e&&0!==e.length&&!Ha.test(e)},Ja=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!ns(e)||e&&"object"==typeof e&&M(e,".sv")},Xa=function(e,t,n,i){Za($(e,"value"),t,n)},Za=function(e,t,n){const i=n instanceof qs?new er(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+nr(i));if("function"==typeof t)throw new Error(e+"contains a function "+nr(i)+" with contents = "+t.toString());if(ns(t))throw new Error(e+"contains "+t.toString()+" "+nr(i));if("string"==typeof t&&t.length>Wa/3&&G(t)>Wa)throw new Error(e+"contains a string greater than "+Wa+" utf8 bytes "+nr(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,s=!1;if(hs(t,((t,r)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!Qa(t)))throw new Error(e+" contains an invalid key ("+t+") "+nr(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,a;a=t,(o=i).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(a),o.byteLength_+=G(a),tr(o),Za(e,r,i),function(e){const t=e.parts_.pop();e.byteLength_-=G(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&s)throw new Error(e+' contains ".value" child '+nr(i)+" in addition to actual children.")}},ec=function(e,t,n,i){if(!Ya(n))throw new Error($(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},tc=function(e,t){if(".info"===Bs(t))throw new Error(e+" failed = Can't modify data under /.info/")};class nc{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ic(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i],r=s.getPath();null===n||Xs(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function sc(e,t,n){ic(e,n),oc(e,(e=>Xs(e,t)))}function rc(e,t,n){ic(e,n),oc(e,(e=>Zs(e,t)||Zs(t,e)))}function oc(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const s=e.eventLists_[i];s&&(t(s.path)?(ac(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function ac(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();Qi&&Ji("event: "+n.toString()),ps(i)}}}class cc{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new nc,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Wr(),this.transactionQueueTree_=new Fa,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function lc(e,t,n){if(e.stats_=Ns(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Gr(e.repoInfo_,((t,n,i,s)=>{dc(e,t,n,i,s)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>fc(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{R(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}e.persistentConnection_=new rr(e.repoInfo_,t,((t,n,i,s)=>{dc(e,t,n,i,s)}),(t=>{fc(e,t)}),(t=>{!function(e,t){hs(t,((t,n)=>{pc(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t){const n=t.toString();return ks[n]||(ks[n]=new Zr(e.stats_,e.server_)),ks[n]}(e.repoInfo_),e.infoData_=new Hr,e.infoSyncTree_=new fa({startListening:(t,n,i,s)=>{let r=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(r=ma(e.infoSyncTree_,t._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),pc(e,"connected",!1),e.serverSyncTree_=new fa({startListening:(t,n,i,s)=>(e.server_.listen(t,i,n,((n,i)=>{const r=s(n,i);rc(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function hc(e){const t=e.infoData_.getNode(new qs(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function uc(e){return(t=(t={timestamp:hc(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function dc(e,t,n,i,s){e.dataUpdateCount++;const r=new qs(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(s)if(i){const t=U(n,(e=>Rr(e)));o=function(e,t,n,i){const s=Sa(e,i);if(s){const i=ka(s),r=i.path,o=i.queryId,a=Ys(r,t),c=yo.fromObject(n);return Na(e,r,new oo(no(o),a,c))}return[]}(e.serverSyncTree_,r,t,s)}else{const t=Rr(n);o=function(e,t,n,i){const s=Sa(e,i);if(null!=s){const i=ka(s),r=i.path,o=i.queryId,a=Ys(r,t);return Na(e,r,new ro(no(o),a,n))}return[]}(e.serverSyncTree_,r,t,s)}else if(i){const t=U(n,(e=>Rr(e)));o=function(e,t,n){const i=yo.fromObject(n);return wa(e,new oo({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,r,t)}else{const t=Rr(n);o=ma(e.serverSyncTree_,r,t)}let a=r;o.length>0&&(a=Tc(e,r)),rc(e.eventQueue_,a,o)}function fc(e,t){pc(e,"connected",t),!1===t&&function(e){vc(e,"onDisconnectEvents");const t=uc(e),n=Wr();Jr(e.onDisconnect_,js(),((i,s)=>{const r=function(e,t,n,i){return La(t,new Da(n,e),i)}(i,s,e.serverSyncTree_,t);Qr(n,i,r)}));let i=[];Jr(n,js(),((t,n)=>{i=i.concat(ma(e.serverSyncTree_,t,n));const s=Nc(e,t);Tc(e,s)})),e.onDisconnect_=Wr(),rc(e.eventQueue_,js(),i)}(e)}function pc(e,t,n){const i=new qs("/.info/"+t),s=Rr(n);e.infoData_.updateSnapshot(i,s);const r=ma(e.infoSyncTree_,i,s);rc(e.eventQueue_,i,r)}function gc(e){return e.nextWriteId_++}function mc(e,t,n){e.server_.onDisconnectCancel(t.toString(),((i,s)=>{"ok"===i&&Yr(e.onDisconnect_,t),wc(0,n,i,s)}))}function yc(e,t,n,i){const s=Rr(n);e.server_.onDisconnectPut(t.toString(),s.val(!0),((n,r)=>{"ok"===n&&Qr(e.onDisconnect_,t,s),wc(0,i,n,r)}))}function _c(e,t,n){let i;i=".info"===Bs(t._path)?ya(e.infoSyncTree_,t,n):ya(e.serverSyncTree_,t,n),sc(e.eventQueue_,t._path,i)}function vc(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),Ji(n,...t)}function wc(e,t,n,i){t&&ps((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let s=e;i&&(s+=": "+i);const r=new Error(s);r.code=e,t(r)}}))}function Ic(e,t,n){return va(e.serverSyncTree_,t,n)||Dr.EMPTY_NODE}function bc(e,t=e.transactionQueueTree_){if(t||kc(e,t),Va(t)){const n=Ec(e,t);r(n.length>0,"Sending zero length transaction queue"),n.every((e=>0===e.status))&&function(e,t,n){const i=n.map((e=>e.currentWriteId)),s=Ic(e,t,i);let o=s;const a=s.hash();for(let h=0;h<n.length;h++){const e=n[h];r(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const i=Ys(t,e.path);o=o.updateChild(i,e.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(i=>{vc(e,"transaction put response",{path:l.toString(),status:i});let s=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,s=s.concat(ga(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();kc(e,Ua(e.transactionQueueTree_,t)),bc(e,e.transactionQueueTree_),rc(e.eventQueue_,t,s);for(let e=0;e<i.length;e++)ps(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{ts("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}Tc(e,t)}}),a)}(e,Ka(t),n)}else ja(t)&&Ba(t,(t=>{bc(e,t)}))}function Tc(e,t){const n=Cc(e,t),i=Ka(n);return function(e,t,n){if(0===t.length)return;const i=[];let s=[];const o=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let c=0;c<t.length;c++){const l=t[c],h=Ys(n,l.path);let u,d=!1;if(r(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,s=s.concat(ga(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)d=!0,u="maxretry",s=s.concat(ga(e.serverSyncTree_,l.currentWriteId,!0));else{const n=Ic(e,l.path,o);l.currentInputSnapshot=n;const i=t[c].update(n.val());if(void 0!==i){Za("transaction failed: Data returned ",i,l.path);let t=Rr(i);"object"==typeof i&&null!=i&&M(i,".priority")||(t=t.updatePriority(n.getPriority()));const r=l.currentWriteId,a=uc(e),c=Ma(t,n,a);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=c,l.currentWriteId=gc(e),o.splice(o.indexOf(r),1),s=s.concat(pa(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),s=s.concat(ga(e.serverSyncTree_,r,!0))}else d=!0,u="nodata",s=s.concat(ga(e.serverSyncTree_,l.currentWriteId,!0))}rc(e.eventQueue_,n,s),s=[],d&&(t[c].status=2,a=t[c].unwatcher,setTimeout(a,Math.floor(0)),t[c].onComplete&&("nodata"===u?i.push((()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot))):i.push((()=>t[c].onComplete(new Error(u),!1,null)))))}var a;kc(e,e.transactionQueueTree_);for(let r=0;r<i.length;r++)ps(i[r]);bc(e,e.transactionQueueTree_)}(e,Ec(e,n),i),i}function Cc(e,t){let n,i=e.transactionQueueTree_;for(n=Bs(t);null!==n&&void 0===Va(i);)i=Ua(i,n),n=Bs(t=Ks(t));return i}function Ec(e,t){const n=[];return Sc(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function Sc(e,t,n){const i=Va(t);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);Ba(t,(t=>{Sc(e,t,n)}))}function kc(e,t){const n=Va(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,qa(t,n.length>0?n:void 0)}Ba(t,(t=>{kc(e,t)}))}function Nc(e,t){const n=Ka(Cc(e,t)),i=Ua(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(i,(t=>{xc(e,t)})),xc(e,i),za(i,(t=>{xc(e,t)})),n}function xc(e,t){const n=Va(t);if(n){const i=[];let s=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(r(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(r(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),s=s.concat(ga(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?qa(t,void 0):n.length=o+1,rc(e.eventQueue_,Ka(t),s);for(let e=0;e<i.length;e++)ps(i[e])}}const Ac=function(e,t){const n=Dc(e),i=n.namespace;"firebase.com"===n.domain&&es(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||es("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ts("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Ts(n.host,n.secure,i,s,t,"",i!==n.subdomain),path:new qs(n.pathString)}},Dc=function(e){let t="",n="",i="",s="",r="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(s=function(e){let t="";const n=e.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let e=n[s];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(i){}t+="/"+e}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):ts(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const f=t.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),r=i}"ns"in d&&(r=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class Pc{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+R(this.snapshot.exportVal())}}class Rc{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Oc{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return r(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Mc{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new w;return mc(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){tc("OnDisconnect.remove",this._path);const e=new w;return yc(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){tc("OnDisconnect.set",this._path),Xa("OnDisconnect.set",e,this._path);const t=new w;return yc(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){tc("OnDisconnect.setWithPriority",this._path),Xa("OnDisconnect.setWithPriority",e,this._path),function(e,t){if(ns(t))throw new Error($(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ja(t))throw new Error($(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}("OnDisconnect.setWithPriority",t);const n=new w;return function(e,t,n,i,s){const r=Rr(n,i);e.server_.onDisconnectPut(t.toString(),r.val(!0),((n,i)=>{"ok"===n&&Qr(e.onDisconnect_,t,r),wc(0,s,n,i)}))}(this._repo,this._path,e,t,n.wrapCallback((()=>{}))),n.promise}update(e){tc("OnDisconnect.update",this._path),function(e,t,n){const i=$(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];hs(t,((e,t)=>{const r=new qs(e);if(Za(i,t,Ws(n,r)),".priority"===$s(r)&&!Ja(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)})),function(e,t){let n,i;for(n=0;n<t.length;n++){i=t[n];const s=Gs(i);for(let t=0;t<s.length;t++)if(".priority"===s[t]&&t===s.length-1);else if(!Qa(s[t]))throw new Error(e+"contains an invalid key ("+s[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Js);let s=null;for(n=0;n<t.length;n++){if(i=t[n],null!==s&&Zs(s,i))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}}(i,s)}("OnDisconnect.update",e,this._path);const t=new w;return function(e,t,n,i){if(F(n))return Ji("onDisconnect().update() called with empty data.  Don't do anything."),void wc(0,i,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,((s,r)=>{"ok"===s&&hs(n,((n,i)=>{const s=Rr(i);Qr(e.onDisconnect_,Ws(t,n),s)})),wc(0,i,s,r)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}class Lc{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return Qs(this._path)?null:$s(this._path)}get ref(){return new Fc(this._repo,this._path)}get _queryIdentifier(){const e=$r(this._queryParams),t=cs(e);return"{}"===t?"default":t}get _queryObject(){return $r(this._queryParams)}isEqual(e){if(!((e=W(e))instanceof Lc))return!1;const t=this._repo===e._repo,n=Xs(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Fc extends Lc{constructor(e,t){super(e,t,new zr,!1)}get parent(){const e=Hs(this._path);return null===e?null:new Fc(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Uc{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new qs(e),n=qc(this.ref,e);return new Uc(this._node.getChild(t),n,Tr)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((t,n)=>e(new Uc(n,qc(this.ref,t),Tr))))}hasChild(e){const t=new qs(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Vc(e,t){return(e=W(e))._checkNotDeleted("ref"),void 0!==t?qc(e._root,t):e._root}function qc(e,t){var n;return null===Bs((e=W(e))._path)?((n=t)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ec("child","path",n)):ec("child","path",t),new Fc(e._repo,Ws(e._path,t))}function jc(e){return e=W(e),new Mc(e._repo,e._path)}class Bc{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Pc("value",this,new Uc(e.snapshotNode,new Fc(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Rc(this,e,t):null}matches(e){return e instanceof Bc&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}var zc;zc=Fc,r(!na,"__referenceConstructor has already been defined"),na=zc,function(e){r(!ia,"__referenceConstructor has already been defined"),ia=e}(Fc);const Kc={};function $c(e,t,n,i,s){let r=i||e.options.databaseURL;void 0===r&&(e.options.projectId||es("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ji("Using default host for project ",e.options.projectId),r=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a=Ac(r,s),c=a.repoInfo;"undefined"!=typeof process&&Mi&&(o=Mi.FIREBASE_DATABASE_EMULATOR_HOST),o?(r=`http://${o}?ns=${c.namespace}`,a=Ac(r,s),c=a.repoInfo):a.repoInfo.secure;const l=new ys(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Qa(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ya(e)}(n))throw new Error($(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",a),Qs(a.path)||es("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,i){let s=Kc[t.name];s||(s={},Kc[t.name]=s);let r=s[e.toURLString()];return r&&es("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new cc(e,false,n,i),s[e.toURLString()]=r,r}(c,e,l,new ms(e.name,n));return new Gc(h,e)}class Gc{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(lc(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Fc(this._repo,js())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Kc[t];n&&n[e.key]===e||es(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&es("Cannot call "+e+" on a deleted database.")}}function Hc(e=Qe(),t){const n=ze(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=y("database");e&&Wc(n,...e)}return n}function Wc(e,t,n,i={}){(e=W(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&es("Cannot call useEmulator() after instance has already been initialized.");const s=e._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&es('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new _s(_s.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:I(i.mockUserToken,e.app.options.projectId);r=new _s(t)}!function(e,t,n,i){e.repoInfo_=new Ts(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(s,t,n,r)}const Qc={".sv":"timestamp"};function Yc(){return Qc}rr.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},rr.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Vi(He),Be(new Q("database",((e,{instanceIdentifier:t})=>$c(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Ye(Li,Fi,void 0),Ye(Li,Fi,"esm2017");const Jc=Object.freeze(Object.defineProperty({__proto__:null,DataSnapshot:Uc,Database:Gc,OnDisconnect:Mc,_QueryImpl:Lc,_QueryParams:zr,_ReferenceImpl:Fc,_repoManagerDatabaseFromApp:$c,_setSDKVersion:Vi,_validatePathString:ec,_validateWritablePath:tc,child:qc,connectDatabaseEmulator:Wc,getDatabase:Hc,onDisconnect:jc,onValue:function(e,t,n,i){return function(e,t,n,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const t=n,i=(n,i)=>{_c(e._repo,e,a),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new Oc(n,r||void 0),a=new Bc(o);return function(e,t,n){let i;i=".info"===Bs(t._path)?_a(e.infoSyncTree_,t,n):_a(e.serverSyncTree_,t,n),sc(e.eventQueue_,t._path,i)}(e._repo,e,a),()=>_c(e._repo,e,a)}(e,0,t,n,i)},ref:Vc,serverTimestamp:Yc,set:function(e,t){e=W(e),tc("set",e._path),Xa("set",t,e._path);const n=new w;return function(e,t,n,i,s){vc(e,"set",{path:t.toString(),value:n,priority:null});const r=uc(e),o=Rr(n,null),a=va(e.serverSyncTree_,t),c=Ma(o,a,r),l=gc(e),h=pa(e.serverSyncTree_,t,c,l,!0);ic(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,i)=>{const r="ok"===n;r||ts("set at "+t+" failed: "+n);const o=ga(e.serverSyncTree_,l,!r);rc(e.eventQueue_,t,o),wc(0,s,n,i)}));const u=Nc(e,t);Tc(e,u),rc(e.eventQueue_,u,[])}(e._repo,e._path,t,0,n.wrapCallback((()=>{}))),n.promise}},Symbol.toStringTag,{value:"Module"}));var Xc,Zc="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)i[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)i[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var r=e.g[3],o=t+(r^n&(s^r))+i[0]+3614090360&4294967295;o=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=n+(o<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^r&(n^s))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^s^r)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(n|~r))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~r))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~r))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(t=n+((o=t+(s^(n|~r))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=r+((o=s+(t^(r|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+r&4294967295}function i(e,t){this.h=t;for(var n=[],i=!0,s=e.length-1;0<=s;s--){var r=0|e[s];i&&r==t||(n[s]=r,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var i=t-this.blockSize,s=this.B,r=this.h,o=0;o<t;){if(0==r)for(;o<=i;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[r++]=e.charCodeAt(o++),r==this.blockSize){n(this,s),r=0;break}}else for(;o<t;)if(s[r++]=e[o++],r==this.blockSize){n(this,s),r=0;break}}this.h=r,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var s={};function r(e){return-128<=e&&128>e?function(e){var t=s;return{}.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new i([0|e],0>e?-1:0)}(e)}(e):new i([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,s=0;e>=n;s++)t[s]=e/n|0,n*=4294967296;return new i(t,0)}var a=r(0),c=r(1),l=r(16777216);function h(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],s=0;s<t;s++)n[s]=~e.g[s];return new i(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(h(t))throw Error("division by zero");if(h(e))return new g(a,a);if(u(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(u(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(30<e.g.length){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,i=t;0>=i.l(e);)n=y(n),i=y(i);var s=_(n,1),r=_(i,1);for(i=_(i,2),n=_(n,2);!h(i);){var l=r.add(i);0>=l.l(e)&&(s=s.add(n),r=l),i=_(i,1),n=_(n,1)}return t=f(e,s.j(t)),new g(s,t)}for(s=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),l=(r=o(n)).j(t);u(l)||0<l.l(e);)l=(r=o(n-=i)).j(t);h(r)&&(r=c),s=s.add(r),e=f(e,l)}return new g(s,e)}function y(e){for(var t=e.g.length+1,n=[],s=0;s<t;s++)n[s]=e.i(s)<<1|e.i(s-1)>>>31;return new i(n,e.h)}function _(e,t){var n=t>>5;t%=32;for(var s=e.g.length-n,r=[],o=0;o<s;o++)r[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new i(r,e.h)}(e=i.prototype).m=function(){if(u(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(h(this))return"0";if(u(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,i="";;){var s=m(n,t).g,r=((0<(n=f(n,s.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(h(n=s))return r+i;for(;6>r.length;)r="0"+r;i=r+i}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=f(this,e))?-1:h(e)?0:1},e.abs=function(){return u(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0,r=0;r<=t;r++){var o=s+(65535&this.i(r))+(65535&e.i(r)),a=(o>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);s=a>>>16,o&=65535,a&=65535,n[r]=a<<16|o}return new i(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(h(this)||h(e))return a;if(u(this))return u(e)?d(this).j(d(e)):d(d(this).j(e));if(u(e))return d(this.j(d(e)));if(0>this.l(l)&&0>e.l(l))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<e.g.length;r++){var c=this.i(s)>>>16,f=65535&this.i(s),g=e.i(r)>>>16,m=65535&e.i(r);n[2*s+2*r]+=f*m,p(n,2*s+2*r),n[2*s+2*r+1]+=c*m,p(n,2*s+2*r+1),n[2*s+2*r+1]+=f*g,p(n,2*s+2*r+1),n[2*s+2*r+2]+=c*g,p(n,2*s+2*r+2)}for(s=0;s<t;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=t;s<2*t;s++)n[s]=0;return new i(n,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)&e.i(s);return new i(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)|e.i(s);return new i(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)^e.i(s);return new i(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=o,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=o(Math.pow(n,8)),s=a,r=0;r<t.length;r+=8){var c=Math.min(8,t.length-r),l=parseInt(t.substring(r,r+c),n);8>c?(c=o(Math.pow(n,c)),s=s.j(c).add(o(l))):s=(s=s.j(i)).add(o(l))}return s},Xc=i}).apply(void 0!==Zc?Zc:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var el,tl,nl,il,sl,rl,ol,al,cl="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof cl&&cl];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,i){if(i)e:{var s=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var o=e[r];if(!(o in s))break e;s=s[o]}(i=i(r=s[e=e[e.length-1]]))!=r&&null!=i&&t(s,e,{configurable:!0,writable:!0,value:i})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,s={next:function(){if(!i&&n<e.length){var s=n++;return{value:t(0,e[s]),done:!1}}return i=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(e,t){return t}))}}));var i=i||{},s=this||self;function r(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=[].slice.call(arguments,2);return function(){var n=[].slice.call(arguments);return[].unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=function(){}.bind&&-1!=function(){}.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function h(e,t){var n=[].slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function f(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(r(t)){const n=e.length||0,i=t.length||0;e.length=n+i;for(let s=0;s<i;s++)e[n+s]=t[s]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function g(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function _(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function v(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(e,t){let n,i;for(let s=1;s<arguments.length;s++){for(n in i=arguments[s],i)e[n]=i[n];for(let t=0;t<w.length;t++)n=w[t],{}.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function b(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function T(e){s.setTimeout((()=>{throw e}),0)}function C(){var e=x;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var E=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new S),(e=>e.reset()));class S{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let k,N=!1,x=new class{constructor(){this.h=this.g=null}add(e,t){const n=E.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},A=()=>{const e=s.Promise.resolve(void 0);k=()=>{e.then(D)}};var D=()=>{for(var e;e=C();){try{e.h.call(e.g)}catch(n){T(n)}var t=E;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}N=!1};function P(){this.s=this.s,this.C=this.C}function R(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},R.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(n){}return e}();function M(e,t){if(R.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{m(t.nodeName);var s=!0;break e}catch(r){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:L[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&M.aa.h.call(this)}}u(M,R);var L={2:"touch",3:"pen",4:"mouse"};M.prototype.h=function(){M.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=s,this.key=++U,this.da=this.fa=!1}function q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function j(e){this.src=e,this.g={},this.h=0}function B(e,t){var n=t.type;if(n in e.g){var i,s=e.g[n],r=[].indexOf.call(s,t,void 0);(i=0<=r)&&[].splice.call(s,r,1),i&&(q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function z(e,t,n,i){for(var s=0;s<e.length;++s){var r=e[s];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==i)return s}return-1}j.prototype.add=function(e,t,n,i,s){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var o=z(e,t,i,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new V(t,this.src,r,!!i,s)).fa=n,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),$={};function G(e,t,n,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++)G(e,t[r],n,i,s);return null}return n=Z(n),e&&e[F]?e.K(t,n,!!o(i)&&!!i.capture,s):function(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=J(e);if(c||(e[K]=c=new j(e)),(n=c.add(t,n,i,a,r)).proxy)return n;if(i=function(){const e=Y;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)O||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(Q(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}(e,t,n,!1,i,s)}function H(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)H(e,t[r],n,i,s);else i=o(i)?!!i.capture:!!i,n=Z(n),e&&e[F]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=z(r=e.g[t],n,i,s))&&(q(r[n]),[].splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--))):e&&(e=J(e))&&(t=e.g[t.toString()],e=-1,t&&(e=z(t,n,i,s)),(n=-1<e?t[e]:null)&&W(n))}function W(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[F])B(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Q(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=J(t))?(B(n,e),0==n.h&&(n.src=null,t[K]=null)):q(e)}}}function Q(e){return e in $?$[e]:$[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new M(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&W(e),e=n.call(i,t)}return e}function J(e){return(e=e[K])instanceof j?e:null}var X="__closure_events_fn_"+(1e9*Math.random()>>>0);function Z(e){return"function"==typeof e?e:(e[X]||(e[X]=function(t){return e.handleEvent(t)}),e[X])}function ee(){P.call(this),this.i=new j(this),this.M=this,this.F=null}function te(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new R(t,e);else if(t instanceof R)t.target=t.target||e;else{var s=t;I(t=new R(i,e),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=t.g=n[r];s=ne(o,i,!0,t)&&s}if(s=ne(o=t.g=e,i,!0,t)&&s,s=ne(o,i,!1,t)&&s,n)for(r=0;r<n.length;r++)s=ne(o=t.g=n[r],i,!1,t)&&s}function ne(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&B(e.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}function ie(e,t,n){if("function"==typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function se(e){e.g=ie((()=>{e.g=null,e.i&&(e.i=!1,se(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(ee,P),ee.prototype[F]=!0,ee.prototype.removeEventListener=function(e,t,n,i){H(this,e,t,n,i)},ee.prototype.N=function(){if(ee.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)q(n[i]);delete t.g[e],t.h--}}this.F=null},ee.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ee.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class re extends P{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:se(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oe(e){P.call(this),this.h=e,this.g={}}u(oe,P);var ae=[];function ce(e){_(e.g,(function(e,t){this.g.hasOwnProperty(t)&&W(e)}),e),e.g={}}oe.prototype.N=function(){oe.aa.N.call(this),ce(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var le=s.JSON.stringify,he=s.JSON.parse,ue=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function de(){}function fe(e){return e.h||(e.h=e.i())}function pe(){}de.prototype.h=null;var ge={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function me(){R.call(this,"d")}function ye(){R.call(this,"c")}u(me,R),u(ye,R);var _e={},ve=null;function we(){return ve=ve||new ee}function Ie(e){R.call(this,_e.La,e)}function be(e){const t=we();te(t,new Ie(t))}function Te(e,t){R.call(this,_e.STAT_EVENT,e),this.stat=t}function Ce(e){const t=we();te(t,new Te(t,e))}function Ee(e,t){R.call(this,_e.Ma,e),this.size=t}function Se(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout((function(){e()}),t)}function ke(){this.g=!0}function Ne(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return le(n)}catch(a){return t}}(e,n)+(i?" "+i:"")}))}_e.La="serverreachability",u(Ie,R),_e.STAT_EVENT="statevent",u(Te,R),_e.Ma="timingevent",u(Ee,R),ke.prototype.xa=function(){this.g=!1},ke.prototype.info=function(){};var xe,Ae={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},De={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Pe(){}function Re(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new oe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Oe}function Oe(){this.i=null,this.g="",this.h=!1}u(Pe,de),Pe.prototype.g=function(){return new XMLHttpRequest},Pe.prototype.i=function(){return{}},xe=new Pe;var Me={},Le={};function Fe(e,t,n){e.L=1,e.v=lt(st(t)),e.m=n,e.P=!0,Ue(e,null)}function Ue(e,t){e.F=Date.now(),je(e),e.A=st(e.v);var n=e.A,i=e.R;Array.isArray(i)||(i=[String(i)]),bt(n.i,"t",i),e.C=0,n=e.j.J,e.h=new Oe,e.g=hn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new re(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,i=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(ae[0]=s.toString()),s=ae);for(var r=0;r<s.length;r++){var o=G(n,s[r],i||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?v(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),be(),function(e,t,n,i,s,r){e.info((function(){if(e.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var h=l[0];l=l[1];var u=h.split("_");o=2<=u.length&&"type"==u[1]?o+(h+"=")+l+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ve(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function qe(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Le:(n=Number(t.substring(n,i)),isNaN(n)?Me:(i+=1)+n>t.length?Le:(t=t.slice(i,i+n),e.C=i+n,t))}function je(e){e.S=Date.now()+e.I,Be(e,e.I)}function Be(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Se(l(e.ba,e),t)}function ze(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function Ke(e){0==e.j.G||e.J||rn(e.j,e)}function $e(e){ze(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ce(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ge(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Je(n.h,e)))if(!e.K&&Je(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(h){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;sn(n),Ht(n)}en(n),Ce(18)}}else n.za=s[1],0<n.za-n.T&&37500>s[2]&&n.F&&0==n.v&&!n.C&&(n.C=Se(l(n.Za,n),6e3));if(1>=Ye(n.h)&&n.ca){try{n.ca()}catch(h){}n.ca=void 0}}else an(n,11)}else if((e.K||n.g==e)&&sn(n),!p(t))for(s=n.Da.g.parse(t),t=0;t<s.length;t++){let l=s[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const s=l[4];null!=s&&(n.Aa=s,n.j.info("SVER="+n.Aa));const h=l[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.L=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Xe(r,r.h),r.h=null))}if(i.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,ct(i.I,i.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((i=n).qa=ln(i,i.J?i.ia:null,i.W),o.K){Ze(i.h,o);var a=o,c=i.L;c&&(a.I=c),a.B&&(ze(a),je(a)),i.g=o}else Zt(i);0<n.i.length&&Qt(n)}else"stop"!=l[0]&&"close"!=l[0]||an(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?an(n,7):Gt(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}be()}catch(h){}}Re.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Bt(e)?t.j():this.Y(e)},Re.prototype.Y=function(e){try{if(e==this.g)e:{const d=Bt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||zt(this.g)))){this.J||4!=d||7==t||be(),ze(this);var n=this.g.Z();this.X=n;t:if(Ve(this)){var i=zt(this.g);e="";var r=i.length,o=4==Bt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$e(this),Ke(this);var a="";break t}this.h.i=new s.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(o&&t==r-1)});i.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,i,s,r,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var h=c;break t}}h=null}if(!(n=h)){this.o=!1,this.s=3,Ce(12),$e(this),Ke(this);break e}Ne(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ge(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=qe(this,a),e==Le){4==d&&(this.s=4,Ce(14),n=!1),Ne(this.i,this.l,null,"[Incomplete Response]");break}if(e==Me){this.s=4,Ce(15),Ne(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ne(this.i,this.l,e,null),Ge(this,e)}if(Ve(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ce(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tn(u),u.M=!0,Ce(11))}}else Ne(this.i,this.l,a,"[Invalid Chunked Response]"),$e(this),Ke(this)}else Ne(this.i,this.l,a,null),Ge(this,a);4==d&&$e(this),this.o&&!this.J&&(4==d?rn(this.j,this):(this.o=!1,je(this)))}else(function(e){const t={};e=(e.g&&2<=Bt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(p(e[i]))continue;var n=b(e[i]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=t[s]||[];t[s]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ce(12)):(this.s=0,Ce(13)),$e(this),Ke(this)}}}catch(d){}},Re.prototype.cancel=function(){this.J=!0,$e(this)},Re.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(be(),Ce(17)),$e(this),this.s=2,Ke(this)):Be(this,this.S-e)};var He=class{constructor(e,t){this.g=e,this.map=t}};function We(e){this.l=e||10,e=s.PerformanceNavigationTiming?0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ye(e){return e.h?1:e.g?e.g.size:0}function Je(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Xe(e,t){e.g?e.g.add(t):e.h=t}function Ze(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function et(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(r(e)||"string"==typeof e)[].forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(r(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(r(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),s=i.length,o=0;o<s;o++)t.call(void 0,i[o],n&&n[o],e)}We.prototype.cancel=function(){if(this.i=et(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function it(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof it){this.h=e.h,rt(this,e.j),this.o=e.o,this.g=e.g,ot(this,e.s),this.l=e.l;var t=e.i,n=new _t;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),at(this,n),this.m=e.m}else e&&(t=String(e).match(nt))?(this.h=!1,rt(this,t[1]||"",!0),this.o=ht(t[2]||""),this.g=ht(t[3]||"",!0),ot(this,t[4]),this.l=ht(t[5]||"",!0),at(this,t[6]||"",!0),this.m=ht(t[7]||"")):(this.h=!1,this.i=new _t(null,this.h))}function st(e){return new it(e)}function rt(e,t,n){e.j=n?ht(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ot(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function at(e,t,n){t instanceof _t?(e.i=t,function(e,t){t&&!e.j&&(vt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(wt(this,t),bt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=ut(t,mt)),e.i=new _t(t,e.h))}function ct(e,t,n){e.i.set(t,n)}function lt(e){return ct(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ht(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ut(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,dt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function dt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}it.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ut(t,ft,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ut(t,ft,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ut(n,"/"==n.charAt(0)?gt:pt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ut(n,yt)),e.join("")};var ft=/[#\/\?@]/g,pt=/[#\?:]/g,gt=/[#\?]/g,mt=/[#\?@]/g,yt=/#/g;function _t(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function vt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),s=null;if(0<=i){var r=e[n].substring(0,i);s=e[n].substring(i+1)}else r=e[n];t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function wt(e,t){vt(e),t=Tt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function It(e,t){return vt(e),t=Tt(e,t),e.g.has(t)}function bt(e,t,n){wt(e,t),0<n.length&&(e.i=null,e.g.set(Tt(e,t),d(n)),e.h+=n.length)}function Tt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ct(e,t,n,i,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),i(n)}catch(r){}}function Et(){this.g=new ue}function St(e,t,n){const i=n||"";try{tt(e,(function(e,n){let s=e;o(e)&&(s=le(e)),t.push(i+n+"="+encodeURIComponent(s))}))}catch(s){throw t.push(i+"type="+encodeURIComponent("_badmap")),s}}function kt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Nt(e,t){ee.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function xt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function At(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Dt(e)}function Dt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Pt(e){let t="";return _(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Rt(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Pt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ct(e,t,n))}function Ot(e){ee.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=_t.prototype).add=function(e,t){vt(this),this.i=null,e=Tt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){vt(this),this.g.forEach((function(n,i){n.forEach((function(n){e.call(t,n,i,this)}),this)}),this)},e.na=function(){vt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const s=e[i];for(let e=0;e<s.length;e++)n.push(t[i])}return n},e.V=function(e){vt(this);let t=[];if("string"==typeof e)It(this,e)&&(t=t.concat(this.g.get(Tt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return vt(this),this.i=null,It(this,e=Tt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const r=encodeURIComponent(String(i)),o=this.V(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),e.push(s)}}return this.i=e.join("&")},u(kt,de),kt.prototype.g=function(){return new Nt(this.l,this.j)},kt.prototype.i=function(e){return function(){return e}}({}),u(Nt,ee),(e=Nt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Dt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,At(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dt(this)),this.g&&(this.readyState=3,Dt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;xt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?At(this):Dt(this),3==this.readyState&&xt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,At(this))},e.Qa=function(e){this.g&&(this.response=e,At(this))},e.ga=function(){this.g&&At(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Nt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Ot,ee);var Mt=/^https?$/i,Lt=["POST","PUT"];function Ft(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ut(e),qt(e)}function Ut(e){e.A||(e.A=!0,te(e,"complete"),te(e,"error"))}function Vt(e){if(e.h&&void 0!==i&&(!e.v[1]||4!=Bt(e)||2!=e.Z()))if(e.u&&4==Bt(e))ie(e.Ea,0,e);else if(te(e,"readystatechange"),4==Bt(e)){e.h=!1;try{const i=e.Z();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===i){var o=String(e.D).match(nt)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),r=!Mt.test(o?o.toLowerCase():"")}n=r}if(n)te(e,"complete"),te(e,"success");else{e.m=6;try{var a=2<Bt(e)?e.g.statusText:""}catch(c){a=""}e.l=a+" ["+e.Z()+"]",Ut(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){jt(e);const i=e.g,s=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||te(e,"ready");try{i.onreadystatechange=s}catch(n){}}}function jt(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function Bt(e){return e.g?e.g.readyState:0}function zt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Kt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function $t(e){this.Aa=0,this.i=[],this.j=new ke,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kt("baseRetryDelayMs",5e3,e),this.cb=Kt("retryDelaySeedMs",1e4,e),this.Wa=Kt("forwardChannelMaxRetries",2,e),this.wa=Kt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new We(e&&e.concurrentRequestLimit),this.Da=new Et,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Gt(e){if(Wt(e),3==e.G){var t=e.U++,n=st(e.I);if(ct(n,"SID",e.K),ct(n,"RID",t),ct(n,"TYPE","terminate"),Jt(e,n),(t=new Re(e,e.j,t)).L=2,t.v=lt(st(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(t.v.toString(),"")}catch(i){}!n&&s.Image&&((new Image).src=t.v,n=!0),n||(t.g=hn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),je(t)}cn(e)}function Ht(e){e.g&&(tn(e),e.g.cancel(),e.g=null)}function Wt(e){Ht(e),e.u&&(s.clearTimeout(e.u),e.u=null),sn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&s.clearTimeout(e.s),e.s=null)}function Qt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;k||A(),N||(k(),N=!0),x.add(t,e),e.B=0}}function Yt(e,t){var n;n=t?t.l:e.U++;const i=st(e.I);ct(i,"SID",e.K),ct(i,"RID",n),ct(i,"AID",e.T),Jt(e,i),e.m&&e.o&&Rt(i,e.m,e.o),n=new Re(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=Xt(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),Xe(e.h,n),Fe(n,i,t)}function Jt(e,t){e.H&&_(e.H,(function(e,n){ct(t,n,e)})),e.l&&tt({},(function(e,n){ct(t,n,e)}))}function Xt(e,t,n){n=Math.min(e.i.length,n);var i=e.l?l(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let a=0;a<n;a++){let n=s[a].g;const c=s[a].map;if(n-=t,0>n)t=Math.max(0,s[a].g-100),o=!1;else try{St(c,e,"req"+n+"_")}catch(r){i&&i(c)}}if(o){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function Zt(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;k||A(),N||(k(),N=!0),x.add(t,e),e.v=0}}function en(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Se(l(e.Fa,e),on(e,e.v)),e.v++,0))}function tn(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function nn(e){e.g=new Re(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=st(e.qa);ct(t,"RID","rpc"),ct(t,"SID",e.K),ct(t,"AID",e.T),ct(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ct(t,"TO",e.ja),ct(t,"TYPE","xmlhttp"),Jt(e,t),e.m&&e.o&&Rt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=lt(st(t)),n.m=null,n.P=!0,Ue(n,e)}function sn(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function rn(e,t){var n=null;if(e.g==t){sn(e),tn(e),e.g=null;var i=2}else{if(!Je(e.h,t))return;n=t.D,Ze(e.h,t),i=1}if(0!=e.G)if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;te(i=we(),new Ee(i,n)),Qt(e)}else Zt(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&function(e,t){return!(Ye(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Se(l(e.Ga,e,t),on(e,e.B)),e.B++,0)))}(e,t)||2==i&&en(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),s){case 1:an(e,5);break;case 4:an(e,10);break;case 3:an(e,6);break;default:an(e,2)}}function on(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function an(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),i=e.Xa;const t=!i;i=new it(i||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||rt(i,"https"),lt(i),t?function(e,t){const n=new ke;if(s.Image){const i=new Image;i.onload=h(Ct,n,"TestLoadImage: loaded",!0,t,i),i.onerror=h(Ct,n,"TestLoadImage: error",!1,t,i),i.onabort=h(Ct,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=h(Ct,n,"TestLoadImage: timeout",!1,t,i),s.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new ke;const n=new AbortController,i=setTimeout((()=>{n.abort(),Ct(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(i),e.ok?Ct(0,0,!0,t):Ct(0,0,!1,t)})).catch((()=>{clearTimeout(i),Ct(0,0,!1,t)}))}(i.toString(),n)}else Ce(2);e.G=0,e.l&&e.l.sa(t),cn(e),Wt(e)}function cn(e){if(e.G=0,e.ka=[],e.l){const t=et(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function ln(e,t,n){var i=n instanceof it?st(n):new it(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ot(i,i.s);else{var r=s.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var o=new it(null);i&&rt(o,i),t&&(o.g=t),r&&ot(o,r),n&&(o.l=n),i=o}return n=e.D,t=e.ya,n&&t&&ct(i,n,t),ct(i,"VER",e.la),Jt(e,i),i}function hn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ot(new kt({eb:n})):new Ot(e.pa)).Ha(e.J),t}function un(){}function dn(){}function fn(e,t){ee.call(this),this.g=new $t(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new mn(this)}function pn(e){me.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function gn(){ye.call(this),this.status=1}function mn(e){this.g=e}(e=Ot.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xe.g(),this.v=this.o?fe(this.o):fe(xe),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ft(this,o)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),r=s.FormData&&e instanceof s.FormData,!(0<=[].indexOf.call(Lt,t,void 0))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of n)this.g.setRequestHeader(s,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{jt(this),this.u=!0,this.g.send(e),this.u=!1}catch(o){Ft(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,te(this,"complete"),te(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),Ot.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Vt(this):this.bb())},e.bb=function(){Vt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Bt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=$t.prototype).la=8,e.G=1,e.connect=function(e,t,n,i){Ce(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=ln(this,null,this.W),Qt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new Re(this,this.j,e);let r=this.o;if(this.S&&(r?(r=v(r),I(r,this.S)):r=this.S),null!==this.m||this.O||(s.H=r,r=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Xt(this,s,t),ct(n=st(this.I),"RID",e),ct(n,"CVER",22),this.D&&ct(n,"X-HTTP-Session-Id",this.D),Jt(this,n),r&&(this.O?t="headers="+encodeURIComponent(String(Pt(r)))+"&"+t:this.m&&Rt(n,this.m,r)),Xe(this.h,s),this.Ua&&ct(n,"TYPE","init"),this.P?(ct(n,"$req",t),ct(n,"SID","null"),s.T=!0,Fe(s,n,null)):Fe(s,n,t),this.G=2}}else 3==this.G&&(e?Yt(this,e):0==this.i.length||Qe(this.h)||Yt(this))},e.Fa=function(){if(this.u=null,nn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Se(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ce(10),Ht(this),nn(this))},e.Za=function(){null!=this.C&&(this.C=null,Ht(this),en(this),Ce(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ce(2)):(this.j.info("Failed to ping google.com"),Ce(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=un.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},dn.prototype.g=function(e,t){return new fn(e,t)},u(fn,ee),fn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},fn.prototype.close=function(){Gt(this.g)},fn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=le(e),e=n);t.i.push(new He(t.Ya++,e)),3==t.G&&Qt(t)},fn.prototype.N=function(){this.g.l=null,delete this.j,Gt(this.g),delete this.g,fn.aa.N.call(this)},u(pn,me),u(gn,ye),u(mn,un),mn.prototype.ua=function(){te(this.g,"a")},mn.prototype.ta=function(e){te(this.g,new pn(e))},mn.prototype.sa=function(e){te(this.g,new gn)},mn.prototype.ra=function(){te(this.g,"b")},dn.prototype.createWebChannel=dn.prototype.g,fn.prototype.send=fn.prototype.o,fn.prototype.open=fn.prototype.m,fn.prototype.close=fn.prototype.close,al=function(){return new dn},ol=function(){return we()},rl=_e,sl={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,il=Ae,De.COMPLETE="complete",nl=De,pe.EventType=ge,ge.OPEN="a",ge.CLOSE="b",ge.ERROR="c",ge.MESSAGE="d",ee.prototype.listen=ee.prototype.K,tl=pe,Ot.prototype.listenOnce=Ot.prototype.L,Ot.prototype.getLastError=Ot.prototype.Ka,Ot.prototype.getLastErrorCode=Ot.prototype.Ba,Ot.prototype.getStatus=Ot.prototype.Z,Ot.prototype.getResponseJson=Ot.prototype.Oa,Ot.prototype.getResponseText=Ot.prototype.oa,Ot.prototype.send=Ot.prototype.ea,Ot.prototype.setWithCredentials=Ot.prototype.Ha,el=Ot}).apply(void 0!==cl?cl:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ll="@firebase/firestore";class hl{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}hl.UNAUTHENTICATED=new hl(null),hl.GOOGLE_CREDENTIALS=new hl("google-credentials-uid"),hl.FIRST_PARTY=new hl("first-party-uid"),hl.MOCK_USER=new hl("mock-user");let ul="10.14.0";const dl=new re("@firebase/firestore");function fl(){return dl.logLevel}function pl(e,...t){if(dl.logLevel<=Z.DEBUG){const n=t.map(yl);dl.debug(`Firestore (${ul}): ${e}`,...n)}}function gl(e,...t){if(dl.logLevel<=Z.ERROR){const n=t.map(yl);dl.error(`Firestore (${ul}): ${e}`,...n)}}function ml(e,...t){if(dl.logLevel<=Z.WARN){const n=t.map(yl);dl.warn(`Firestore (${ul}): ${e}`,...n)}}function yl(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(n){return e}var t}function _l(e="Unexpected state"){const t=`FIRESTORE (${ul}) INTERNAL ASSERTION FAILED: `+e;throw gl(t),new Error(t)}function vl(e,t){e||_l()}function wl(e,t){return e}const Il={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class bl extends x{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Tl{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Cl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class El{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(hl.UNAUTHENTICATED)))}shutdown(){}}class Sl{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class kl{constructor(e){this.t=e,this.currentUser=hl.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){vl(void 0===this.o);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new Tl;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Tl,e.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{pl("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(pl("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Tl)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(pl("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(vl("string"==typeof t.accessToken),new Cl(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return vl(null===e||"string"==typeof e),new hl(e)}}class Nl{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=hl.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class xl{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Nl(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(hl.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Al{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Dl{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){vl(void 0===this.o);const n=e=>{null!=e.error&&pl("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,pl("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{pl("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?i(e):pl("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(vl("string"==typeof e.token),this.R=e.token,new Al(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Pl(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}class Rl{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Pl(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function Ol(e,t){return e<t?-1:e>t?1:0}function Ml(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}function Ll(e){return e+"\0"}class Fl{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new bl(Il.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new bl(Il.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new bl(Il.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new bl(Il.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Fl.fromMillis(Date.now())}static fromDate(e){return Fl.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Fl(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ol(this.nanoseconds,e.nanoseconds):Ol(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ul{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ul(e)}static min(){return new Ul(new Fl(0,0))}static max(){return new Ul(new Fl(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Vl{constructor(e,t,n){void 0===t?t=0:t>e.length&&_l(),void 0===n?n=e.length-t:n>e.length-t&&_l(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Vl.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Vl?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),s=t.get(i);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ql extends Vl{construct(e,t,n){return new ql(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new bl(Il.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ql(t)}static emptyPath(){return new ql([])}}const jl=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bl extends Vl{construct(e,t,n){return new Bl(e,t,n)}static isValidIdentifier(e){return jl.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bl.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Bl(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new bl(Il.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new bl(Il.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new bl(Il.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new bl(Il.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bl(t)}static emptyPath(){return new Bl([])}}class zl{constructor(e){this.path=e}static fromPath(e){return new zl(ql.fromString(e))}static fromName(e){return new zl(ql.fromString(e).popFirst(5))}static empty(){return new zl(ql.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ql.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ql.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new zl(new ql(e.slice()))}}class Kl{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function $l(e){return e.fields.find((e=>2===e.kind))}function Gl(e){return e.fields.filter((e=>2!==e.kind))}Kl.UNKNOWN_ID=-1;class Hl{constructor(e,t){this.fieldPath=e,this.kind=t}}class Wl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Wl(0,Yl.min())}}function Ql(e){return new Yl(e.readTime,e.key,-1)}class Yl{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Yl(Ul.min(),zl.empty(),-1)}static max(){return new Yl(Ul.max(),zl.empty(),-1)}}function Jl(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=zl.comparator(e.documentKey,t.documentKey),0!==n?n:Ol(e.largestBatchId,t.largestBatchId))}const Xl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Zl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function eh(e){if(e.code!==Il.FAILED_PRECONDITION||e.message!==Xl)throw e;pl("LocalStore","Unexpectedly lost primary lease")}class th{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&_l(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new th(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof th?t:th.resolve(t)}catch(t){return th.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):th.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):th.reject(t)}static resolve(e){return new th(((t,n)=>{t(e)}))}static reject(e){return new th(((t,n)=>{n(e)}))}static waitFor(e){return new th(((t,n)=>{let i=0,s=0,r=!1;e.forEach((e=>{++i,e.next((()=>{++s,r&&s===i&&t()}),(e=>n(e)))})),r=!0,s===i&&t()}))}static or(e){let t=th.resolve(!1);for(const n of e)t=t.next((e=>e?th.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}static mapArray(e,t){return new th(((n,i)=>{const s=e.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next((e=>{r[c]=e,++o,o===s&&n(r)}),(e=>i(e)))}}))}static doWhile(e,t){return new th(((n,i)=>{const s=()=>{!0===e()?t().next((()=>{s()}),i):n()};s()}))}}class nh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Tl,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new oh(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=uh(t.target.error);this.V.reject(new oh(e,n))}}static open(e,t,n,i){try{return new nh(t,e.transaction(i,n))}catch(s){throw new oh(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(pl("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ch(t)}}class ih{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===ih.S(b())&&gl("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return pl("SimpleDb","Removing database:",e),lh(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!k())return!1;if(ih.v())return!0;const e=b(),t=ih.S(e),n=0<t&&t<10,i=sh(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}async M(e){return this.db||(pl("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{const n=e.target.result;t(n)},i.onblocked=()=>{n(new oh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=t=>{const i=t.target.error;"VersionError"===i.name?n(new bl(Il.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===i.name?n(new bl(Il.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+i)):n(new oh(e,i))},i.onupgradeneeded=e=>{pl("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.O(t,i.transaction,e.oldVersion,this.version).next((()=>{pl("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,i){const s="readonly"===t;let r=0;for(;;){++r;try{this.db=await this.M(e);const t=nh.open(this.db,e,s?"readonly":"readwrite",n),r=i(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),th.reject(e)))).toPromise();return r.catch((()=>{})),await t.m,r}catch(o){const e=o,t="FirebaseError"!==e.name&&r<3;if(pl("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function sh(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class rh{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return lh(this.B.delete())}}class oh extends bl{constructor(e,t){super(Il.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ah(e){return"IndexedDbTransactionError"===e.name}class ch{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(pl("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(pl("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),lh(n)}add(e){return pl("SimpleDb","ADD",this.store.name,e,e),lh(this.store.add(e))}get(e){return lh(this.store.get(e)).next((t=>(void 0===t&&(t=null),pl("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return pl("SimpleDb","DELETE",this.store.name,e),lh(this.store.delete(e))}count(){return pl("SimpleDb","COUNT",this.store.name),lh(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const e=i.getAll(n.range);return new th(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new th(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}j(e,t){pl("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,((e,t,n)=>n.delete()))}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new th(((n,i)=>{t.onerror=e=>{const t=uh(e.target.error);i(t)},t.onsuccess=t=>{const i=t.target.result;i?e(i.primaryKey,i.value).next((e=>{e?i.continue():n()})):n()}}))}W(e,t){const n=[];return new th(((i,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{const s=e.target.result;if(!s)return void i();const r=new rh(s),o=t(s.primaryKey,s.value,r);if(o instanceof th){const e=o.catch((e=>(r.done(),th.reject(e))));n.push(e)}r.isDone?i():null===r.K?s.continue():s.continue(r.K)}})).next((()=>th.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function lh(e){return new th(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=uh(e.target.error);n(t)}}))}let hh=!1;function uh(e){const t=ih.S(b());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new bl("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return hh||(hh=!0,setTimeout((()=>{throw e}),0)),e}}return e}class dh{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){pl("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{pl("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(e){ah(e)?pl("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await eh(e)}await this.X(6e4)}))}}class fh{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.te(t,e)))}te(e,t){const n=new Set;let i=t,s=!0;return th.doWhile((()=>!0===s&&i>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return pl("IndexBackfiller",`Processing collection: ${t}`),this.ne(e,t,i).next((e=>{i-=e,n.add(t)}));s=!1})))).next((()=>t-i))}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next((n=>{const s=n.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next((()=>this.re(i,n))).next((n=>(pl("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>s.size))}))))}re(e,t){let n=e;return t.changes.forEach(((e,t)=>{const i=Ql(t);Jl(i,n)>0&&(n=i)})),new Yl(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ph{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function gh(e){return null==e}function mh(e){return 0===e&&1/e==-1/0}function yh(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=vh(t)),t=_h(e.get(n),t);return vh(t)}function _h(e,t){let n=t;const i=e.length;for(let s=0;s<i;s++){const t=e.charAt(s);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function vh(e){return e+""}function wh(e){const t=e.length;if(vl(t>=2),2===t)return vl(""===e.charAt(0)&&""===e.charAt(1)),ql.emptyPath();const n=t-2,i=[];let s="";for(let r=0;r<t;){const t=e.indexOf("",r);switch((t<0||t>n)&&_l(),e.charAt(t+1)){case"":const n=e.substring(r,t);let o;0===s.length?o=n:(s+=n,o=s,s=""),i.push(o);break;case"":s+=e.substring(r,t),s+="\0";break;case"":s+=e.substring(r,t+1);break;default:_l()}r=t+2}return new ql(i)}ph.oe=-1;const Ih=["userId","batchId"];function bh(e,t){return[e,yh(t)]}function Th(e,t,n){return[e,yh(t),n]}const Ch={},Eh=["prefixPath","collectionGroup","readTime","documentId"],Sh=["prefixPath","collectionGroup","documentId"],kh=["collectionGroup","readTime","prefixPath","documentId"],Nh=["canonicalId","targetId"],xh=["targetId","path"],Ah=["path","targetId"],Dh=["collectionId","parent"],Ph=["indexId","uid"],Rh=["uid","sequenceNumber"],Oh=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Mh=["indexId","uid","orderedDocumentKey"],Lh=["userId","collectionPath","documentId"],Fh=["userId","collectionPath","largestBatchId"],Uh=["userId","collectionGroup","largestBatchId"],Vh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],qh=[...Vh,"documentOverlays"],jh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Bh=jh,zh=[...Bh,"indexConfiguration","indexState","indexEntries"],Kh=zh,$h=[...zh,"globals"];class Gh extends Zl{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Hh(e,t){const n=wl(e);return ih.F(n._e,t)}function Wh(e){let t=0;for(const n in e)({}).hasOwnProperty.call(e,n)&&t++;return t}function Qh(e,t){for(const n in e)({}).hasOwnProperty.call(e,n)&&t(n,e[n])}class Yh{constructor(e,t){this.comparator=e,this.root=t||Xh.EMPTY}insert(e,t){return new Yh(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xh.BLACK,null,null))}remove(e){return new Yh(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xh.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Jh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Jh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Jh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Jh(this.root,e,this.comparator,!0)}}class Jh{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Xh{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Xh.RED,this.left=null!=i?i:Xh.EMPTY,this.right=null!=s?s:Xh.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Xh(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Xh.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Xh.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Xh.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Xh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _l();if(this.right.isRed())throw _l();const e=this.left.check();if(e!==this.right.check())throw _l();return e+(this.isRed()?0:1)}}Xh.EMPTY=null,Xh.RED=!0,Xh.BLACK=!1,Xh.EMPTY=new class{constructor(){this.size=0}get key(){throw _l()}get value(){throw _l()}get color(){throw _l()}get left(){throw _l()}get right(){throw _l()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Xh(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Zh{constructor(e){this.comparator=e,this.data=new Yh(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new eu(this.data.getIterator())}getIteratorFrom(e){return new eu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Zh))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Zh(this.comparator);return t.data=e,t}}class eu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function tu(e){return e.hasNext()?e.getNext():void 0}class nu{constructor(e){this.fields=e,e.sort(Bl.comparator)}static empty(){return new nu([])}unionWith(e){let t=new Zh(Bl.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new nu(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ml(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class iu extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class su{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new iu("Invalid base64 string: "+t):t}}(e);return new su(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new su(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ol(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}su.EMPTY_BYTE_STRING=new su("");const ru=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ou(e){if(vl(!!e),"string"==typeof e){let t=0;const n=ru.exec(e);if(vl(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:au(e.seconds),nanos:au(e.nanos)}}function au(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function cu(e){return"string"==typeof e?su.fromBase64String(e):su.fromUint8Array(e)}function lu(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function hu(e){const t=e.mapValue.fields.__previous_value__;return lu(t)?hu(t):t}function uu(e){const t=ou(e.mapValue.fields.__local_write_time__.timestampValue);return new Fl(t.seconds,t.nanos)}class du{constructor(e,t,n,i,s,r,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class fu{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new fu("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof fu&&e.projectId===this.projectId&&e.database===this.database}}const pu={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},gu={nullValue:"NULL_VALUE"};function mu(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?lu(e)?4:Pu(e)?9007199254740991:Au(e)?10:11:_l()}function yu(e,t){if(e===t)return!0;const n=mu(e);if(n!==mu(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return uu(e).isEqual(uu(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=ou(e.timestampValue),i=ou(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return i=t,cu(e.bytesValue).isEqual(cu(i.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return au(e.geoPointValue.latitude)===au(t.geoPointValue.latitude)&&au(e.geoPointValue.longitude)===au(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return au(e.integerValue)===au(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=au(e.doubleValue),i=au(t.doubleValue);return n===i?mh(n)===mh(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Ml(e.arrayValue.values||[],t.arrayValue.values||[],yu);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Wh(n)!==Wh(i))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===i[s]||!yu(n[s],i[s])))return!1;return!0}(e,t);default:return _l()}var i}function _u(e,t){return void 0!==(e.values||[]).find((e=>yu(e,t)))}function vu(e,t){if(e===t)return 0;const n=mu(e),i=mu(t);if(n!==i)return Ol(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ol(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=au(e.integerValue||e.doubleValue),i=au(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return wu(e.timestampValue,t.timestampValue);case 4:return wu(uu(e),uu(t));case 5:return Ol(e.stringValue,t.stringValue);case 6:return function(e,t){const n=cu(e),i=cu(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let s=0;s<n.length&&s<i.length;s++){const e=Ol(n[s],i[s]);if(0!==e)return e}return Ol(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ol(au(e.latitude),au(t.latitude));return 0!==n?n:Ol(au(e.longitude),au(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Iu(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,i,s,r;const o=e.fields||{},a=t.fields||{},c=null===(n=o.value)||void 0===n?void 0:n.arrayValue,l=null===(i=a.value)||void 0===i?void 0:i.arrayValue,h=Ol((null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0,(null===(r=null==l?void 0:l.values)||void 0===r?void 0:r.length)||0);return 0!==h?h:Iu(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===pu.mapValue&&t===pu.mapValue)return 0;if(e===pu.mapValue)return 1;if(t===pu.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let o=0;o<i.length&&o<r.length;++o){const e=Ol(i[o],r[o]);if(0!==e)return e;const t=vu(n[i[o]],s[r[o]]);if(0!==t)return t}return Ol(i.length,r.length)}(e.mapValue,t.mapValue);default:throw _l()}}function wu(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ol(e,t);const n=ou(e),i=ou(t),s=Ol(n.seconds,i.seconds);return 0!==s?s:Ol(n.nanos,i.nanos)}function Iu(e,t){const n=e.values||[],i=t.values||[];for(let s=0;s<n.length&&s<i.length;++s){const e=vu(n[s],i[s]);if(e)return e}return Ol(n.length,i.length)}function bu(e){return Tu(e)}function Tu(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=ou(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?cu(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,zl.fromName(t).toString()):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=Tu(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+=`${s}:${Tu(e.fields[s])}`;return n+"}"}(e.mapValue):_l();var t}function Cu(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Eu(e){return!!e&&"integerValue"in e}function Su(e){return!!e&&"arrayValue"in e}function ku(e){return!!e&&"nullValue"in e}function Nu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function xu(e){return!!e&&"mapValue"in e}function Au(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Du(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Qh(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Du(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Du(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Pu(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}const Ru={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Ou(e){return"nullValue"in e?gu:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Cu(fu.empty(),zl.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?Au(e)?Ru:{mapValue:{}}:_l()}function Mu(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Cu(fu.empty(),zl.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?Ru:"mapValue"in e?Au(e)?{mapValue:{}}:pu:_l()}function Lu(e,t){const n=vu(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Fu(e,t){const n=vu(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Uu{constructor(e){this.value=e}static empty(){return new Uu({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!xu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Du(t)}setAll(e){let t=Bl.emptyPath(),n={},i=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=Du(e):i.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());xu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return yu(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];xu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Qh(t,((t,n)=>e[t]=n));for(const i of n)delete e[i]}clone(){return new Uu(Du(this.value))}}class Vu{constructor(e,t,n,i,s,r,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(e){return new Vu(e,0,Ul.min(),Ul.min(),Ul.min(),Uu.empty(),0)}static newFoundDocument(e,t,n,i){return new Vu(e,1,t,Ul.min(),n,i,0)}static newNoDocument(e,t){return new Vu(e,2,t,Ul.min(),Ul.min(),Uu.empty(),0)}static newUnknownDocument(e,t){return new Vu(e,3,t,Ul.min(),Ul.min(),Uu.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ul.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Uu.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Uu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ul.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Vu&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Vu(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class qu{constructor(e,t){this.position=e,this.inclusive=t}}function ju(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],o=e.position[s];if(i=r.field.isKeyField()?zl.comparator(zl.fromName(o.referenceValue),n.key):vu(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function Bu(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!yu(e.position[n],t.position[n]))return!1;return!0}class zu{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ku(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class $u{}class Gu extends $u{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new nd(e,t,n):"array-contains"===t?new od(e,n):"in"===t?new ad(e,n):"not-in"===t?new cd(e,n):"array-contains-any"===t?new ld(e,n):new Gu(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new id(e,n):new sd(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(vu(t,this.value)):null!==t&&mu(this.value)===mu(t)&&this.matchesComparison(vu(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return _l()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Hu extends $u{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Hu(e,t)}matches(e){return Wu(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Wu(e){return"and"===e.op}function Qu(e){return"or"===e.op}function Yu(e){return Ju(e)&&Wu(e)}function Ju(e){for(const t of e.filters)if(t instanceof Hu)return!1;return!0}function Xu(e){if(e instanceof Gu)return e.field.canonicalString()+e.op.toString()+bu(e.value);if(Yu(e))return e.filters.map((e=>Xu(e))).join(",");{const t=e.filters.map((e=>Xu(e))).join(",");return`${e.op}(${t})`}}function Zu(e,t){return e instanceof Gu?(n=e,(i=t)instanceof Gu&&n.op===i.op&&n.field.isEqual(i.field)&&yu(n.value,i.value)):e instanceof Hu?function(e,t){return t instanceof Hu&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,i)=>e&&Zu(n,t.filters[i])),!0)}(e,t):void _l();var n,i}function ed(e,t){const n=e.filters.concat(t);return Hu.create(n,e.op)}function td(e){return e instanceof Gu?`${(t=e).field.canonicalString()} ${t.op} ${bu(t.value)}`:e instanceof Hu?function(e){return e.op.toString()+" {"+e.getFilters().map(td).join(" ,")+"}"}(e):"Filter";var t}class nd extends Gu{constructor(e,t,n){super(e,t,n),this.key=zl.fromName(n.referenceValue)}matches(e){const t=zl.comparator(e.key,this.key);return this.matchesComparison(t)}}class id extends Gu{constructor(e,t){super(e,"in",t),this.keys=rd(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class sd extends Gu{constructor(e,t){super(e,"not-in",t),this.keys=rd(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function rd(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>zl.fromName(e.referenceValue)))}class od extends Gu{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Su(t)&&_u(t.arrayValue,this.value)}}class ad extends Gu{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&_u(this.value.arrayValue,t)}}class cd extends Gu{constructor(e,t){super(e,"not-in",t)}matches(e){if(_u(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!_u(this.value.arrayValue,t)}}class ld extends Gu{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Su(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>_u(this.value.arrayValue,e)))}}class hd{constructor(e,t=null,n=[],i=[],s=null,r=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.ue=null}}function ud(e,t=null,n=[],i=[],s=null,r=null,o=null){return new hd(e,t,n,i,s,r,o)}function dd(e){const t=wl(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Xu(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>{return(t=e).field.canonicalString()+t.dir;var t})).join(","),gh(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>bu(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>bu(e))).join(",")),t.ue=e}return t.ue}function fd(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ku(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Zu(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Bu(e.startAt,t.startAt)&&Bu(e.endAt,t.endAt)}function pd(e,t){return e.filters.filter((e=>e instanceof Gu&&e.field.isEqual(t)))}function gd(e,t,n){let i=gu,s=!0;for(const r of pd(e,t)){let e=gu,t=!0;switch(r.op){case"<":case"<=":e=Ou(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=gu}Lu({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}if(null!==n)for(let r=0;r<e.orderBy.length;++r)if(e.orderBy[r].field.isEqual(t)){const e=n.position[r];Lu({value:i,inclusive:s},{value:e,inclusive:n.inclusive})<0&&(i=e,s=n.inclusive);break}return{value:i,inclusive:s}}function md(e,t,n){let i=pu,s=!0;for(const r of pd(e,t)){let e=pu,t=!0;switch(r.op){case">=":case">":e=Mu(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=pu}Fu({value:i,inclusive:s},{value:e,inclusive:t})>0&&(i=e,s=t)}if(null!==n)for(let r=0;r<e.orderBy.length;++r)if(e.orderBy[r].field.isEqual(t)){const e=n.position[r];Fu({value:i,inclusive:s},{value:e,inclusive:n.inclusive})>0&&(i=e,s=n.inclusive);break}return{value:i,inclusive:s}}class yd{constructor(e,t=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function _d(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function vd(e){const t=wl(e);if(null===t.ce){t.ce=[];const e=new Set;for(const i of t.explicitOrderBy)t.ce.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new Zh(Bl.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t})(t).forEach((i=>{e.has(i.canonicalString())||i.isKeyField()||t.ce.push(new zu(i,n))})),e.has(Bl.keyField().canonicalString())||t.ce.push(new zu(Bl.keyField(),n))}return t.ce}function wd(e){const t=wl(e);return t.le||(t.le=function(e,t){if("F"===e.limitType)return ud(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new zu(e.field,t)}));const n=e.endAt?new qu(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new qu(e.startAt.position,e.startAt.inclusive):null;return ud(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(t,vd(e))),t.le}function Id(e,t,n){return new yd(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function bd(e,t){return fd(wd(e),wd(t))&&e.limitType===t.limitType}function Td(e){return`${dd(wd(e))}|lt:${e.limitType}`}function Cd(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>td(e))).join(", ")}]`),gh(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t})).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>bu(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>bu(e))).join(",")),`Target(${t})`}(wd(e))}; limitType=${e.limitType})`}function Ed(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):zl.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of vd(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(i=t,!((n=e).startAt&&!function(e,t,n){const i=ju(e,t,n);return e.inclusive?i<=0:i<0}(n.startAt,vd(n),i)||n.endAt&&!function(e,t,n){const i=ju(e,t,n);return e.inclusive?i>=0:i>0}(n.endAt,vd(n),i)));var n,i}function Sd(e,t,n){const i=e.field.isKeyField()?zl.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?vu(i,s):_l()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return _l()}}class kd{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Qh(this.inner,((t,n)=>{for(const[i,s]of n)e(i,s)}))}isEmpty(){return function(e){for(const t in e)if({}.hasOwnProperty.call(e,t))return!1;return!0}(this.inner)}size(){return this.innerSize}}const Nd=new Yh(zl.comparator);function xd(){return Nd}const Ad=new Yh(zl.comparator);function Dd(...e){let t=Ad;for(const n of e)t=t.insert(n.key,n);return t}function Pd(e){let t=Ad;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Rd(){return Md()}function Od(){return Md()}function Md(){return new kd((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Ld=new Yh(zl.comparator),Fd=new Zh(zl.comparator);function Ud(...e){let t=Fd;for(const n of e)t=t.add(n);return t}const Vd=new Zh(Ol);class qd{constructor(){this._=void 0}}function jd(e,t,n){return e instanceof zd?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&lu(t)&&(t=hu(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Kd?$d(e,t):e instanceof Gd?Hd(e,t):function(e,t){const n=function(e,t){return e instanceof Wd?function(e){return Eu(e)||!!(t=e)&&"doubleValue"in t;var t}(t)?t:{integerValue:0}:null}(e,t),i=Qd(n)+Qd(e.Pe);return Eu(n)&&Eu(e.Pe)?function(e){return{integerValue:""+e}}(i):function(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mh(t)?"-0":t}}(e.serializer,i)}(e,t)}function Bd(e,t,n){return e instanceof Kd?$d(e,t):e instanceof Gd?Hd(e,t):n}class zd extends qd{}class Kd extends qd{constructor(e){super(),this.elements=e}}function $d(e,t){const n=Yd(t);for(const i of e.elements)n.some((e=>yu(e,i)))||n.push(i);return{arrayValue:{values:n}}}class Gd extends qd{constructor(e){super(),this.elements=e}}function Hd(e,t){let n=Yd(t);for(const i of e.elements)n=n.filter((e=>!yu(e,i)));return{arrayValue:{values:n}}}class Wd extends qd{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Qd(e){return au(e.integerValue||e.doubleValue)}function Yd(e){return Su(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Jd{constructor(e,t){this.field=e,this.transform=t}}class Xd{constructor(e,t){this.version=e,this.transformResults=t}}class Zd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Zd}static exists(e){return new Zd(void 0,e)}static updateTime(e){return new Zd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ef(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class tf{}function nf(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new df(e.key,Zd.none()):new af(e.key,e.data,Zd.none());{const n=e.data,i=Uu.empty();let s=new Zh(Bl.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),s=s.add(e)}return new cf(e.key,i,new nu(s.toArray()),Zd.none())}}function sf(e,t,n){var i;e instanceof af?function(e,t,n){const i=e.value.clone(),s=hf(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof cf?function(e,t,n){if(!ef(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=hf(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(lf(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):(i=n,t.convertToNoDocument(i.version).setHasCommittedMutations())}function rf(e,t,n,i){return e instanceof af?function(e,t,n,i){if(!ef(e.precondition,t))return n;const s=e.value.clone(),r=uf(e.fieldTransforms,i,t);return s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,i):e instanceof cf?function(e,t,n,i){if(!ef(e.precondition,t))return n;const s=uf(e.fieldTransforms,i,t),r=t.data;return r.setAll(lf(e)),r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,i):(s=t,r=n,ef(e.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):r);var s,r}function of(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||n&&i&&Ml(n,i,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof Kd&&i instanceof Kd||n instanceof Gd&&i instanceof Gd?Ml(n.elements,i.elements,yu):n instanceof Wd&&i instanceof Wd?yu(n.Pe,i.Pe):n instanceof zd&&i instanceof zd);var n,i}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,i}class af extends tf{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class cf extends tf{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function lf(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function hf(e,t,n){const i=new Map;vl(e.length===n.length);for(let s=0;s<n.length;s++){const r=e[s],o=r.transform,a=t.data.field(r.field);i.set(r.field,Bd(o,a,n[s]))}return i}function uf(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,jd(e,r,t))}return i}class df extends tf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ff extends tf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class pf{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&sf(t,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=rf(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=rf(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Od();return this.mutations.forEach((i=>{const s=e.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=t.has(i.key)?null:o;const a=nf(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(Ul.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Ud())}isEqual(e){return this.batchId===e.batchId&&Ml(this.mutations,e.mutations,((e,t)=>of(e,t)))&&Ml(this.baseMutations,e.baseMutations,((e,t)=>of(e,t)))}}class gf{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){vl(e.mutations.length===n.length);let i=function(){return Ld}();const s=e.mutations;for(let r=0;r<s.length;r++)i=i.insert(s[r].key,n[r].version);return new gf(e,t,n,i)}}class mf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}var yf,_f;(_f=yf||(yf={}))[_f.OK=0]="OK",_f[_f.CANCELLED=1]="CANCELLED",_f[_f.UNKNOWN=2]="UNKNOWN",_f[_f.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_f[_f.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_f[_f.NOT_FOUND=5]="NOT_FOUND",_f[_f.ALREADY_EXISTS=6]="ALREADY_EXISTS",_f[_f.PERMISSION_DENIED=7]="PERMISSION_DENIED",_f[_f.UNAUTHENTICATED=16]="UNAUTHENTICATED",_f[_f.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_f[_f.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_f[_f.ABORTED=10]="ABORTED",_f[_f.OUT_OF_RANGE=11]="OUT_OF_RANGE",_f[_f.UNIMPLEMENTED=12]="UNIMPLEMENTED",_f[_f.INTERNAL=13]="INTERNAL",_f[_f.UNAVAILABLE=14]="UNAVAILABLE",_f[_f.DATA_LOSS=15]="DATA_LOSS",new Xc([4294967295,4294967295],0);const vf=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),wf=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),If=(()=>({and:"AND",or:"OR"}))();class bf{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Tf(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Cf(e,t){return Tf(e,t.toTimestamp())}function Ef(e){return vl(!!e),Ul.fromTimestamp(function(e){const t=ou(e);return new Fl(t.seconds,t.nanos)}(e))}function Sf(e,t){return kf(e,t).canonicalString()}function kf(e,t){const n=(i=e,new ql(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===t?n:n.child(t)}function Nf(e){const t=ql.fromString(e);return vl(function(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}(t)),t}function xf(e,t){return Sf(e.databaseId,t.path)}function Af(e,t){const n=Nf(t);if(n.get(1)!==e.databaseId.projectId)throw new bl(Il.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new bl(Il.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new zl(Rf(n))}function Df(e,t){return Sf(e.databaseId,t)}function Pf(e){const t=Nf(e);return 4===t.length?ql.emptyPath():Rf(t)}function Rf(e){return vl(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Of(e,t,n){return{name:xf(e,t),fields:n.value.mapValue.fields}}function Mf(e,t){let n;if(t instanceof af)n={update:Of(e,t.key,t.value)};else if(t instanceof df)n={delete:xf(e,t.key)};else if(t instanceof cf)n={update:Of(e,t.key,t.data),updateMask:Gf(t.fieldMask)};else{if(!(t instanceof ff))return _l();n={verify:xf(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof zd)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Kd)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Gd)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Wd)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw _l()}(0,e)))),t.precondition.isNone||(n.currentDocument=(i=e,void 0!==(s=t.precondition).updateTime?{updateTime:Cf(i,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:_l())),n;var i,s}function Lf(e,t){const n=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?Zd.updateTime(Ef(s.updateTime)):void 0!==s.exists?Zd.exists(s.exists):Zd.none():Zd.none(),i=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)vl("REQUEST_TIME"===t.setToServerValue),n=new zd;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Kd(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Gd(e)}else"increment"in t?n=new Wd(e,t.increment):_l();const i=Bl.fromServerFormat(t.fieldPath);return new Jd(i,n)}(e,t))):[];var s;if(t.update){t.update.name;const s=Af(e,t.update.name),r=new Uu({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new nu(t.map((e=>Bl.fromServerFormat(e))))}(t.updateMask);return new cf(s,r,e,n,i)}return new af(s,r,n,i)}if(t.delete){const i=Af(e,t.delete);return new df(i,n)}if(t.verify){const i=Af(e,t.verify);return new ff(i,n)}return _l()}function Ff(e,t){const n={structuredQuery:{}},i=t.path;let s;null!==t.collectionGroup?(s=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=Df(e,s);const r=function(e){if(0!==e.length)return $f(Hu.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const o=function(e){if(0!==e.length)return e.map((e=>{return{field:zf((t=e).field),direction:qf(t.dir)};var t}))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=function(e,t){return e.useProto3Json||gh(t)?t:{value:t}}(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:s};var c}function Uf(e){let t=Pf(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){vl(1===i);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=Vf(e);return t instanceof Hu&&Yu(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>{return new zu(Kf((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t})));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,gh(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new qu(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new qu(n,t)}(n.endAt)),function(e,t,n,i,s,r,o,a){return new yd(e,t,n,i,s,"F",o,a)}(t,s,o,r,a,0,c,l)}function Vf(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Kf(e.unaryFilter.field);return Gu.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Kf(e.unaryFilter.field);return Gu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Kf(e.unaryFilter.field);return Gu.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Kf(e.unaryFilter.field);return Gu.create(s,"!=",{nullValue:"NULL_VALUE"});default:return _l()}}(e):void 0!==e.fieldFilter?(t=e,Gu.create(Kf(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _l()}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Hu.create(e.compositeFilter.filters.map((e=>Vf(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return _l()}}(e.compositeFilter.op))}(e):_l();var t}function qf(e){return vf[e]}function jf(e){return wf[e]}function Bf(e){return If[e]}function zf(e){return{fieldPath:e.canonicalString()}}function Kf(e){return Bl.fromServerFormat(e.fieldPath)}function $f(e){return e instanceof Gu?function(e){if("=="===e.op){if(Nu(e.value))return{unaryFilter:{field:zf(e.field),op:"IS_NAN"}};if(ku(e.value))return{unaryFilter:{field:zf(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Nu(e.value))return{unaryFilter:{field:zf(e.field),op:"IS_NOT_NAN"}};if(ku(e.value))return{unaryFilter:{field:zf(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zf(e.field),op:jf(e.op),value:e.value}}}(e):e instanceof Hu?function(e){const t=e.getFilters().map((e=>$f(e)));return 1===t.length?t[0]:{compositeFilter:{op:Bf(e.op),filters:t}}}(e):_l()}function Gf(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}class Hf{constructor(e,t,n,i,s=Ul.min(),r=Ul.min(),o=su.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Hf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Hf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Hf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Hf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Wf{constructor(e){this.ct=e}}function Qf(e,t){const n=t.key,i={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Yf(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())i.document={name:xf(s=e.ct,(r=t).key),fields:r.data.value.mapValue.fields,updateTime:Tf(s,r.version.toTimestamp()),createTime:Tf(s,r.createTime.toTimestamp())};else if(t.isNoDocument())i.noDocument={path:n.path.toArray(),readTime:Jf(t.version)};else{if(!t.isUnknownDocument())return _l();i.unknownDocument={path:n.path.toArray(),version:Jf(t.version)}}var s,r;return i}function Yf(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Jf(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Xf(e){const t=new Fl(e.seconds,e.nanoseconds);return Ul.fromTimestamp(t)}function Zf(e,t){const n=(t.baseMutations||[]).map((t=>Lf(e.ct,t)));for(let r=0;r<t.mutations.length-1;++r){const e=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){const n=t.mutations[r+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}const i=t.mutations.map((t=>Lf(e.ct,t))),s=Fl.fromMillis(t.localWriteTimeMs);return new pf(t.batchId,s,n,i)}function ep(e){const t=Xf(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Xf(e.lastLimboFreeSnapshotVersion):Ul.min();let i;return i=void 0!==e.query.documents?(vl(1===(s=e.query).documents.length),wd(function(e){return new yd(e)}(Pf(s.documents[0])))):function(e){return wd(Uf(e))}(e.query),new Hf(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,su.fromBase64String(e.resumeToken));var s}function tp(e,t){const n=Jf(t.snapshotVersion),i=Jf(t.lastLimboFreeSnapshotVersion);let s;s=function(e){return zl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t.target)?function(e,t){return{documents:[Df(e,t.path)]}}(e.ct,t.target):Ff(e.ct,t.target)._t;const r=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:dd(t.target),readTime:n,resumeToken:r,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:s}}function np(e){const t=Uf({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Id(t,t.limit,"L"):t}function ip(e,t){return new mf(t.largestBatchId,Lf(e.ct,t.overlayMutation))}function sp(e,t){const n=t.path.lastSegment();return[e,yh(t.path.popLast()),n]}function rp(e,t,n,i){return{indexId:e,uid:t,sequenceNumber:n,readTime:Jf(i.readTime),documentKey:yh(i.documentKey.path),largestBatchId:i.largestBatchId}}class op{getBundleMetadata(e,t){return ap(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Xf(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return ap(e).put({bundleId:(n=t).id,createTime:Jf(Ef(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return cp(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:np(t.bundledQuery),readTime:Xf(t.readTime)};var t}))}saveNamedQuery(e,t){return cp(e).put({name:(n=t).name,readTime:Jf(Ef(n.readTime)),bundledQuery:n.bundledQuery});var n}}function ap(e){return Hh(e,"bundles")}function cp(e){return Hh(e,"namedQueries")}class lp{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new lp(e,n)}getOverlay(e,t){return hp(e).get(sp(this.userId,t)).next((e=>e?ip(this.serializer,e):null))}getOverlays(e,t){const n=Rd();return th.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const i=[];return n.forEach(((n,s)=>{const r=new mf(t,s);i.push(this.ht(e,r))})),th.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach((e=>i.add(yh(e.getCollectionPath()))));const s=[];return i.forEach((t=>{const i=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);s.push(hp(e).j("collectionPathOverlayIndex",i))})),th.waitFor(s)}getOverlaysForCollection(e,t,n){const i=Rd(),s=yh(t),r=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return hp(e).U("collectionPathOverlayIndex",r).next((e=>{for(const t of e){const e=ip(this.serializer,t);i.set(e.getKey(),e)}return i}))}getOverlaysForCollectionGroup(e,t,n,i){const s=Rd();let r;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return hp(e).J({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=ip(this.serializer,t);s.size()<i||o.largestBatchId===r?(s.set(o.getKey(),o),r=o.largestBatchId):n.done()})).next((()=>s))}ht(e,t){return hp(e).put(function(e,t,n){const[i,s,r]=sp(t,n.mutation.key);return{userId:t,collectionPath:s,documentId:r,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Mf(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function hp(e){return Hh(e,"documentOverlays")}class up{Pt(e){return Hh(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next((e=>{const t=null==e?void 0:e.value;return t?su.fromUint8Array(t):su.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class dp{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(au(e.integerValue));else if("doubleValue"in e){const n=au(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),mh(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=ou(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(cu(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Pu(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Au(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):_l()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const s=e.fields||{};this.dt(t,53);const r="value",o=(null===(i=null===(n=s[r].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(au(o)),this.Vt(r,t),this.Tt(s[r],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),zl.fromName(e).path.forEach((e=>{this.dt(t,60),this.Dt(e,t)}))}dt(e,t){e.At(t)}ft(e){e.At(2)}}function fp(e){if(0===e)return 8;let t=0;return!(e>>4)&&(t+=4,e<<=4),!(e>>6)&&(t+=2,e<<=2),!(e>>7)&&(t+=1),t}function pp(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const i=fp(255&e[n]);if(t+=i,8!==i)break}return t}(e);return Math.ceil(t/8)}dp.vt=new dp;class gp{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ft(e);else if(e<2048)this.Ft(960|e>>>6),this.Ft(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e);else{const e=t.codePointAt(0);this.Ft(240|e>>>18),this.Ft(128|63&e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e)}}this.Mt()}Bt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ot(e);else if(e<2048)this.Ot(960|e>>>6),this.Ot(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e);else{const e=t.codePointAt(0);this.Ot(240|e>>>18),this.Ot(128|63&e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e)}}this.Nt()}kt(e){const t=this.qt(e),n=pp(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),n=pp(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class mp{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class yp{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class _p{constructor(){this.jt=new gp,this.Ht=new mp(this.jt),this.Jt=new yp(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class vp{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new vp(this.indexId,this.documentKey,this.arrayValue,n)}}function wp(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Ip(e.arrayValue,t.arrayValue),0!==n?n:(n=Ip(e.directionalValue,t.directionalValue),0!==n?n:zl.comparator(e.documentKey,t.documentKey)))}function Ip(e,t){for(let n=0;n<e.length&&n<t.length;++n){const i=e[n]-t[n];if(0!==i)return i}return e.length-t.length}class bp{constructor(e){this.Xt=new Zh(((e,t)=>Bl.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const e=t;e.isInequality()?this.Xt=this.Xt.add(e):this.tn.push(e)}}get nn(){return this.Xt.size>1}rn(e){if(vl(e.collectionGroup===this.collectionId),this.nn)return!1;const t=$l(e);if(void 0!==t&&!this.sn(t))return!1;const n=Gl(e);let i=new Set,s=0,r=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){const e=this.Xt.getIterator().getNext();if(!i.has(e.field.canonicalString())){const t=n[s];if(!this.on(e,t)||!this._n(this.en[r++],t))return!1}++s}for(;s<n.length;++s){const e=n[s];if(r>=this.en.length||!this._n(this.en[r++],e))return!1}return!0}an(){if(this.nn)return null;let e=new Zh(Bl.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Hl(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Hl(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Hl(n.field,"asc"===n.dir?0:1)));return new Kl(Kl.UNKNOWN_ID,this.collectionId,t,Wl.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Tp(e){var t,n;if(vl(e instanceof Gu||e instanceof Hu),e instanceof Gu){if(e instanceof ad){const i=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>Gu.create(e.field,"==",t))))||[];return Hu.create(i,"or")}return e}const i=e.filters.map((e=>Tp(e)));return Hu.create(i,e.op)}function Cp(e){if(0===e.getFilters().length)return[];const t=Np(Tp(e));return vl(kp(t)),Ep(t)||Sp(t)?[t]:t.getFilters()}function Ep(e){return e instanceof Gu}function Sp(e){return e instanceof Hu&&Yu(e)}function kp(e){return Ep(e)||Sp(e)||function(e){if(e instanceof Hu&&Qu(e)){for(const t of e.getFilters())if(!Ep(t)&&!Sp(t))return!1;return!0}return!1}(e)}function Np(e){if(vl(e instanceof Gu||e instanceof Hu),e instanceof Gu)return e;if(1===e.filters.length)return Np(e.filters[0]);const t=e.filters.map((e=>Np(e)));let n=Hu.create(t,e.op);return n=Dp(n),kp(n)?n:(vl(n instanceof Hu),vl(Wu(n)),vl(n.filters.length>1),n.filters.reduce(((e,t)=>xp(e,t))))}function xp(e,t){let n;return vl(e instanceof Gu||e instanceof Hu),vl(t instanceof Gu||t instanceof Hu),n=e instanceof Gu?t instanceof Gu?(i=e,s=t,Hu.create([i,s],"and")):Ap(e,t):t instanceof Gu?Ap(t,e):function(e,t){if(vl(e.filters.length>0&&t.filters.length>0),Wu(e)&&Wu(t))return ed(e,t.getFilters());const n=Qu(e)?e:t,i=Qu(e)?t:e,s=n.filters.map((e=>xp(e,i)));return Hu.create(s,"or")}(e,t),Dp(n);var i,s}function Ap(e,t){if(Wu(t))return ed(t,e.getFilters());{const n=t.filters.map((t=>xp(e,t)));return Hu.create(n,"or")}}function Dp(e){if(vl(e instanceof Gu||e instanceof Hu),e instanceof Gu)return e;const t=e.getFilters();if(1===t.length)return Dp(t[0]);if(Ju(e))return e;const n=t.map((e=>Dp(e))),i=[];return n.forEach((t=>{t instanceof Gu?i.push(t):t instanceof Hu&&(t.op===e.op?i.push(...t.filters):i.push(t))})),1===i.length?i[0]:Hu.create(i,e.op)}class Pp{constructor(){this.un=new Rp}addToCollectionParentIndex(e,t){return this.un.add(t),th.resolve()}getCollectionParents(e,t){return th.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return th.resolve()}deleteFieldIndex(e,t){return th.resolve()}deleteAllFieldIndexes(e){return th.resolve()}createTargetIndexes(e,t){return th.resolve()}getDocumentsMatchingTarget(e,t){return th.resolve(null)}getIndexType(e,t){return th.resolve(0)}getFieldIndexes(e,t){return th.resolve([])}getNextCollectionGroupToUpdate(e){return th.resolve(null)}getMinOffset(e,t){return th.resolve(Yl.min())}getMinOffsetFromCollectionGroup(e,t){return th.resolve(Yl.min())}updateCollectionGroup(e,t,n){return th.resolve()}updateIndexEntries(e,t){return th.resolve()}}class Rp{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Zh(ql.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Zh(ql.comparator)).toArray()}}const Op=new Uint8Array(0);class Mp{constructor(e,t){this.databaseId=t,this.cn=new Rp,this.ln=new kd((e=>dd(e)),((e,t)=>fd(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((()=>{this.cn.add(t)}));const s={collectionId:n,parent:yh(i)};return Lp(e).put(s)}return th.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Ll(t),""],!1,!0);return Lp(e).U(i).next((e=>{for(const i of e){if(i.collectionId!==t)break;n.push(wh(i.parent))}return n}))}addFieldIndex(e,t){const n=Up(e),i={indexId:(s=t).indexId,collectionGroup:s.collectionGroup,fields:s.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))};var s;delete i.indexId;const r=n.add(i);if(t.indexState){const n=Vp(e);return r.next((e=>{n.put(rp(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return r.next()}deleteFieldIndex(e,t){const n=Up(e),i=Vp(e),s=Fp(e);return n.delete(t.indexId).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Up(e),n=Fp(e),i=Vp(e);return t.j().next((()=>n.j())).next((()=>i.j()))}createTargetIndexes(e,t){return th.forEach(this.hn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new bp(t).an();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=Fp(e);let i=!0;const s=new Map;return th.forEach(this.hn(t),(t=>this.Pn(e,t).next((e=>{i&&(i=!!e),s.set(t,e)})))).next((()=>{if(i){let e=Ud();const i=[];return th.forEach(s,((s,r)=>{var o;pl("IndexedDbIndexManager",`Using index ${o=s,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${dd(t)}`);const a=function(e,t){const n=$l(t);if(void 0===n)return null;for(const i of pd(e,n.fieldPath))switch(i.op){case"array-contains-any":return i.value.arrayValue.values||[];case"array-contains":return[i.value]}return null}(r,s),c=function(e,t){const n=new Map;for(const i of Gl(t))for(const t of pd(e,i.fieldPath))switch(t.op){case"==":case"in":n.set(i.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(i.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(r,s),l=function(e,t){const n=[];let i=!0;for(const s of Gl(t)){const t=0===s.kind?gd(e,s.fieldPath,e.startAt):md(e,s.fieldPath,e.startAt);n.push(t.value),i&&(i=t.inclusive)}return new qu(n,i)}(r,s),h=function(e,t){const n=[];let i=!0;for(const s of Gl(t)){const t=0===s.kind?md(e,s.fieldPath,e.endAt):gd(e,s.fieldPath,e.endAt);n.push(t.value),i&&(i=t.inclusive)}return new qu(n,i)}(r,s),u=this.In(s,r,l),d=this.In(s,r,h),f=this.Tn(s,r,c),p=this.En(s.indexId,a,u,l.inclusive,d,h.inclusive,f);return th.forEach(p,(s=>n.G(s,t.limit).next((t=>{t.forEach((t=>{const n=zl.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),i.push(n))}))}))))})).next((()=>i))}return th.resolve(null)}))}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:Cp(Hu.create(e.filters,"and")).map((t=>ud(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.ln.set(e,t),t)}En(e,t,n,i,s,r,o){const a=(null!=t?t.length:1)*Math.max(n.length,s.length),c=a/(null!=t?t.length:1),l=[];for(let h=0;h<a;++h){const a=t?this.dn(t[h/c]):Op,u=this.An(e,a,n[h%c],i),d=this.Rn(e,a,s[h%c],r),f=o.map((t=>this.An(e,a,t,!0)));l.push(...this.createRange(u,d,f))}return l}An(e,t,n,i){const s=new vp(e,zl.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){const s=new vp(e,zl.empty(),t,n);return i?s.Zt():s}Pn(e,t){const n=new bp(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next((e=>{let t=null;for(const i of e)n.rn(i)&&(!t||i.fields.length>t.fields.length)&&(t=i);return t}))}getIndexType(e,t){let n=2;const i=this.hn(t);return th.forEach(i,(t=>this.Pn(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Zh(Bl.comparator),n=!1;for(const i of e.filters)for(const e of i.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const i of e.orderBy)i.field.isKeyField()||(t=t.add(i.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>null!==t.limit&&i.length>1&&2===n?1:n))}Vn(e,t){const n=new _p;for(const i of Gl(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;const s=n.Yt(i.kind);dp.vt.It(e,s)}return n.zt()}dn(e){const t=new _p;return dp.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new _p;return dp.vt.It(Cu(this.databaseId,t),n.Yt(function(e){const t=Gl(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let i=[];i.push(new _p);let s=0;for(const r of Gl(e)){const e=n[s++];for(const n of i)if(this.fn(t,r.fieldPath)&&Su(e))i=this.gn(i,r,e);else{const t=n.Yt(r.kind);dp.vt.It(e,t)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const i=[...e],s=[];for(const r of n.arrayValue.values||[])for(const e of i){const n=new _p;n.seed(e.zt()),dp.vt.It(r,n.Yt(t.kind)),s.push(n)}return s}fn(e,t){return!!e.filters.find((e=>e instanceof Gu&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Up(e),i=Vp(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next((e=>{const t=[];return th.forEach(e,(e=>i.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Wl(t.sequenceNumber,new Yl(Xf(t.readTime),new zl(wh(t.documentKey)),t.largestBatchId)):Wl.empty(),i=e.fields.map((([e,t])=>new Hl(Bl.fromServerFormat(e),t)));return new Kl(e.indexId,e.collectionGroup,i,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Ol(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const i=Up(e),s=Vp(e);return this.yn(e).next((e=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>th.forEach(t,(t=>s.put(rp(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return th.forEach(t,((t,i)=>{const s=n.get(t.collectionGroup);return(s?th.resolve(s):this.getFieldIndexes(e,t.collectionGroup)).next((s=>(n.set(t.collectionGroup,s),th.forEach(s,(n=>this.wn(e,t,n).next((t=>{const s=this.Sn(i,n);return t.isEqual(s)?th.resolve():this.bn(e,i,n,t,s)})))))))}))}Dn(e,t,n,i){return Fp(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return Fp(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const i=Fp(e);let s=new Zh(wp);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},((e,i)=>{s=s.add(new vp(n.indexId,t,i.arrayValue,i.directionalValue))})).next((()=>s))}Sn(e,t){let n=new Zh(wp);const i=this.Vn(t,e);if(null==i)return n;const s=$l(t);if(null!=s){const r=e.data.field(s.fieldPath);if(Su(r))for(const s of r.arrayValue.values||[])n=n.add(new vp(t.indexId,e.key,this.dn(s),i))}else n=n.add(new vp(t.indexId,e.key,Op,i));return n}bn(e,t,n,i,s){pl("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const r=[];return function(e,t,n,i,s){const r=e.getIterator(),o=t.getIterator();let a=tu(r),c=tu(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const i=n(a,c);i<0?t=!0:i>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(i(c),c=tu(o)):t?(s(a),a=tu(r)):(a=tu(r),c=tu(o))}}(i,s,wp,(i=>{r.push(this.Dn(e,t,n,i))}),(i=>{r.push(this.vn(e,t,n,i))})),th.waitFor(r)}yn(e){let t=1;return Vp(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,i)=>{i.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>wp(e,t))).filter(((e,t,n)=>!t||0!==wp(e,n[t-1])));const i=[];i.push(e);for(const r of n){const n=wp(r,e),s=wp(r,t);if(0===n)i[0]=e.Zt();else if(n>0&&s<0)i.push(r),i.push(r.Zt());else if(s>0)break}i.push(t);const s=[];for(let r=0;r<i.length;r+=2){if(this.Cn(i[r],i[r+1]))return[];const e=[i[r].indexId,this.uid,i[r].arrayValue,i[r].directionalValue,Op,[]],t=[i[r+1].indexId,this.uid,i[r+1].arrayValue,i[r+1].directionalValue,Op,[]];s.push(IDBKeyRange.bound(e,t))}return s}Cn(e,t){return wp(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(qp)}getMinOffset(e,t){return th.mapArray(this.hn(t),(t=>this.Pn(e,t).next((e=>e||_l())))).next(qp)}}function Lp(e){return Hh(e,"collectionParents")}function Fp(e){return Hh(e,"indexEntries")}function Up(e){return Hh(e,"indexConfiguration")}function Vp(e){return Hh(e,"indexState")}function qp(e){vl(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){const s=e[i].indexState.offset;Jl(s,t)<0&&(t=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new Yl(t.readTime,t.documentKey,n)}const jp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Bp{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Bp(e,Bp.DEFAULT_COLLECTION_PERCENTILE,Bp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function zp(e,t,n){const i=e.store("mutations"),s=e.store("documentMutations"),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=i.J({range:o},((e,t,n)=>(a++,n.delete())));r.push(c.next((()=>{vl(1===a)})));const l=[];for(const h of n.mutations){const e=Th(t,h.key.path,n.batchId);r.push(s.delete(e)),l.push(h.key)}return th.waitFor(r).next((()=>l))}function Kp(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw _l();t=e.noDocument}return JSON.stringify(t).length}Bp.DEFAULT_COLLECTION_PERCENTILE=10,Bp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bp.DEFAULT=new Bp(41943040,Bp.DEFAULT_COLLECTION_PERCENTILE,Bp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bp.DISABLED=new Bp(-1,0,0);class $p{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){vl(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new $p(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hp(e).J({index:"userMutationsIndex",range:n},((e,n,i)=>{t=!1,i.done()})).next((()=>t))}addMutationBatch(e,t,n,i){const s=Wp(e),r=Hp(e);return r.add({}).next((o=>{vl("number"==typeof o);const a=new pf(o,t,n,i),c=function(e,t,n){const i=n.baseMutations.map((t=>Mf(e.ct,t))),s=n.mutations.map((t=>Mf(e.ct,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:i,mutations:s}}(this.serializer,this.userId,a),l=[];let h=new Zh(((e,t)=>Ol(e.canonicalString(),t.canonicalString())));for(const e of i){const t=Th(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),l.push(r.put(c)),l.push(s.put(t,Ch))}return h.forEach((t=>{l.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Fn[o]=a.keys()})),th.waitFor(l).next((()=>a))}))}lookupMutationBatch(e,t){return Hp(e).get(t).next((e=>e?(vl(e.userId===this.userId),Zf(this.serializer,e)):null))}Mn(e,t){return this.Fn[t]?th.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Fn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Hp(e).J({index:"userMutationsIndex",range:i},((e,t,i)=>{t.userId===this.userId&&(vl(t.batchId>=n),s=Zf(this.serializer,t)),i.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Hp(e).J({index:"userMutationsIndex",range:t,reverse:!0},((e,t,i)=>{n=t.batchId,i.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Hp(e).U("userMutationsIndex",t).next((e=>e.map((e=>Zf(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=bh(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return Wp(e).J({range:i},((n,i,r)=>{const[o,a,c]=n,l=wh(a);if(o===this.userId&&t.path.isEqual(l))return Hp(e).get(c).next((e=>{if(!e)throw _l();vl(e.userId===this.userId),s.push(Zf(this.serializer,e))}));r.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Zh(Ol);const i=[];return t.forEach((t=>{const s=bh(this.userId,t.path),r=IDBKeyRange.lowerBound(s),o=Wp(e).J({range:r},((e,i,s)=>{const[r,o,a]=e,c=wh(o);r===this.userId&&t.path.isEqual(c)?n=n.add(a):s.done()}));i.push(o)})),th.waitFor(i).next((()=>this.xn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=bh(this.userId,n),r=IDBKeyRange.lowerBound(s);let o=new Zh(Ol);return Wp(e).J({range:r},((e,t,s)=>{const[r,a,c]=e,l=wh(a);r===this.userId&&n.isPrefixOf(l)?l.length===i&&(o=o.add(c)):s.done()})).next((()=>this.xn(e,o)))}xn(e,t){const n=[],i=[];return t.forEach((t=>{i.push(Hp(e).get(t).next((e=>{if(null===e)throw _l();vl(e.userId===this.userId),n.push(Zf(this.serializer,e))})))})),th.waitFor(i).next((()=>n))}removeMutationBatch(e,t){return zp(e._e,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.On(t.batchId)})),th.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return th.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),i=[];return Wp(e).J({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=wh(e[1]);i.push(t)}else n.done()})).next((()=>{vl(0===i.length)}))}))}containsKey(e,t){return Gp(e,this.userId,t)}Nn(e){return Qp(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Gp(e,t,n){const i=bh(t,n.path),s=i[1],r=IDBKeyRange.lowerBound(i);let o=!1;return Wp(e).J({range:r,H:!0},((e,n,i)=>{const[r,a,c]=e;r===t&&a===s&&(o=!0),i.done()})).next((()=>o))}function Hp(e){return Hh(e,"mutations")}function Wp(e){return Hh(e,"documentMutations")}function Qp(e){return Hh(e,"mutationQueues")}class Yp{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Yp(0)}static kn(){return new Yp(-1)}}class Jp{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next((t=>{const n=new Yp(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.qn(e).next((e=>Ul.fromTimestamp(new Fl(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.qn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.qn(e).next((i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i))))}addTargetData(e,t){return this.Kn(e,t).next((()=>this.qn(e).next((n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Xp(e).delete(t.targetId))).next((()=>this.qn(e))).next((t=>(vl(t.targetCount>0),t.targetCount-=1,this.Qn(e,t))))}removeTargets(e,t,n){let i=0;const s=[];return Xp(e).J(((r,o)=>{const a=ep(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(i++,s.push(this.removeTargetData(e,a)))})).next((()=>th.waitFor(s))).next((()=>i))}forEachTarget(e,t){return Xp(e).J(((e,n)=>{const i=ep(n);t(i)}))}qn(e){return Zp(e).get("targetGlobalKey").next((e=>(vl(null!==e),e)))}Qn(e,t){return Zp(e).put("targetGlobalKey",t)}Kn(e,t){return Xp(e).put(tp(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=dd(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Xp(e).J({range:i,index:"queryTargetsIndex"},((e,n,i)=>{const r=ep(n);fd(t,r.target)&&(s=r,i.done())})).next((()=>s))}addMatchingKeys(e,t,n){const i=[],s=eg(e);return t.forEach((t=>{const r=yh(t.path);i.push(s.put({targetId:n,path:r})),i.push(this.referenceDelegate.addReference(e,n,t))})),th.waitFor(i)}removeMatchingKeys(e,t,n){const i=eg(e);return th.forEach(t,(t=>{const s=yh(t.path);return th.waitFor([i.delete([n,s]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=eg(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=eg(e);let s=Ud();return i.J({range:n,H:!0},((e,t,n)=>{const i=wh(e[1]),r=new zl(i);s=s.add(r)})).next((()=>s))}containsKey(e,t){const n=yh(t.path),i=IDBKeyRange.bound([n],[Ll(n)],!1,!0);let s=0;return eg(e).J({index:"documentTargetsIndex",H:!0,range:i},(([e,t],n,i)=>{0!==e&&(s++,i.done())})).next((()=>s>0))}ot(e,t){return Xp(e).get(t).next((e=>e?ep(e):null))}}function Xp(e){return Hh(e,"targets")}function Zp(e){return Hh(e,"targetGlobal")}function eg(e){return Hh(e,"targetDocuments")}function tg([e,t],[n,i]){const s=Ol(e,n);return 0===s?Ol(t,i):s}class ng{constructor(e){this.Un=e,this.buffer=new Zh(tg),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();tg(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ig{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){pl("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ah(e)?pl("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await eh(e)}await this.Hn(3e5)}))}}class sg{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return th.resolve(ph.oe);const n=new ng(t);return this.Jn.forEachTarget(e,(e=>n.zn(e.sequenceNumber))).next((()=>this.Jn.Zn(e,(e=>n.zn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(pl("LruGarbageCollector","Garbage collection skipped; disabled"),th.resolve(jp)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(pl("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),jp):this.Xn(e,t)))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,r,o,a,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(pl("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,r=Date.now(),this.nthSequenceNumber(e,i)))).next((i=>(n=i,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),fl()<=Z.DEBUG&&pl("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-l}ms\n\tDetermined least recently used ${i} in `+(o-r)+`ms\n\tRemoved ${s} targets in `+(a-o)+`ms\n\tRemoved ${e} documents in `+(c-a)+`ms\nTotal Duration: ${c-l}ms`),th.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e}))))}}class rg{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new sg(e,t)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}er(e){let t=0;return this.Zn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,((e,n)=>t(n)))}addReference(e,t,n){return og(e,n)}removeReference(e,t,n){return og(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return og(e,t)}nr(e,t){return function(e,t){let n=!1;return Qp(e).Y((i=>Gp(e,i,t).next((e=>(e&&(n=!0),th.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,((r,o)=>{if(o<=t){const t=this.nr(e,r).next((t=>{if(!t)return s++,n.getEntry(e,r).next((()=>(n.removeEntry(r,Ul.min()),eg(e).delete([0,yh(r.path)]))))}));i.push(t)}})).next((()=>th.waitFor(i))).next((()=>n.apply(e))).next((()=>s))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return og(e,t)}tr(e,t){const n=eg(e);let i,s=ph.oe;return n.J({index:"documentTargetsIndex"},(([e,n],{path:r,sequenceNumber:o})=>{0===e?(s!==ph.oe&&t(new zl(wh(i)),s),s=o,i=r):s=ph.oe})).next((()=>{s!==ph.oe&&t(new zl(wh(i)),s)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function og(e,t){return eg(e).put((n=t,i=e.currentSequenceNumber,{targetId:0,path:yh(n.path),sequenceNumber:i}));var n,i}class ag{constructor(){this.changes=new kd((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Vu.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?th.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return dg(e).put(n)}removeEntry(e,t,n){return dg(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Yf(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.rr(e,n))))}getEntry(e,t){let n=Vu.newInvalidDocument(t);return dg(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(fg(t))},((e,i)=>{n=this.ir(t,i)})).next((()=>n))}sr(e,t){let n={size:0,document:Vu.newInvalidDocument(t)};return dg(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(fg(t))},((e,i)=>{n={document:this.ir(t,i),size:Kp(i)}})).next((()=>n))}getEntries(e,t){let n=xd();return this._r(e,t,((e,t)=>{const i=this.ir(e,t);n=n.insert(e,i)})).next((()=>n))}ar(e,t){let n=xd(),i=new Yh(zl.comparator);return this._r(e,t,((e,t)=>{const s=this.ir(e,t);n=n.insert(e,s),i=i.insert(e,Kp(t))})).next((()=>({documents:n,ur:i})))}_r(e,t,n){if(t.isEmpty())return th.resolve();let i=new Zh(gg);t.forEach((e=>i=i.add(e)));const s=IDBKeyRange.bound(fg(i.first()),fg(i.last())),r=i.getIterator();let o=r.getNext();return dg(e).J({index:"documentKeyIndex",range:s},((e,t,i)=>{const s=zl.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&gg(o,s)<0;)n(o,null),o=r.getNext();o&&o.isEqual(s)&&(n(o,t),o=r.hasNext()?r.getNext():null),o?i.$(fg(o)):i.done()})).next((()=>{for(;o;)n(o,null),o=r.hasNext()?r.getNext():null}))}getDocumentsMatchingQuery(e,t,n,i,s){const r=t.path,o=[r.popLast().toArray(),r.lastSegment(),Yf(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dg(e).U(IDBKeyRange.bound(o,a,!0)).next((e=>{null==s||s.incrementDocumentReadCount(e.length);let n=xd();for(const s of e){const e=this.ir(zl.fromSegments(s.prefixPath.concat(s.collectionGroup,s.documentId)),s);e.isFoundDocument()&&(Ed(t,e)||i.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,i){let s=xd();const r=pg(t,n),o=pg(t,Yl.max());return dg(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,o,!0)},((e,t,n)=>{const r=this.ir(zl.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()})).next((()=>s))}newChangeBuffer(e){return new hg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return ug(e).get("remoteDocumentGlobalKey").next((e=>(vl(!!e),e)))}rr(e,t){return ug(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const e=function(e,t){let n;if(t.document)n=function(e,t,n){const i=Af(e,t.name),s=Ef(t.updateTime),r=t.createTime?Ef(t.createTime):Ul.min(),o=new Uu({mapValue:{fields:t.fields}}),a=Vu.newFoundDocument(i,s,r,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=zl.fromSegments(t.noDocument.path),i=Xf(t.noDocument.readTime);n=Vu.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return _l();{const e=zl.fromSegments(t.unknownDocument.path),i=Xf(t.unknownDocument.version);n=Vu.newUnknownDocument(e,i)}}return t.readTime&&n.setReadTime(function(e){const t=new Fl(e[0],e[1]);return Ul.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Ul.min()))return e}return Vu.newInvalidDocument(e)}}function lg(e){return new cg(e)}class hg extends ag{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new kd((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,i=new Zh(((e,t)=>Ol(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((s,r)=>{const o=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,o.readTime)),r.isValidDocument()){const a=Qf(this.cr.serializer,r);i=i.add(s.path.popLast());const c=Kp(a);n+=c-o.size,t.push(this.cr.addEntry(e,s,a))}else if(n-=o.size,this.trackRemovals){const n=Qf(this.cr.serializer,r.convertToNoDocument(Ul.min()));t.push(this.cr.addEntry(e,s,n))}})),i.forEach((n=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.cr.updateMetadata(e,n)),th.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next((e=>(this.lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.cr.ar(e,t).next((({documents:e,ur:t})=>(t.forEach(((t,n)=>{this.lr.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function ug(e){return Hh(e,"remoteDocumentGlobal")}function dg(e){return Hh(e,"remoteDocumentsV14")}function fg(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function pg(e,t){const n=t.documentKey.path.toArray();return[e,Yf(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function gg(e,t){const n=e.path.toArray(),i=t.path.toArray();let s=0;for(let r=0;r<n.length-2&&r<i.length-2;++r)if(s=Ol(n[r],i[r]),s)return s;return s=Ol(n.length,i.length),s||(s=Ol(n[n.length-2],i[i.length-2]),s||Ol(n[n.length-1],i[i.length-1]))}class mg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class yg{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&rf(n.mutation,e,nu.empty(),Fl.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Ud()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Ud()){const i=Rd();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((e=>{let t=Dd();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Rd();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Ud())))}populateOverlays(e,t,n){const i=[];return n.forEach((e=>{t.has(e)||i.push(e)})),this.documentOverlayCache.getOverlays(e,i).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,i){let s=xd();const r=Md(),o=Md();return t.forEach(((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof cf)?s=s.insert(t.key,t):void 0!==o?(r.set(t.key,o.mutation.getFieldMask()),rf(o.mutation,t,o.mutation.getFieldMask(),Fl.now())):r.set(t.key,nu.empty())})),this.recalculateAndSaveOverlays(e,s).next((e=>(e.forEach(((e,t)=>r.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new mg(t,null!==(n=r.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Md();let i=new Yh(((e,t)=>e-t)),s=Ud();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const s of e)s.keys().forEach((e=>{const r=t.get(e);if(null===r)return;let o=n.get(e)||nu.empty();o=s.applyToLocalView(r,o),n.set(e,o);const a=(i.get(s.batchId)||Ud()).add(e);i=i.insert(s.batchId,a)}))})).next((()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,l=Od();c.forEach((e=>{if(!s.has(e)){const i=nf(t.get(e),n.get(e));null!==i&&l.set(e,i),s=s.add(e)}})),r.push(this.documentOverlayCache.saveOverlays(e,a,l))}return th.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,i){return s=t,zl.isDocumentKey(s.path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var s}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):th.resolve(Rd());let o=-1,a=s;return r.next((t=>th.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?th.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,s))).next((()=>this.computeViews(e,a,t,Ud()))).next((e=>({batchId:o,changes:Pd(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new zl(t)).next((e=>{let t=Dd();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let r=Dd();return this.indexManager.getCollectionParents(e,s).next((o=>th.forEach(o,(o=>{const a=(c=t,l=o.child(s),new yd(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,a,n,i).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i)))).next((e=>{s.forEach(((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,Vu.newInvalidDocument(i)))}));let n=Dd();return e.forEach(((e,i)=>{const r=s.get(e);void 0!==r&&rf(r.mutation,i,nu.empty(),Fl.now()),Ed(t,i)&&(n=n.insert(e,i))})),n}))}}class _g{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return th.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(n=t).id,version:n.version,createTime:Ef(n.createTime)}),th.resolve();var n}getNamedQuery(e,t){return th.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(n=t).name,query:np(n.bundledQuery),readTime:Ef(n.readTime)}),th.resolve();var n}}class vg{constructor(){this.overlays=new Yh(zl.comparator),this.Ir=new Map}getOverlay(e,t){return th.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Rd();return th.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,i)=>{this.ht(e,t,i)})),th.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.Ir.delete(n)),th.resolve()}getOverlaysForCollection(e,t,n){const i=Rd(),s=t.length+1,r=new zl(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return th.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Yh(((e,t)=>e-t));const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Rd(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Rd(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=i)););return th.resolve(o)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new mf(t,n));let s=this.Ir.get(t);void 0===s&&(s=Ud(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}}class wg{constructor(){this.sessionToken=su.EMPTY_BYTE_STRING}getSessionToken(e){return th.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,th.resolve()}}class Ig{constructor(){this.Tr=new Zh(bg.Er),this.dr=new Zh(bg.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new bg(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Vr(new bg(e,t))}mr(e,t){e.forEach((e=>this.removeReference(e,t)))}gr(e){const t=new zl(new ql([])),n=new bg(t,e),i=new bg(t,e+1),s=[];return this.dr.forEachInRange([n,i],(e=>{this.Vr(e),s.push(e.key)})),s}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new zl(new ql([])),n=new bg(t,e),i=new bg(t,e+1);let s=Ud();return this.dr.forEachInRange([n,i],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new bg(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class bg{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return zl.comparator(e.key,t.key)||Ol(e.wr,t.wr)}static Ar(e,t){return Ol(e.wr,t.wr)||zl.comparator(e.key,t.key)}}class Tg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Zh(bg.Er)}checkEmpty(e){return th.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new pf(s,t,n,i);this.mutationQueue.push(r);for(const o of i)this.br=this.br.add(new bg(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return th.resolve(r)}lookupMutationBatch(e,t){return th.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.vr(n),s=i<0?0:i;return th.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return th.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return th.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new bg(t,0),i=new bg(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],(e=>{const t=this.Dr(e.wr);s.push(t)})),th.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Zh(Ol);return t.forEach((e=>{const t=new bg(e,0),i=new bg(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,i],(e=>{n=n.add(e.wr)}))})),th.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;zl.isDocumentKey(s)||(s=s.child(""));const r=new bg(new zl(s),0);let o=new Zh(Ol);return this.br.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.wr)),!0)}),r),th.resolve(this.Cr(o))}Cr(e){const t=[];return e.forEach((e=>{const n=this.Dr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){vl(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return th.forEach(t.mutations,(i=>{const s=new bg(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.br=n}))}On(e){}containsKey(e,t){const n=new bg(t,0),i=this.br.firstAfterOrEqual(n);return th.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,th.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Cg{constructor(e){this.Mr=e,this.docs=new Yh(zl.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return th.resolve(n?n.document.mutableCopy():Vu.newInvalidDocument(t))}getEntries(e,t){let n=xd();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Vu.newInvalidDocument(e))})),th.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=xd();const r=t.path,o=new zl(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||Jl(Ql(o),n)<=0||(i.has(o.key)||Ed(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return th.resolve(s)}getAllFromCollectionGroup(e,t,n,i){_l()}Or(e,t){return th.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Eg(this)}getSize(e){return th.resolve(this.size)}}class Eg extends ag{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)})),th.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Sg{constructor(e){this.persistence=e,this.Nr=new kd((e=>dd(e)),fd),this.lastRemoteSnapshotVersion=Ul.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ig,this.targetCount=0,this.kr=Yp.Bn()}forEachTarget(e,t){return this.Nr.forEach(((e,n)=>t(n))),th.resolve()}getLastRemoteSnapshotVersion(e){return th.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return th.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),th.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),th.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Yp(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,th.resolve()}updateTargetData(e,t){return this.Kn(t),th.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,th.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Nr.forEach(((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Nr.delete(r),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),th.waitFor(s).next((()=>i))}getTargetCount(e){return th.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return th.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),th.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((t=>{s.push(i.markPotentiallyOrphaned(e,t))})),th.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),th.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return th.resolve(n)}containsKey(e,t){return th.resolve(this.Br.containsKey(t))}}class kg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ph(0),this.Kr=!1,this.Kr=!0,this.$r=new wg,this.referenceDelegate=e(this),this.Ur=new Sg(this),this.indexManager=new Pp,this.remoteDocumentCache=new Cg((e=>this.referenceDelegate.Wr(e))),this.serializer=new Wf(t),this.Gr=new _g(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new vg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Tg(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){pl("MemoryPersistence","Starting transaction:",e);const i=new Ng(this.Qr.next());return this.referenceDelegate.zr(),n(i).next((e=>this.referenceDelegate.jr(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}Hr(e,t){return th.or(Object.values(this.qr).map((n=>()=>n.containsKey(e,t))))}}class Ng extends Zl{constructor(e){super(),this.currentSequenceNumber=e}}class xg{constructor(e){this.persistence=e,this.Jr=new Ig,this.Yr=null}static Zr(e){return new xg(e)}get Xr(){if(this.Yr)return this.Yr;throw _l()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),th.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),th.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),th.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((e=>this.Xr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Xr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return th.forEach(this.Xr,(n=>{const i=zl.fromPath(n);return this.ei(e,i).next((e=>{e||t.removeEntry(i,Ul.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return th.or([()=>th.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Ag{constructor(e){this.serializer=e}O(e,t,n,i){const s=new nh("createOrUpgrade",t);var r;n<1&&i>=1&&(e.createObjectStore("owner"),(r=e).createObjectStore("mutationQueues",{keyPath:"userId"}),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ih,{unique:!0}),r.createObjectStore("documentMutations"),Dg(e),function(e){e.createObjectStore("remoteDocuments")}(e));let o=th.resolve();return n<3&&i>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Dg(e)),o=o.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ul.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(s)))),n<4&&i>=4&&(0!==n&&(o=o.next((()=>function(e,t){return t.store("mutations").U().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ih,{unique:!0});const i=t.store("mutations"),s=n.map((e=>i.put(e)));return th.waitFor(s)}))}(e,s)))),o=o.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&i>=5&&(o=o.next((()=>this.ni(s)))),n<6&&i>=6&&(o=o.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s))))),n<7&&i>=7&&(o=o.next((()=>this.ii(s)))),n<8&&i>=8&&(o=o.next((()=>this.si(e,s)))),n<9&&i>=9&&(o=o.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&i>=10&&(o=o.next((()=>this.oi(s)))),n<11&&i>=11&&(o=o.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&i>=12&&(o=o.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Lh});t.createIndex("collectionPathOverlayIndex",Fh,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Uh,{unique:!1})}(e)}))),n<13&&i>=13&&(o=o.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Eh});t.createIndex("documentKeyIndex",Sh),t.createIndex("collectionGroupIndex",kh)}(e))).next((()=>this._i(e,s))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&i>=14&&(o=o.next((()=>this.ai(e,s)))),n<15&&i>=15&&(o=o.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ph}).createIndex("sequenceNumberIndex",Rh,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Oh}).createIndex("documentKeyIndex",Mh,{unique:!1})}(e)))),n<16&&i>=16&&(o=o.next((()=>{t.objectStore("indexState").clear()})).next((()=>{t.objectStore("indexEntries").clear()}))),n<17&&i>=17&&(o=o.next((()=>{!function(e){e.createObjectStore("globals",{keyPath:"name"})}(e)}))),o}ri(e){let t=0;return e.store("remoteDocuments").J(((e,n)=>{t+=Kp(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next((t=>th.forEach(t,(t=>{const i=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",i).next((n=>th.forEach(n,(n=>{vl(n.userId===t.userId);const i=Zf(this.serializer,n);return zp(e,t.userId,i).next((()=>{}))}))))}))))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const i=[];return n.J(((n,s)=>{const r=new ql(n),o=[0,yh(r)];i.push(t.get(o).next((n=>{return n?th.resolve():(i=r,t.put({targetId:0,path:yh(i),sequenceNumber:e.highestListenSequenceNumber}));var i})))})).next((()=>th.waitFor(i)))}))}si(e,t){e.createObjectStore("collectionParents",{keyPath:Dh});const n=t.store("collectionParents"),i=new Rp,s=e=>{if(i.add(e)){const t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:yh(i)})}};return t.store("remoteDocuments").J({H:!0},((e,t)=>{const n=new ql(e);return s(n.popLast())})).next((()=>t.store("documentMutations").J({H:!0},(([e,t,n],i)=>{const r=wh(t);return s(r.popLast())}))))}oi(e){const t=e.store("targets");return t.J(((e,n)=>{const i=ep(n),s=tp(this.serializer,i);return t.put(s)}))}_i(e,t){const n=t.store("remoteDocuments"),i=[];return n.J(((e,n)=>{const s=t.store("remoteDocumentsV14"),r=(a=n,a.document?new zl(ql.fromString(a.document.name).popFirst(5)):a.noDocument?zl.fromSegments(a.noDocument.path):a.unknownDocument?zl.fromSegments(a.unknownDocument.path):_l()).path.toArray(),o={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};var a;i.push(s.put(o))})).next((()=>th.waitFor(i)))}ai(e,t){const n=t.store("mutations"),i=lg(this.serializer),s=new kg(xg.Zr,this.serializer.ct);return n.U().next((e=>{const n=new Map;return e.forEach((e=>{var t;let i=null!==(t=n.get(e.userId))&&void 0!==t?t:Ud();Zf(this.serializer,e).keys().forEach((e=>i=i.add(e))),n.set(e.userId,i)})),th.forEach(n,((e,n)=>{const r=new hl(n),o=lp.lt(this.serializer,r),a=s.getIndexManager(r),c=$p.lt(r,this.serializer,a,s.referenceDelegate);return new yg(i,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new Gh(t,ph.oe),e).next()}))}))}}function Dg(e){e.createObjectStore("targetDocuments",{keyPath:xh}).createIndex("documentTargetsIndex",Ah,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Nh,{unique:!0}),e.createObjectStore("targetGlobal")}const Pg="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Rg{constructor(e,t,n,i,s,r,o,a,c,l,h=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=r,this.document=o,this.ci=c,this.li=l,this.hi=h,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=e=>Promise.resolve(),!Rg.D())throw new bl(Il.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new rg(this,i),this.Ai=t+"main",this.serializer=new Wf(a),this.Ri=new ih(this.Ai,this.hi,new Ag(this.serializer)),this.$r=new up,this.Ur=new Jp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=lg(this.serializer),this.Gr=new op,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===l&&gl("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new bl(Il.FAILED_PRECONDITION,Pg);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Ur.getHighestSequenceNumber(e)))})).then((e=>{this.Qr=new ph(e,this.ci)})).then((()=>{this.Kr=!0})).catch((e=>(this.Ri&&this.Ri.close(),Promise.reject(e))))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Mg(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.wi(e).next((e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable((()=>this.di(!1))))}))})).next((()=>this.Si(e))).next((t=>this.isPrimary&&!t?this.bi(e).next((()=>!1)):!!t&&this.Di(e).next((()=>!0)))))).catch((e=>{if(ah(e))return pl("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return pl("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ui.enqueueRetryable((()=>this.di(e))),this.isPrimary=e}))}wi(e){return Og(e).get("owner").next((e=>th.resolve(this.vi(e))))}Ci(e){return Mg(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Hh(e,"clientMetadata");return t.U().next((e=>{const n=this.xi(e,18e5),i=e.filter((e=>-1===n.indexOf(e)));return th.forEach(i,(e=>t.delete(e.clientId))).next((()=>i))}))})).catch((()=>[]));if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.Fi())).then((()=>this.pi()))))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?th.resolve(!0):Og(e).get("owner").next((t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new bl(Il.FAILED_PRECONDITION,Pg);return!1}}return!(!this.networkEnabled||!this.inForeground)||Mg(e).U().next((e=>void 0===this.xi(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,i=this.networkEnabled===e.networkEnabled;if(t||n&&i)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&pl("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Gh(e,ph.oe);return this.bi(t).next((()=>this.Ci(t)))})),this.Ri.close(),this.qi()}xi(e,t){return e.filter((e=>this.Mi(e.updateTimeMs,t)&&!this.Ni(e.clientId)))}Qi(){return this.runTransaction("getActiveClients","readonly",(e=>Mg(e).U().next((e=>this.xi(e,18e5).map((e=>e.clientId))))))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return $p.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Mp(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return lp.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){pl("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(r=this.hi)?$h:16===r?Kh:15===r?zh:14===r?Bh:13===r?jh:12===r?qh:11===r?Vh:void _l();var r;let o;return this.Ri.runTransaction(e,i,s,(i=>(o=new Gh(i,this.Qr?this.Qr.next():ph.oe),"readwrite-primary"===t?this.wi(o).next((e=>!!e||this.Si(o))).next((t=>{if(!t)throw gl(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable((()=>this.di(!1))),new bl(Il.FAILED_PRECONDITION,Xl);return n(o)})).next((e=>this.Di(o).next((()=>e)))):this.Ki(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Ki(e){return Og(e).get("owner").next((e=>{if(null!==e&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new bl(Il.FAILED_PRECONDITION,Pg)}))}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Og(e).put("owner",t)}static D(){return ih.D()}bi(e){const t=Og(e);return t.get("owner").next((e=>this.vi(e)?(pl("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):th.resolve()))}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(gl(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const e=/(?:Version|Mobile)\/1[456]/;S()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return pl("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return gl("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){gl("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch(e){}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Og(e){return Hh(e,"owner")}function Mg(e){return Hh(e,"clientMetadata")}class Lg{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=Ud(),i=Ud();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Lg(e,t.fromCache,n,i)}}class Fg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ug{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=S()?8:sh(b())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Yi(e,t).next((e=>{s.result=e})).next((()=>{if(!s.result)return this.Zi(e,t,i,n).next((e=>{s.result=e}))})).next((()=>{if(s.result)return;const n=new Fg;return this.Xi(e,t,n).next((i=>{if(s.result=i,this.zi)return this.es(e,t,n,i.size)}))})).next((()=>s.result))}es(e,t,n,i){return n.documentReadCount<this.ji?(fl()<=Z.DEBUG&&pl("QueryEngine","SDK will not create cache indexes for query:",Cd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),th.resolve()):(fl()<=Z.DEBUG&&pl("QueryEngine","Query:",Cd(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(fl()<=Z.DEBUG&&pl("QueryEngine","The SDK decides to create cache indexes for query:",Cd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wd(t))):th.resolve())}Yi(e,t){if(_d(t))return th.resolve(null);let n=wd(t);return this.indexManager.getIndexType(e,n).next((i=>0===i?null:(null!==t.limit&&1===i&&(t=Id(t,null,"F"),n=wd(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((i=>{const s=Ud(...i);return this.Ji.getDocuments(e,s).next((i=>this.indexManager.getMinOffset(e,n).next((n=>{const r=this.ts(t,i);return this.ns(t,r,s,n.readTime)?this.Yi(e,Id(t,null,"F")):this.rs(e,r,t,n)}))))})))))}Zi(e,t,n,i){return _d(t)||i.isEqual(Ul.min())?th.resolve(null):this.Ji.getDocuments(e,n).next((s=>{const r=this.ts(t,s);return this.ns(t,r,n,i)?th.resolve(null):(fl()<=Z.DEBUG&&pl("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Cd(t)),this.rs(e,r,t,function(e){const t=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,i=Ul.fromTimestamp(1e9===n?new Fl(t+1,0):new Fl(t,n));return new Yl(i,zl.empty(),-1)}(i)).next((e=>e)))}))}ts(e,t){let n=new Zh(function(e){return(t,n)=>{let i=!1;for(const s of vd(e)){const e=Sd(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}(e));return t.forEach(((t,i)=>{Ed(e,i)&&(n=n.add(i))})),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return fl()<=Z.DEBUG&&pl("QueryEngine","Using full collection scan to execute query:",Cd(t)),this.Ji.getDocumentsMatchingQuery(e,t,Yl.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Vg{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new Yh(Ol),this._s=new kd((e=>dd(e)),fd),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yg(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}function qg(e,t,n,i){return new Vg(e,t,n,i)}function jg(e,t){const n=wl(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}class Bg{constructor(){this.activeTargetIds=Vd}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zg{constructor(){this.so=new Bg,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Bg,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Kg{_o(e){}shutdown(){}}class $g{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){pl("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){pl("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Gg=null;function Hg(){return null===Gg?Gg=268435456+Math.round(2147483648*Math.random()):Gg++,"0x"+Gg.toString(16)}const Wg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Qg{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Yg="WebChannelConnection";class Jg extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${n}/databases/${i}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get Fo(){return!1}Mo(e,t,n,i,s){const r=Hg(),o=this.xo(e,t.toUriEncodedString());pl("RestConnection",`Sending RPC '${e}' ${r}:`,o,n);const a={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(a,i,s),this.No(e,o,a,n).then((t=>(pl("RestConnection",`Received RPC '${e}' ${r}: `,t),t)),(t=>{throw ml("RestConnection",`RPC '${e}' ${r} failed with error: `,t,"url: ",o,"request:",n),t}))}Lo(e,t,n,i,s,r){return this.Mo(e,t,n,i,s)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ul,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}xo(e,t){const n=Wg[e];return`${this.Do}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const s=Hg();return new Promise(((r,o)=>{const a=new el;a.setWithCredentials(!0),a.listenOnce(nl.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case il.NO_ERROR:const t=a.getResponseJson();pl(Yg,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),r(t);break;case il.TIMEOUT:pl(Yg,`RPC '${e}' ${s} timed out`),o(new bl(Il.DEADLINE_EXCEEDED,"Request time out"));break;case il.HTTP_ERROR:const n=a.getStatus();if(pl(Yg,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Il).indexOf(t)>=0?t:Il.UNKNOWN}(t.status);o(new bl(e,t.message))}else o(new bl(Il.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new bl(Il.UNAVAILABLE,"Connection failed."));break;default:_l()}}finally{pl(Yg,`RPC '${e}' ${s} completed.`)}}));const c=JSON.stringify(i);pl(Yg,`RPC '${e}' ${s} sending request:`,i),a.send(t,"POST",c,n,15)}))}Bo(e,t,n){const i=Hg(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=al(),o=ol(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Oo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=s.join("");pl(Yg,`Creating RPC '${e}' stream ${i}: ${l}`,a);const h=r.createWebChannel(l,a);let u=!1,d=!1;const f=new Qg({Io:t=>{d?pl(Yg,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(u||(pl(Yg,`Opening RPC '${e}' stream ${i} transport.`),h.open(),u=!0),pl(Yg,`RPC '${e}' stream ${i} sending:`,t),h.send(t))},To:()=>h.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(h,tl.EventType.OPEN,(()=>{d||(pl(Yg,`RPC '${e}' stream ${i} transport opened.`),f.yo())})),p(h,tl.EventType.CLOSE,(()=>{d||(d=!0,pl(Yg,`RPC '${e}' stream ${i} transport closed`),f.So())})),p(h,tl.EventType.ERROR,(t=>{d||(d=!0,ml(Yg,`RPC '${e}' stream ${i} transport errored:`,t),f.So(new bl(Il.UNAVAILABLE,"The operation could not be completed")))})),p(h,tl.EventType.MESSAGE,(t=>{var n;if(!d){const s=t.data[0];vl(!!s);const r=s,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){pl(Yg,`RPC '${e}' stream ${i} received error:`,o);const t=o.status;let n=function(e){const t=yf[e];if(void 0!==t)return function(e){if(void 0===e)return gl("GRPC error has no .code"),Il.UNKNOWN;switch(e){case yf.OK:return Il.OK;case yf.CANCELLED:return Il.CANCELLED;case yf.UNKNOWN:return Il.UNKNOWN;case yf.DEADLINE_EXCEEDED:return Il.DEADLINE_EXCEEDED;case yf.RESOURCE_EXHAUSTED:return Il.RESOURCE_EXHAUSTED;case yf.INTERNAL:return Il.INTERNAL;case yf.UNAVAILABLE:return Il.UNAVAILABLE;case yf.UNAUTHENTICATED:return Il.UNAUTHENTICATED;case yf.INVALID_ARGUMENT:return Il.INVALID_ARGUMENT;case yf.NOT_FOUND:return Il.NOT_FOUND;case yf.ALREADY_EXISTS:return Il.ALREADY_EXISTS;case yf.PERMISSION_DENIED:return Il.PERMISSION_DENIED;case yf.FAILED_PRECONDITION:return Il.FAILED_PRECONDITION;case yf.ABORTED:return Il.ABORTED;case yf.OUT_OF_RANGE:return Il.OUT_OF_RANGE;case yf.UNIMPLEMENTED:return Il.UNIMPLEMENTED;case yf.DATA_LOSS:return Il.DATA_LOSS;default:return _l()}}(t)}(t),s=o.message;void 0===n&&(n=Il.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.So(new bl(n,s)),h.close()}else pl(Yg,`RPC '${e}' stream ${i} received:`,s),f.bo(s)}})),p(o,rl.STAT_EVENT,(t=>{t.stat===sl.PROXY?pl(Yg,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===sl.NOPROXY&&pl(Yg,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.wo()}),0),f}}function Xg(){return"undefined"!=typeof document?document:null}function Zg(e){return new bf(e,!0)}class em{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&pl("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class tm{constructor(e,t,n,i,s,r,o,a){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new em(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===Il.RESOURCE_EXHAUSTED?(gl(t.toString()),gl("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Il.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Yo===t&&this.P_(e,n)}),(t=>{e((()=>{const e=new bl(Il.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)}))}))}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{n((()=>this.listener.Eo()))})),this.stream.Ro((()=>{n((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((e=>{n((()=>this.I_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.e_?this.E_(e):this.onNext(e)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return pl("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(pl("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class nm extends tm{constructor(e,t,n,i,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return vl(!!e.streamToken),this.lastStreamToken=e.streamToken,vl(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){vl(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(vl(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Ef(e.updateTime):Ef(t);return n.isEqual(Ul.min())&&(n=Ef(t)),new Xd(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Ef(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=function(e){return new ql(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Mf(this.serializer,e)))};this.a_(t)}}class im extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new bl(Il.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.Mo(e,kf(t,n),i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Il.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new bl(Il.UNKNOWN,e.toString())}))}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Lo(e,kf(t,n),i,r,o,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Il.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new bl(Il.UNKNOWN,e.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class sm{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(gl(t),this.D_=!1):pl("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class rm{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o((e=>{n.enqueueAndForget((async()=>{cm(this)&&(pl("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=wl(e);t.L_.add(4),await am(t),t.q_.set("Unknown"),t.L_.delete(4),await om(t)}(this))}))})),this.q_=new sm(n,i)}}async function om(e){if(cm(e))for(const t of e.B_)await t(!0)}async function am(e){for(const t of e.B_)await t(!1)}function cm(e){return 0===wl(e).L_.size}async function lm(e,t,n){if(!ah(t))throw t;e.L_.add(1),await am(e),e.q_.set("Offline"),n||(n=()=>function(e){const t=wl(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ur.getLastRemoteSnapshotVersion(e)))}(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{pl("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await om(e)}))}function hm(e,t){return t().catch((n=>lm(e,n,t)))}async function um(e){const t=wl(e),n=wm(t);let i=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;dm(t);)try{const e=await jg(t.localStore,i);if(null===e){0===t.O_.length&&n.o_();break}i=e.batchId,fm(t,e)}catch(s){await lm(t,s)}pm(t)&&gm(t)}function dm(e){return cm(e)&&e.O_.length<10}function fm(e,t){e.O_.push(t);const n=wm(e);n.r_()&&n.V_&&n.m_(t.mutations)}function pm(e){return cm(e)&&!wm(e).n_()&&e.O_.length>0}function gm(e){wm(e).start()}async function mm(e){wm(e).p_()}async function ym(e){const t=wm(e);for(const n of e.O_)t.m_(n.mutations)}async function _m(e,t,n){const i=e.O_.shift(),s=gf.from(i,t,n);await hm(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await um(e)}async function vm(e,t){t&&wm(e).V_&&await async function(e,t){if(function(e){switch(e){default:return _l();case Il.CANCELLED:case Il.UNKNOWN:case Il.DEADLINE_EXCEEDED:case Il.RESOURCE_EXHAUSTED:case Il.INTERNAL:case Il.UNAVAILABLE:case Il.UNAUTHENTICATED:return!1;case Il.INVALID_ARGUMENT:case Il.NOT_FOUND:case Il.ALREADY_EXISTS:case Il.PERMISSION_DENIED:case Il.FAILED_PRECONDITION:case Il.ABORTED:case Il.OUT_OF_RANGE:case Il.UNIMPLEMENTED:case Il.DATA_LOSS:return!0}}(n=t.code)&&n!==Il.ABORTED){const n=e.O_.shift();wm(e).s_(),await hm(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await um(e)}var n}(e,t),pm(e)&&gm(e)}function wm(e){return e.U_||(e.U_=function(e,t,n){const i=wl(e);return i.w_(),new nm(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:mm.bind(null,e),mo:vm.bind(null,e),f_:ym.bind(null,e),g_:_m.bind(null,e)}),e.B_.push((async t=>{t?(e.U_.s_(),await um(e)):(await e.U_.stop(),e.O_.length>0&&(pl("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))}))),e.U_}class Im{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Tl,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,o=new Im(e,t,r,i,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new bl(Il.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class bm{constructor(){this.queries=Tm(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=wl(e),i=n.queries;n.queries=Tm(),i.forEach(((e,n)=>{for(const i of n.j_)i.onError(t)}))}(this,new bl(Il.ABORTED,"Firestore shutting down"))}}function Tm(){return new kd((e=>Td(e)),bd)}var Cm,Em;(Em=Cm||(Cm={})).ea="default",Em.Cache="cache";class Sm{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Ca={},this.Fa=new kd((e=>Td(e)),bd),this.Ma=new Map,this.xa=new Set,this.Oa=new Yh(zl.comparator),this.Na=new Map,this.La=new Ig,this.Ba={},this.ka=new Map,this.qa=Yp.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function km(e,t,n){const i=wl(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Fa.forEach(((n,i)=>{const s=i.view.Z_(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=wl(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const s of n.j_)s.Z_(t)&&(i=!0)})),i&&function(e){e.Y_.forEach((e=>{e.next()}))}(n)}(i.eventManager,t),e.length&&i.Ca.d_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Nm(e,t){const n=wl(e),i=t.batch.batchId;try{const e=await function(e,t){const n=wl(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const i=t.batch.keys(),s=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const s=n.batch,r=s.keys();let o=th.resolve();return r.forEach((e=>{o=o.next((()=>i.getEntry(t,e))).next((t=>{const r=n.docVersions.get(e);vl(null!==r),t.version.compareTo(r)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Ud();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(n.localStore,t);Dm(n,i,null),Am(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Pm(n,e)}catch(s){await eh(s)}}async function xm(e,t,n){const i=wl(e);try{const e=await function(e,t){const n=wl(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(vl(null!==t),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(i.localStore,t);Dm(i,t,n),Am(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await Pm(i,e)}catch(s){await eh(s)}}function Am(e,t){(e.ka.get(t)||[]).forEach((e=>{e.resolve()})),e.ka.delete(t)}function Dm(e,t,n){const i=wl(e);let s=i.Ba[i.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),i.Ba[i.currentUser.toKey()]=s}}async function Pm(e,t,n){const i=wl(e),s=[],r=[],o=[];i.Fa.isEmpty()||(i.Fa.forEach(((e,a)=>{o.push(i.Ka(a,t,n).then((e=>{if((e||n)&&i.isPrimaryClient){const t=e?!e.fromCache:void 0;i.sharedClientState.updateQueryState(a.targetId,t?"current":"not-current")}if(e){s.push(e);const t=Lg.Wi(a.targetId,e);r.push(t)}})))})),await Promise.all(o),i.Ca.d_(s),await async function(e,t){const n=wl(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>th.forEach(t,(t=>th.forEach(t.$i,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>th.forEach(t.Ui,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(i){if(!ah(i))throw i;pl("LocalStore","Failed to update sequence numbers: "+i)}for(const s of t){const e=s.targetId;if(!s.fromCache){const t=n.os.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.os=n.os.insert(e,s)}}}(i.localStore,r))}async function Rm(e,t){const n=wl(e);if(!n.currentUser.isEqual(t)){pl("SyncEngine","User change. New user:",t.toKey());const e=await async function(e,t){const n=wl(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next((s=>(i=s,n.ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const s=[],r=[];let o=Ud();for(const e of i){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({hs:e,removedBatchIds:s,addedBatchIds:r})))}))}))}(n.localStore,t);n.currentUser=t,(i=n).ka.forEach((e=>{e.forEach((e=>{e.reject(new bl(Il.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),i.ka.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Pm(n,e.hs)}var i}function Om(e){const t=wl(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Nm.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=xm.bind(null,t),t}class Mm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Zg(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return qg(this.persistence,new Ug,e.initialUser,this.serializer)}Ga(e){return new kg(xg.Zr,this.serializer)}Wa(e){return new zg}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mm.provider={build:()=>new Mm};class Lm extends Mm{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Om(this.Ja.syncEngine),await um(this.Ja.remoteStore),await this.persistence.yi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}za(e){return qg(this.persistence,new Ug,e.initialUser,this.serializer)}ja(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new ig(n,e.asyncQueue,t)}Ha(e,t){const n=new fh(t,this.persistence);return new dh(e.asyncQueue,n)}Ga(e){const t=function(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Bp.withCacheSize(this.cacheSizeBytes):Bp.DEFAULT;return new Rg(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,"undefined"!=typeof window?window:null,Xg(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new zg}}class Fm{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>km(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Rm.bind(null,this.syncEngine),await async function(e,t){const n=wl(e);t?(n.L_.delete(2),await om(n)):t||(n.L_.add(2),await am(n),n.q_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new bm}createDatastore(e){const t=Zg(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new Jg(i));var i;return function(e,t,n,i){return new im(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,s=e=>km(this.syncEngine,e,0),r=$g.D()?new $g:new Kg,new rm(t,n,i,s,r);var t,n,i,s,r}createSyncEngine(e,t){return function(e,t,n,i,s,r,o){const a=new Sm(e,t,n,i,s,r);return o&&(a.Qa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=wl(e);pl("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await am(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Fm.provider={build:()=>new Fm};class Um{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=hl.UNAUTHENTICATED,this.clientId=Rl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async e=>{pl("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(pl("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Tl;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=function(e,t){if(gl("AsyncQueue",`${t}: ${e}`),ah(e))return new bl(Il.UNAVAILABLE,`${t}: ${e}`);throw e}(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}function Vm(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const qm=new Map;function jm(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new bl(Il.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":_l()}(e);throw new bl(Il.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Bm{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new bl(Il.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new bl(Il.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new bl(Il.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vm(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new bl(Il.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new bl(Il.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new bl(Il.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class zm{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bm({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new bl(Il.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new bl(Il.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bm(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new El;switch(e.type){case"firstParty":return new xl(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new bl(Il.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=qm.get(e);t&&(pl("ComponentProvider","Removing Datastore"),qm.delete(e),t.terminate())}(this),Promise.resolve()}}class Km{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new em(this,"async_queue_retry"),this.Vu=()=>{const e=Xg();e&&pl("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=Xg();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Xg();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new Tl;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ah(e))throw e;pl("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((e=>{throw this.Eu=e,this.du=!1,gl("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e})).then((e=>(this.du=!1,e))))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const i=Im.createAndSchedule(this,e,t,n,(e=>this.yu(e)));return this.Tu.push(i),i}fu(){this.Eu&&_l()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class $m extends zm{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Km,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Km(e),this._firestoreClient=void 0,await e}}}!function(e,t=!0){ul=He,Be(new Q("firestore",((e,{instanceIdentifier:n,options:i})=>{const s=e.getProvider("app").getImmediate(),r=new $m(new kl(e.getProvider("auth-internal")),new Dl(e.getProvider("app-check-internal")),function(e,t){if(!{}.hasOwnProperty.apply(e.options,["projectId"]))throw new bl(Il.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fu(e.options.projectId,t)}(s,n),s);return i=Object.assign({useFetchStreams:t},i),r._setSettings(i),r}),"PUBLIC").setMultipleInstances(!0)),Ye(ll,"4.7.3",e),Ye(ll,"4.7.3","esm2017")}();const Gm="@firebase/installations",Hm="0.6.9",Wm=`w:${Hm}`,Qm="FIS_v2",Ym=new A("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Jm(e){return e instanceof x&&e.code.includes("request-failed")}function Xm({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Zm(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function ey(e,t){const n=(await t.json()).error;return Ym.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ty({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function ny(e){const t=await e();return t.status>=500&&t.status<600?e():t}function iy(e){return new Promise((t=>{setTimeout(t,e)}))}const sy=/^[cdef][\w-]{21}$/;function ry(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return sy.test(t)?t:""}catch(e){return""}}function oy(e){return`${e.appName}!${e.appId}`}const ay=new Map;function cy(e,t){const n=oy(e);ly(n,t),function(e,t){const n=(!hy&&"BroadcastChannel"in self&&(hy=new BroadcastChannel("[Firebase] FID Change"),hy.onmessage=e=>{ly(e.data.key,e.data.fid)}),hy);n&&n.postMessage({key:e,fid:t}),0===ay.size&&hy&&(hy.close(),hy=null)}(n,t)}function ly(e,t){const n=ay.get(e);if(n)for(const i of n)i(t)}let hy=null;const uy="firebase-installations-store";let dy=null;function fy(){return dy||(dy=e("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(uy)}})),dy}async function py(e,t){const n=oy(e),i=(await fy()).transaction(uy,"readwrite"),s=i.objectStore(uy),r=await s.get(n);return await s.put(t,n),await i.done,r&&r.fid===t.fid||cy(e,t.fid),t}async function gy(e){const t=oy(e),n=(await fy()).transaction(uy,"readwrite");await n.objectStore(uy).delete(t),await n.done}async function my(e,t){const n=oy(e),i=(await fy()).transaction(uy,"readwrite"),s=i.objectStore(uy),r=await s.get(n),o=t(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||cy(e,o.fid),o}async function yy(e){let t;const n=await my(e.appConfig,(n=>{const i=function(e){return wy(e||{fid:ry(),registrationStatus:0})}(n),s=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Ym.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=Xm(e),s=ty(e),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={fid:n,authVersion:Qm,appId:e.appId,sdkVersion:Wm},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await ny((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:Zm(e.authToken)}}throw await ey("Create Installation",c)}(e,t);return py(e.appConfig,n)}catch(n){throw Jm(n)&&409===n.customData.serverCode?await gy(e.appConfig):await py(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:_y(e)}:{installationEntry:t}}(e,i);return t=s.registrationPromise,s.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function _y(e){let t=await vy(e.appConfig);for(;1===t.registrationStatus;)await iy(100),t=await vy(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await yy(e);return n||t}return t}function vy(e){return my(e,(e=>{if(!e)throw Ym.create("installation-not-found");return wy(e)}))}function wy(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Iy({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${Xm(e)}/${t}/authTokens:generate`}(e,n),s=function(e,{refreshToken:t}){const n=ty(e);return n.append("Authorization",function(e){return`${Qm} ${e}`}(t)),n}(e,n),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={installation:{sdkVersion:Wm,appId:e.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await ny((()=>fetch(i,a)));if(c.ok)return Zm(await c.json());throw await ey("Generate Auth Token",c)}async function by(e,t=!1){let n;const i=await my(e.appConfig,(i=>{if(!Cy(i))throw Ym.create("not-registered");const s=i.authToken;if(!t&&(2===(r=s).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(r)))return i;var r;if(1===s.requestStatus)return n=async function(e,t){let n=await Ty(e.appConfig);for(;1===n.authToken.requestStatus;)await iy(100),n=await Ty(e.appConfig);const i=n.authToken;return 0===i.requestStatus?by(e,t):i}(e,t),i;{if(!navigator.onLine)throw Ym.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await Iy(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await py(e.appConfig,i),n}catch(n){if(!Jm(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await py(e.appConfig,n)}else await gy(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Ty(e){return my(e,(e=>{if(!Cy(e))throw Ym.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function Cy(e){return void 0!==e&&2===e.registrationStatus}function Ey(e){return Ym.create("missing-app-config-values",{valueName:e})}const Sy="installations";Be(new Q(Sy,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Ey("App Configuration");if(!e.name)throw Ey("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Ey(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:ze(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Be(new Q("installations-internal",(e=>{const t=ze(e.getProvider("app").getImmediate(),Sy).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await yy(t);return i?i.catch(console.error):by(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await yy(e);t&&await t}(n),(await by(n,t)).token}(t,e)}}),"PRIVATE")),Ye(Gm,Hm),Ye(Gm,Hm,"esm2017");const ky="analytics",Ny="https://www.googletagmanager.com/gtag/js",xy=new re("@firebase/analytics"),Ay=new A("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Dy(e){if(!e.startsWith(Ny)){const t=Ay.create("invalid-gtag-resource",{gtagURL:e});return xy.warn(t.message),""}return e}function Py(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Ry=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Oy(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function My(e,t=Ry,n){const{appId:i,apiKey:s,measurementId:r}=e.options;if(!i)throw Ay.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Ay.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Fy;return setTimeout((async()=>{a.abort()}),6e4),Ly({appId:i,apiKey:s,measurementId:r},o,a,t)}async function Ly(e,{throttleEndTimeMillis:t,backoffCount:n},i,s=Ry){var r;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const s=Math.max(t-Date.now(),0),r=setTimeout(n,s);e.addEventListener((()=>{clearTimeout(r),i(Ay.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(c){if(a)return xy.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw c}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,s={method:"GET",headers:Oy(i)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(a){}throw Ay.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return s.deleteThrottleMetadata(o),t}catch(c){const t=c;if(!function(e){if(!(e instanceof x&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(t)){if(s.deleteThrottleMetadata(o),a)return xy.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw c}const l=503===Number(null===(r=null==t?void 0:t.customData)||void 0===r?void 0:r.httpStatus)?H(n,s.intervalMillis,30):H(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return s.setThrottleMetadata(o,h),xy.debug(`Calling attemptFetch again in ${l} millis`),Ly(e,h,i,s)}}class Fy{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}async function Uy(e,t,n,i,s,r,o){var a;const c=My(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&xy.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>xy.error(e))),t.push(c);const l=async function(){if(!k())return xy.warn(Ay.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await N()}catch(e){return xy.warn(Ay.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,u]=await Promise.all([c,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(Ny)&&n.src.includes(e))return n;return null})(r)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:Dy}),i=document.createElement("script"),s=`${Ny}?l=${e}&id=${t}`;i.src=n?null==n?void 0:n.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}(r,h.measurementId),s("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=u&&(d.firebase_id=u),s("config",h.measurementId,d),h.measurementId}class Vy{constructor(e){this.app=e}_delete(){return delete qy[this.app.options.appId],Promise.resolve()}}let qy={},jy=[];const By={};let zy,Ky,$y="dataLayer",Gy=!1;function Hy(e,t,n){!function(){const e=[];if(C()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=Ay.create("invalid-analytics-context",{errorInfo:t});xy.warn(n.message)}}();const i=e.options.appId;if(!i)throw Ay.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Ay.create("no-api-key");xy.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=qy[i])throw Ay.create("already-exists",{id:i});if(!Gy){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}($y);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,s){let r=function(...e){window[i].push(arguments)};return window[s]&&"function"==typeof window[s]&&(r=window[s]),window[s]=function(e,t,n,i){return async function(s,...r){try{if("event"===s){const[i,s]=r;await async function(e,t,n,i,s){try{let r=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const i=await Py(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),s=e&&t[e.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(t)),await Promise.all(r),e("event",i,s||{})}catch(r){xy.error(r)}}(e,t,n,i,s)}else if("config"===s){const[s,o]=r;await async function(e,t,n,i,s,r){const o=i[s];try{if(o)await t[o];else{const e=(await Py(n)).find((e=>e.measurementId===s));e&&await t[e.appId]}}catch(a){xy.error(a)}e("config",s,r)}(e,t,n,i,s,o)}else if("consent"===s){const[t,n]=r;e("consent",t,n)}else if("get"===s){const[t,n,i]=r;e("get",t,n,i)}else if("set"===s){const[t]=r;e("set",t)}else e(s,...r)}catch(o){xy.error(o)}}}(r,e,t,n),{gtagCore:r,wrappedGtag:window[s]}}(qy,jy,By,$y,"gtag");Ky=e,zy=t,Gy=!0}return qy[i]=Uy(e,jy,By,t,zy,$y,n),new Vy(e)}function Wy(e,t,n,i){e=W(e),async function(e,t,n,i,s){if(s&&s.global)e("event",n,i);else{const s=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(Ky,qy[e.app.options.appId],t,n,i).catch((e=>xy.error(e)))}const Qy="@firebase/analytics",Yy="0.10.8";Be(new Q(ky,((e,{options:t})=>Hy(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),Be(new Q("analytics-internal",(function(e){try{const t=e.getProvider(ky).getImmediate();return{logEvent:(e,n,i)=>Wy(t,e,n,i)}}catch(t){throw Ay.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Ye(Qy,Yy),Ye(Qy,Yy,"esm2017");const Jy={apiKey:"AIzaSyDKioWgt_ZH2trYzn-wMTMrQ6-TGIencHY",authDomain:"mini-game-jynx.firebaseapp.com",databaseURL:"https://mini-game-jynx-default-rtdb.firebaseio.com",projectId:"mini-game-jynx",storageBucket:"mini-game-jynx.firebasestorage.app",messagingSenderId:"1050228692405",appId:"1:1050228692405:web:282098ee61e9c88310b5fc"};function Xy(){const e=["apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId"].filter((e=>!Jy[e]||"undefined"===Jy[e]));if(e.length>0)throw new Error(`Missing Firebase configuration: ${e.join(", ")}. Please check .env file exists in both project root and src/ directory. See src/sync-game/docs/04-firebase-setup.md for setup instructions.`);return!0}class Zy{static#e=null;#t=null;#n=null;#i=null;#s=null;#r=null;#o=!1;#a=!1;#c=null;#l=[];#h=[];#u=!1;constructor(){if(Zy.#e)throw new Error("FirebaseService is a singleton. Use getInstance().")}static getInstance(){return Zy.#e||(Zy.#e=new Zy),Zy.#e}async init(){if(!this.#o)try{Xy();const t=(Xy(),Jy);this.#t=We(t),this.#n=Ri(this.#t),this.#i=Hc(this.#t),this.#s=function(e){const t="string"==typeof e?e:"(default)",n=ze("object"==typeof e?e:Qe(),"firestore").getImmediate({identifier:t});if(!n._initialized){const e=y("firestore");e&&function(e,t,n,i={}){var s;const r=(e=jm(e,zm))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==r.host&&r.host!==o&&ml("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=hl.MOCK_USER;else{t=I(i.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const r=i.mockUserToken.sub||i.mockUserToken.user_id;if(!r)throw new bl(Il.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new hl(r)}e._authCredentials=new Sl(new Cl(t,n))}}(n,...e)}return n}(this.#t);try{await function(e){ml("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=e._freezeSettings();return function(e,t,n){if((e=jm(e,$m))._firestoreClient||e._terminated)throw new bl(Il.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new bl(Il.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},function(e){var t,n,i;const s=e._freezeSettings(),r=(o=e._databaseId,a=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",c=e._persistenceKey,new du(o,a,c,(l=s).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Vm(l.experimentalLongPollingOptions),l.useFetchStreams));var o,a,c,l;e._componentsProvider||(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new Um(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e)}(e,Fm.provider,{build:e=>new Lm(e,t.cacheSizeBytes,void 0)}),Promise.resolve()}(this.#s)}catch(e){"failed-precondition"===e.code||e.code}try{this.#r=function(e=Qe()){const t=ze(e=W(e),ky);return t.isInitialized()?t.getImmediate():function(e,t={}){const n=ze(e,ky);if(n.isInitialized()){const e=n.getImmediate();if(V(t,n.getOptions()))return e;throw Ay.create("already-initialized")}return n.initialize({options:t})}(e)}(this.#t)}catch(e){}this.#d(),this.#f(),await this.authenticateAnonymously(),this.#o=!0}catch(e){throw new Error(`Firebase initialization failed: ${e.message}`)}}async authenticateAnonymously(){if(this.#a)return this.#c;try{const e=await async function(e){var t;if(Ke(e.app))return Promise.reject(ft(e));const n=dn(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Sn({user:n.currentUser,providerId:null,operationType:"signIn"});const i=await async function(e){return Nt(e,"POST","/v1/accounts:signUp",Et(e,{returnSecureToken:!0}))}(n),s=await Sn._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(s.user),s}(this.#n);return this.#c=e.user.uid,this.#a=!0,this.#p(),this.logEvent("user_authenticated",{method:"anonymous",timestamp:Date.now()}),this.#c}catch(e){throw new Error(`Authentication failed: ${e.message}`)}}#f(){var e;e=e=>{e?(this.#c=e.uid,this.#a=!0):(this.#c=null,this.#a=!1),this.#l.forEach((t=>{try{t(e)}catch(n){}}))},W(this.#n).onAuthStateChanged(e,undefined,undefined)}#d(){const e=Vc(this.#i,".info/connected");i((async()=>{const{onValue:e}=await Promise.resolve().then((()=>Jc));return{onValue:e}}),void 0).then((({onValue:t})=>{t(e,(e=>{const t=!0===e.val();this.#u=t,this.#h.forEach((e=>{try{e(t)}catch(n){}}))}))}))}#p(){if(!this.#c)return;const e=Vc(this.#i,`active-players/${this.#c}`);i((async()=>{const{set:e,onValue:t}=await Promise.resolve().then((()=>Jc));return{set:e,onValue:t}}),void 0).then((({set:t,onValue:n})=>{const i={name:"Anonymous",lastSeen:Yc(),online:!0};t(e,i),jc(e).set({name:"Anonymous",lastSeen:Yc(),online:!1})}))}onAuthStateChange(e){if("function"!=typeof e)throw new Error("Callback must be a function");this.#l.push(e)}onConnectionStateChange(e){if("function"!=typeof e)throw new Error("Callback must be a function");this.#h.push(e)}getRealtimeDB(){if(!this.#i)throw new Error("Firebase not initialized. Call init() first.");return this.#i}getFirestore(){if(!this.#s)throw new Error("Firebase not initialized. Call init() first.");return this.#s}getAnalytics(){return this.#r}getCurrentUser(){return this.#n?.currentUser?{uid:this.#n.currentUser.uid,isAnonymous:this.#n.currentUser.isAnonymous}:null}getUserId(){return this.#c}isInitialized(){return this.#o}isAuthenticated(){return this.#a}isConnected(){return this.#u}getConnectionState(){return{isConnected:this.#u,isAuthenticated:this.#a,userId:this.#c,lastConnected:Date.now()}}logEvent(e,t={}){if(this.#r)try{Wy(this.#r,e,{...t,timestamp:Date.now()})}catch(n){}}async signOut(){if(this.#n)try{await this.#n.signOut(),this.#a=!1,this.#c=null}catch(e){throw e}}}const e_=Zy.getInstance(),t_=Object.freeze(Object.defineProperty({__proto__:null,default:e_},Symbol.toStringTag,{value:"Module"}));export{t_ as F,i as _};
